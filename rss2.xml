<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>ddanzit</title>
    <link>https://ckck803.github.io/</link>
    
    <atom:link href="https://ckck803.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>개발 노트</description>
    <pubDate>Sun, 04 Jan 2026 05:43:15 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Google Gemini 2.5 Flash 사용 가이드</title>
      <link>https://ckck803.github.io/2026/01/04/ai/llm/gemini-2.5-flash-guide/</link>
      <guid>https://ckck803.github.io/2026/01/04/ai/llm/gemini-2.5-flash-guide/</guid>
      <pubDate>Sat, 03 Jan 2026 15:00:00 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;1-API-키-발급&quot;&gt;&lt;a href=&quot;#1-API-키-발급&quot; class=&quot;headerlink&quot; title=&quot;1. API 키 발급&quot;&gt;&lt;/a&gt;1. API 키 발급&lt;/h2&gt;&lt;h3 id=&quot;Google-AI-Studio에서-API-키-받기&quot;&gt;&lt;a href=&quot;#Google-AI-Studio에서-API-키-받기&quot; class=&quot;headerlink&quot; title=&quot;Google AI Studio에서 API 키 받기&quot;&gt;&lt;/a&gt;Google AI Studio에서 API 키 받기&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://aistudio.google.com/app/apikey&quot;&gt;Google AI Studio&lt;/a&gt; 접속&lt;/li&gt;
&lt;li&gt;Google 계정으로 로그인&lt;/li&gt;
&lt;li&gt;“Get API Key” 또는 “API 키 만들기” 클릭&lt;/li&gt;
&lt;li&gt;새 프로젝트 생성 또는 기존 프로젝트 선택&lt;/li&gt;
&lt;li&gt;API 키 복사 및 안전하게 보관&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/images/ai/ai-studio.png&quot; alt=&quot;구글 AI Studio&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;환경-변수-설정&quot;&gt;&lt;a href=&quot;#환경-변수-설정&quot; class=&quot;headerlink&quot; title=&quot;환경 변수 설정&quot;&gt;&lt;/a&gt;환경 변수 설정&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Linux/macOS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; GOOGLE_API_KEY=&lt;span class=&quot;string&quot;&gt;&amp;#x27;your-api-key-here&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Windows (PowerShell)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$env&lt;/span&gt;:GOOGLE_API_KEY=&lt;span class=&quot;string&quot;&gt;&amp;#x27;your-api-key-here&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# .env 파일 사용 (권장)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;GOOGLE_API_KEY=your-api-key-here&amp;quot;&lt;/span&gt; &amp;gt; .&lt;span class=&quot;built_in&quot;&gt;env&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-Python에서-Gemini-2-5-Flash-사용&quot;&gt;&lt;a href=&quot;#2-Python에서-Gemini-2-5-Flash-사용&quot; class=&quot;headerlink&quot; title=&quot;2. Python에서 Gemini 2.5 Flash 사용&quot;&gt;&lt;/a&gt;2. Python에서 Gemini 2.5 Flash 사용&lt;/h2&gt;&lt;h3 id=&quot;설치&quot;&gt;&lt;a href=&quot;#설치&quot; class=&quot;headerlink&quot; title=&quot;설치&quot;&gt;&lt;/a&gt;설치&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Python 환경 변수 관리&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install python-dotenv &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Python Gemini 플러그인 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install google-generativeai&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;기본-사용법&quot;&gt;&lt;a href=&quot;#기본-사용법&quot; class=&quot;headerlink&quot; title=&quot;기본 사용법&quot;&gt;&lt;/a&gt;기본 사용법&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="1-API-키-발급"><a href="#1-API-키-발급" class="headerlink" title="1. API 키 발급"></a>1. API 키 발급</h2><h3 id="Google-AI-Studio에서-API-키-받기"><a href="#Google-AI-Studio에서-API-키-받기" class="headerlink" title="Google AI Studio에서 API 키 받기"></a>Google AI Studio에서 API 키 받기</h3><ol><li><a href="https://aistudio.google.com/app/apikey">Google AI Studio</a> 접속</li><li>Google 계정으로 로그인</li><li>“Get API Key” 또는 “API 키 만들기” 클릭</li><li>새 프로젝트 생성 또는 기존 프로젝트 선택</li><li>API 키 복사 및 안전하게 보관</li></ol><p><img src="/images/ai/ai-studio.png" alt="구글 AI Studio"></p><h3 id="환경-변수-설정"><a href="#환경-변수-설정" class="headerlink" title="환경 변수 설정"></a>환경 변수 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Linux/macOS</span></span><br><span class="line"><span class="built_in">export</span> GOOGLE_API_KEY=<span class="string">&#x27;your-api-key-here&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows (PowerShell)</span></span><br><span class="line"><span class="variable">$env</span>:GOOGLE_API_KEY=<span class="string">&#x27;your-api-key-here&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .env 파일 사용 (권장)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GOOGLE_API_KEY=your-api-key-here&quot;</span> &gt; .<span class="built_in">env</span></span><br></pre></td></tr></table></figure><h2 id="2-Python에서-Gemini-2-5-Flash-사용"><a href="#2-Python에서-Gemini-2-5-Flash-사용" class="headerlink" title="2. Python에서 Gemini 2.5 Flash 사용"></a>2. Python에서 Gemini 2.5 Flash 사용</h2><h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python 환경 변수 관리</span></span><br><span class="line">pip install python-dotenv </span><br><span class="line"><span class="comment"># Python Gemini 플러그인 설치</span></span><br><span class="line">pip install google-generativeai</span><br></pre></td></tr></table></figure><h3 id="기본-사용법"><a href="#기본-사용법" class="headerlink" title="기본 사용법"></a>기본 사용법</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> gemini</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># API 키 설정</span></span><br><span class="line"></span><br><span class="line">gemini.configure(api_key=os.getenv(<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>))</span><br><span class="line"><span class="comment"># 모델 초기화</span></span><br><span class="line">model = gemini.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 텍스트 생성</span></span><br><span class="line">response = model.generate_content(<span class="string">&#x27;Python으로 간단한 계산기를 만드는 방법을 알려줘&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h3 id="스트리밍-응답"><a href="#스트리밍-응답" class="headerlink" title="스트리밍 응답"></a>스트리밍 응답</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> gemini</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 환경 변수 load</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gemini.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = gemini.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 스트리밍으로 응답 받기</span></span><br><span class="line">response = model.generate_content(</span><br><span class="line">    <span class="string">&#x27;머신러닝의 주요 개념 10가지를 설명해줘&#x27;</span>,</span><br><span class="line">    stream=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> response:</span><br><span class="line">    <span class="built_in">print</span>(chunk.text, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="3-대화-컨텍스트-유지하기"><a href="#3-대화-컨텍스트-유지하기" class="headerlink" title="3. 대화 컨텍스트 유지하기"></a>3. 대화 컨텍스트 유지하기</h2><h3 id="Chat-세션-사용"><a href="#Chat-세션-사용" class="headerlink" title="Chat 세션 사용"></a>Chat 세션 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 채팅 세션 시작</span></span><br><span class="line">chat = model.start_chat(history=[])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 진행</span></span><br><span class="line">response1 = chat.send_message(<span class="string">&#x27;안녕하세요! 파이썬에 대해 알려주세요.&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;답변 1: <span class="subst">&#123;response1.text&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이전 대화를 기억하며 계속 대화</span></span><br><span class="line">response2 = chat.send_message(<span class="string">&#x27;방금 설명한 내용 중 주요 특징 3가지만 요약해줘&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;답변 2: <span class="subst">&#123;response2.text&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 히스토리 확인</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;대화 히스토리:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> message <span class="keyword">in</span> chat.history:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;message.role&#125;</span>: <span class="subst">&#123;message.parts[<span class="number">0</span>].text[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="시스템-프롬프트와-함께-사용"><a href="#시스템-프롬프트와-함께-사용" class="headerlink" title="시스템 프롬프트와 함께 사용"></a>시스템 프롬프트와 함께 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시스템 프롬프트 설정</span></span><br><span class="line">model = genai.GenerativeModel(</span><br><span class="line">    <span class="string">&#x27;gemini-2.5-flash&#x27;</span>,</span><br><span class="line">    system_instruction=<span class="string">&#x27;You are a helpful coding assistant. Always provide code examples with explanations in Korean.&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chat = model.start_chat()</span><br><span class="line"></span><br><span class="line">response = chat.send_message(<span class="string">&#x27;배열을 정렬하는 방법을 알려줘&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 컨텍스트를 유지하며 계속 대화</span></span><br><span class="line">response2 = chat.send_message(<span class="string">&#x27;방금 설명한 방법의 시간 복잡도는?&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response2.text)</span><br></pre></td></tr></table></figure><h3 id="대화-히스토리-초기화-및-관리"><a href="#대화-히스토리-초기화-및-관리" class="headerlink" title="대화 히스토리 초기화 및 관리"></a>대화 히스토리 초기화 및 관리</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeminiChatSession</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name=<span class="string">&#x27;gemini-2.5-flash&#x27;</span>, system_instruction=<span class="literal">None</span></span>):</span><br><span class="line">        genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> system_instruction:</span><br><span class="line">            self.model = genai.GenerativeModel(</span><br><span class="line">                model_name,</span><br><span class="line">                system_instruction=system_instruction</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.model = genai.GenerativeModel(model_name)</span><br><span class="line"></span><br><span class="line">        self.chat = self.model.start_chat(history=[])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message, stream=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;메시지 전송&quot;&quot;&quot;</span></span><br><span class="line">        response = self.chat.send_message(message, stream=stream)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stream:</span><br><span class="line">            <span class="keyword">return</span> response  <span class="comment"># 스트림 객체 반환</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 히스토리 반환&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.chat.history</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 히스토리 초기화&quot;&quot;&quot;</span></span><br><span class="line">        self.chat = self.model.start_chat(history=[])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset_with_history</span>(<span class="params">self, history</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;특정 히스토리로 세션 재설정&quot;&quot;&quot;</span></span><br><span class="line">        self.chat = self.model.start_chat(history=history)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">session = GeminiChatSession(</span><br><span class="line">    system_instruction=<span class="string">&#x27;You are a helpful AI assistant. Answer in Korean.&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(session.send(<span class="string">&#x27;Python의 리스트와 튜플의 차이는?&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n---\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(session.send(<span class="string">&#x27;그럼 언제 튜플을 사용하는게 좋아?&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n---\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 히스토리 확인</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;총 <span class="subst">&#123;<span class="built_in">len</span>(session.get_history())&#125;</span>개의 메시지&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 히스토리 초기화</span></span><br><span class="line">session.clear_history()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;대화가 초기화되었습니다.&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="대화-저장-및-불러오기"><a href="#대화-저장-및-불러오기" class="headerlink" title="대화 저장 및 불러오기"></a>대화 저장 및 불러오기</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> google.generativeai.types <span class="keyword">import</span> content_types</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersistentGeminiChat</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name=<span class="string">&#x27;gemini-2.5-flash&#x27;</span>, session_file=<span class="string">&#x27;gemini_chat.json&#x27;</span></span>):</span><br><span class="line">        genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">        self.model = genai.GenerativeModel(model_name)</span><br><span class="line">        self.session_file = session_file</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 저장된 히스토리 로드</span></span><br><span class="line">        history = self.load_history()</span><br><span class="line">        self.chat = self.model.start_chat(history=history)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;저장된 대화 불러오기&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.session_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                data = json.load(f)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># JSON을 Gemini 히스토리 형식으로 변환</span></span><br><span class="line">            history = []</span><br><span class="line">            <span class="keyword">for</span> msg <span class="keyword">in</span> data:</span><br><span class="line">                history.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;role&#x27;</span>: msg[<span class="string">&#x27;role&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;parts&#x27;</span>: [msg[<span class="string">&#x27;content&#x27;</span>]]</span><br><span class="line">                &#125;)</span><br><span class="line">            <span class="keyword">return</span> history</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 저장&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Gemini 히스토리를 JSON 형식으로 변환</span></span><br><span class="line">        history_data = []</span><br><span class="line">        <span class="keyword">for</span> msg <span class="keyword">in</span> self.chat.history:</span><br><span class="line">            history_data.append(&#123;</span><br><span class="line">                <span class="string">&#x27;role&#x27;</span>: msg.role,</span><br><span class="line">                <span class="string">&#x27;content&#x27;</span>: msg.parts[<span class="number">0</span>].text</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.session_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(history_data, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;메시지 전송 및 자동 저장&quot;&quot;&quot;</span></span><br><span class="line">        response = self.chat.send_message(message)</span><br><span class="line">        self.save_history()</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">chat = PersistentGeminiChat()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(chat.send(<span class="string">&#x27;안녕하세요!&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(chat.send(<span class="string">&#x27;내 이름은 김철수야&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프로그램을 재시작해도 이전 대화가 유지됩니다</span></span><br><span class="line"><span class="comment"># chat2 = PersistentGeminiChat()</span></span><br><span class="line"><span class="comment"># print(chat2.send(&#x27;내 이름이 뭐였지?&#x27;))  # &quot;김철수&quot; 기억</span></span><br></pre></td></tr></table></figure><h2 id="4-이미지와-함께-사용-멀티모달"><a href="#4-이미지와-함께-사용-멀티모달" class="headerlink" title="4. 이미지와 함께 사용 (멀티모달)"></a>4. 이미지와 함께 사용 (멀티모달)</h2><h3 id="이미지-파일-업로드"><a href="#이미지-파일-업로드" class="headerlink" title="이미지 파일 업로드"></a>이미지 파일 업로드</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이미지 로드</span></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&#x27;example.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이미지와 텍스트 함께 전송</span></span><br><span class="line">response = model.generate_content([</span><br><span class="line">    <span class="string">&#x27;이 이미지에 무엇이 보이나요? 자세히 설명해주세요.&#x27;</span>,</span><br><span class="line">    image</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h3 id="URL에서-이미지-사용"><a href="#URL에서-이미지-사용" class="headerlink" title="URL에서 이미지 사용"></a>URL에서 이미지 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># URL에서 이미지 가져오기</span></span><br><span class="line">image_url = <span class="string">&#x27;https://example.com/image.jpg&#x27;</span></span><br><span class="line">response = requests.get(image_url)</span><br><span class="line">image = Image.<span class="built_in">open</span>(BytesIO(response.content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이미지 분석</span></span><br><span class="line">response = model.generate_content([</span><br><span class="line">    <span class="string">&#x27;이 이미지의 주요 객체들을 나열하고 설명해주세요.&#x27;</span>,</span><br><span class="line">    image</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h3 id="여러-이미지-분석"><a href="#여러-이미지-분석" class="headerlink" title="여러 이미지 분석"></a>여러 이미지 분석</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 여러 이미지 로드</span></span><br><span class="line">image1 = Image.<span class="built_in">open</span>(<span class="string">&#x27;before.jpg&#x27;</span>)</span><br><span class="line">image2 = Image.<span class="built_in">open</span>(<span class="string">&#x27;after.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 여러 이미지 비교</span></span><br><span class="line">response = model.generate_content([</span><br><span class="line">    <span class="string">&#x27;두 이미지의 차이점을 분석해주세요.&#x27;</span>,</span><br><span class="line">    image1,</span><br><span class="line">    image2</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h2 id="5-고급-설정"><a href="#5-고급-설정" class="headerlink" title="5. 고급 설정"></a>5. 고급 설정</h2><h3 id="생성-파라미터-조정"><a href="#생성-파라미터-조정" class="headerlink" title="생성 파라미터 조정"></a>생성 파라미터 조정</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 생성 설정</span></span><br><span class="line">generation_config = genai.GenerationConfig(</span><br><span class="line">    temperature=<span class="number">0.9</span>,          <span class="comment"># 창의성 (0.0 ~ 2.0)</span></span><br><span class="line">    top_p=<span class="number">0.95</span>,               <span class="comment"># Nucleus sampling</span></span><br><span class="line">    top_k=<span class="number">40</span>,                 <span class="comment"># Top-k sampling</span></span><br><span class="line">    max_output_tokens=<span class="number">2048</span>,   <span class="comment"># 최대 출력 토큰</span></span><br><span class="line">    stop_sequences=[<span class="string">&#x27;END&#x27;</span>]    <span class="comment"># 중지 시퀀스</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = model.generate_content(</span><br><span class="line">    <span class="string">&#x27;창의적인 단편 소설을 써줘&#x27;</span>,</span><br><span class="line">    generation_config=generation_config</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h3 id="안전-설정"><a href="#안전-설정" class="headerlink" title="안전 설정"></a>안전 설정</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">from</span> google.generativeai.types <span class="keyword">import</span> HarmCategory, HarmBlockThreshold</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 안전 설정</span></span><br><span class="line">safety_settings = &#123;</span><br><span class="line">    HarmCategory.HARM_CATEGORY_HATE_SPEECH: HarmBlockThreshold.BLOCK_NONE,</span><br><span class="line">    HarmCategory.HARM_CATEGORY_HARASSMENT: HarmBlockThreshold.BLOCK_NONE,</span><br><span class="line">    HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,</span><br><span class="line">    HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = model.generate_content(</span><br><span class="line">    <span class="string">&#x27;프롬프트 내용&#x27;</span>,</span><br><span class="line">    safety_settings=safety_settings</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h2 id="6-함수-호출-Function-Calling"><a href="#6-함수-호출-Function-Calling" class="headerlink" title="6. 함수 호출 (Function Calling)"></a>6. 함수 호출 (Function Calling)</h2><h3 id="함수-정의-및-사용"><a href="#함수-정의-및-사용" class="headerlink" title="함수 정의 및 사용"></a>함수 정의 및 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수 정의</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">location: <span class="built_in">str</span>, unit: <span class="built_in">str</span> = <span class="string">&quot;celsius&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;날씨 정보를 가져옵니다.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 실제로는 API 호출</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;location&#125;</span>의 날씨는 맑음, 온도는 20<span class="subst">&#123;unit&#125;</span>입니다.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">operation: <span class="built_in">str</span>, a: <span class="built_in">float</span>, b: <span class="built_in">float</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;계산을 수행합니다.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> operation == <span class="string">&quot;add&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    <span class="keyword">elif</span> operation == <span class="string">&quot;subtract&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> a - b</span><br><span class="line">    <span class="keyword">elif</span> operation == <span class="string">&quot;multiply&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> a * b</span><br><span class="line">    <span class="keyword">elif</span> operation == <span class="string">&quot;divide&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> a / b <span class="keyword">if</span> b != <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;0으로 나눌 수 없습니다&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수를 모델에 등록</span></span><br><span class="line">tools = [get_weather, calculate]</span><br><span class="line"></span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>, tools=tools)</span><br><span class="line">chat = model.start_chat()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수 호출을 포함한 대화</span></span><br><span class="line">response = chat.send_message(<span class="string">&#x27;서울의 날씨가 어때? 그리고 25 곱하기 4는?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수 호출 실행</span></span><br><span class="line"><span class="keyword">for</span> part <span class="keyword">in</span> response.parts:</span><br><span class="line">    <span class="keyword">if</span> fn := part.function_call:</span><br><span class="line">        <span class="comment"># 함수 실행</span></span><br><span class="line">        <span class="keyword">if</span> fn.name == <span class="string">&#x27;get_weather&#x27;</span>:</span><br><span class="line">            result = get_weather(**<span class="built_in">dict</span>(fn.args))</span><br><span class="line">        <span class="keyword">elif</span> fn.name == <span class="string">&#x27;calculate&#x27;</span>:</span><br><span class="line">            result = calculate(**<span class="built_in">dict</span>(fn.args))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;함수 실행: <span class="subst">&#123;fn.name&#125;</span>(<span class="subst">&#123;fn.args&#125;</span>) = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h2 id="7-토큰-수-계산"><a href="#7-토큰-수-계산" class="headerlink" title="7. 토큰 수 계산"></a>7. 토큰 수 계산</h2><h3 id="입력-토큰-수-확인"><a href="#입력-토큰-수-확인" class="headerlink" title="입력 토큰 수 확인"></a>입력 토큰 수 확인</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">prompt = <span class="string">&quot;이것은 토큰 수를 계산하기 위한 예시 텍스트입니다.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 토큰 수 계산</span></span><br><span class="line">token_count = model.count_tokens(prompt)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;토큰 수: <span class="subst">&#123;token_count.total_tokens&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="대화-히스토리-토큰-수"><a href="#대화-히스토리-토큰-수" class="headerlink" title="대화 히스토리 토큰 수"></a>대화 히스토리 토큰 수</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">chat = model.start_chat()</span><br><span class="line">chat.send_message(<span class="string">&#x27;안녕하세요&#x27;</span>)</span><br><span class="line">chat.send_message(<span class="string">&#x27;오늘 날씨가 좋네요&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 대화 토큰 수</span></span><br><span class="line">total_tokens = model.count_tokens(chat.history)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;전체 대화 토큰 수: <span class="subst">&#123;total_tokens.total_tokens&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="8-REST-API-직접-사용"><a href="#8-REST-API-직접-사용" class="headerlink" title="8. REST API 직접 사용"></a>8. REST API 직접 사용</h2><h3 id="cURL-예시"><a href="#cURL-예시" class="headerlink" title="cURL 예시"></a>cURL 예시</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl <span class="string">&quot;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=<span class="variable">$GOOGLE_API_KEY</span>&quot;</span> \</span><br><span class="line">  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;contents&quot;: [&#123;</span></span><br><span class="line"><span class="string">      &quot;parts&quot;: [&#123;</span></span><br><span class="line"><span class="string">        &quot;text&quot;: &quot;Python으로 Hello World를 출력하는 방법을 알려줘&quot;</span></span><br><span class="line"><span class="string">      &#125;]</span></span><br><span class="line"><span class="string">    &#125;]</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Python-requests-사용"><a href="#Python-requests-사용" class="headerlink" title="Python requests 사용"></a>Python requests 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">API_KEY = os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>]</span><br><span class="line">url = <span class="string">f&#x27;https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=<span class="subst">&#123;API_KEY&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;contents&#x27;</span>: [&#123;</span><br><span class="line">        <span class="string">&#x27;parts&#x27;</span>: [&#123;</span><br><span class="line">            <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Python으로 Hello World를 출력하는 방법을 알려줘&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, headers=headers, json=data)</span><br><span class="line">result = response.json()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&#x27;candidates&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;parts&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;text&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="Node-js에서-사용"><a href="#Node-js에서-사용" class="headerlink" title="Node.js에서 사용"></a>Node.js에서 사용</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;node-fetch&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_KEY</span> = process.<span class="property">env</span>.<span class="property">GOOGLE_API_KEY</span>;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=<span class="subst">$&#123;API_KEY&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">generateContent</span>(<span class="params">prompt</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">      <span class="attr">contents</span>: [&#123;</span><br><span class="line">        <span class="attr">parts</span>: [&#123;</span><br><span class="line">          <span class="attr">text</span>: prompt</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">return</span> data.<span class="property">candidates</span>[<span class="number">0</span>].<span class="property">content</span>.<span class="property">parts</span>[<span class="number">0</span>].<span class="property">text</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 사용 예시</span></span><br><span class="line"><span class="title function_">generateContent</span>(<span class="string">&#x27;JavaScript로 배열을 정렬하는 방법&#x27;</span>).<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure><h3 id="대화-컨텍스트-유지-REST-API"><a href="#대화-컨텍스트-유지-REST-API" class="headerlink" title="대화 컨텍스트 유지 (REST API)"></a>대화 컨텍스트 유지 (REST API)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeminiRESTChat</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model=<span class="string">&#x27;gemini-2.5-flash&#x27;</span></span>):</span><br><span class="line">        self.api_key = os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>]</span><br><span class="line">        self.model = model</span><br><span class="line">        self.url = <span class="string">f&#x27;https://generativelanguage.googleapis.com/v1beta/models/<span class="subst">&#123;model&#125;</span>:generateContent?key=<span class="subst">&#123;self.api_key&#125;</span>&#x27;</span></span><br><span class="line">        self.history = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="comment"># 새 메시지 추가</span></span><br><span class="line">        self.history.append(&#123;</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;parts&#x27;</span>: [&#123;<span class="string">&#x27;text&#x27;</span>: text&#125;]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># API 요청</span></span><br><span class="line">        response = requests.post(</span><br><span class="line">            self.url,</span><br><span class="line">            headers=&#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;,</span><br><span class="line">            json=&#123;<span class="string">&#x27;contents&#x27;</span>: self.history&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        result = response.json()</span><br><span class="line">        assistant_message = result[<span class="string">&#x27;candidates&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 응답을 히스토리에 추가</span></span><br><span class="line">        self.history.append(&#123;</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;model&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;parts&#x27;</span>: assistant_message[<span class="string">&#x27;parts&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> assistant_message[<span class="string">&#x27;parts&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear_history</span>(<span class="params">self</span>):</span><br><span class="line">        self.history = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">chat = GeminiRESTChat()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(chat.send_message(<span class="string">&#x27;안녕하세요&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n---\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(chat.send_message(<span class="string">&#x27;방금 내가 뭐라고 말했지?&#x27;</span>))  <span class="comment"># 컨텍스트 유지</span></span><br></pre></td></tr></table></figure><h2 id="9-에러-처리"><a href="#9-에러-처리" class="headerlink" title="9. 에러 처리"></a>9. 에러 처리</h2><h3 id="기본-에러-처리"><a href="#기본-에러-처리" class="headerlink" title="기본 에러 처리"></a>기본 에러 처리</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> google.api_core <span class="keyword">import</span> exceptions</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = model.generate_content(<span class="string">&#x27;테스트 프롬프트&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="keyword">except</span> exceptions.InvalidArgument <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;잘못된 인자: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> exceptions.ResourceExhausted <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;할당량 초과: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> exceptions.PermissionDenied <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;권한 거부: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;에러 발생: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="안전-필터-처리"><a href="#안전-필터-처리" class="headerlink" title="안전 필터 처리"></a>안전 필터 처리</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">response = model.generate_content(<span class="string">&#x27;프롬프트&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 안전 필터로 차단되었는지 확인</span></span><br><span class="line"><span class="keyword">if</span> response.prompt_feedback.block_reason:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;차단됨: <span class="subst">&#123;response.prompt_feedback.block_reason&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><h2 id="10-성능-최적화-팁"><a href="#10-성능-최적화-팁" class="headerlink" title="10. 성능 최적화 팁"></a>10. 성능 최적화 팁</h2><h3 id="배치-처리"><a href="#배치-처리" class="headerlink" title="배치 처리"></a>배치 처리</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line">prompts = [</span><br><span class="line">    <span class="string">&#x27;Python이란?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;JavaScript란?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Go언어란?&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">prompt</span>):</span><br><span class="line">    response = model.generate_content(prompt)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 병렬 처리</span></span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">3</span>) <span class="keyword">as</span> executor:</span><br><span class="line">    results = executor.<span class="built_in">map</span>(generate, prompts)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> prompt, result <span class="keyword">in</span> <span class="built_in">zip</span>(prompts, results):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Q: <span class="subst">&#123;prompt&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;A: <span class="subst">&#123;result[:<span class="number">100</span>]&#125;</span>...\n&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="캐싱-간단한-예시"><a href="#캐싱-간단한-예시" class="headerlink" title="캐싱 (간단한 예시)"></a>캐싱 (간단한 예시)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> google.generativeai <span class="keyword">as</span> genai</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"></span><br><span class="line">genai.configure(api_key=os.environ[<span class="string">&#x27;GOOGLE_API_KEY&#x27;</span>])</span><br><span class="line">model = genai.GenerativeModel(<span class="string">&#x27;gemini-2.5-flash&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">100</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cached_generate</span>(<span class="params">prompt</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;동일한 프롬프트에 대해 캐싱&quot;&quot;&quot;</span></span><br><span class="line">    response = model.generate_content(prompt)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 첫 번째 호출 - API 요청</span></span><br><span class="line">result1 = cached_generate(<span class="string">&#x27;Python이란?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 두 번째 호출 - 캐시에서 반환 (빠름)</span></span><br><span class="line">result2 = cached_generate(<span class="string">&#x27;Python이란?&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result1 == result2)  <span class="comment"># True</span></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/LLM/">LLM</category>
      
      
      <category domain="https://ckck803.github.io/tags/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://ckck803.github.io/tags/Google/">Google</category>
      
      <category domain="https://ckck803.github.io/tags/Gemini/">Gemini</category>
      
      <category domain="https://ckck803.github.io/tags/API/">API</category>
      
      
      <comments>https://ckck803.github.io/2026/01/04/ai/llm/gemini-2.5-flash-guide/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Linux에서 연결된 볼륨 확인하기</title>
      <link>https://ckck803.github.io/2026/01/02/linux/check-disk-volumes/</link>
      <guid>https://ckck803.github.io/2026/01/02/linux/check-disk-volumes/</guid>
      <pubDate>Thu, 01 Jan 2026 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/linux/linux.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;Linux 시스템에서 연결된 디스크와 볼륨을 확인하는 다양한 방법을 소개합니다.&lt;/p&gt;
&lt;h2 id=&quot;1-lsblk-블록-디바이스-목록-확인&quot;&gt;&lt;a href=&quot;#1-lsblk-블록-디바이스-목록-확인&quot; class=&quot;headerlink&quot; title=&quot;1. lsblk - 블록 디바이스 목록 확인&quot;&gt;&lt;/a&gt;1. lsblk - 블록 디바이스 목록 확인&lt;/h2&gt;&lt;p&gt;가장 직관적이고 많이 사용되는 명령어입니다.&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lsblk&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;출력 예시:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sda      8:0    0   50G  0 disk&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;├─sda1   8:1    0    1G  0 part /boot&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└─sda2   8:2    0   49G  0 part /&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sdb      8:16   0  100G  0 disk&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└─sdb1   8:17   0  100G  0 part /data&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;유용한 옵션:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 파일시스템 정보 포함&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lsblk -f&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 상세 정보 출력&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lsblk -a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 특정 디바이스만 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lsblk /dev/sda&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-fdisk-디스크-파티션-확인&quot;&gt;&lt;a href=&quot;#2-fdisk-디스크-파티션-확인&quot; class=&quot;headerlink&quot; title=&quot;2. fdisk - 디스크 파티션 확인&quot;&gt;&lt;/a&gt;2. fdisk - 디스크 파티션 확인&lt;/h2&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/linux/linux.png"></p><p>Linux 시스템에서 연결된 디스크와 볼륨을 확인하는 다양한 방법을 소개합니다.</p><h2 id="1-lsblk-블록-디바이스-목록-확인"><a href="#1-lsblk-블록-디바이스-목록-확인" class="headerlink" title="1. lsblk - 블록 디바이스 목록 확인"></a>1. lsblk - 블록 디바이스 목록 확인</h2><p>가장 직관적이고 많이 사용되는 명령어입니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><p><strong>출력 예시:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   50G  0 disk</span><br><span class="line">├─sda1   8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2   8:2    0   49G  0 part /</span><br><span class="line">sdb      8:16   0  100G  0 disk</span><br><span class="line">└─sdb1   8:17   0  100G  0 part /data</span><br></pre></td></tr></table></figure><p><strong>유용한 옵션:</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 파일시스템 정보 포함</span></span><br><span class="line">lsblk -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 상세 정보 출력</span></span><br><span class="line">lsblk -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디바이스만 확인</span></span><br><span class="line">lsblk /dev/sda</span><br></pre></td></tr></table></figure><h2 id="2-fdisk-디스크-파티션-확인"><a href="#2-fdisk-디스크-파티션-확인" class="headerlink" title="2. fdisk - 디스크 파티션 확인"></a>2. fdisk - 디스크 파티션 확인</h2><p>모든 디스크와 파티션 정보를 표시합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 디스크 목록</span></span><br><span class="line">sudo fdisk -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디스크 정보</span></span><br><span class="line">sudo fdisk -l /dev/sda</span><br></pre></td></tr></table></figure><h2 id="3-df-마운트된-파일시스템-확인"><a href="#3-df-마운트된-파일시스템-확인" class="headerlink" title="3. df - 마운트된 파일시스템 확인"></a>3. df - 마운트된 파일시스템 확인</h2><p>현재 마운트된 파일시스템의 사용량을 확인합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 기본 출력</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일시스템 타입 포함</span></span><br><span class="line"><span class="built_in">df</span> -hT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 타입만 출력</span></span><br><span class="line"><span class="built_in">df</span> -hT -t ext4</span><br></pre></td></tr></table></figure><p><strong>출력 예시:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Filesystem     Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda2      ext4   49G   15G   32G  32% /</span><br><span class="line">/dev/sdb1      xfs   100G   20G   80G  20% /data</span><br></pre></td></tr></table></figure><h2 id="4-mount-마운트-정보-확인"><a href="#4-mount-마운트-정보-확인" class="headerlink" title="4. mount - 마운트 정보 확인"></a>4. mount - 마운트 정보 확인</h2><p>현재 마운트된 모든 파일시스템을 표시합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 마운트 포인트</span></span><br><span class="line">mount</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep과 함께 사용</span></span><br><span class="line">mount | grep /dev/sd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 타입만 확인</span></span><br><span class="line">mount -t ext4</span><br></pre></td></tr></table></figure><h2 id="5-blkid-블록-디바이스-속성-확인"><a href="#5-blkid-블록-디바이스-속성-확인" class="headerlink" title="5. blkid - 블록 디바이스 속성 확인"></a>5. blkid - 블록 디바이스 속성 확인</h2><p>UUID, 파일시스템 타입 등 상세 정보를 확인합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 블록 디바이스</span></span><br><span class="line">sudo blkid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디바이스</span></span><br><span class="line">sudo blkid /dev/sda1</span><br></pre></td></tr></table></figure><p><strong>출력 예시:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/dev/sda1: UUID=&quot;a1b2c3d4-...&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;...&quot;</span><br><span class="line">/dev/sdb1: UUID=&quot;e5f6g7h8-...&quot; TYPE=&quot;xfs&quot; PARTUUID=&quot;...&quot;</span><br></pre></td></tr></table></figure><h2 id="6-parted-파티션-정보-확인"><a href="#6-parted-파티션-정보-확인" class="headerlink" title="6. parted - 파티션 정보 확인"></a>6. parted - 파티션 정보 확인</h2><p>GPT와 MBR 모두 지원하는 고급 파티션 도구입니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 디스크 목록</span></span><br><span class="line">sudo parted -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디스크 정보</span></span><br><span class="line">sudo parted /dev/sda <span class="built_in">print</span></span><br></pre></td></tr></table></figure><h2 id="7-proc-partitions-확인"><a href="#7-proc-partitions-확인" class="headerlink" title="7. &#x2F;proc&#x2F;partitions 확인"></a>7. &#x2F;proc&#x2F;partitions 확인</h2><p>커널이 인식하는 모든 파티션을 확인합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/partitions</span><br></pre></td></tr></table></figure><h2 id="8-lvdisplay-LVM-볼륨-확인"><a href="#8-lvdisplay-LVM-볼륨-확인" class="headerlink" title="8. lvdisplay - LVM 볼륨 확인"></a>8. lvdisplay - LVM 볼륨 확인</h2><p>LVM(Logical Volume Manager)을 사용하는 경우:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 논리 볼륨 목록</span></span><br><span class="line">sudo lvdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 볼륨 그룹 확인</span></span><br><span class="line">sudo vgdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 물리 볼륨 확인</span></span><br><span class="line">sudo pvdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 간단한 요약</span></span><br><span class="line">sudo lvs</span><br><span class="line">sudo vgs</span><br><span class="line">sudo pvs</span><br></pre></td></tr></table></figure><h2 id="9-lshw-하드웨어-정보-확인"><a href="#9-lshw-하드웨어-정보-확인" class="headerlink" title="9. lshw - 하드웨어 정보 확인"></a>9. lshw - 하드웨어 정보 확인</h2><p>디스크 하드웨어 정보를 포함한 전체 시스템 정보를 확인합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 디스크 정보만 출력</span></span><br><span class="line">sudo lshw -class disk -short</span><br><span class="line"></span><br><span class="line"><span class="comment"># 상세 정보</span></span><br><span class="line">sudo lshw -class disk</span><br></pre></td></tr></table></figure><h2 id="10-smartctl-디스크-SMART-정보-확인"><a href="#10-smartctl-디스크-SMART-정보-확인" class="headerlink" title="10. smartctl - 디스크 SMART 정보 확인"></a>10. smartctl - 디스크 SMART 정보 확인</h2><p>디스크의 건강 상태와 상세 정보를 확인합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># smartmontools 설치 필요</span></span><br><span class="line">sudo apt install smartmontools  <span class="comment"># Ubuntu/Debian</span></span><br><span class="line">sudo yum install smartmontools  <span class="comment"># CentOS/RHEL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 디스크 정보 확인</span></span><br><span class="line">sudo smartctl -i /dev/sda</span><br><span class="line"></span><br><span class="line"><span class="comment"># 건강 상태 확인</span></span><br><span class="line">sudo smartctl -H /dev/sda</span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 정보</span></span><br><span class="line">sudo smartctl -a /dev/sda</span><br></pre></td></tr></table></figure><h2 id="실무-활용-예시"><a href="#실무-활용-예시" class="headerlink" title="실무 활용 예시"></a>실무 활용 예시</h2><h3 id="새로-추가된-디스크-확인"><a href="#새로-추가된-디스크-확인" class="headerlink" title="새로 추가된 디스크 확인"></a>새로 추가된 디스크 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 연결 전 블록 디바이스 확인</span></span><br><span class="line">lsblk &gt; before.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디스크 연결 후</span></span><br><span class="line">lsblk &gt; after.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 차이점 확인</span></span><br><span class="line">diff before.txt after.txt</span><br></pre></td></tr></table></figure><h3 id="마운트되지-않은-디스크-찾기"><a href="#마운트되지-않은-디스크-찾기" class="headerlink" title="마운트되지 않은 디스크 찾기"></a>마운트되지 않은 디스크 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 디스크 확인</span></span><br><span class="line">lsblk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 마운트된 디스크만 확인</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 둘을 비교하여 마운트되지 않은 디스크 파악</span></span><br></pre></td></tr></table></figure><h3 id="디스크-상세-정보-한번에-확인"><a href="#디스크-상세-정보-한번에-확인" class="headerlink" title="디스크 상세 정보 한번에 확인"></a>디스크 상세 정보 한번에 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Block Devices ===&quot;</span></span><br><span class="line">lsblk -f</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Disk Usage ===&quot;</span></span><br><span class="line"><span class="built_in">df</span> -hT</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Block Device IDs ===&quot;</span></span><br><span class="line">sudo blkid</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Mount Points ===&quot;</span></span><br><span class="line">mount | grep /dev/sd</span><br></pre></td></tr></table></figure><h2 id="AWS-EC2에서-EBS-볼륨-확인"><a href="#AWS-EC2에서-EBS-볼륨-확인" class="headerlink" title="AWS EC2에서 EBS 볼륨 확인"></a>AWS EC2에서 EBS 볼륨 확인</h2><p>AWS EC2 인스턴스에서 EBS 볼륨을 확인할 때:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 연결된 모든 블록 디바이스</span></span><br><span class="line">lsblk</span><br><span class="line"></span><br><span class="line"><span class="comment"># NVMe 디바이스 확인 (최신 인스턴스 타입)</span></span><br><span class="line"><span class="built_in">ls</span> -l /dev/nvme*</span><br><span class="line"></span><br><span class="line"><span class="comment"># NVMe 디바이스와 EBS 볼륨 ID 매핑</span></span><br><span class="line">sudo nvme id-ctrl -v /dev/nvme1n1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디바이스 이름 확인</span></span><br><span class="line"><span class="built_in">ls</span> -l /dev/disk/by-id/</span><br></pre></td></tr></table></figure><h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><table><thead><tr><th>명령어</th><th>용도</th><th>특징</th></tr></thead><tbody><tr><td><code>lsblk</code></td><td>블록 디바이스 목록</td><td>가장 직관적, 트리 구조</td></tr><tr><td><code>fdisk -l</code></td><td>파티션 정보</td><td>전통적인 방법</td></tr><tr><td><code>df -h</code></td><td>마운트된 디스크 사용량</td><td>사용 가능 공간 확인</td></tr><tr><td><code>mount</code></td><td>마운트 정보</td><td>마운트 옵션 확인</td></tr><tr><td><code>blkid</code></td><td>UUID, 파일시스템</td><td>자동 마운트 설정 시 유용</td></tr><tr><td><code>parted -l</code></td><td>파티션 상세 정보</td><td>GPT 지원</td></tr><tr><td><code>lvs/vgs/pvs</code></td><td>LVM 볼륨</td><td>LVM 환경에서 필수</td></tr></tbody></table><p>일반적으로 <code>lsblk</code> 와 <code>df -h</code> 를 조합하여 사용하면 대부분의 상황에서 충분합니다.</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/DevOps/">DevOps</category>
      
      <category domain="https://ckck803.github.io/categories/DevOps/Linux/">Linux</category>
      
      
      <category domain="https://ckck803.github.io/tags/linux/">linux</category>
      
      
      <comments>https://ckck803.github.io/2026/01/02/linux/check-disk-volumes/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Linux에서 파일과 디렉토리 찾기</title>
      <link>https://ckck803.github.io/2026/01/02/linux/find-files-and-directories/</link>
      <guid>https://ckck803.github.io/2026/01/02/linux/find-files-and-directories/</guid>
      <pubDate>Thu, 01 Jan 2026 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/linux/linux.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;Linux 시스템에서 파일과 디렉토리를 효율적으로 찾는 다양한 방법을 소개합니다.&lt;/p&gt;
&lt;h2 id=&quot;1-find-강력한-파일-검색-명령어&quot;&gt;&lt;a href=&quot;#1-find-강력한-파일-검색-명령어&quot; class=&quot;headerlink&quot; title=&quot;1. find - 강력한 파일 검색 명령어&quot;&gt;&lt;/a&gt;1. find - 강력한 파일 검색 명령어&lt;/h2&gt;&lt;p&gt;가장 강력하고 유연한 파일 검색 도구입니다.&lt;/p&gt;
&lt;h3 id=&quot;기본-사용법&quot;&gt;&lt;a href=&quot;#기본-사용법&quot; class=&quot;headerlink&quot; title=&quot;기본 사용법&quot;&gt;&lt;/a&gt;기본 사용법&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 현재 디렉토리에서 특정 파일명 찾기&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -name &lt;span class=&quot;string&quot;&gt;&amp;quot;filename.txt&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 대소문자 구분 없이 찾기&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -iname &lt;span class=&quot;string&quot;&gt;&amp;quot;filename.txt&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 특정 디렉토리에서 찾기&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find /home/user -name &lt;span class=&quot;string&quot;&gt;&amp;quot;*.log&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;파일-타입으로-찾기&quot;&gt;&lt;a href=&quot;#파일-타입으로-찾기&quot; class=&quot;headerlink&quot; title=&quot;파일 타입으로 찾기&quot;&gt;&lt;/a&gt;파일 타입으로 찾기&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 일반 파일만&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; f -name &lt;span class=&quot;string&quot;&gt;&amp;quot;*.txt&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 디렉토리만&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; d -name &lt;span class=&quot;string&quot;&gt;&amp;quot;backup&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 심볼릭 링크만&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; l&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;파일-크기로-찾기&quot;&gt;&lt;a href=&quot;#파일-크기로-찾기&quot; class=&quot;headerlink&quot; title=&quot;파일 크기로 찾기&quot;&gt;&lt;/a&gt;파일 크기로 찾기&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 100MB보다 큰 파일&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; f -size +100M&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 10KB보다 작은 파일&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; f -size -10k&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 정확히 1GB 파일&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;find . -&lt;span class=&quot;built_in&quot;&gt;type&lt;/span&gt; f -size 1G&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 크기 단위: c(bytes), k(KB), M(MB), G(GB)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/linux/linux.png"></p><p>Linux 시스템에서 파일과 디렉토리를 효율적으로 찾는 다양한 방법을 소개합니다.</p><h2 id="1-find-강력한-파일-검색-명령어"><a href="#1-find-강력한-파일-검색-명령어" class="headerlink" title="1. find - 강력한 파일 검색 명령어"></a>1. find - 강력한 파일 검색 명령어</h2><p>가장 강력하고 유연한 파일 검색 도구입니다.</p><h3 id="기본-사용법"><a href="#기본-사용법" class="headerlink" title="기본 사용법"></a>기본 사용법</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 현재 디렉토리에서 특정 파일명 찾기</span></span><br><span class="line">find . -name <span class="string">&quot;filename.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 대소문자 구분 없이 찾기</span></span><br><span class="line">find . -iname <span class="string">&quot;filename.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디렉토리에서 찾기</span></span><br><span class="line">find /home/user -name <span class="string">&quot;*.log&quot;</span></span><br></pre></td></tr></table></figure><h3 id="파일-타입으로-찾기"><a href="#파일-타입으로-찾기" class="headerlink" title="파일 타입으로 찾기"></a>파일 타입으로 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 일반 파일만</span></span><br><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 디렉토리만</span></span><br><span class="line">find . -<span class="built_in">type</span> d -name <span class="string">&quot;backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 심볼릭 링크만</span></span><br><span class="line">find . -<span class="built_in">type</span> l</span><br></pre></td></tr></table></figure><h3 id="파일-크기로-찾기"><a href="#파일-크기로-찾기" class="headerlink" title="파일 크기로 찾기"></a>파일 크기로 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 100MB보다 큰 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -size +100M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10KB보다 작은 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -size -10k</span><br><span class="line"></span><br><span class="line"><span class="comment"># 정확히 1GB 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -size 1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 크기 단위: c(bytes), k(KB), M(MB), G(GB)</span></span><br></pre></td></tr></table></figure><h3 id="수정-시간으로-찾기"><a href="#수정-시간으로-찾기" class="headerlink" title="수정 시간으로 찾기"></a>수정 시간으로 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 7일 이내 수정된 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -mtime -7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 30일 이전 수정된 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -mtime +30</span><br><span class="line"></span><br><span class="line"><span class="comment"># 24시간 이내 수정된 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -mmin -1440</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최근 1시간 이내</span></span><br><span class="line">find . -<span class="built_in">type</span> f -mmin -60</span><br></pre></td></tr></table></figure><h3 id="권한으로-찾기"><a href="#권한으로-찾기" class="headerlink" title="권한으로 찾기"></a>권한으로 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 특정 권한을 가진 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -perm 0644</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실행 권한이 있는 파일</span></span><br><span class="line">find . -<span class="built_in">type</span> f -perm /111</span><br><span class="line"></span><br><span class="line"><span class="comment"># SUID가 설정된 파일</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h3 id="소유자로-찾기"><a href="#소유자로-찾기" class="headerlink" title="소유자로 찾기"></a>소유자로 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 특정 사용자 소유 파일</span></span><br><span class="line">find . -user username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 그룹 소유 파일</span></span><br><span class="line">find . -group groupname</span><br></pre></td></tr></table></figure><h3 id="찾은-파일에-명령-실행"><a href="#찾은-파일에-명령-실행" class="headerlink" title="찾은 파일에 명령 실행"></a>찾은 파일에 명령 실행</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 찾은 파일 삭제</span></span><br><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span> -<span class="built_in">type</span> f -delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># 찾은 파일에 명령 실행</span></span><br><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 확인 후 실행</span></span><br><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> -<span class="built_in">type</span> f -ok <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 여러 파일을 한번에 처리 (더 빠름)</span></span><br><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; +</span><br></pre></td></tr></table></figure><h3 id="복합-조건"><a href="#복합-조건" class="headerlink" title="복합 조건"></a>복합 조건</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># AND 조건 (기본)</span></span><br><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> -size +1M</span><br><span class="line"></span><br><span class="line"><span class="comment"># OR 조건</span></span><br><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> -o -name <span class="string">&quot;*.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NOT 조건</span></span><br><span class="line">find . -<span class="built_in">type</span> f -not -name <span class="string">&quot;*.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 괄호 사용 (복잡한 조건)</span></span><br><span class="line">find . \( -name <span class="string">&quot;*.txt&quot;</span> -o -name <span class="string">&quot;*.log&quot;</span> \) -size +1M</span><br></pre></td></tr></table></figure><h3 id="실용적인-예시"><a href="#실용적인-예시" class="headerlink" title="실용적인 예시"></a>실용적인 예시</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 빈 파일 찾기</span></span><br><span class="line">find . -<span class="built_in">type</span> f -empty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 빈 디렉토리 찾기</span></span><br><span class="line">find . -<span class="built_in">type</span> d -empty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 확장자를 제외하고 찾기</span></span><br><span class="line">find . -<span class="built_in">type</span> f ! -name <span class="string">&quot;*.git*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 숨김 파일 찾기</span></span><br><span class="line">find . -name <span class="string">&quot;.*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 중복 파일 찾기 (같은 이름)</span></span><br><span class="line">find . -<span class="built_in">type</span> f -<span class="built_in">printf</span> <span class="string">&#x27;%f\n&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최근 수정된 파일 10개</span></span><br><span class="line">find . -<span class="built_in">type</span> f -<span class="built_in">printf</span> <span class="string">&#x27;%T+ %p\n&#x27;</span> | <span class="built_in">sort</span> -r | <span class="built_in">head</span> -10</span><br></pre></td></tr></table></figure><h2 id="2-locate-빠른-파일-검색"><a href="#2-locate-빠른-파일-검색" class="headerlink" title="2. locate - 빠른 파일 검색"></a>2. locate - 빠른 파일 검색</h2><p>데이터베이스를 사용하여 매우 빠르게 파일을 찾습니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># locate 설치</span></span><br><span class="line">sudo apt install mlocate      <span class="comment"># Ubuntu/Debian</span></span><br><span class="line">sudo yum install mlocate      <span class="comment"># CentOS/RHEL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 데이터베이스 업데이트</span></span><br><span class="line">sudo updatedb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일 찾기</span></span><br><span class="line">locate filename.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대소문자 구분 없이</span></span><br><span class="line">locate -i filename.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 정확한 경로만</span></span><br><span class="line">locate -b <span class="string">&#x27;\filename.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 개수 제한</span></span><br><span class="line">locate -l 10 <span class="string">&quot;*.conf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 통계 정보</span></span><br><span class="line">locate -S</span><br></pre></td></tr></table></figure><h2 id="3-grep-파일-내용으로-검색"><a href="#3-grep-파일-내용으로-검색" class="headerlink" title="3. grep - 파일 내용으로 검색"></a>3. grep - 파일 내용으로 검색</h2><p>파일 내용을 검색하여 특정 텍스트를 포함한 파일을 찾습니다.</p><h3 id="기본-사용법-1"><a href="#기본-사용법-1" class="headerlink" title="기본 사용법"></a>기본 사용법</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 단일 파일에서 검색</span></span><br><span class="line">grep <span class="string">&quot;search_text&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 여러 파일에서 검색</span></span><br><span class="line">grep <span class="string">&quot;search_text&quot;</span> *.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 재귀적으로 검색</span></span><br><span class="line">grep -r <span class="string">&quot;search_text&quot;</span> /path/to/dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대소문자 구분 없이</span></span><br><span class="line">grep -i <span class="string">&quot;search_text&quot;</span> file.txt</span><br></pre></td></tr></table></figure><h3 id="유용한-옵션"><a href="#유용한-옵션" class="headerlink" title="유용한 옵션"></a>유용한 옵션</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 파일 이름만 출력</span></span><br><span class="line">grep -l <span class="string">&quot;search_text&quot;</span> *.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일 이름과 줄 번호</span></span><br><span class="line">grep -n <span class="string">&quot;search_text&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 매칭되지 않는 줄</span></span><br><span class="line">grep -v <span class="string">&quot;search_text&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 단어 단위로 매칭</span></span><br><span class="line">grep -w <span class="string">&quot;word&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 앞뒤 줄 포함 (컨텍스트)</span></span><br><span class="line">grep -A 3 -B 3 <span class="string">&quot;search_text&quot;</span> file.txt  <span class="comment"># 앞뒤 3줄</span></span><br><span class="line">grep -C 3 <span class="string">&quot;search_text&quot;</span> file.txt       <span class="comment"># 같은 의미</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 색상 강조</span></span><br><span class="line">grep --color=auto <span class="string">&quot;search_text&quot;</span> file.txt</span><br></pre></td></tr></table></figure><h3 id="정규-표현식"><a href="#정규-표현식" class="headerlink" title="정규 표현식"></a>정규 표현식</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 기본 정규식</span></span><br><span class="line">grep <span class="string">&quot;^start&quot;</span> file.txt        <span class="comment"># 줄 시작</span></span><br><span class="line">grep <span class="string">&quot;end$&quot;</span> file.txt          <span class="comment"># 줄 끝</span></span><br><span class="line">grep <span class="string">&quot;test.*text&quot;</span> file.txt    <span class="comment"># 패턴 매칭</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 확장 정규식</span></span><br><span class="line">grep -E <span class="string">&quot;pattern1|pattern2&quot;</span> file.txt</span><br><span class="line">grep -E <span class="string">&quot;[0-9]&#123;3&#125;-[0-9]&#123;4&#125;&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Perl 정규식</span></span><br><span class="line">grep -P <span class="string">&quot;\d&#123;3&#125;-\d&#123;4&#125;&quot;</span> file.txt</span><br></pre></td></tr></table></figure><h3 id="실용-예시"><a href="#실용-예시" class="headerlink" title="실용 예시"></a>실용 예시</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 에러 로그 찾기</span></span><br><span class="line">grep -r <span class="string">&quot;ERROR&quot;</span> /var/log/</span><br><span class="line"></span><br><span class="line"><span class="comment"># IP 주소 찾기</span></span><br><span class="line">grep -E <span class="string">&quot;[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;&quot;</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 확장자에서만 검색</span></span><br><span class="line">grep -r --include=<span class="string">&quot;*.py&quot;</span> <span class="string">&quot;def function_name&quot;</span> .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 확장자 제외</span></span><br><span class="line">grep -r --exclude=<span class="string">&quot;*.min.js&quot;</span> <span class="string">&quot;search_text&quot;</span> .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디렉토리 제외</span></span><br><span class="line">grep -r --exclude-dir=node_modules <span class="string">&quot;search_text&quot;</span> .</span><br></pre></td></tr></table></figure><h2 id="4-which-실행-파일-경로-찾기"><a href="#4-which-실행-파일-경로-찾기" class="headerlink" title="4. which - 실행 파일 경로 찾기"></a>4. which - 실행 파일 경로 찾기</h2><p>PATH에 있는 실행 파일의 위치를 찾습니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 명령어 위치 찾기</span></span><br><span class="line"><span class="built_in">which</span> python</span><br><span class="line"><span class="built_in">which</span> java</span><br><span class="line"><span class="built_in">which</span> node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 모든 매칭 경로</span></span><br><span class="line"><span class="built_in">which</span> -a python</span><br></pre></td></tr></table></figure><h2 id="5-whereis-바이너리-소스-매뉴얼-찾기"><a href="#5-whereis-바이너리-소스-매뉴얼-찾기" class="headerlink" title="5. whereis - 바이너리, 소스, 매뉴얼 찾기"></a>5. whereis - 바이너리, 소스, 매뉴얼 찾기</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 전체 정보</span></span><br><span class="line">whereis python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 바이너리만</span></span><br><span class="line">whereis -b python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 매뉴얼만</span></span><br><span class="line">whereis -m python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 소스만</span></span><br><span class="line">whereis -s python</span><br></pre></td></tr></table></figure><h2 id="6-type-명령어-타입-확인"><a href="#6-type-명령어-타입-확인" class="headerlink" title="6. type - 명령어 타입 확인"></a>6. type - 명령어 타입 확인</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 명령어가 무엇인지 확인</span></span><br><span class="line"><span class="built_in">type</span> <span class="built_in">ls</span>          <span class="comment"># ls is aliased to `ls --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">type</span> <span class="built_in">cd</span>          <span class="comment"># cd is a shell builtin</span></span><br><span class="line"><span class="built_in">type</span> python      <span class="comment"># python is /usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 모든 정보</span></span><br><span class="line"><span class="built_in">type</span> -a python</span><br></pre></td></tr></table></figure><h2 id="7-fd-현대적인-find-대안"><a href="#7-fd-현대적인-find-대안" class="headerlink" title="7. fd - 현대적인 find 대안"></a>7. fd - 현대적인 find 대안</h2><p>더 빠르고 사용하기 쉬운 find의 대안입니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># fd 설치</span></span><br><span class="line">sudo apt install fd-find      <span class="comment"># Ubuntu/Debian</span></span><br><span class="line">brew install fd               <span class="comment"># macOS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 사용</span></span><br><span class="line">fd pattern</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일 타입 지정</span></span><br><span class="line">fd -t f pattern   <span class="comment"># 파일만</span></span><br><span class="line">fd -t d pattern   <span class="comment"># 디렉토리만</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 숨김 파일 포함</span></span><br><span class="line">fd -H pattern</span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 경로 검색</span></span><br><span class="line">fd -p path/pattern</span><br><span class="line"></span><br><span class="line"><span class="comment"># 확장자로 검색</span></span><br><span class="line">fd -e txt</span><br><span class="line">fd -e <span class="built_in">log</span> -e txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 제외 패턴</span></span><br><span class="line">fd -E node_modules pattern</span><br></pre></td></tr></table></figure><h2 id="8-ripgrep-rg-빠른-grep-대안"><a href="#8-ripgrep-rg-빠른-grep-대안" class="headerlink" title="8. ripgrep (rg) - 빠른 grep 대안"></a>8. ripgrep (rg) - 빠른 grep 대안</h2><p>매우 빠른 코드 검색 도구입니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ripgrep 설치</span></span><br><span class="line">sudo apt install ripgrep      <span class="comment"># Ubuntu/Debian</span></span><br><span class="line">brew install ripgrep          <span class="comment"># macOS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 사용</span></span><br><span class="line">rg <span class="string">&quot;search_text&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 타입만</span></span><br><span class="line">rg -t py <span class="string">&quot;def &quot;</span>           <span class="comment"># Python 파일만</span></span><br><span class="line">rg -t js <span class="string">&quot;function&quot;</span>       <span class="comment"># JavaScript 파일만</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 대소문자 구분 없이</span></span><br><span class="line">rg -i <span class="string">&quot;search_text&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 숨김 파일 포함</span></span><br><span class="line">rg --hidden <span class="string">&quot;search_text&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 디렉토리 제외</span></span><br><span class="line">rg <span class="string">&quot;search_text&quot;</span> -g <span class="string">&#x27;!node_modules&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일 이름만</span></span><br><span class="line">rg -l <span class="string">&quot;search_text&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 통계 정보</span></span><br><span class="line">rg --stats <span class="string">&quot;search_text&quot;</span></span><br></pre></td></tr></table></figure><h2 id="9-tree-디렉토리-구조-시각화"><a href="#9-tree-디렉토리-구조-시각화" class="headerlink" title="9. tree - 디렉토리 구조 시각화"></a>9. tree - 디렉토리 구조 시각화</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tree 설치</span></span><br><span class="line">sudo apt install tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 사용</span></span><br><span class="line">tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 레벨 제한</span></span><br><span class="line">tree -L 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디렉토리만</span></span><br><span class="line">tree -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 숨김 파일 포함</span></span><br><span class="line">tree -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 패턴 매칭</span></span><br><span class="line">tree -P <span class="string">&quot;*.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 패턴 제외</span></span><br><span class="line">tree -I <span class="string">&quot;node_modules|.git&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 크기 표시</span></span><br><span class="line">tree -h</span><br></pre></td></tr></table></figure><h2 id="10-실전-활용-스크립트"><a href="#10-실전-활용-스크립트" class="headerlink" title="10. 실전 활용 스크립트"></a>10. 실전 활용 스크립트</h2><h3 id="대용량-파일-찾기"><a href="#대용량-파일-찾기" class="headerlink" title="대용량 파일 찾기"></a>대용량 파일 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 1GB 이상 파일을 크기순으로 정렬</span></span><br><span class="line">find . -<span class="built_in">type</span> f -size +1G -<span class="built_in">exec</span> <span class="built_in">ls</span> -lh &#123;&#125; \; | awk <span class="string">&#x27;&#123;print $5, $9&#125;&#x27;</span> | <span class="built_in">sort</span> -hr</span><br></pre></td></tr></table></figure><h3 id="오래된-로그-파일-정리"><a href="#오래된-로그-파일-정리" class="headerlink" title="오래된 로그 파일 정리"></a>오래된 로그 파일 정리</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 30일 이상된 .log 파일 삭제</span></span><br><span class="line">find /var/log -name <span class="string">&quot;*.log&quot;</span> -<span class="built_in">type</span> f -mtime +30 -delete</span><br></pre></td></tr></table></figure><h3 id="특정-텍스트를-포함한-파일-찾기"><a href="#특정-텍스트를-포함한-파일-찾기" class="headerlink" title="특정 텍스트를 포함한 파일 찾기"></a>특정 텍스트를 포함한 파일 찾기</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ERROR를 포함한 로그 파일 찾기</span></span><br><span class="line">grep -r <span class="string">&quot;ERROR&quot;</span> /var/log --include=<span class="string">&quot;*.log&quot;</span> -l</span><br></pre></td></tr></table></figure><h3 id="중복-파일-찾기-md5-해시-기반"><a href="#중복-파일-찾기-md5-해시-기반" class="headerlink" title="중복 파일 찾기 (md5 해시 기반)"></a>중복 파일 찾기 (md5 해시 기반)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 현재 디렉토리에서 중복 파일 찾기</span></span><br><span class="line">find . -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">md5sum</span> &#123;&#125; \; | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -w32 -dD</span><br></pre></td></tr></table></figure><h3 id="최근-수정된-파일-모니터링"><a href="#최근-수정된-파일-모니터링" class="headerlink" title="최근 수정된 파일 모니터링"></a>최근 수정된 파일 모니터링</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 최근 5분 이내 수정된 파일</span></span><br><span class="line">find /path/to/watch -<span class="built_in">type</span> f -mmin -5</span><br></pre></td></tr></table></figure><h2 id="성능-비교"><a href="#성능-비교" class="headerlink" title="성능 비교"></a>성능 비교</h2><table><thead><tr><th>도구</th><th>속도</th><th>용도</th><th>설치 필요</th></tr></thead><tbody><tr><td><code>find</code></td><td>보통</td><td>범용적인 파일 검색</td><td>기본 설치</td></tr><tr><td><code>locate</code></td><td>매우 빠름</td><td>파일명 검색</td><td>필요</td></tr><tr><td><code>grep</code></td><td>보통</td><td>파일 내용 검색</td><td>기본 설치</td></tr><tr><td><code>fd</code></td><td>빠름</td><td>현대적인 파일 검색</td><td>필요</td></tr><tr><td><code>rg</code></td><td>매우 빠름</td><td>코드 검색</td><td>필요</td></tr></tbody></table><h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><ul><li><strong>파일명으로 찾기</strong>: <code>find</code>, <code>locate</code>, <code>fd</code></li><li><strong>파일 내용으로 찾기</strong>: <code>grep</code>, <code>rg</code></li><li><strong>실행 파일 찾기</strong>: <code>which</code>, <code>whereis</code>, <code>type</code></li><li><strong>대용량 검색</strong>: <code>locate</code> (사전 인덱싱) 또는 <code>fd</code>, <code>rg</code> (빠른 성능)</li><li><strong>정확한 제어</strong>: <code>find</code> (가장 강력한 옵션)</li></ul><p>일반적으로 **<code>find</code>**와 **<code>grep</code>**을 조합하면 대부분의 검색 작업을 수행할 수 있습니다. 성능이 중요하다면 **<code>fd</code>**와 **<code>rg</code>**를 설치하여 사용하는 것을 추천합니다.</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/DevOps/">DevOps</category>
      
      <category domain="https://ckck803.github.io/categories/DevOps/Linux/">Linux</category>
      
      
      <category domain="https://ckck803.github.io/tags/linux/">linux</category>
      
      <category domain="https://ckck803.github.io/tags/find/">find</category>
      
      <category domain="https://ckck803.github.io/tags/search/">search</category>
      
      <category domain="https://ckck803.github.io/tags/grep/">grep</category>
      
      <category domain="https://ckck803.github.io/tags/locate/">locate</category>
      
      
      <comments>https://ckck803.github.io/2026/01/02/linux/find-files-and-directories/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>스프링부트에서 Ollama 사용하기</title>
      <link>https://ckck803.github.io/2026/01/01/spring/springboot-ollama-integration/</link>
      <guid>https://ckck803.github.io/2026/01/01/spring/springboot-ollama-integration/</guid>
      <pubDate>Wed, 31 Dec 2025 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/ollama.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;스프링부트에서-Ollama-사용하기&quot;&gt;&lt;a href=&quot;#스프링부트에서-Ollama-사용하기&quot; class=&quot;headerlink&quot; title=&quot;스프링부트에서 Ollama 사용하기&quot;&gt;&lt;/a&gt;스프링부트에서 Ollama 사용하기&lt;/h1&gt;&lt;p&gt;스프링부트 애플리케이션에서 Ollama를 통합하여 로컬 LLM을 사용하는 방법을 안내합니다.&lt;/p&gt;
&lt;h2 id=&quot;1-Ollama-서버-준비&quot;&gt;&lt;a href=&quot;#1-Ollama-서버-준비&quot; class=&quot;headerlink&quot; title=&quot;1. Ollama 서버 준비&quot;&gt;&lt;/a&gt;1. Ollama 서버 준비&lt;/h2&gt;&lt;p&gt;먼저 Ollama를 설치하고 모델을 준비합니다.&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Ollama 설치 (macOS/Linux)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -fsSL https://ollama.com/install.sh | sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 모델 다운로드&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ollama pull llama2:13b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Ollama 서버 실행 (기본 포트: 11434)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ollama serve&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-Spring-Boot-프로젝트-설정&quot;&gt;&lt;a href=&quot;#2-Spring-Boot-프로젝트-설정&quot; class=&quot;headerlink&quot; title=&quot;2. Spring Boot 프로젝트 설정&quot;&gt;&lt;/a&gt;2. Spring Boot 프로젝트 설정&lt;/h2&gt;&lt;h3 id=&quot;build-gradle&quot;&gt;&lt;a href=&quot;#build-gradle&quot; class=&quot;headerlink&quot; title=&quot;build.gradle&quot;&gt;&lt;/a&gt;build.gradle&lt;/h3&gt;&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;dependencies&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    implementation &lt;span class=&quot;string&quot;&gt;&amp;#x27;org.springframework.boot:spring-boot-starter-web&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    implementation &lt;span class=&quot;string&quot;&gt;&amp;#x27;org.springframework.boot:spring-boot-starter-webflux&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compileOnly &lt;span class=&quot;string&quot;&gt;&amp;#x27;org.projectlombok:lombok&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    annotationProcessor &lt;span class=&quot;string&quot;&gt;&amp;#x27;org.projectlombok:lombok&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;application-yml&quot;&gt;&lt;a href=&quot;#application-yml&quot; class=&quot;headerlink&quot; title=&quot;application.yml&quot;&gt;&lt;/a&gt;application.yml&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/ollama.png"></p><h1 id="스프링부트에서-Ollama-사용하기"><a href="#스프링부트에서-Ollama-사용하기" class="headerlink" title="스프링부트에서 Ollama 사용하기"></a>스프링부트에서 Ollama 사용하기</h1><p>스프링부트 애플리케이션에서 Ollama를 통합하여 로컬 LLM을 사용하는 방법을 안내합니다.</p><h2 id="1-Ollama-서버-준비"><a href="#1-Ollama-서버-준비" class="headerlink" title="1. Ollama 서버 준비"></a>1. Ollama 서버 준비</h2><p>먼저 Ollama를 설치하고 모델을 준비합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Ollama 설치 (macOS/Linux)</span></span><br><span class="line">curl -fsSL https://ollama.com/install.sh | sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 모델 다운로드</span></span><br><span class="line">ollama pull llama2:13b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ollama 서버 실행 (기본 포트: 11434)</span></span><br><span class="line">ollama serve</span><br></pre></td></tr></table></figure><h2 id="2-Spring-Boot-프로젝트-설정"><a href="#2-Spring-Boot-프로젝트-설정" class="headerlink" title="2. Spring Boot 프로젝트 설정"></a>2. Spring Boot 프로젝트 설정</h2><h3 id="build-gradle"><a href="#build-gradle" class="headerlink" title="build.gradle"></a>build.gradle</h3><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-web&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-webflux&#x27;</span></span><br><span class="line">    compileOnly <span class="string">&#x27;org.projectlombok:lombok&#x27;</span></span><br><span class="line">    annotationProcessor <span class="string">&#x27;org.projectlombok:lombok&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ollama:</span></span><br><span class="line">  <span class="attr">base-url:</span> <span class="string">http://localhost:11434</span></span><br><span class="line">  <span class="attr">model:</span> <span class="string">llama2:13b</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">300</span>  <span class="comment"># seconds</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ollama-demo</span></span><br></pre></td></tr></table></figure><h2 id="3-Ollama-클라이언트-구현"><a href="#3-Ollama-클라이언트-구현" class="headerlink" title="3. Ollama 클라이언트 구현"></a>3. Ollama 클라이언트 구현</h2><h3 id="방법-1-RestTemplate-사용"><a href="#방법-1-RestTemplate-사용" class="headerlink" title="방법 1: RestTemplate 사용"></a>방법 1: RestTemplate 사용</h3><h4 id="OllamaProperties-java"><a href="#OllamaProperties-java" class="headerlink" title="OllamaProperties.java"></a>OllamaProperties.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ollama&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String baseUrl;</span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="keyword">private</span> Integer timeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OllamaRequest-java"><a href="#OllamaRequest-java" class="headerlink" title="OllamaRequest.java"></a>OllamaRequest.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="keyword">private</span> String prompt;</span><br><span class="line">    <span class="keyword">private</span> Boolean stream;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;num_ctx&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer numCtx;  <span class="comment">// context window size</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double temperature;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;num_predict&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer numPredict;  <span class="comment">// max tokens to generate</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OllamaResponse-java"><a href="#OllamaResponse-java" class="headerlink" title="OllamaResponse.java"></a>OllamaResponse.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;created_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean done;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;total_duration&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long totalDuration;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;load_duration&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long loadDuration;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;prompt_eval_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer promptEvalCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;eval_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer evalCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OllamaService-java"><a href="#OllamaService-java" class="headerlink" title="OllamaService.java"></a>OllamaService.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.config.OllamaProperties;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.OllamaRequest;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.OllamaResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.client.RestTemplateBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaProperties ollamaProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OllamaService</span><span class="params">(OllamaProperties ollamaProperties, RestTemplateBuilder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ollamaProperties = ollamaProperties;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = builder</span><br><span class="line">                .setConnectTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">                .setReadTimeout(Duration.ofSeconds(ollamaProperties.getTimeout()))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generate</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> generate(prompt, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generate</span><span class="params">(String prompt, <span class="type">boolean</span> stream)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> ollamaProperties.getBaseUrl() + <span class="string">&quot;/api/generate&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">OllamaRequest</span> <span class="variable">request</span> <span class="operator">=</span> OllamaRequest.builder()</span><br><span class="line">                .model(ollamaProperties.getModel())</span><br><span class="line">                .prompt(prompt)</span><br><span class="line">                .stream(stream)</span><br><span class="line">                .temperature(<span class="number">0.7</span>)</span><br><span class="line">                .numCtx(<span class="number">4096</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        HttpEntity&lt;OllamaRequest&gt; entity = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(request, headers);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Sending request to Ollama: &#123;&#125;&quot;</span>, prompt);</span><br><span class="line"></span><br><span class="line">        <span class="type">OllamaResponse</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.postForObject(</span><br><span class="line">                url,</span><br><span class="line">                entity,</span><br><span class="line">                OllamaResponse.class</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Received response from Ollama in &#123;&#125;ms&quot;</span>,</span><br><span class="line">                    response.getTotalDuration() / <span class="number">1_000_000</span>);</span><br><span class="line">            <span class="keyword">return</span> response.getResponse();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="방법-2-WebClient-사용-비동기"><a href="#방법-2-WebClient-사용-비동기" class="headerlink" title="방법 2: WebClient 사용 (비동기)"></a>방법 2: WebClient 사용 (비동기)</h3><h4 id="OllamaWebClientService-java"><a href="#OllamaWebClientService-java" class="headerlink" title="OllamaWebClientService.java"></a>OllamaWebClientService.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.config.OllamaProperties;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.OllamaRequest;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.OllamaResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaWebClientService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaProperties ollamaProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OllamaWebClientService</span><span class="params">(OllamaProperties ollamaProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ollamaProperties = ollamaProperties;</span><br><span class="line">        <span class="built_in">this</span>.webClient = WebClient.builder()</span><br><span class="line">                .baseUrl(ollamaProperties.getBaseUrl())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">generateAsync</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">OllamaRequest</span> <span class="variable">request</span> <span class="operator">=</span> OllamaRequest.builder()</span><br><span class="line">                .model(ollamaProperties.getModel())</span><br><span class="line">                .prompt(prompt)</span><br><span class="line">                .stream(<span class="literal">false</span>)</span><br><span class="line">                .temperature(<span class="number">0.7</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> webClient.post()</span><br><span class="line">                .uri(<span class="string">&quot;/api/generate&quot;</span>)</span><br><span class="line">                .bodyValue(request)</span><br><span class="line">                .retrieve()</span><br><span class="line">                .bodyToMono(OllamaResponse.class)</span><br><span class="line">                .timeout(Duration.ofSeconds(ollamaProperties.getTimeout()))</span><br><span class="line">                .map(OllamaResponse::getResponse)</span><br><span class="line">                .doOnSuccess(response -&gt; log.info(<span class="string">&quot;Async response received&quot;</span>))</span><br><span class="line">                .doOnError(error -&gt; log.error(<span class="string">&quot;Error during async call&quot;</span>, error));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">generateStream</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">OllamaRequest</span> <span class="variable">request</span> <span class="operator">=</span> OllamaRequest.builder()</span><br><span class="line">                .model(ollamaProperties.getModel())</span><br><span class="line">                .prompt(prompt)</span><br><span class="line">                .stream(<span class="literal">true</span>)</span><br><span class="line">                .temperature(<span class="number">0.7</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> webClient.post()</span><br><span class="line">                .uri(<span class="string">&quot;/api/generate&quot;</span>)</span><br><span class="line">                .bodyValue(request)</span><br><span class="line">                .retrieve()</span><br><span class="line">                .bodyToFlux(OllamaResponse.class)</span><br><span class="line">                .map(OllamaResponse::getResponse)</span><br><span class="line">                .doOnNext(chunk -&gt; log.debug(<span class="string">&quot;Stream chunk received: &#123;&#125;&quot;</span>, chunk));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-REST-컨트롤러-구현"><a href="#4-REST-컨트롤러-구현" class="headerlink" title="4. REST 컨트롤러 구현"></a>4. REST 컨트롤러 구현</h2><h3 id="OllamaController-java"><a href="#OllamaController-java" class="headerlink" title="OllamaController.java"></a>OllamaController.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.service.OllamaService;</span><br><span class="line"><span class="keyword">import</span> com.example.service.OllamaWebClientService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/ollama&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaService ollamaService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaWebClientService ollamaWebClientService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/generate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">generate</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> request.get(<span class="string">&quot;prompt&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;Received prompt: &#123;&#125;&quot;</span>, prompt);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> ollamaService.generate(prompt);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Map.of(<span class="string">&quot;response&quot;</span>, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/generate/async&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Map&lt;String, String&gt;&gt; <span class="title function_">generateAsync</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> request.get(<span class="string">&quot;prompt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ollamaWebClientService.generateAsync(prompt)</span><br><span class="line">                .map(response -&gt; Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/generate/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">generateStream</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> request.get(<span class="string">&quot;prompt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ollamaWebClientService.generateStream(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Chat-API-활용"><a href="#5-Chat-API-활용" class="headerlink" title="5. Chat API 활용"></a>5. Chat API 활용</h2><h3 id="ChatMessage-java"><a href="#ChatMessage-java" class="headerlink" title="ChatMessage.java"></a>ChatMessage.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatMessage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String role;  <span class="comment">// system, user, assistant</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ChatRequest-java"><a href="#ChatRequest-java" class="headerlink" title="ChatRequest.java"></a>ChatRequest.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ChatMessage&gt; messages;</span><br><span class="line">    <span class="keyword">private</span> Boolean stream;</span><br><span class="line">    <span class="keyword">private</span> Double temperature;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ChatResponse-java"><a href="#ChatResponse-java" class="headerlink" title="ChatResponse.java"></a>ChatResponse.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="keyword">private</span> ChatMessage message;</span><br><span class="line">    <span class="keyword">private</span> Boolean done;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;total_duration&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long totalDuration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="OllamaChatService-java"><a href="#OllamaChatService-java" class="headerlink" title="OllamaChatService.java"></a>OllamaChatService.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.config.OllamaProperties;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.ChatMessage;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.ChatRequest;</span><br><span class="line"><span class="keyword">import</span> com.example.dto.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OllamaChatService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaProperties ollamaProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ChatMessage&gt; conversationHistory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(String userMessage)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> ollamaProperties.getBaseUrl() + <span class="string">&quot;/api/chat&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 사용자 메시지 추가</span></span><br><span class="line">        conversationHistory.add(<span class="keyword">new</span> <span class="title class_">ChatMessage</span>(<span class="string">&quot;user&quot;</span>, userMessage));</span><br><span class="line"></span><br><span class="line">        <span class="type">ChatRequest</span> <span class="variable">request</span> <span class="operator">=</span> ChatRequest.builder()</span><br><span class="line">                .model(ollamaProperties.getModel())</span><br><span class="line">                .messages(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(conversationHistory))</span><br><span class="line">                .stream(<span class="literal">false</span>)</span><br><span class="line">                .temperature(<span class="number">0.7</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.postForObject(url, request, ChatResponse.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (response != <span class="literal">null</span> &amp;&amp; response.getMessage() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">assistantMessage</span> <span class="operator">=</span> response.getMessage().getContent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 어시스턴트 응답을 히스토리에 추가</span></span><br><span class="line">            conversationHistory.add(<span class="keyword">new</span> <span class="title class_">ChatMessage</span>(<span class="string">&quot;assistant&quot;</span>, assistantMessage));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> assistantMessage;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearHistory</span><span class="params">()</span> &#123;</span><br><span class="line">        conversationHistory.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSystemPrompt</span><span class="params">(String systemPrompt)</span> &#123;</span><br><span class="line">        conversationHistory.clear();</span><br><span class="line">        conversationHistory.add(<span class="keyword">new</span> <span class="title class_">ChatMessage</span>(<span class="string">&quot;system&quot;</span>, systemPrompt));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-실전-활용-예시"><a href="#6-실전-활용-예시" class="headerlink" title="6. 실전 활용 예시"></a>6. 실전 활용 예시</h2><h3 id="1-텍스트-요약-서비스"><a href="#1-텍스트-요약-서비스" class="headerlink" title="1) 텍스트 요약 서비스"></a>1) 텍스트 요약 서비스</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextSummarizationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaService ollamaService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">summarize</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;다음 텍스트를 3문장으로 요약해주세요:\n\n%s&quot;</span>,</span><br><span class="line">            text</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ollamaService.generate(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-코드-리뷰-서비스"><a href="#2-코드-리뷰-서비스" class="headerlink" title="2) 코드 리뷰 서비스"></a>2) 코드 리뷰 서비스</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeReviewService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaChatService chatService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        chatService.setSystemPrompt(</span><br><span class="line">            <span class="string">&quot;You are an expert code reviewer. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;Analyze the code and provide constructive feedback.&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reviewCode</span><span class="params">(String code, String language)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;Review this %s code:\n\n```%s\n%s\n```&quot;</span>,</span><br><span class="line">            language, language, code</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chatService.chat(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Q-A-챗봇"><a href="#3-Q-A-챗봇" class="headerlink" title="3) Q&amp;A 챗봇"></a>3) Q&amp;A 챗봇</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QnAService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaChatService chatService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;ChatMessage&gt;&gt; userSessions = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">answer</span><span class="params">(String userId, String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 사용자별 세션 관리</span></span><br><span class="line">        <span class="keyword">return</span> chatService.chat(question);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-예외-처리-및-에러-핸들링"><a href="#7-예외-처리-및-에러-핸들링" class="headerlink" title="7. 예외 처리 및 에러 핸들링"></a>7. 예외 처리 및 에러 핸들링</h2><h3 id="GlobalExceptionHandler-java"><a href="#GlobalExceptionHandler-java" class="headerlink" title="GlobalExceptionHandler.java"></a>GlobalExceptionHandler.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.ResourceAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestClientException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(ResourceAccessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">handleTimeout</span><span class="params">(ResourceAccessException ex)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Ollama request timeout&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.REQUEST_TIMEOUT)</span><br><span class="line">                .body(Map.of(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;Request timeout. The model took too long to respond.&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(RestClientException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">handleRestClientException</span><span class="params">(RestClientException ex)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;Error communicating with Ollama&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE)</span><br><span class="line">                .body(Map.of(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;Ollama service is unavailable.&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-테스트"><a href="#8-테스트" class="headerlink" title="8. 테스트"></a>8. 테스트</h2><h3 id="OllamaServiceTest-java"><a href="#OllamaServiceTest-java" class="headerlink" title="OllamaServiceTest.java"></a>OllamaServiceTest.java</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.config.OllamaProperties;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.assertj.core.api.Assertions.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OllamaServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OllamaService ollamaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGenerate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;What is the capital of France?&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> ollamaService.generate(prompt);</span><br><span class="line"></span><br><span class="line">        assertThat(response).isNotNull();</span><br><span class="line">        assertThat(response).containsIgnoringCase(<span class="string">&quot;Paris&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-성능-최적화"><a href="#9-성능-최적화" class="headerlink" title="9. 성능 최적화"></a>9. 성능 최적화</h2><h3 id="Connection-Pool-설정"><a href="#Connection-Pool-설정" class="headerlink" title="Connection Pool 설정"></a>Connection Pool 설정</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">factory</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>();</span><br><span class="line"></span><br><span class="line">        factory.setConnectTimeout(<span class="number">10000</span>);</span><br><span class="line">        factory.setReadTimeout(<span class="number">300000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Connection pool 설정</span></span><br><span class="line">        <span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">connectionManager</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">        connectionManager.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">        connectionManager.setDefaultMaxPerRoute(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">                .setConnectionManager(connectionManager)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        factory.setHttpClient(httpClient);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="캐싱-적용"><a href="#캐싱-적용" class="headerlink" title="캐싱 적용"></a>캐싱 적용</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedOllamaService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OllamaService ollamaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;ollama-responses&quot;, key = &quot;#prompt&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateWithCache</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ollamaService.generate(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-Docker-Compose-설정"><a href="#10-Docker-Compose-설정" class="headerlink" title="10. Docker Compose 설정"></a>10. Docker Compose 설정</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ollama:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ollama/ollama:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;11434:11434&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ollama-data:/root/.ollama</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">              <span class="attr">count:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">capabilities:</span> [<span class="string">gpu</span>]</span><br><span class="line"></span><br><span class="line">  <span class="attr">spring-app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">OLLAMA_BASE_URL=http://ollama:11434</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ollama</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">ollama-data:</span></span><br></pre></td></tr></table></figure><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://github.com/ollama/ollama/blob/main/docs/api.md">Ollama API 문서</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/io.html#io.rest-client">Spring Boot REST Client</a></li><li><a href="https://docs.spring.io/spring-framework/reference/web/webflux.html">Spring WebFlux</a></li></ul><h2 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h2><p>스프링부트에서 Ollama를 사용하면:</p><ul><li>외부 API 비용 없이 로컬에서 LLM 활용 가능</li><li>데이터 프라이버시 보장</li><li>빠른 응답 속도 (네트워크 레이턴시 없음)</li><li>다양한 오픈소스 모델 활용 가능</li></ul><p>다만 충분한 서버 리소스(RAM, GPU)가 필요하므로 운영 환경에서는 리소스 요구사항을 고려해야 합니다.</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Spring/">Spring</category>
      
      
      <category domain="https://ckck803.github.io/tags/Spring-Boot/">Spring Boot</category>
      
      <category domain="https://ckck803.github.io/tags/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://ckck803.github.io/tags/Ollama/">Ollama</category>
      
      <category domain="https://ckck803.github.io/tags/REST-API/">REST API</category>
      
      
      <comments>https://ckck803.github.io/2026/01/01/spring/springboot-ollama-integration/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Ollama를 이용한 GPT OSS 20B 모델 설치 가이드</title>
      <link>https://ckck803.github.io/2026/01/01/ai/ollma/install-gpt-oss-20b/</link>
      <guid>https://ckck803.github.io/2026/01/01/ai/ollma/install-gpt-oss-20b/</guid>
      <pubDate>Wed, 31 Dec 2025 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/ollama.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;Ollama를-이용한-GPT-OSS-20B-모델-설치-가이드&quot;&gt;&lt;a href=&quot;#Ollama를-이용한-GPT-OSS-20B-모델-설치-가이드&quot; class=&quot;headerlink&quot; title=&quot;Ollama를 이용한 GPT OSS 20B 모델 설치 가이드&quot;&gt;&lt;/a&gt;Ollama를 이용한 GPT OSS 20B 모델 설치 가이드&lt;/h1&gt;&lt;p&gt;Ollama를 사용하여 오픈소스 GPT 대규모 언어 모델을 로컬 환경에서 실행하는 방법을 안내합니다.&lt;/p&gt;
&lt;h2 id=&quot;1-Ollama-설치&quot;&gt;&lt;a href=&quot;#1-Ollama-설치&quot; class=&quot;headerlink&quot; title=&quot;1. Ollama 설치&quot;&gt;&lt;/a&gt;1. Ollama 설치&lt;/h2&gt;&lt;h3 id=&quot;macOS-Linux&quot;&gt;&lt;a href=&quot;#macOS-Linux&quot; class=&quot;headerlink&quot; title=&quot;macOS&amp;#x2F;Linux&quot;&gt;&lt;/a&gt;macOS&amp;#x2F;Linux&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -fsSL https://ollama.com/install.sh | sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;Windows&quot;&gt;&lt;a href=&quot;#Windows&quot; class=&quot;headerlink&quot; title=&quot;Windows&quot;&gt;&lt;/a&gt;Windows&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://ollama.com/download&quot;&gt;Ollama 공식 웹사이트&lt;/a&gt;에서 Windows 설치 프로그램을 다운로드하여 설치합니다.&lt;/p&gt;
&lt;h3 id=&quot;설치-확인&quot;&gt;&lt;a href=&quot;#설치-확인&quot; class=&quot;headerlink&quot; title=&quot;설치 확인&quot;&gt;&lt;/a&gt;설치 확인&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ollama --version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/ollama.png"></p><h1 id="Ollama를-이용한-GPT-OSS-20B-모델-설치-가이드"><a href="#Ollama를-이용한-GPT-OSS-20B-모델-설치-가이드" class="headerlink" title="Ollama를 이용한 GPT OSS 20B 모델 설치 가이드"></a>Ollama를 이용한 GPT OSS 20B 모델 설치 가이드</h1><p>Ollama를 사용하여 오픈소스 GPT 대규모 언어 모델을 로컬 환경에서 실행하는 방법을 안내합니다.</p><h2 id="1-Ollama-설치"><a href="#1-Ollama-설치" class="headerlink" title="1. Ollama 설치"></a>1. Ollama 설치</h2><h3 id="macOS-Linux"><a href="#macOS-Linux" class="headerlink" title="macOS&#x2F;Linux"></a>macOS&#x2F;Linux</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://ollama.com/install.sh | sh</span><br></pre></td></tr></table></figure><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p><a href="https://ollama.com/download">Ollama 공식 웹사이트</a>에서 Windows 설치 프로그램을 다운로드하여 설치합니다.</p><h3 id="설치-확인"><a href="#설치-확인" class="headerlink" title="설치 확인"></a>설치 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama --version</span><br></pre></td></tr></table></figure><h2 id="2-사용-가능한-GPT-계열-오픈소스-모델"><a href="#2-사용-가능한-GPT-계열-오픈소스-모델" class="headerlink" title="2. 사용 가능한 GPT 계열 오픈소스 모델"></a>2. 사용 가능한 GPT 계열 오픈소스 모델</h2><p>Ollama에서 사용할 수 있는 주요 GPT 계열 오픈소스 모델:</p><h3 id="GPT-NeoX-기반-모델"><a href="#GPT-NeoX-기반-모델" class="headerlink" title="GPT-NeoX 기반 모델"></a>GPT-NeoX 기반 모델</h3><ul><li><strong>StableLM</strong>: Stability AI의 오픈소스 모델</li><li><strong>Dolly</strong>: Databricks의 instruction-following 모델</li></ul><h3 id="20B-크기-모델-예시"><a href="#20B-크기-모델-예시" class="headerlink" title="20B 크기 모델 예시"></a>20B 크기 모델 예시</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># StableLM 모델 (다양한 크기 제공)</span></span><br><span class="line">ollama pull stablelm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># CodeLlama 34B (20B보다 큰 코드 생성 특화 모델)</span></span><br><span class="line">ollama pull codellama:34b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mixtral 8x7B (MoE 아키텍처)</span></span><br><span class="line">ollama pull mixtral:8x7b</span><br></pre></td></tr></table></figure><h2 id="3-모델-설치-및-실행"><a href="#3-모델-설치-및-실행" class="headerlink" title="3. 모델 설치 및 실행"></a>3. 모델 설치 및 실행</h2><h3 id="기본-설치"><a href="#기본-설치" class="headerlink" title="기본 설치"></a>기본 설치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 20b 모델 다운로드</span></span><br><span class="line">ollama pull gpt-oss:20b</span><br><span class="line"><span class="comment"># 120b 모델 다운로드</span></span><br><span class="line">ollama pull gpt-oss:120b</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">❯ ollama pull gpt-oss:20b</span><br><span class="line">pulling manifest</span><br><span class="line">pulling e7b273f96360: 100% ▕██████████████████████████████████████████████████████████▏  13 GB</span><br><span class="line">pulling fa6710a93d78: 100% ▕██████████████████████████████████████████████████████████▏ 7.2 KB</span><br><span class="line">pulling f60356777647: 100% ▕██████████████████████████████████████████████████████████▏  11 KB</span><br><span class="line">pulling d8ba2f9a17b3: 100% ▕██████████████████████████████████████████████████████████▏   18 B</span><br><span class="line">pulling 776beb3adb23: 100% ▕██████████████████████████████████████████████████████████▏  489 B</span><br><span class="line">verifying sha256 digest</span><br><span class="line">writing manifest</span><br><span class="line">success</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">❯ ollama show gpt-oss:20b</span><br><span class="line">  Model</span><br><span class="line">    architecture        gptoss</span><br><span class="line">    parameters          20.9B</span><br><span class="line">    context length      131072</span><br><span class="line">    embedding length    2880</span><br><span class="line">    quantization        MXFP4</span><br><span class="line"></span><br><span class="line">  Capabilities</span><br><span class="line">    completion</span><br><span class="line">    tools</span><br><span class="line">    thinking</span><br><span class="line"></span><br><span class="line">  Parameters</span><br><span class="line">    temperature    1</span><br><span class="line"></span><br><span class="line">  License</span><br><span class="line">    Apache License</span><br><span class="line">    Version 2.0, January 2004</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h3 id="모델-실행"><a href="#모델-실행" class="headerlink" title="모델 실행"></a>모델 실행</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 대화형 모드로 실행</span></span><br><span class="line">ollama run gpt-oss:20b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프롬프트와 함께 실행</span></span><br><span class="line">ollama run gpt-oss:20b <span class="string">&quot;Explain quantum computing in simple terms&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">❯ ollama run gpt-oss:20b</span><br><span class="line">&gt;&gt;&gt; 안녕</span><br><span class="line">Thinking...</span><br><span class="line">User says <span class="string">&quot;안녕&quot;</span> <span class="built_in">which</span> means <span class="string">&quot;Hi&quot;</span> <span class="keyword">in</span> Korean. The assistant should respond accordingly <span class="keyword">in</span> Korean. We can say <span class="string">&quot;안녕하</span></span><br><span class="line"><span class="string">세요! 어떻게 도와드릴까요?&quot;</span> Or similar. We need to respond appropriately. The instruction: <span class="string">&quot;You are ChatGPT, a</span></span><br><span class="line"><span class="string">large language model trained by OpenAI.&quot;</span> So respond politely. Should I ask a follow-up question? The user just</span><br><span class="line">says hello. We can reply with a friendly greeting and ask <span class="keyword">if</span> there<span class="string">&#x27;s anything they need help with. We&#x27;</span>ll reply <span class="keyword">in</span></span><br><span class="line">Korean. The content must be consistent. So final.</span><br><span class="line">...<span class="keyword">done</span> thinking.</span><br><span class="line"></span><br><span class="line">안녕하세요! 무엇을 도와드릴까요? 😊</span><br></pre></td></tr></table></figure><h2 id="4-커스텀-모델-생성-Modelfile-사용"><a href="#4-커스텀-모델-생성-Modelfile-사용" class="headerlink" title="4. 커스텀 모델 생성 (Modelfile 사용)"></a>4. 커스텀 모델 생성 (Modelfile 사용)</h2><p>20B 급 모델을 커스터마이징하려면 Modelfile을 생성합니다.</p><h3 id="Modelfile-예시"><a href="#Modelfile-예시" class="headerlink" title="Modelfile 예시"></a>Modelfile 예시</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Modelfile</span></span><br><span class="line"><span class="keyword">FROM</span> gpt-oss:<span class="number">20</span>b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 온도 설정 (창의성 조절)</span></span><br><span class="line">PARAMETER temperature <span class="number">0.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 컨텍스트 윈도우 크기</span></span><br><span class="line">PARAMETER num_ctx <span class="number">4096</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 시스템 프롬프트 설정</span></span><br><span class="line">SYSTEM <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">You are a helpful AI assistant specialized in technical documentation and code explanation.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="커스텀-모델-생성-및-실행"><a href="#커스텀-모델-생성-및-실행" class="headerlink" title="커스텀 모델 생성 및 실행"></a>커스텀 모델 생성 및 실행</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모델 생성</span></span><br><span class="line">ollama create my-custom-gpt -f ./Modelfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 생성된 모델 실행</span></span><br><span class="line">ollama run my-custom-gpt</span><br></pre></td></tr></table></figure><h2 id="5-Python에서-Ollama-사용"><a href="#5-Python에서-Ollama-사용" class="headerlink" title="5. Python에서 Ollama 사용"></a>5. Python에서 Ollama 사용</h2><h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install ollama</span><br></pre></td></tr></table></figure><h3 id="코드-예시"><a href="#코드-예시" class="headerlink" title="코드 예시"></a>코드 예시</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># 모델 실행</span></span><br><span class="line">response = ollama.chat(model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>, messages=[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;C++ 로 HelloWorld 를 출력하는 코드를 짜줘&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="스트리밍-응답"><a href="#스트리밍-응답" class="headerlink" title="스트리밍 응답"></a>스트리밍 응답</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line">stream = ollama.chat(</span><br><span class="line">    model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">    messages=[&#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;C++ 로 HelloWorld 를 출력하는 코드를 짜줘&#x27;</span>&#125;],</span><br><span class="line">    stream=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> stream:</span><br><span class="line">    <span class="built_in">print</span>(chunk[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>], end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-대화-컨텍스트-유지하기"><a href="#6-대화-컨텍스트-유지하기" class="headerlink" title="6. 대화 컨텍스트 유지하기"></a>6. 대화 컨텍스트 유지하기</h2><p>Ollama에서 이전 대화를 이어가려면 메시지 히스토리를 관리해야 합니다.</p><h3 id="Python에서-대화-컨텍스트-유지"><a href="#Python에서-대화-컨텍스트-유지" class="headerlink" title="Python에서 대화 컨텍스트 유지"></a>Python에서 대화 컨텍스트 유지</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 히스토리 저장</span></span><br><span class="line">conversation_history = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat_with_context</span>(<span class="params">user_message</span>):</span><br><span class="line">    <span class="comment"># 새 사용자 메시지 추가</span></span><br><span class="line">    conversation_history.append(&#123;</span><br><span class="line">        <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span>: user_message</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 전체 대화 히스토리를 포함하여 요청</span></span><br><span class="line">    response = ollama.chat(</span><br><span class="line">        model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">        messages=conversation_history</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 응답을 히스토리에 추가</span></span><br><span class="line">    conversation_history.append(&#123;</span><br><span class="line">        <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;assistant&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span>: response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line"><span class="built_in">print</span>(chat_with_context(<span class="string">&quot;안녕하세요, 파이썬에 대해 알려주세요.&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(chat_with_context(<span class="string">&quot;방금 설명한 내용 중 주요 특징 3가지만 요약해줘&quot;</span>))  <span class="comment"># 이전 대화 참조</span></span><br></pre></td></tr></table></figure><h3 id="시스템-프롬프트와-함께-사용"><a href="#시스템-프롬프트와-함께-사용" class="headerlink" title="시스템 프롬프트와 함께 사용"></a>시스템 프롬프트와 함께 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시스템 프롬프트로 대화 초기화</span></span><br><span class="line">conversation_history = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;You are a helpful coding assistant. Answer in Korean.&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat_with_system_context</span>(<span class="params">user_message</span>):</span><br><span class="line">    conversation_history.append(&#123;</span><br><span class="line">        <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;content&#x27;</span>: user_message</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    response = ollama.chat(</span><br><span class="line">        model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">        messages=conversation_history</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    conversation_history.append(response[<span class="string">&#x27;message&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="대화-컨텍스트-관리-메모리-제한"><a href="#대화-컨텍스트-관리-메모리-제한" class="headerlink" title="대화 컨텍스트 관리 (메모리 제한)"></a>대화 컨텍스트 관리 (메모리 제한)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line">MAX_HISTORY = <span class="number">10</span>  <span class="comment"># 최근 10개 메시지만 유지</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatSession</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>, system_prompt=<span class="literal">None</span></span>):</span><br><span class="line">        self.model = model</span><br><span class="line">        self.history = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> system_prompt:</span><br><span class="line">            self.history.append(&#123;</span><br><span class="line">                <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;content&#x27;</span>: system_prompt</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">self, user_message</span>):</span><br><span class="line">        <span class="comment"># 사용자 메시지 추가</span></span><br><span class="line">        self.history.append(&#123;</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: user_message</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 히스토리가 너무 길면 오래된 메시지 제거 (시스템 프롬프트는 유지)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.history) &gt; MAX_HISTORY:</span><br><span class="line">            system_messages = [msg <span class="keyword">for</span> msg <span class="keyword">in</span> self.history <span class="keyword">if</span> msg[<span class="string">&#x27;role&#x27;</span>] == <span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">            recent_messages = self.history[-(MAX_HISTORY-<span class="built_in">len</span>(system_messages)):]</span><br><span class="line">            self.history = system_messages + recent_messages</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 응답 생성</span></span><br><span class="line">        response = ollama.chat(</span><br><span class="line">            model=self.model,</span><br><span class="line">            messages=self.history</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 응답 저장</span></span><br><span class="line">        self.history.append(response[<span class="string">&#x27;message&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 히스토리 초기화&quot;&quot;&quot;</span></span><br><span class="line">        system_messages = [msg <span class="keyword">for</span> msg <span class="keyword">in</span> self.history <span class="keyword">if</span> msg[<span class="string">&#x27;role&#x27;</span>] == <span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">        self.history = system_messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">session = ChatSession(</span><br><span class="line">    model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">    system_prompt=<span class="string">&#x27;You are a helpful AI assistant. Answer in Korean.&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;Python의 리스트와 튜플의 차이는?&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;그럼 언제 튜플을 사용하는게 좋아?&quot;</span>))  <span class="comment"># 이전 대화 참조</span></span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;코드 예시 하나만 보여줘&quot;</span>))  <span class="comment"># 계속 이어가기</span></span><br></pre></td></tr></table></figure><h3 id="대화-저장-및-불러오기"><a href="#대화-저장-및-불러오기" class="headerlink" title="대화 저장 및 불러오기"></a>대화 저장 및 불러오기</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersistentChatSession</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>, session_file=<span class="string">&#x27;chat_history.json&#x27;</span></span>):</span><br><span class="line">        self.model = model</span><br><span class="line">        self.session_file = session_file</span><br><span class="line">        self.history = self.load_history()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;저장된 대화 불러오기&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.session_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">return</span> json.load(f)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_history</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 저장&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.session_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(self.history, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">self, user_message</span>):</span><br><span class="line">        self.history.append(&#123;</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: user_message</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        response = ollama.chat(</span><br><span class="line">            model=self.model,</span><br><span class="line">            messages=self.history</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.history.append(response[<span class="string">&#x27;message&#x27;</span>])</span><br><span class="line">        self.save_history()  <span class="comment"># 자동 저장</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">session = PersistentChatSession()</span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;안녕하세요&quot;</span>))</span><br><span class="line"><span class="comment"># 프로그램을 재시작해도 이전 대화가 유지됩니다</span></span><br></pre></td></tr></table></figure><h3 id="대화-컨텍스트-vs-Context-파라미터-비교"><a href="#대화-컨텍스트-vs-Context-파라미터-비교" class="headerlink" title="대화 컨텍스트 vs Context 파라미터 비교"></a>대화 컨텍스트 vs Context 파라미터 비교</h3><p>Ollama에서는 두 가지 방식으로 대화를 이어갈 수 있습니다:</p><h4 id="방법-1-메시지-히스토리-방식-권장"><a href="#방법-1-메시지-히스토리-방식-권장" class="headerlink" title="방법 1: 메시지 히스토리 방식 (권장)"></a>방법 1: 메시지 히스토리 방식 (권장)</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 전체 대화 히스토리를 매번 전송</span></span><br><span class="line">messages = [</span><br><span class="line">    &#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;안녕&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;assistant&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;안녕하세요!&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;role&#x27;</span>: <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;내가 방금 뭐라고 했지?&#x27;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">response = ollama.chat(model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>, messages=messages)</span><br></pre></td></tr></table></figure><h4 id="방법-2-Context-토큰-방식"><a href="#방법-2-Context-토큰-방식" class="headerlink" title="방법 2: Context 토큰 방식"></a>방법 2: Context 토큰 방식</h4><p>Ollama는 이전 응답의 <code>context</code> 토큰을 저장하고 재사용할 수 있습니다:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="comment"># 첫 번째 대화</span></span><br><span class="line">response1 = ollama.generate(</span><br><span class="line">    model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">    prompt=<span class="string">&#x27;안녕&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># context 저장</span></span><br><span class="line">context = response1[<span class="string">&#x27;context&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 두 번째 대화 - context만 전달</span></span><br><span class="line">response2 = ollama.generate(</span><br><span class="line">    model=<span class="string">&#x27;gpt-oss:20b&#x27;</span>,</span><br><span class="line">    prompt=<span class="string">&#x27;내가 방금 뭐라고 했지?&#x27;</span>,</span><br><span class="line">    context=context  <span class="comment"># 이전 대화의 context 재사용</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response2[<span class="string">&#x27;response&#x27;</span>])</span><br></pre></td></tr></table></figure><h4 id="두-방식의-차이점"><a href="#두-방식의-차이점" class="headerlink" title="두 방식의 차이점"></a>두 방식의 차이점</h4><table><thead><tr><th>구분</th><th>메시지 히스토리 방식</th><th>Context 토큰 방식</th></tr></thead><tbody><tr><td><strong>API</strong></td><td><code>ollama.chat()</code></td><td><code>ollama.generate()</code></td></tr><tr><td><strong>전송 데이터</strong></td><td>전체 대화 텍스트</td><td>압축된 토큰 배열</td></tr><tr><td><strong>네트워크 부하</strong></td><td>대화가 길어질수록 증가</td><td>일정 (토큰 크기 고정)</td></tr><tr><td><strong>메모리 효율</strong></td><td>낮음</td><td>높음</td></tr><tr><td><strong>가독성</strong></td><td>높음 (텍스트로 확인 가능)</td><td>낮음 (토큰 ID 배열)</td></tr><tr><td><strong>디버깅</strong></td><td>쉬움</td><td>어려움</td></tr><tr><td><strong>시스템 프롬프트</strong></td><td>지원</td><td>제한적</td></tr></tbody></table><h4 id="Context-방식-실전-예제"><a href="#Context-방식-실전-예제" class="headerlink" title="Context 방식 실전 예제"></a>Context 방식 실전 예제</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ollama</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContextChatSession</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model=<span class="string">&#x27;gpt-oss:20b&#x27;</span></span>):</span><br><span class="line">        self.model = model</span><br><span class="line">        self.context = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">self, prompt</span>):</span><br><span class="line">        response = ollama.generate(</span><br><span class="line">            model=self.model,</span><br><span class="line">            prompt=prompt,</span><br><span class="line">            context=self.context  <span class="comment"># 이전 context 재사용</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 새로운 context 저장</span></span><br><span class="line">        self.context = response[<span class="string">&#x27;context&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&#x27;response&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;대화 리셋&quot;&quot;&quot;</span></span><br><span class="line">        self.context = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예시</span></span><br><span class="line">session = ContextChatSession()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;내 이름은 홍길동이야&quot;</span>))</span><br><span class="line"><span class="comment"># 출력: 안녕하세요, 홍길동님!</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(session.chat(<span class="string">&quot;내 이름이 뭐였지?&quot;</span>))</span><br><span class="line"><span class="comment"># 출력: 홍길동이라고 하셨습니다.</span></span><br></pre></td></tr></table></figure><h4 id="REST-API에서-Context-사용"><a href="#REST-API에서-Context-사용" class="headerlink" title="REST API에서 Context 사용"></a>REST API에서 Context 사용</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 첫 번째 요청</span></span><br><span class="line">curl http://localhost:11434/api/generate -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;model&quot;: &quot;gpt-oss:20b&quot;,</span></span><br><span class="line"><span class="string">  &quot;prompt&quot;: &quot;안녕하세요&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 응답에서 context 추출 (예시)</span></span><br><span class="line"><span class="comment"># &quot;context&quot;: [200006, 17360, 200008, 3575, 553, ...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 두 번째 요청 - context 포함</span></span><br><span class="line">curl http://localhost:11434/api/generate -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;model&quot;: &quot;gpt-oss:20b&quot;,</span></span><br><span class="line"><span class="string">  &quot;prompt&quot;: &quot;내가 방금 뭐라고 했지?&quot;,</span></span><br><span class="line"><span class="string">  &quot;context&quot;: [200006, 17360, 200008, 3575, 553]</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="어떤-방식을-선택해야-할까"><a href="#어떤-방식을-선택해야-할까" class="headerlink" title="어떤 방식을 선택해야 할까?"></a>어떤 방식을 선택해야 할까?</h4><p><strong>메시지 히스토리 방식을 권장하는 경우:</strong></p><ul><li>챗봇, 대화형 애플리케이션</li><li>시스템 프롬프트가 필요한 경우</li><li>대화 내용을 로깅&#x2F;분석해야 하는 경우</li><li>코드 가독성과 유지보수가 중요한 경우</li></ul><p><strong>Context 토큰 방식을 권장하는 경우:</strong></p><ul><li>매우 긴 대화 (수백 번 이상)</li><li>네트워크 대역폭이 제한적인 환경</li><li>빠른 응답 속도가 중요한 경우</li><li>메모리 사용량을 최소화해야 하는 경우</li></ul><blockquote><p><strong>참고</strong>: 실제 성능 차이는 대화 길이에 따라 달라집니다. 짧은 대화(10회 미만)에서는 두 방식의 성능 차이가 거의 없지만, 대화가 길어질수록 Context 방식이 효율적입니다.</p></blockquote><h2 id="7-REST-API-사용"><a href="#7-REST-API-사용" class="headerlink" title="7. REST API 사용"></a>7. REST API 사용</h2><p>Ollama는 기본적으로 <code>http://localhost:11434</code>에서 REST API를 제공합니다.</p><h3 id="cURL-예시"><a href="#cURL-예시" class="headerlink" title="cURL 예시"></a>cURL 예시</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://localhost:11434/api/generate -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;model&quot;: &quot;gpt-oss:20b&quot;,</span></span><br><span class="line"><span class="string">  &quot;prompt&quot;: &quot;What is machine learning?&quot;,</span></span><br><span class="line"><span class="string">  &quot;stream&quot;: false</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gpt-oss:20b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2026-01-01T12:24:28.384219Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;response&quot;</span><span class="punctuation">:</span> <span class="string">&quot;## LLM(대규모 언어 모델, Large Language Model)이란?\n\n### 1️⃣ 정의\n- **LLM**은 수십억~수조 개의 파라미터(가중치)를 갖는 인공지능 모델로, 자연어를 이해하고 생성하는 데 특화되어 있습니다.\n- “대규모”라는 명칭은 주로 **학습 데이터의 규모**와 **모델 파라미터 수**가 기존 NLP 모델보다 훨씬 크다는 점을 강조합니다.\n\n### 2️⃣ 역사와 발전 과정\n| 시기 | 주요 모델 | 핵심 특징 |\n|------|-----------|-----------|\n| 2018 | GPT-1 | Transformer 아키텍처 기반, 117M 파라미터 |\n| 2019 | GPT-2 | 1.5B 파라미터, 다양한 언어 생성 가능 |\n| 2020 | BERT | &quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thinking&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The user: \&quot;LLM 에 대해 설명해줘\&quot; Korean: \&quot;Explain LLM\&quot; They want an explanation about LLM. Likely a high-level overview. Could include definition, architecture, training, use cases, differences between models, scaling laws, challenges, future. Also could be Korean explanation. The user didn&#x27;t specify length, but presumably thorough. Provide explanation in Korean. Provide clear sections: 1. 정의, 2. 역사, 3. 아키텍처, 4. 학습 방법, 5. 활용, 6. 한계, 7. 앞으로의 전망. Also maybe mention GPT-4, Claude, etc. Provide some nuance: LLM vs traditional ML. Provide examples.\n\nLet&#x27;s craft.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;done&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;done_reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stop&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">200006</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">17360</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">200008</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">3575</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">553</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total_duration&quot;</span><span class="punctuation">:</span> <span class="number">29593057458</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;load_duration&quot;</span><span class="punctuation">:</span> <span class="number">151055750</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prompt_eval_count&quot;</span><span class="punctuation">:</span> <span class="number">74</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prompt_eval_duration&quot;</span><span class="punctuation">:</span> <span class="number">184719666</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eval_count&quot;</span><span class="punctuation">:</span> <span class="number">1734</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eval_duration&quot;</span><span class="punctuation">:</span> <span class="number">28871083592</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="스트림-형식으로-받을-경우"><a href="#스트림-형식으로-받을-경우" class="headerlink" title="스트림 형식으로 받을 경우"></a>스트림 형식으로 받을 경우</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://localhost:11434/api/generate -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;model&quot;: &quot;gpt-oss:20b&quot;,</span></span><br><span class="line"><span class="string">  &quot;prompt&quot;: &quot;What is machine learning?&quot;,</span></span><br><span class="line"><span class="string">  &quot;stream&quot;: true</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.026732Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot;The&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.045446Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot; user&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.063421Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot; says&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.082734Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot; \&quot;&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.101733Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot;LL&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;model&quot;</span>:<span class="string">&quot;gpt-oss:20b&quot;</span>,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2026-01-01T12:23:09.120114Z&quot;</span>,<span class="string">&quot;response&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;thinking&quot;</span>:<span class="string">&quot;M&quot;</span>,<span class="string">&quot;done&quot;</span>:<span class="literal">false</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="REST-API로-대화-컨텍스트-유지"><a href="#REST-API로-대화-컨텍스트-유지" class="headerlink" title="REST API로 대화 컨텍스트 유지"></a>REST API로 대화 컨텍스트 유지</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /api/chat 엔드포인트를 사용하여 대화 히스토리 전달</span></span><br><span class="line">curl http://localhost:11434/api/chat -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;model&quot;: &quot;gpt-oss:20b&quot;,</span></span><br><span class="line"><span class="string">  &quot;messages&quot;: [</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;role&quot;: &quot;user&quot;,</span></span><br><span class="line"><span class="string">      &quot;content&quot;: &quot;파이썬이 뭐야?&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;role&quot;: &quot;assistant&quot;,</span></span><br><span class="line"><span class="string">      &quot;content&quot;: &quot;파이썬은 1991년 귀도 반 로섬이 만든 고급 프로그래밍 언어입니다...&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;role&quot;: &quot;user&quot;,</span></span><br><span class="line"><span class="string">      &quot;content&quot;: &quot;방금 말한 내용 중 주요 특징 3가지만 알려줘&quot;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;stream&quot;: false</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="JavaScript-Node-js에서-컨텍스트-유지"><a href="#JavaScript-Node-js에서-컨텍스트-유지" class="headerlink" title="JavaScript&#x2F;Node.js에서 컨텍스트 유지"></a>JavaScript&#x2F;Node.js에서 컨텍스트 유지</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OllamaChat</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">model = <span class="string">&#x27;gpt-oss:20b&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = model;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">apiUrl</span> = <span class="string">&#x27;http://localhost:11434/api/chat&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">chat</span>(<span class="params">userMessage</span>) &#123;</span><br><span class="line">    <span class="comment">// 사용자 메시지 추가</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">role</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: userMessage</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// API 호출</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable language_">this</span>.<span class="property">apiUrl</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="variable language_">this</span>.<span class="property">model</span>,</span><br><span class="line">        <span class="attr">messages</span>: <span class="variable language_">this</span>.<span class="property">messages</span>,</span><br><span class="line">        <span class="attr">stream</span>: <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 응답을 메시지 히스토리에 추가</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span>.<span class="title function_">push</span>(data.<span class="property">message</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">message</span>.<span class="property">content</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 사용 예시</span></span><br><span class="line"><span class="keyword">const</span> chat = <span class="keyword">new</span> <span class="title class_">OllamaChat</span>(<span class="string">&#x27;gpt-oss:20b&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> response1 = <span class="keyword">await</span> chat.<span class="title function_">chat</span>(<span class="string">&#x27;안녕하세요&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> response2 = <span class="keyword">await</span> chat.<span class="title function_">chat</span>(<span class="string">&#x27;방금 내가 뭐라고 말했지?&#x27;</span>);  <span class="comment">// 이전 대화 참조</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response2);</span><br></pre></td></tr></table></figure><h3 id="JavaScript-스트리밍-컨텍스트-유지"><a href="#JavaScript-스트리밍-컨텍스트-유지" class="headerlink" title="JavaScript 스트리밍 컨텍스트 유지"></a>JavaScript 스트리밍 컨텍스트 유지</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StreamingOllamaChat</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">model = <span class="string">&#x27;gpt-oss:20b&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = model;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">apiUrl</span> = <span class="string">&#x27;http://localhost:11434/api/chat&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">streamChat</span>(<span class="params">userMessage, onChunk</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">role</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: userMessage</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable language_">this</span>.<span class="property">apiUrl</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="variable language_">this</span>.<span class="property">model</span>,</span><br><span class="line">        <span class="attr">messages</span>: <span class="variable language_">this</span>.<span class="property">messages</span>,</span><br><span class="line">        <span class="attr">stream</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reader = response.<span class="property">body</span>.<span class="title function_">getReader</span>();</span><br><span class="line">    <span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>();</span><br><span class="line">    <span class="keyword">let</span> assistantMessage = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">      <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> chunk = decoder.<span class="title function_">decode</span>(value);</span><br><span class="line">      <span class="keyword">const</span> lines = chunk.<span class="title function_">split</span>(<span class="string">&#x27;\n&#x27;</span>).<span class="title function_">filter</span>(<span class="function"><span class="params">line</span> =&gt;</span> line.<span class="title function_">trim</span>());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> line <span class="keyword">of</span> lines) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(line);</span><br><span class="line">          <span class="keyword">if</span> (data.<span class="property">message</span>?.<span class="property">content</span>) &#123;</span><br><span class="line">            assistantMessage += data.<span class="property">message</span>.<span class="property">content</span>;</span><br><span class="line">            <span class="title function_">onChunk</span>(data.<span class="property">message</span>.<span class="property">content</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="comment">// JSON 파싱 에러 무시</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 완성된 응답을 히스토리에 추가</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messages</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">role</span>: <span class="string">&#x27;assistant&#x27;</span>,</span><br><span class="line">      <span class="attr">content</span>: assistantMessage</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> assistantMessage;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 사용 예시</span></span><br><span class="line"><span class="keyword">const</span> streamChat = <span class="keyword">new</span> <span class="title class_">StreamingOllamaChat</span>(<span class="string">&#x27;gpt-oss:20b&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> streamChat.<span class="title function_">streamChat</span>(<span class="string">&#x27;안녕하세요&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  process.<span class="property">stdout</span>.<span class="title function_">write</span>(chunk);  <span class="comment">// 실시간 출력</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n---&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> streamChat.<span class="title function_">streamChat</span>(<span class="string">&#x27;방금 인사했던 거 기억해?&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  process.<span class="property">stdout</span>.<span class="title function_">write</span>(chunk);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="8-모델-관리"><a href="#8-모델-관리" class="headerlink" title="8. 모델 관리"></a>8. 모델 관리</h2><h3 id="설치된-모델-목록-확인"><a href="#설치된-모델-목록-확인" class="headerlink" title="설치된 모델 목록 확인"></a>설치된 모델 목록 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama list</span><br></pre></td></tr></table></figure><h3 id="모델-삭제"><a href="#모델-삭제" class="headerlink" title="모델 삭제"></a>모델 삭제</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama <span class="built_in">rm</span> gpt-oss:20b</span><br></pre></td></tr></table></figure><h3 id="실행-중인-모델-확인"><a href="#실행-중인-모델-확인" class="headerlink" title="실행 중인 모델 확인"></a>실행 중인 모델 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ollama ps</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/ollma/">ollma</category>
      
      
      <category domain="https://ckck803.github.io/tags/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://ckck803.github.io/tags/ollama/">ollama</category>
      
      <category domain="https://ckck803.github.io/tags/GPT/">GPT</category>
      
      <category domain="https://ckck803.github.io/tags/%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4/">오픈소스</category>
      
      
      <comments>https://ckck803.github.io/2026/01/01/ai/ollma/install-gpt-oss-20b/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Terraform 이란?</title>
      <link>https://ckck803.github.io/2025/12/31/infra/terraform/</link>
      <guid>https://ckck803.github.io/2025/12/31/infra/terraform/</guid>
      <pubDate>Tue, 30 Dec 2025 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/devops/Terraform.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Terraform-이란&quot;&gt;&lt;a href=&quot;#Terraform-이란&quot; class=&quot;headerlink&quot; title=&quot;Terraform 이란?&quot;&gt;&lt;/a&gt;Terraform 이란?&lt;/h2&gt;&lt;p&gt;Terraform은 HashiCorp에서 개발한 오픈소스 Infrastructure as Code(IaC) 도구입니다. 선언적 구성 언어(HCL - HashiCorp Configuration Language)를 사용하여 클라우드 및 온프레미스 리소스를 안전하고 효율적으로 구축, 변경, 버전 관리할 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;주요-특징&quot;&gt;&lt;a href=&quot;#주요-특징&quot; class=&quot;headerlink&quot; title=&quot;주요 특징&quot;&gt;&lt;/a&gt;주요 특징&lt;/h2&gt;&lt;h3 id=&quot;1-멀티-클라우드-지원&quot;&gt;&lt;a href=&quot;#1-멀티-클라우드-지원&quot; class=&quot;headerlink&quot; title=&quot;1. 멀티 클라우드 지원&quot;&gt;&lt;/a&gt;1. 멀티 클라우드 지원&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;AWS, Azure, GCP, Kubernetes 등 다양한 프로바이더 지원&lt;/li&gt;
&lt;li&gt;700개 이상의 프로바이더 사용 가능&lt;/li&gt;
&lt;li&gt;단일 구성으로 여러 클라우드 관리 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-선언적-구성&quot;&gt;&lt;a href=&quot;#2-선언적-구성&quot; class=&quot;headerlink&quot; title=&quot;2. 선언적 구성&quot;&gt;&lt;/a&gt;2. 선언적 구성&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;원하는 최종 상태를 선언하면 Terraform이 자동으로 실행 계획 수립&lt;/li&gt;
&lt;li&gt;명령형이 아닌 선언형 접근 방식&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-실행-계획-Plan&quot;&gt;&lt;a href=&quot;#3-실행-계획-Plan&quot; class=&quot;headerlink&quot; title=&quot;3. 실행 계획 (Plan)&quot;&gt;&lt;/a&gt;3. 실행 계획 (Plan)&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;변경 사항을 미리 확인 가능&lt;/li&gt;
&lt;li&gt;예상치 못한 변경 방지&lt;/li&gt;
&lt;li&gt;&lt;code&gt;terraform plan&lt;/code&gt; 명령으로 변경 사항 시뮬레이션&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/devops/Terraform.png"></p><h2 id="Terraform-이란"><a href="#Terraform-이란" class="headerlink" title="Terraform 이란?"></a>Terraform 이란?</h2><p>Terraform은 HashiCorp에서 개발한 오픈소스 Infrastructure as Code(IaC) 도구입니다. 선언적 구성 언어(HCL - HashiCorp Configuration Language)를 사용하여 클라우드 및 온프레미스 리소스를 안전하고 효율적으로 구축, 변경, 버전 관리할 수 있습니다.</p><h2 id="주요-특징"><a href="#주요-특징" class="headerlink" title="주요 특징"></a>주요 특징</h2><h3 id="1-멀티-클라우드-지원"><a href="#1-멀티-클라우드-지원" class="headerlink" title="1. 멀티 클라우드 지원"></a>1. 멀티 클라우드 지원</h3><ul><li>AWS, Azure, GCP, Kubernetes 등 다양한 프로바이더 지원</li><li>700개 이상의 프로바이더 사용 가능</li><li>단일 구성으로 여러 클라우드 관리 가능</li></ul><h3 id="2-선언적-구성"><a href="#2-선언적-구성" class="headerlink" title="2. 선언적 구성"></a>2. 선언적 구성</h3><ul><li>원하는 최종 상태를 선언하면 Terraform이 자동으로 실행 계획 수립</li><li>명령형이 아닌 선언형 접근 방식</li></ul><h3 id="3-실행-계획-Plan"><a href="#3-실행-계획-Plan" class="headerlink" title="3. 실행 계획 (Plan)"></a>3. 실행 계획 (Plan)</h3><ul><li>변경 사항을 미리 확인 가능</li><li>예상치 못한 변경 방지</li><li><code>terraform plan</code> 명령으로 변경 사항 시뮬레이션</li></ul><h3 id="4-상태-관리"><a href="#4-상태-관리" class="headerlink" title="4. 상태 관리"></a>4. 상태 관리</h3><ul><li>인프라의 현재 상태를 추적</li><li>원격 상태 저장 지원 (S3, Terraform Cloud 등)</li><li>팀 협업 시 상태 잠금(lock) 기능 제공</li></ul><h3 id="5-리소스-그래프"><a href="#5-리소스-그래프" class="headerlink" title="5. 리소스 그래프"></a>5. 리소스 그래프</h3><ul><li>리소스 간 종속성을 자동으로 파악</li><li>병렬 실행으로 효율성 향상</li><li>올바른 순서로 리소스 생성&#x2F;삭제</li></ul><h2 id="설치-방법"><a href="#설치-방법" class="headerlink" title="설치 방법"></a>설치 방법</h2><h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Homebrew 사용</span></span><br><span class="line">brew tap hashicorp/tap</span><br><span class="line">brew install hashicorp/tap/terraform</span><br><span class="line"></span><br><span class="line"><span class="comment"># 버전 확인</span></span><br><span class="line">terraform version</span><br></pre></td></tr></table></figure><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Debian</span></span><br><span class="line">wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com <span class="subst">$(lsb_release -cs)</span> main&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/hashicorp.list</span><br><span class="line">sudo apt update &amp;&amp; sudo apt install terraform</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS/RHEL</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo</span><br><span class="line">sudo yum -y install terraform</span><br></pre></td></tr></table></figure><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Chocolatey 사용</span></span><br><span class="line">choco install terraform</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 Scoop 사용</span></span><br><span class="line">scoop install terraform</span><br></pre></td></tr></table></figure><h2 id="기본-구조"><a href="#기본-구조" class="headerlink" title="기본 구조"></a>기본 구조</h2><h3 id="프로젝트-구조"><a href="#프로젝트-구조" class="headerlink" title="프로젝트 구조"></a>프로젝트 구조</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">terraform-project/</span><br><span class="line">├── main.tf           # 주요 리소스 정의</span><br><span class="line">├── variables.tf      # 입력 변수 정의</span><br><span class="line">├── outputs.tf        # 출력 값 정의</span><br><span class="line">├── terraform.tfvars  # 변수 값 설정</span><br><span class="line">├── providers.tf      # 프로바이더 설정</span><br><span class="line">└── modules/          # 재사용 가능한 모듈</span><br><span class="line">    ├── vpc/</span><br><span class="line">    ├── ec2/</span><br><span class="line">    └── rds/</span><br></pre></td></tr></table></figure><h3 id="HCL-기본-문법"><a href="#HCL-기본-문법" class="headerlink" title="HCL 기본 문법"></a>HCL 기본 문법</h3><h4 id="1-프로바이더-설정"><a href="#1-프로바이더-설정" class="headerlink" title="1. 프로바이더 설정"></a>1. 프로바이더 설정</h4><figure class="highlight plaintext"><figcaption><span>providers.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_version = &quot;&gt;= 1.0&quot;</span><br><span class="line"></span><br><span class="line">  required_providers &#123;</span><br><span class="line">    aws = &#123;</span><br><span class="line">      source  = &quot;hashicorp/aws&quot;</span><br><span class="line">      version = &quot;~&gt; 5.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  backend &quot;s3&quot; &#123;</span><br><span class="line">    bucket         = &quot;my-terraform-state&quot;</span><br><span class="line">    key            = &quot;prod/terraform.tfstate&quot;</span><br><span class="line">    region         = &quot;ap-northeast-2&quot;</span><br><span class="line">    encrypt        = true</span><br><span class="line">    dynamodb_table = &quot;terraform-lock&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">  region = var.aws_region</span><br><span class="line"></span><br><span class="line">  default_tags &#123;</span><br><span class="line">    tags = &#123;</span><br><span class="line">      Environment = var.environment</span><br><span class="line">      ManagedBy   = &quot;Terraform&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-변수-정의"><a href="#2-변수-정의" class="headerlink" title="2. 변수 정의"></a>2. 변수 정의</h4><figure class="highlight plaintext"><figcaption><span>variables.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">variable &quot;aws_region&quot; &#123;</span><br><span class="line">  description = &quot;AWS 리전&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  default     = &quot;ap-northeast-2&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;environment&quot; &#123;</span><br><span class="line">  description = &quot;환경 (dev, staging, prod)&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  validation &#123;</span><br><span class="line">    condition     = contains([&quot;dev&quot;, &quot;staging&quot;, &quot;prod&quot;], var.environment)</span><br><span class="line">    error_message = &quot;환경은 dev, staging, prod 중 하나여야 합니다.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vpc_cidr&quot; &#123;</span><br><span class="line">  description = &quot;VPC CIDR 블록&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  default     = &quot;10.0.0.0/16&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_type&quot; &#123;</span><br><span class="line">  description = &quot;EC2 인스턴스 타입&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  default     = &quot;t3.micro&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;tags&quot; &#123;</span><br><span class="line">  description = &quot;리소스 태그&quot;</span><br><span class="line">  type        = map(string)</span><br><span class="line">  default     = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-리소스-정의"><a href="#3-리소스-정의" class="headerlink" title="3. 리소스 정의"></a>3. 리소스 정의</h4><figure class="highlight plaintext"><figcaption><span>main.tf</span></figcaption><table><tr><td class="code"><pre><span class="line"># VPC 생성</span><br><span class="line">resource &quot;aws_vpc&quot; &quot;main&quot; &#123;</span><br><span class="line">  cidr_block           = var.vpc_cidr</span><br><span class="line">  enable_dns_hostnames = true</span><br><span class="line">  enable_dns_support   = true</span><br><span class="line"></span><br><span class="line">  tags = merge(</span><br><span class="line">    var.tags,</span><br><span class="line">    &#123;</span><br><span class="line">      Name = &quot;$&#123;var.environment&#125;-vpc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 서브넷 생성</span><br><span class="line">resource &quot;aws_subnet&quot; &quot;public&quot; &#123;</span><br><span class="line">  count             = length(var.availability_zones)</span><br><span class="line">  vpc_id            = aws_vpc.main.id</span><br><span class="line">  cidr_block        = cidrsubnet(var.vpc_cidr, 8, count.index)</span><br><span class="line">  availability_zone = var.availability_zones[count.index]</span><br><span class="line"></span><br><span class="line">  map_public_ip_on_launch = true</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.environment&#125;-public-subnet-$&#123;count.index + 1&#125;&quot;</span><br><span class="line">    Type = &quot;Public&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 보안 그룹</span><br><span class="line">resource &quot;aws_security_group&quot; &quot;web&quot; &#123;</span><br><span class="line">  name        = &quot;$&#123;var.environment&#125;-web-sg&quot;</span><br><span class="line">  description = &quot;Web server security group&quot;</span><br><span class="line">  vpc_id      = aws_vpc.main.id</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    description = &quot;HTTP&quot;</span><br><span class="line">    from_port   = 80</span><br><span class="line">    to_port     = 80</span><br><span class="line">    protocol    = &quot;tcp&quot;</span><br><span class="line">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    description = &quot;HTTPS&quot;</span><br><span class="line">    from_port   = 443</span><br><span class="line">    to_port     = 443</span><br><span class="line">    protocol    = &quot;tcp&quot;</span><br><span class="line">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    description = &quot;All outbound&quot;</span><br><span class="line">    from_port   = 0</span><br><span class="line">    to_port     = 0</span><br><span class="line">    protocol    = &quot;-1&quot;</span><br><span class="line">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.environment&#125;-web-sg&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># EC2 인스턴스</span><br><span class="line">resource &quot;aws_instance&quot; &quot;web&quot; &#123;</span><br><span class="line">  ami           = data.aws_ami.amazon_linux_2.id</span><br><span class="line">  instance_type = var.instance_type</span><br><span class="line">  subnet_id     = aws_subnet.public[0].id</span><br><span class="line"></span><br><span class="line">  vpc_security_group_ids = [aws_security_group.web.id]</span><br><span class="line"></span><br><span class="line">  user_data = &lt;&lt;-EOF</span><br><span class="line">              #!/bin/bash</span><br><span class="line">              yum update -y</span><br><span class="line">              yum install -y httpd</span><br><span class="line">              systemctl start httpd</span><br><span class="line">              systemctl enable httpd</span><br><span class="line">              echo &quot;&lt;h1&gt;Hello from Terraform&lt;/h1&gt;&quot; &gt; /var/www/html/index.html</span><br><span class="line">              EOF</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.environment&#125;-web-server&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-데이터-소스"><a href="#4-데이터-소스" class="headerlink" title="4. 데이터 소스"></a>4. 데이터 소스</h4><figure class="highlight plaintext"><figcaption><span>data.tf</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">data &quot;aws_ami&quot; &quot;amazon_linux_2&quot; &#123;</span><br><span class="line">  most_recent = true</span><br><span class="line">  owners      = [&quot;amazon&quot;]</span><br><span class="line"></span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;name&quot;</span><br><span class="line">    values = [&quot;amzn2-ami-hvm-*-x86_64-gp2&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;virtualization-type&quot;</span><br><span class="line">    values = [&quot;hvm&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;aws_availability_zones&quot; &quot;available&quot; &#123;</span><br><span class="line">  state = &quot;available&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-출력-값"><a href="#5-출력-값" class="headerlink" title="5. 출력 값"></a>5. 출력 값</h4><figure class="highlight plaintext"><figcaption><span>outputs.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">output &quot;vpc_id&quot; &#123;</span><br><span class="line">  description = &quot;VPC ID&quot;</span><br><span class="line">  value       = aws_vpc.main.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;public_subnet_ids&quot; &#123;</span><br><span class="line">  description = &quot;Public 서브넷 ID 목록&quot;</span><br><span class="line">  value       = aws_subnet.public[*].id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;web_server_public_ip&quot; &#123;</span><br><span class="line">  description = &quot;웹 서버 공인 IP&quot;</span><br><span class="line">  value       = aws_instance.web.public_ip</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;web_server_url&quot; &#123;</span><br><span class="line">  description = &quot;웹 서버 URL&quot;</span><br><span class="line">  value       = &quot;http://$&#123;aws_instance.web.public_ip&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="주요-명령어"><a href="#주요-명령어" class="headerlink" title="주요 명령어"></a>주요 명령어</h2><h3 id="초기화"><a href="#초기화" class="headerlink" title="초기화"></a>초기화</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Terraform 초기화 (프로바이더 다운로드)</span></span><br><span class="line">terraform init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 업그레이드 포함 초기화</span></span><br><span class="line">terraform init -upgrade</span><br></pre></td></tr></table></figure><h3 id="포맷팅-및-검증"><a href="#포맷팅-및-검증" class="headerlink" title="포맷팅 및 검증"></a>포맷팅 및 검증</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 코드 포맷팅</span></span><br><span class="line">terraform <span class="built_in">fmt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 재귀적으로 포맷팅</span></span><br><span class="line">terraform <span class="built_in">fmt</span> -recursive</span><br><span class="line"></span><br><span class="line"><span class="comment"># 구성 파일 검증</span></span><br><span class="line">terraform validate</span><br></pre></td></tr></table></figure><h3 id="계획-및-적용"><a href="#계획-및-적용" class="headerlink" title="계획 및 적용"></a>계획 및 적용</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 실행 계획 확인</span></span><br><span class="line">terraform plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 변수 파일 사용</span></span><br><span class="line">terraform plan -var-file=<span class="string">&quot;prod.tfvars&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 리소스만 계획</span></span><br><span class="line">terraform plan -target=aws_instance.web</span><br><span class="line"></span><br><span class="line"><span class="comment"># 변경 사항 적용</span></span><br><span class="line">terraform apply</span><br><span class="line"></span><br><span class="line"><span class="comment"># 자동 승인으로 적용</span></span><br><span class="line">terraform apply -auto-approve</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 리소스만 적용</span></span><br><span class="line">terraform apply -target=aws_instance.web</span><br></pre></td></tr></table></figure><h3 id="상태-관리"><a href="#상태-관리" class="headerlink" title="상태 관리"></a>상태 관리</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 상태 목록 확인</span></span><br><span class="line">terraform state list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 리소스 상태 확인</span></span><br><span class="line">terraform state show aws_instance.web</span><br><span class="line"></span><br><span class="line"><span class="comment"># 리소스 이름 변경</span></span><br><span class="line">terraform state <span class="built_in">mv</span> aws_instance.old aws_instance.new</span><br><span class="line"></span><br><span class="line"><span class="comment"># 리소스를 상태에서 제거 (실제 리소스는 유지)</span></span><br><span class="line">terraform state <span class="built_in">rm</span> aws_instance.web</span><br><span class="line"></span><br><span class="line"><span class="comment"># 상태 파일 가져오기 (기존 리소스를 Terraform 관리로)</span></span><br><span class="line">terraform import aws_instance.web i-1234567890abcdef0</span><br></pre></td></tr></table></figure><h3 id="출력-및-조회"><a href="#출력-및-조회" class="headerlink" title="출력 및 조회"></a>출력 및 조회</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 출력 값 표시</span></span><br><span class="line">terraform output</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 출력 값 표시</span></span><br><span class="line">terraform output vpc_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON 형식으로 출력</span></span><br><span class="line">terraform output -json</span><br></pre></td></tr></table></figure><h3 id="리소스-삭제"><a href="#리소스-삭제" class="headerlink" title="리소스 삭제"></a>리소스 삭제</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 모든 리소스 삭제</span></span><br><span class="line">terraform destroy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 리소스만 삭제</span></span><br><span class="line">terraform destroy -target=aws_instance.web</span><br><span class="line"></span><br><span class="line"><span class="comment"># 자동 승인으로 삭제</span></span><br><span class="line">terraform destroy -auto-approve</span><br></pre></td></tr></table></figure><h3 id="워크스페이스-관리"><a href="#워크스페이스-관리" class="headerlink" title="워크스페이스 관리"></a>워크스페이스 관리</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 워크스페이스 목록</span></span><br><span class="line">terraform workspace list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 새 워크스페이스 생성</span></span><br><span class="line">terraform workspace new dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 워크스페이스 전환</span></span><br><span class="line">terraform workspace <span class="keyword">select</span> prod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 현재 워크스페이스 확인</span></span><br><span class="line">terraform workspace show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 워크스페이스 삭제</span></span><br><span class="line">terraform workspace delete dev</span><br></pre></td></tr></table></figure><h2 id="모듈-활용"><a href="#모듈-활용" class="headerlink" title="모듈 활용"></a>모듈 활용</h2><h3 id="모듈-구조"><a href="#모듈-구조" class="headerlink" title="모듈 구조"></a>모듈 구조</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modules/</span><br><span class="line">└── vpc/</span><br><span class="line">    ├── main.tf</span><br><span class="line">    ├── variables.tf</span><br><span class="line">    ├── outputs.tf</span><br><span class="line">    └── README.md</span><br></pre></td></tr></table></figure><h3 id="모듈-정의"><a href="#모듈-정의" class="headerlink" title="모듈 정의"></a>모듈 정의</h3><figure class="highlight plaintext"><figcaption><span>modules/vpc/main.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">resource &quot;aws_vpc&quot; &quot;this&quot; &#123;</span><br><span class="line">  cidr_block           = var.cidr_block</span><br><span class="line">  enable_dns_hostnames = var.enable_dns_hostnames</span><br><span class="line">  enable_dns_support   = var.enable_dns_support</span><br><span class="line"></span><br><span class="line">  tags = merge(</span><br><span class="line">    var.tags,</span><br><span class="line">    &#123;</span><br><span class="line">      Name = var.name</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_internet_gateway&quot; &quot;this&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.this.id</span><br><span class="line"></span><br><span class="line">  tags = merge(</span><br><span class="line">    var.tags,</span><br><span class="line">    &#123;</span><br><span class="line">      Name = &quot;$&#123;var.name&#125;-igw&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><figcaption><span>modules/vpc/variables.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">variable &quot;name&quot; &#123;</span><br><span class="line">  description = &quot;VPC 이름&quot;</span><br><span class="line">  type        = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;cidr_block&quot; &#123;</span><br><span class="line">  description = &quot;VPC CIDR 블록&quot;</span><br><span class="line">  type        = string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;enable_dns_hostnames&quot; &#123;</span><br><span class="line">  description = &quot;DNS 호스트명 활성화&quot;</span><br><span class="line">  type        = bool</span><br><span class="line">  default     = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;enable_dns_support&quot; &#123;</span><br><span class="line">  description = &quot;DNS 지원 활성화&quot;</span><br><span class="line">  type        = bool</span><br><span class="line">  default     = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;tags&quot; &#123;</span><br><span class="line">  description = &quot;태그&quot;</span><br><span class="line">  type        = map(string)</span><br><span class="line">  default     = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><figcaption><span>modules/vpc/outputs.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">output &quot;vpc_id&quot; &#123;</span><br><span class="line">  description = &quot;VPC ID&quot;</span><br><span class="line">  value       = aws_vpc.this.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;igw_id&quot; &#123;</span><br><span class="line">  description = &quot;Internet Gateway ID&quot;</span><br><span class="line">  value       = aws_internet_gateway.this.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="모듈-사용"><a href="#모듈-사용" class="headerlink" title="모듈 사용"></a>모듈 사용</h3><figure class="highlight plaintext"><figcaption><span>main.tf</span></figcaption><table><tr><td class="code"><pre><span class="line">module &quot;vpc&quot; &#123;</span><br><span class="line">  source = &quot;./modules/vpc&quot;</span><br><span class="line"></span><br><span class="line">  name       = &quot;$&#123;var.environment&#125;-vpc&quot;</span><br><span class="line">  cidr_block = var.vpc_cidr</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Environment = var.environment</span><br><span class="line">    ManagedBy   = &quot;Terraform&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 모듈 출력 값 사용</span><br><span class="line">resource &quot;aws_subnet&quot; &quot;public&quot; &#123;</span><br><span class="line">  vpc_id     = module.vpc.vpc_id</span><br><span class="line">  cidr_block = &quot;10.0.1.0/24&quot;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.environment&#125;-public-subnet&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="고급-기능"><a href="#고급-기능" class="headerlink" title="고급 기능"></a>고급 기능</h2><h3 id="1-반복문-Loop"><a href="#1-반복문-Loop" class="headerlink" title="1. 반복문 (Loop)"></a>1. 반복문 (Loop)</h3><h4 id="count-사용"><a href="#count-사용" class="headerlink" title="count 사용"></a>count 사용</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource &quot;aws_instance&quot; &quot;server&quot; &#123;</span><br><span class="line">  count = 3</span><br><span class="line"></span><br><span class="line">  ami           = data.aws_ami.amazon_linux_2.id</span><br><span class="line">  instance_type = &quot;t3.micro&quot;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;server-$&#123;count.index + 1&#125;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="for-each-사용"><a href="#for-each-사용" class="headerlink" title="for_each 사용"></a>for_each 사용</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">variable &quot;instances&quot; &#123;</span><br><span class="line">  type = map(object(&#123;</span><br><span class="line">    instance_type = string</span><br><span class="line">    ami           = string</span><br><span class="line">  &#125;))</span><br><span class="line">  default = &#123;</span><br><span class="line">    web = &#123;</span><br><span class="line">      instance_type = &quot;t3.micro&quot;</span><br><span class="line">      ami           = &quot;ami-0c55b159cbfafe1f0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    app = &#123;</span><br><span class="line">      instance_type = &quot;t3.small&quot;</span><br><span class="line">      ami           = &quot;ami-0c55b159cbfafe1f0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_instance&quot; &quot;server&quot; &#123;</span><br><span class="line">  for_each = var.instances</span><br><span class="line"></span><br><span class="line">  ami           = each.value.ami</span><br><span class="line">  instance_type = each.value.instance_type</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;each.key&#125;-server&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-조건문"><a href="#2-조건문" class="headerlink" title="2. 조건문"></a>2. 조건문</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource &quot;aws_instance&quot; &quot;server&quot; &#123;</span><br><span class="line">  ami           = data.aws_ami.amazon_linux_2.id</span><br><span class="line">  instance_type = var.environment == &quot;prod&quot; ? &quot;t3.large&quot; : &quot;t3.micro&quot;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = var.environment == &quot;prod&quot; ? &quot;prod-server&quot; : &quot;dev-server&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 조건부 리소스 생성</span><br><span class="line">resource &quot;aws_eip&quot; &quot;server&quot; &#123;</span><br><span class="line">  count = var.create_eip ? 1 : 0</span><br><span class="line"></span><br><span class="line">  instance = aws_instance.server.id</span><br><span class="line">  domain   = &quot;vpc&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-동적-블록"><a href="#3-동적-블록" class="headerlink" title="3. 동적 블록"></a>3. 동적 블록</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">variable &quot;ingress_rules&quot; &#123;</span><br><span class="line">  type = list(object(&#123;</span><br><span class="line">    from_port   = number</span><br><span class="line">    to_port     = number</span><br><span class="line">    protocol    = string</span><br><span class="line">    cidr_blocks = list(string)</span><br><span class="line">    description = string</span><br><span class="line">  &#125;))</span><br><span class="line">  default = [</span><br><span class="line">    &#123;</span><br><span class="line">      from_port   = 80</span><br><span class="line">      to_port     = 80</span><br><span class="line">      protocol    = &quot;tcp&quot;</span><br><span class="line">      cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">      description = &quot;HTTP&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      from_port   = 443</span><br><span class="line">      to_port     = 443</span><br><span class="line">      protocol    = &quot;tcp&quot;</span><br><span class="line">      cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">      description = &quot;HTTPS&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_security_group&quot; &quot;web&quot; &#123;</span><br><span class="line">  name   = &quot;web-sg&quot;</span><br><span class="line">  vpc_id = aws_vpc.main.id</span><br><span class="line"></span><br><span class="line">  dynamic &quot;ingress&quot; &#123;</span><br><span class="line">    for_each = var.ingress_rules</span><br><span class="line">    content &#123;</span><br><span class="line">      from_port   = ingress.value.from_port</span><br><span class="line">      to_port     = ingress.value.to_port</span><br><span class="line">      protocol    = ingress.value.protocol</span><br><span class="line">      cidr_blocks = ingress.value.cidr_blocks</span><br><span class="line">      description = ingress.value.description</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-로컬-변수"><a href="#4-로컬-변수" class="headerlink" title="4. 로컬 변수"></a>4. 로컬 변수</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">locals &#123;</span><br><span class="line">  common_tags = &#123;</span><br><span class="line">    Environment = var.environment</span><br><span class="line">    Project     = var.project_name</span><br><span class="line">    ManagedBy   = &quot;Terraform&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vpc_name = &quot;$&#123;var.environment&#125;-$&#123;var.project_name&#125;-vpc&quot;</span><br><span class="line"></span><br><span class="line">  availability_zones = slice(data.aws_availability_zones.available.names, 0, 3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_vpc&quot; &quot;main&quot; &#123;</span><br><span class="line">  cidr_block = var.vpc_cidr</span><br><span class="line"></span><br><span class="line">  tags = merge(</span><br><span class="line">    local.common_tags,</span><br><span class="line">    &#123;</span><br><span class="line">      Name = local.vpc_name</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-함수-활용"><a href="#5-함수-활용" class="headerlink" title="5. 함수 활용"></a>5. 함수 활용</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 문자열 함수</span><br><span class="line">output &quot;upper_name&quot; &#123;</span><br><span class="line">  value = upper(var.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;lower_name&quot; &#123;</span><br><span class="line">  value = lower(var.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 숫자 함수</span><br><span class="line">output &quot;max_value&quot; &#123;</span><br><span class="line">  value = max(5, 12, 9)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 컬렉션 함수</span><br><span class="line">output &quot;subnet_ids&quot; &#123;</span><br><span class="line">  value = join(&quot;,&quot;, aws_subnet.public[*].id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;first_subnet&quot; &#123;</span><br><span class="line">  value = element(aws_subnet.public[*].id, 0)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># IP 네트워크 함수</span><br><span class="line">output &quot;subnets&quot; &#123;</span><br><span class="line">  value = [</span><br><span class="line">    for i in range(3) :</span><br><span class="line">    cidrsubnet(var.vpc_cidr, 8, i)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 날짜/시간 함수</span><br><span class="line">output &quot;timestamp&quot; &#123;</span><br><span class="line">  value = timestamp()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 파일시스템 함수</span><br><span class="line">resource &quot;aws_instance&quot; &quot;web&quot; &#123;</span><br><span class="line">  user_data = file(&quot;$&#123;path.module&#125;/user-data.sh&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 인코딩 함수</span><br><span class="line">output &quot;encoded&quot; &#123;</span><br><span class="line">  value = base64encode(&quot;Hello Terraform&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="상태-관리-Best-Practices"><a href="#상태-관리-Best-Practices" class="headerlink" title="상태 관리 Best Practices"></a>상태 관리 Best Practices</h2><h3 id="원격-백엔드-설정-S3"><a href="#원격-백엔드-설정-S3" class="headerlink" title="원격 백엔드 설정 (S3)"></a>원격 백엔드 설정 (S3)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  backend &quot;s3&quot; &#123;</span><br><span class="line">    bucket         = &quot;my-terraform-state&quot;</span><br><span class="line">    key            = &quot;prod/terraform.tfstate&quot;</span><br><span class="line">    region         = &quot;ap-northeast-2&quot;</span><br><span class="line">    encrypt        = true</span><br><span class="line">    dynamodb_table = &quot;terraform-lock&quot;</span><br><span class="line"></span><br><span class="line">    # 상태 파일 버전 관리</span><br><span class="line">    versioning     = true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DynamoDB-잠금-테이블-생성"><a href="#DynamoDB-잠금-테이블-생성" class="headerlink" title="DynamoDB 잠금 테이블 생성"></a>DynamoDB 잠금 테이블 생성</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource &quot;aws_dynamodb_table&quot; &quot;terraform_lock&quot; &#123;</span><br><span class="line">  name           = &quot;terraform-lock&quot;</span><br><span class="line">  billing_mode   = &quot;PAY_PER_REQUEST&quot;</span><br><span class="line">  hash_key       = &quot;LockID&quot;</span><br><span class="line"></span><br><span class="line">  attribute &#123;</span><br><span class="line">    name = &quot;LockID&quot;</span><br><span class="line">    type = &quot;S&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;Terraform Lock Table&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="워크플로우-예제"><a href="#워크플로우-예제" class="headerlink" title="워크플로우 예제"></a>워크플로우 예제</h2><h3 id="환경별-관리"><a href="#환경별-관리" class="headerlink" title="환경별 관리"></a>환경별 관리</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 디렉토리 구조</span></span><br><span class="line">terraform/</span><br><span class="line">├── environments/</span><br><span class="line">│   ├── dev/</span><br><span class="line">│   │   ├── main.tf</span><br><span class="line">│   │   ├── terraform.tfvars</span><br><span class="line">│   │   └── backend.tf</span><br><span class="line">│   ├── staging/</span><br><span class="line">│   │   ├── main.tf</span><br><span class="line">│   │   ├── terraform.tfvars</span><br><span class="line">│   │   └── backend.tf</span><br><span class="line">│   └── prod/</span><br><span class="line">│       ├── main.tf</span><br><span class="line">│       ├── terraform.tfvars</span><br><span class="line">│       └── backend.tf</span><br><span class="line">└── modules/</span><br><span class="line">    ├── vpc/</span><br><span class="line">    ├── ec2/</span><br><span class="line">    └── rds/</span><br></pre></td></tr></table></figure><h3 id="CI-CD-파이프라인-GitHub-Actions"><a href="#CI-CD-파이프라인-GitHub-Actions" class="headerlink" title="CI&#x2F;CD 파이프라인 (GitHub Actions)"></a>CI&#x2F;CD 파이프라인 (GitHub Actions)</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Terraform</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line">  <span class="attr">pull_request:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TF_VERSION:</span> <span class="number">1.6</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">AWS_REGION:</span> <span class="string">ap-northeast-2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">terraform:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Terraform</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">hashicorp/setup-terraform@v2</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">terraform_version:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.TF_VERSION</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span> <span class="string">AWS</span> <span class="string">Credentials</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">aws-actions/configure-aws-credentials@v2</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">aws-access-key-id:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.AWS_ACCESS_KEY_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">aws-secret-access-key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.AWS_SECRET_ACCESS_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">aws-region:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.AWS_REGION</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Terraform</span> <span class="string">Format</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">fmt</span> <span class="string">-check</span> <span class="string">-recursive</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Terraform</span> <span class="string">Init</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">init</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Terraform</span> <span class="string">Validate</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">validate</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Terraform</span> <span class="string">Plan</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">plan</span> <span class="string">-out=tfplan</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Terraform</span> <span class="string">Apply</span></span><br><span class="line">      <span class="attr">if:</span> <span class="string">github.ref</span> <span class="string">==</span> <span class="string">&#x27;refs/heads/main&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">github.event_name</span> <span class="string">==</span> <span class="string">&#x27;push&#x27;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">terraform</span> <span class="string">apply</span> <span class="string">-auto-approve</span> <span class="string">tfplan</span></span><br></pre></td></tr></table></figure><h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><h3 id="1-코드-구조화"><a href="#1-코드-구조화" class="headerlink" title="1. 코드 구조화"></a>1. 코드 구조화</h3><ul><li>리소스를 논리적으로 그룹화</li><li>재사용 가능한 모듈 작성</li><li>환경별로 분리 (dev, staging, prod)</li></ul><h3 id="2-명명-규칙"><a href="#2-명명-규칙" class="headerlink" title="2. 명명 규칙"></a>2. 명명 규칙</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 일관된 명명 규칙 사용</span><br><span class="line">resource &quot;aws_instance&quot; &quot;web_server&quot; &#123;  # snake_case</span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;$&#123;var.environment&#125;-web-server&quot;  # kebab-case</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-변수-사용"><a href="#3-변수-사용" class="headerlink" title="3. 변수 사용"></a>3. 변수 사용</h3><ul><li>하드코딩 대신 변수 사용</li><li>민감한 정보는 환경 변수나 Vault 사용</li><li>기본값 제공</li></ul><h3 id="4-상태-관리-1"><a href="#4-상태-관리-1" class="headerlink" title="4. 상태 관리"></a>4. 상태 관리</h3><ul><li>원격 백엔드 사용 (S3 + DynamoDB)</li><li>상태 파일 암호화</li><li>버전 관리 활성화</li></ul><h3 id="5-버전-관리"><a href="#5-버전-관리" class="headerlink" title="5. 버전 관리"></a>5. 버전 관리</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_version = &quot;&gt;= 1.0, &lt; 2.0&quot;</span><br><span class="line"></span><br><span class="line">  required_providers &#123;</span><br><span class="line">    aws = &#123;</span><br><span class="line">      source  = &quot;hashicorp/aws&quot;</span><br><span class="line">      version = &quot;~&gt; 5.0&quot;  # 5.x 버전 사용</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-태그-전략"><a href="#6-태그-전략" class="headerlink" title="6. 태그 전략"></a>6. 태그 전략</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">locals &#123;</span><br><span class="line">  common_tags = &#123;</span><br><span class="line">    Environment = var.environment</span><br><span class="line">    Project     = var.project_name</span><br><span class="line">    ManagedBy   = &quot;Terraform&quot;</span><br><span class="line">    Owner       = var.owner</span><br><span class="line">    CostCenter  = var.cost_center</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 모든 리소스에 공통 태그 적용</span><br><span class="line">resource &quot;aws_instance&quot; &quot;web&quot; &#123;</span><br><span class="line">  tags = merge(</span><br><span class="line">    local.common_tags,</span><br><span class="line">    &#123;</span><br><span class="line">      Name = &quot;web-server&quot;</span><br><span class="line">      Role = &quot;web&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-문서화"><a href="#7-문서화" class="headerlink" title="7. 문서화"></a>7. 문서화</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 주석으로 의도 명확히 표현</span><br><span class="line">variable &quot;instance_type&quot; &#123;</span><br><span class="line">  description = &quot;EC2 인스턴스 타입. 프로덕션 환경에서는 최소 t3.small 권장&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  default     = &quot;t3.micro&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-보안"><a href="#8-보안" class="headerlink" title="8. 보안"></a>8. 보안</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 민감한 정보는 sensitive 표시</span><br><span class="line">variable &quot;db_password&quot; &#123;</span><br><span class="line">  description = &quot;데이터베이스 비밀번호&quot;</span><br><span class="line">  type        = string</span><br><span class="line">  sensitive   = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;db_password&quot; &#123;</span><br><span class="line">  value     = var.db_password</span><br><span class="line">  sensitive = true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="실전-예제-3-Tier-아키텍처"><a href="#실전-예제-3-Tier-아키텍처" class="headerlink" title="실전 예제: 3-Tier 아키텍처"></a>실전 예제: 3-Tier 아키텍처</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># VPC</span><br><span class="line">module &quot;vpc&quot; &#123;</span><br><span class="line">  source = &quot;./modules/vpc&quot;</span><br><span class="line"></span><br><span class="line">  name       = &quot;$&#123;var.environment&#125;-vpc&quot;</span><br><span class="line">  cidr_block = &quot;10.0.0.0/16&quot;</span><br><span class="line"></span><br><span class="line">  availability_zones = [&quot;ap-northeast-2a&quot;, &quot;ap-northeast-2c&quot;]</span><br><span class="line">  public_subnets     = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;]</span><br><span class="line">  private_subnets    = [&quot;10.0.11.0/24&quot;, &quot;10.0.12.0/24&quot;]</span><br><span class="line">  database_subnets   = [&quot;10.0.21.0/24&quot;, &quot;10.0.22.0/24&quot;]</span><br><span class="line"></span><br><span class="line">  enable_nat_gateway = true</span><br><span class="line">  single_nat_gateway = var.environment != &quot;prod&quot;</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ALB</span><br><span class="line">module &quot;alb&quot; &#123;</span><br><span class="line">  source = &quot;./modules/alb&quot;</span><br><span class="line"></span><br><span class="line">  name            = &quot;$&#123;var.environment&#125;-alb&quot;</span><br><span class="line">  vpc_id          = module.vpc.vpc_id</span><br><span class="line">  public_subnets  = module.vpc.public_subnet_ids</span><br><span class="line">  security_groups = [aws_security_group.alb.id]</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># EC2 Auto Scaling</span><br><span class="line">module &quot;asg&quot; &#123;</span><br><span class="line">  source = &quot;./modules/asg&quot;</span><br><span class="line"></span><br><span class="line">  name               = &quot;$&#123;var.environment&#125;-web-asg&quot;</span><br><span class="line">  vpc_id             = module.vpc.vpc_id</span><br><span class="line">  private_subnets    = module.vpc.private_subnet_ids</span><br><span class="line">  target_group_arns  = [module.alb.target_group_arn]</span><br><span class="line"></span><br><span class="line">  min_size         = var.environment == &quot;prod&quot; ? 2 : 1</span><br><span class="line">  max_size         = var.environment == &quot;prod&quot; ? 10 : 3</span><br><span class="line">  desired_capacity = var.environment == &quot;prod&quot; ? 2 : 1</span><br><span class="line"></span><br><span class="line">  instance_type = var.instance_type</span><br><span class="line">  ami_id        = data.aws_ami.amazon_linux_2.id</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># RDS</span><br><span class="line">module &quot;rds&quot; &#123;</span><br><span class="line">  source = &quot;./modules/rds&quot;</span><br><span class="line"></span><br><span class="line">  identifier        = &quot;$&#123;var.environment&#125;-db&quot;</span><br><span class="line">  engine            = &quot;mysql&quot;</span><br><span class="line">  engine_version    = &quot;8.0&quot;</span><br><span class="line">  instance_class    = var.environment == &quot;prod&quot; ? &quot;db.t3.medium&quot; : &quot;db.t3.micro&quot;</span><br><span class="line">  allocated_storage = var.environment == &quot;prod&quot; ? 100 : 20</span><br><span class="line"></span><br><span class="line">  db_name  = var.db_name</span><br><span class="line">  username = var.db_username</span><br><span class="line">  password = var.db_password</span><br><span class="line"></span><br><span class="line">  vpc_id             = module.vpc.vpc_id</span><br><span class="line">  subnet_ids         = module.vpc.database_subnet_ids</span><br><span class="line">  security_group_ids = [aws_security_group.rds.id]</span><br><span class="line"></span><br><span class="line">  multi_az               = var.environment == &quot;prod&quot;</span><br><span class="line">  backup_retention_period = var.environment == &quot;prod&quot; ? 7 : 1</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="트러블슈팅"><a href="#트러블슈팅" class="headerlink" title="트러블슈팅"></a>트러블슈팅</h2><h3 id="일반적인-문제-해결"><a href="#일반적인-문제-해결" class="headerlink" title="일반적인 문제 해결"></a>일반적인 문제 해결</h3><h4 id="1-상태-파일-충돌"><a href="#1-상태-파일-충돌" class="headerlink" title="1. 상태 파일 충돌"></a>1. 상태 파일 충돌</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 잠금 해제</span></span><br><span class="line">terraform force-unlock &lt;LOCK_ID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 상태 파일 새로고침</span></span><br><span class="line">terraform refresh</span><br></pre></td></tr></table></figure><h4 id="2-리소스-import"><a href="#2-리소스-import" class="headerlink" title="2. 리소스 import"></a>2. 리소스 import</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 기존 AWS 리소스를 Terraform 관리로 가져오기</span></span><br><span class="line">terraform import aws_instance.web i-1234567890abcdef0</span><br></pre></td></tr></table></figure><h4 id="3-상태-파일-복구"><a href="#3-상태-파일-복구" class="headerlink" title="3. 상태 파일 복구"></a>3. 상태 파일 복구</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 백업에서 복구 (S3)</span></span><br><span class="line">aws s3 <span class="built_in">cp</span> s3://my-terraform-state/prod/terraform.tfstate.backup terraform.tfstate</span><br></pre></td></tr></table></figure><h4 id="4-디버깅"><a href="#4-디버깅" class="headerlink" title="4. 디버깅"></a>4. 디버깅</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 디버그 로그 활성화</span></span><br><span class="line"><span class="built_in">export</span> TF_LOG=DEBUG</span><br><span class="line"><span class="built_in">export</span> TF_LOG_PATH=./terraform.log</span><br><span class="line"></span><br><span class="line">terraform plan</span><br></pre></td></tr></table></figure><h2 id="유용한-도구"><a href="#유용한-도구" class="headerlink" title="유용한 도구"></a>유용한 도구</h2><h3 id="1-Terragrunt"><a href="#1-Terragrunt" class="headerlink" title="1. Terragrunt"></a>1. Terragrunt</h3><ul><li>Terraform 코드를 DRY하게 관리</li><li>여러 환경 구성 간소화</li></ul><h3 id="2-tflint"><a href="#2-tflint" class="headerlink" title="2. tflint"></a>2. tflint</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설치</span></span><br><span class="line">brew install tflint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실행</span></span><br><span class="line">tflint</span><br></pre></td></tr></table></figure><h3 id="3-terraform-docs"><a href="#3-terraform-docs" class="headerlink" title="3. terraform-docs"></a>3. terraform-docs</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설치</span></span><br><span class="line">brew install terraform-docs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 문서 생성</span></span><br><span class="line">terraform-docs markdown table . &gt; README.md</span><br></pre></td></tr></table></figure><h3 id="4-Checkov"><a href="#4-Checkov" class="headerlink" title="4. Checkov"></a>4. Checkov</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설치</span></span><br><span class="line">pip install checkov</span><br><span class="line"></span><br><span class="line"><span class="comment"># 보안 스캔</span></span><br><span class="line">checkov -d .</span><br></pre></td></tr></table></figure><h3 id="5-Infracost"><a href="#5-Infracost" class="headerlink" title="5. Infracost"></a>5. Infracost</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설치</span></span><br><span class="line">brew install infracost</span><br><span class="line"></span><br><span class="line"><span class="comment"># 비용 예측</span></span><br><span class="line">infracost breakdown --path .</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Infrastructure/">Infrastructure</category>
      
      <category domain="https://ckck803.github.io/categories/Infrastructure/DevOps/">DevOps</category>
      
      
      <category domain="https://ckck803.github.io/tags/Terraform/">Terraform</category>
      
      <category domain="https://ckck803.github.io/tags/IaC/">IaC</category>
      
      <category domain="https://ckck803.github.io/tags/Infrastructure-as-Code/">Infrastructure as Code</category>
      
      <category domain="https://ckck803.github.io/tags/AWS/">AWS</category>
      
      <category domain="https://ckck803.github.io/tags/Cloud/">Cloud</category>
      
      
      <comments>https://ckck803.github.io/2025/12/31/infra/terraform/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>EC2 를 이용한 WireGuard Full Tunnel 구성</title>
      <link>https://ckck803.github.io/2025/12/30/linux/wireguard-vpn-guide/</link>
      <guid>https://ckck803.github.io/2025/12/30/linux/wireguard-vpn-guide/</guid>
      <pubDate>Tue, 30 Dec 2025 03:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/devops/wireguard.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;✅-VPN-서버-설정&quot;&gt;&lt;a href=&quot;#✅-VPN-서버-설정&quot; class=&quot;headerlink&quot; title=&quot;✅ VPN 서버 설정&quot;&gt;&lt;/a&gt;✅ VPN 서버 설정&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;WireGuard 내부 대역: &lt;code&gt;10.100.0.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;EC2 VPC 대역: &lt;code&gt;10.1.0.0/16&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;EC2-설정&quot;&gt;&lt;a href=&quot;#EC2-설정&quot; class=&quot;headerlink&quot; title=&quot;EC2 설정&quot;&gt;&lt;/a&gt;EC2 설정&lt;/h4&gt;&lt;p&gt;EC2 를 VPN 서버로 사용하기 위해서는 일단 Client 와 연결하기 위한 Port 가 오픈이 돼 있어야 합니다. Wireguard 는 51820 UDP 포트를 사용하므로 해당 포트를 통해 Client 가 접속할 수 있도록 보안 그룹 허용 목록에 추가해줍니다.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/devops/infra/vpn-ec2-sg.png&quot; alt=&quot;EC2 보안그룹 설정&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;EC2-에-WireGuard-설치&quot;&gt;&lt;a href=&quot;#EC2-에-WireGuard-설치&quot; class=&quot;headerlink&quot; title=&quot;EC2 에 WireGuard 설치&quot;&gt;&lt;/a&gt;EC2 에 WireGuard 설치&lt;/h3&gt;&lt;h4 id=&quot;Debian-계열-리눅스&quot;&gt;&lt;a href=&quot;#Debian-계열-리눅스&quot; class=&quot;headerlink&quot; title=&quot;Debian 계열 리눅스&quot;&gt;&lt;/a&gt;Debian 계열 리눅스&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 패키지 목록 업데이트&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt update&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# WireGuard 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt install wireguard -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# WireGuard 버전 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wg --version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;RHEL-계열-리눅스&quot;&gt;&lt;a href=&quot;#RHEL-계열-리눅스&quot; class=&quot;headerlink&quot; title=&quot;RHEL 계열 리눅스&quot;&gt;&lt;/a&gt;RHEL 계열 리눅스&lt;/h4&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/devops/wireguard.png"></p><h2 id="✅-VPN-서버-설정"><a href="#✅-VPN-서버-설정" class="headerlink" title="✅ VPN 서버 설정"></a>✅ VPN 서버 설정</h2><ul><li>WireGuard 내부 대역: <code>10.100.0.0/24</code></li><li>EC2 VPC 대역: <code>10.1.0.0/16</code></li></ul><h4 id="EC2-설정"><a href="#EC2-설정" class="headerlink" title="EC2 설정"></a>EC2 설정</h4><p>EC2 를 VPN 서버로 사용하기 위해서는 일단 Client 와 연결하기 위한 Port 가 오픈이 돼 있어야 합니다. Wireguard 는 51820 UDP 포트를 사용하므로 해당 포트를 통해 Client 가 접속할 수 있도록 보안 그룹 허용 목록에 추가해줍니다.</p><p><img src="/images/devops/infra/vpn-ec2-sg.png" alt="EC2 보안그룹 설정"></p><h3 id="EC2-에-WireGuard-설치"><a href="#EC2-에-WireGuard-설치" class="headerlink" title="EC2 에 WireGuard 설치"></a>EC2 에 WireGuard 설치</h3><h4 id="Debian-계열-리눅스"><a href="#Debian-계열-리눅스" class="headerlink" title="Debian 계열 리눅스"></a>Debian 계열 리눅스</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 패키지 목록 업데이트</span></span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># WireGuard 설치</span></span><br><span class="line">sudo apt install wireguard -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># WireGuard 버전 확인</span></span><br><span class="line">wg --version</span><br></pre></td></tr></table></figure><h4 id="RHEL-계열-리눅스"><a href="#RHEL-계열-리눅스" class="headerlink" title="RHEL 계열 리눅스"></a>RHEL 계열 리눅스</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># EPEL 저장소 추가</span></span><br><span class="line">sudo dnf install epel-release -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># WireGuard 설치</span></span><br><span class="line">sudo dnf install wireguard-tools -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 커널 모듈 확인</span></span><br><span class="line">sudo modprobe wireguard</span><br><span class="line">lsmod | grep wireguard</span><br><span class="line"></span><br><span class="line"><span class="comment"># WireGuard 설치</span></span><br><span class="line">sudo pacman -S wireguard-tools</span><br></pre></td></tr></table></figure><h4 id="설치-확인"><a href="#설치-확인" class="headerlink" title="설치 확인"></a>설치 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># WireGuard 명령어 확인</span></span><br><span class="line">❯ <span class="built_in">which</span> wg</span><br><span class="line">/usr/bin/wg</span><br><span class="line"></span><br><span class="line">❯ <span class="built_in">which</span> wg-quick</span><br><span class="line">/usr/bin/wg-quick</span><br><span class="line"></span><br><span class="line"><span class="comment"># 커널 모듈 확인</span></span><br><span class="line">❯ lsmod | grep wireguard</span><br><span class="line">wireguard             118784  0</span><br><span class="line">curve25519_x86_64      36864  1 wireguard</span><br><span class="line">libchacha20poly1305    16384  1 wireguard</span><br><span class="line">ip6_udp_tunnel         16384  1 wireguard</span><br><span class="line">udp_tunnel             32768  1 wireguard</span><br><span class="line">libcurve25519_generic    49152  2 curve25519_x86_64,wireguard</span><br></pre></td></tr></table></figure><h3 id="EC2-에-WireGuard-서버-설정"><a href="#EC2-에-WireGuard-서버-설정" class="headerlink" title="EC2 에 WireGuard 서버 설정"></a>EC2 에 WireGuard 서버 설정</h3><p>WireGuard 설정 파일에는 VPN 연결을 위한 Server 와 Client 의 키 정보가 필요합니다.</p><h4 id="WireGuard-서버-키-쌍-생성"><a href="#WireGuard-서버-키-쌍-생성" class="headerlink" title="WireGuard 서버 키 쌍 생성"></a>WireGuard 서버 키 쌍 생성</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 서버 비밀키 생성</span></span><br><span class="line"><span class="built_in">umask</span> 077</span><br><span class="line">wg genkey | sudo <span class="built_in">tee</span> server_private.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서버 공개키 생성</span></span><br><span class="line">sudo <span class="built_in">cat</span> server_private.key | wg pubkey | sudo <span class="built_in">tee</span> server_public.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 키 확인</span></span><br><span class="line">sudo <span class="built_in">cat</span> server_private.key</span><br><span class="line">sudo <span class="built_in">cat</span> server_public.key</span><br></pre></td></tr></table></figure><h4 id="클라이언트-키-쌍-생성"><a href="#클라이언트-키-쌍-생성" class="headerlink" title="클라이언트 키 쌍 생성"></a>클라이언트 키 쌍 생성</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 클라이언트 비밀키 생성</span></span><br><span class="line"><span class="built_in">umask</span> 077</span><br><span class="line">wg genkey | sudo <span class="built_in">tee</span> client_private.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트 공개키 생성</span></span><br><span class="line">sudo <span class="built_in">cat</span> client_private.key | wg pubkey | sudo <span class="built_in">tee</span> client_public.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 키 확인</span></span><br><span class="line">sudo <span class="built_in">cat</span> client_private.key</span><br><span class="line">sudo <span class="built_in">cat</span> client_public.key</span><br></pre></td></tr></table></figure><h4 id="서버-네트워크-인터페이스-확인"><a href="#서버-네트워크-인터페이스-확인" class="headerlink" title="서버 네트워크 인터페이스 확인"></a>서버 네트워크 인터페이스 확인</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">❯ ip route | grep default</span><br><span class="line"></span><br><span class="line">default via 10.1.0.1 dev ens5 proto dhcp src 10.1.9.228 metric 100</span><br></pre></td></tr></table></figure><h4 id="서버-설정-파일-생성"><a href="#서버-설정-파일-생성" class="headerlink" title="서버 설정 파일 생성"></a>서버 설정 파일 생성</h4><p><code>/etc/wireguard/</code> 경로의 <code>wg0.conf</code> 파일에 아래 내용을 추가해줍니다.</p><figure class="highlight plaintext"><figcaption><span>/etc/wireguard/wg0.conf</span></figcaption><table><tr><td class="code"><pre><span class="line">[Interface]</span><br><span class="line"># 서버의 VPN IP 주소</span><br><span class="line">Address = 10.100.0.1/24</span><br><span class="line"># 서버가 리스닝할 포트</span><br><span class="line">ListenPort = 51820</span><br><span class="line"># 서버 비밀키 (server_private.key의 내용)</span><br><span class="line">PrivateKey = &lt;SERVER_PRIVATE_KEY&gt;</span><br><span class="line"></span><br><span class="line">PostUp   = sysctl -w net.ipv4.ip_forward=1</span><br><span class="line">PostDown = sysctl -w net.ipv4.ip_forward=0</span><br><span class="line"></span><br><span class="line">PostUp   = iptables -A FORWARD -i %i -j ACCEPT</span><br><span class="line">PostUp   = iptables -A FORWARD -o %i -j ACCEPT</span><br><span class="line">PostDown = iptables -D FORWARD -i %i -j ACCEPT</span><br><span class="line">PostDown = iptables -D FORWARD -o %i -j ACCEPT</span><br><span class="line"></span><br><span class="line"># PostUp/PostDown: 방화벽 규칙 설정 (ens5 를 실제 인터페이스명으로 변경, eth0 일 수 있음)</span><br><span class="line">PostUp   = iptables -t nat -A POSTROUTING -s 10.100.0.0/24 -o ens5 -j MASQUERADE</span><br><span class="line">PostDown = iptables -t nat -D POSTROUTING -s 10.100.0.0/24 -o ens5 -j MASQUERADE</span><br><span class="line"></span><br><span class="line"># 클라이언트 1</span><br><span class="line">[Peer]</span><br><span class="line"># 클라이언트 공개키</span><br><span class="line">PublicKey = &lt;CLIENT_PUBLIC_KEY&gt;</span><br><span class="line"># 클라이언트에게 할당할 IP</span><br><span class="line">AllowedIPs = 10.100.0.2/32</span><br><span class="line"></span><br><span class="line"># # 클라이언트 2</span><br><span class="line"># [Peer]</span><br><span class="line"># PublicKey = &lt;CLIENT2_PUBLIC_KEY&gt;</span><br><span class="line"># AllowedIPs = 10.100.0.3/32</span><br></pre></td></tr></table></figure><h3 id="WireGuard-서비스-시작"><a href="#WireGuard-서비스-시작" class="headerlink" title="WireGuard 서비스 시작"></a>WireGuard 서비스 시작</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># WireGuard 인터페이스 시작</span></span><br><span class="line">❯ sudo wg-quick up wg0</span><br><span class="line"></span><br><span class="line">[<span class="comment">#] ip link add wg0 type wireguard</span></span><br><span class="line">[<span class="comment">#] wg setconf wg0 /dev/fd/63</span></span><br><span class="line">[<span class="comment">#] ip -4 address add 10.100.0.1/24 dev wg0</span></span><br><span class="line">[<span class="comment">#] ip link set mtu 8921 up dev wg0</span></span><br><span class="line">[<span class="comment">#] iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 상태 확인</span></span><br><span class="line">❯ sudo wg show</span><br><span class="line"></span><br><span class="line">interface: wg0</span><br><span class="line">  public key: &lt;SERVER_PUBLIC_KEY&gt;</span><br><span class="line">  private key: (hidden)</span><br><span class="line">  listening port: 51820</span><br></pre></td></tr></table></figure><h4 id="시스템-서비스-추가"><a href="#시스템-서비스-추가" class="headerlink" title="시스템 서비스 추가"></a>시스템 서비스 추가</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 부팅 시 자동 시작 설정</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> wg-quick@wg0</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemd로 서비스 관리</span></span><br><span class="line">sudo systemctl start wg-quick@wg0</span><br><span class="line">sudo systemctl status wg-quick@wg0</span><br></pre></td></tr></table></figure><h2 id="✅-클라이언트-설정"><a href="#✅-클라이언트-설정" class="headerlink" title="✅ 클라이언트 설정"></a>✅ 클라이언트 설정</h2><p>VPN 접속을 위해서는 EC2 에 외부 접속을 위한 Elastic IP 가 할당돼 있어야 합니다. VPN 이 설치된 EC2 인스턴스에서 퍼블릭 IP 가 있는지 확인합니다.</p><p><img src="/images/devops/infra/vpn-ec2-eip.png" alt="EC2 Elastic IP 확인"></p><h4 id="Full-Tunnel"><a href="#Full-Tunnel" class="headerlink" title="Full Tunnel"></a>Full Tunnel</h4><p><code>AllowedIPs</code> 를 <code>0.0.0.0/0</code> 로 설정하게 되면 Full Tunnel 상태로 모든 트래픽이 VPN 으로 향하게 됩니다.</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Interface]</span></span><br><span class="line"><span class="attr">PrivateKey</span> = &lt;CLIENT_PRIVATE_KEY&gt;</span><br><span class="line"><span class="attr">Address</span> = <span class="number">10.100</span>.<span class="number">0.2</span>/<span class="number">32</span></span><br><span class="line"><span class="attr">DNS</span> = <span class="number">1.1</span>.<span class="number">1.1</span>, <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Peer]</span></span><br><span class="line"><span class="attr">PublicKey</span> = &lt;SERVER_PUBLIC_KEY&gt;</span><br><span class="line"><span class="attr">Endpoint</span> = &lt;EC2_PUBLIC_IP&gt;:<span class="number">51820</span></span><br><span class="line"><span class="attr">AllowedIPs</span> = <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span></span><br><span class="line"><span class="attr">PersistentKeepalive</span> = <span class="number">25</span></span><br></pre></td></tr></table></figure><p>특정 IP 대역만 VPN을 통해 통신하도록 설정하려면, <code>AllowedIPs</code> 에 해당 IP 대역을 명시하면 됩니다. 이렇게 설정하면 지정한 IP 대역의 트래픽만 VPN을 경유하고, 그 외 트래픽은 기존 네트워크 경로를 그대로 사용하게 됩니다.</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Interface]</span></span><br><span class="line"><span class="attr">PrivateKey</span> = CLIENT_PRIVATE_KEY</span><br><span class="line"><span class="attr">Address</span> = <span class="number">10.100</span>.<span class="number">0.2</span>/<span class="number">32</span></span><br><span class="line"><span class="attr">DNS</span> = <span class="number">1.1</span>.<span class="number">1.1</span>, <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Peer]</span></span><br><span class="line"><span class="attr">PublicKey</span> = &lt;SERVER_PUBLIC_KEY&gt;</span><br><span class="line"><span class="attr">Endpoint</span> = &lt;EC2_PUBLIC_IP&gt;:<span class="number">51820</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 네트워크만 VPN으로 라우팅</span></span><br><span class="line"><span class="attr">AllowedIPs</span> = <span class="number">10.10</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PersistentKeepalive</span> = <span class="number">25</span></span><br></pre></td></tr></table></figure><h2 id="5-문제-발생"><a href="#5-문제-발생" class="headerlink" title="5. 문제 발생"></a>5. 문제 발생</h2><ul><li>VPN 연결은 성공</li><li>라우팅도 정상</li><li>하지만 인터넷 불가</li><li><code>wg show</code>에 handshake 없음</li></ul><hr><h2 id="6-NAT-확인"><a href="#6-NAT-확인" class="headerlink" title="6. NAT 확인"></a>6. NAT 확인</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -t nat -S POSTROUTING</span><br><span class="line"></span><br><span class="line">-P POSTROUTING ACCEPT</span><br><span class="line">-A POSTROUTING -s 10.100.0.0/24 -d 10.1.0.0/20 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 10.100.0.0/24 -o ens5 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>불필요한 eth0 룰 제거:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure><hr><h2 id="7-tcpdump로-패킷-확인"><a href="#7-tcpdump로-패킷-확인" class="headerlink" title="7. tcpdump로 패킷 확인"></a>7. tcpdump로 패킷 확인</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcpdump -ni ens5 udp port 51820</span><br></pre></td></tr></table></figure><p>→ UDP 패킷 도착 확인</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/Linux/">Linux</category>
      
      
      <category domain="https://ckck803.github.io/tags/Linux/">Linux</category>
      
      <category domain="https://ckck803.github.io/tags/WireGuard/">WireGuard</category>
      
      <category domain="https://ckck803.github.io/tags/VPN/">VPN</category>
      
      <category domain="https://ckck803.github.io/tags/Security/">Security</category>
      
      <category domain="https://ckck803.github.io/tags/Dual-Tunneling/">Dual Tunneling</category>
      
      
      <comments>https://ckck803.github.io/2025/12/30/linux/wireguard-vpn-guide/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>RAG 성능 최적화 기법</title>
      <link>https://ckck803.github.io/2025/12/29/rag/rag-optimization/</link>
      <guid>https://ckck803.github.io/2025/12/29/rag/rag-optimization/</guid>
      <pubDate>Mon, 29 Dec 2025 09:33:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/rag.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;RAG-시스템-최적화-개요&quot;&gt;&lt;a href=&quot;#RAG-시스템-최적화-개요&quot; class=&quot;headerlink&quot; title=&quot;RAG 시스템 최적화 개요&quot;&gt;&lt;/a&gt;RAG 시스템 최적화 개요&lt;/h2&gt;&lt;p&gt;RAG 시스템의 성능은 다음 세 가지 측면에서 최적화할 수 있습니다:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;검색 품질&lt;/strong&gt; - 관련성 높은 문서 찾기&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;응답 품질&lt;/strong&gt; - 정확하고 유용한 답변 생성&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;성능&amp;#x2F;비용&lt;/strong&gt; - 빠른 응답과 비용 효율성&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;1-청킹-전략-최적화&quot;&gt;&lt;a href=&quot;#1-청킹-전략-최적화&quot; class=&quot;headerlink&quot; title=&quot;1. 청킹 전략 최적화&quot;&gt;&lt;/a&gt;1. 청킹 전략 최적화&lt;/h2&gt;&lt;h3 id=&quot;1-1-고정-크기-청킹&quot;&gt;&lt;a href=&quot;#1-1-고정-크기-청킹&quot; class=&quot;headerlink&quot; title=&quot;1.1 고정 크기 청킹&quot;&gt;&lt;/a&gt;1.1 고정 크기 청킹&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; langchain.text_splitter &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; RecursiveCharacterTextSplitter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 기본 설정&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;text_splitter = RecursiveCharacterTextSplitter(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_size=&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_overlap=&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    length_function=&lt;span class=&quot;built_in&quot;&gt;len&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 문서 유형별 최적화&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 기술 문서 - 작은 청크&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tech_splitter = RecursiveCharacterTextSplitter(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_size=&lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_overlap=&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 소설/긴 글 - 큰 청크&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;narrative_splitter = RecursiveCharacterTextSplitter(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_size=&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    chunk_overlap=&lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-2-의미-기반-청킹&quot;&gt;&lt;a href=&quot;#1-2-의미-기반-청킹&quot; class=&quot;headerlink&quot; title=&quot;1.2 의미 기반 청킹&quot;&gt;&lt;/a&gt;1.2 의미 기반 청킹&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; langchain_experimental.text_splitter &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SemanticChunker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; langchain_openai.embeddings &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; OpenAIEmbeddings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 의미론적 유사도로 분할&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;semantic_chunker = SemanticChunker(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    OpenAIEmbeddings(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    breakpoint_threshold_type=&lt;span class=&quot;string&quot;&gt;&amp;quot;percentile&amp;quot;&lt;/span&gt;,  &lt;span class=&quot;comment&quot;&gt;# or &amp;quot;standard_deviation&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    breakpoint_threshold_amount=&lt;span class=&quot;number&quot;&gt;95&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;# 상위 5%에서 분할&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chunks = semantic_chunker.split_documents(documents)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;1-3-문서-구조-기반-청킹&quot;&gt;&lt;a href=&quot;#1-3-문서-구조-기반-청킹&quot; class=&quot;headerlink&quot; title=&quot;1.3 문서 구조 기반 청킹&quot;&gt;&lt;/a&gt;1.3 문서 구조 기반 청킹&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/rag.png"></p><h2 id="RAG-시스템-최적화-개요"><a href="#RAG-시스템-최적화-개요" class="headerlink" title="RAG 시스템 최적화 개요"></a>RAG 시스템 최적화 개요</h2><p>RAG 시스템의 성능은 다음 세 가지 측면에서 최적화할 수 있습니다:</p><ol><li><strong>검색 품질</strong> - 관련성 높은 문서 찾기</li><li><strong>응답 품질</strong> - 정확하고 유용한 답변 생성</li><li><strong>성능&#x2F;비용</strong> - 빠른 응답과 비용 효율성</li></ol><h2 id="1-청킹-전략-최적화"><a href="#1-청킹-전략-최적화" class="headerlink" title="1. 청킹 전략 최적화"></a>1. 청킹 전략 최적화</h2><h3 id="1-1-고정-크기-청킹"><a href="#1-1-고정-크기-청킹" class="headerlink" title="1.1 고정 크기 청킹"></a>1.1 고정 크기 청킹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 설정</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">1000</span>,</span><br><span class="line">    chunk_overlap=<span class="number">200</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 문서 유형별 최적화</span></span><br><span class="line"><span class="comment">## 기술 문서 - 작은 청크</span></span><br><span class="line">tech_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">500</span>,</span><br><span class="line">    chunk_overlap=<span class="number">100</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 소설/긴 글 - 큰 청크</span></span><br><span class="line">narrative_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">2000</span>,</span><br><span class="line">    chunk_overlap=<span class="number">400</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="1-2-의미-기반-청킹"><a href="#1-2-의미-기반-청킹" class="headerlink" title="1.2 의미 기반 청킹"></a>1.2 의미 기반 청킹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_experimental.text_splitter <span class="keyword">import</span> SemanticChunker</span><br><span class="line"><span class="keyword">from</span> langchain_openai.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 의미론적 유사도로 분할</span></span><br><span class="line">semantic_chunker = SemanticChunker(</span><br><span class="line">    OpenAIEmbeddings(),</span><br><span class="line">    breakpoint_threshold_type=<span class="string">&quot;percentile&quot;</span>,  <span class="comment"># or &quot;standard_deviation&quot;</span></span><br><span class="line">    breakpoint_threshold_amount=<span class="number">95</span>  <span class="comment"># 상위 5%에서 분할</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chunks = semantic_chunker.split_documents(documents)</span><br></pre></td></tr></table></figure><h3 id="1-3-문서-구조-기반-청킹"><a href="#1-3-문서-구조-기반-청킹" class="headerlink" title="1.3 문서 구조 기반 청킹"></a>1.3 문서 구조 기반 청킹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> MarkdownHeaderTextSplitter</span><br><span class="line"></span><br><span class="line"><span class="comment"># Markdown 헤더 기준 분할</span></span><br><span class="line">headers_to_split_on = [</span><br><span class="line">    (<span class="string">&quot;#&quot;</span>, <span class="string">&quot;Header 1&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;##&quot;</span>, <span class="string">&quot;Header 2&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;###&quot;</span>, <span class="string">&quot;Header 3&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">markdown_splitter = MarkdownHeaderTextSplitter(</span><br><span class="line">    headers_to_split_on=headers_to_split_on</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">md_chunks = markdown_splitter.split_text(markdown_document)</span><br></pre></td></tr></table></figure><h3 id="1-4-청크에-컨텍스트-추가"><a href="#1-4-청크에-컨텍스트-추가" class="headerlink" title="1.4 청크에 컨텍스트 추가"></a>1.4 청크에 컨텍스트 추가</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_context_to_chunks</span>(<span class="params">chunks, context_window=<span class="number">1</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;이전/다음 청크 정보를 메타데이터에 추가&quot;&quot;&quot;</span></span><br><span class="line">    enhanced_chunks = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks):</span><br><span class="line">        <span class="comment"># 이전 청크의 마지막 부분</span></span><br><span class="line">        prev_context = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">            prev_context = chunks[i-<span class="number">1</span>].page_content[-<span class="number">100</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 다음 청크의 시작 부분</span></span><br><span class="line">        next_context = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(chunks) - <span class="number">1</span>:</span><br><span class="line">            next_context = chunks[i+<span class="number">1</span>].page_content[:<span class="number">100</span>]</span><br><span class="line"></span><br><span class="line">        chunk.metadata[<span class="string">&quot;prev_context&quot;</span>] = prev_context</span><br><span class="line">        chunk.metadata[<span class="string">&quot;next_context&quot;</span>] = next_context</span><br><span class="line">        enhanced_chunks.append(chunk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> enhanced_chunks</span><br></pre></td></tr></table></figure><h2 id="2-임베딩-최적화"><a href="#2-임베딩-최적화" class="headerlink" title="2. 임베딩 최적화"></a>2. 임베딩 최적화</h2><h3 id="2-1-임베딩-모델-선택"><a href="#2-1-임베딩-모델-선택" class="headerlink" title="2.1 임베딩 모델 선택"></a>2.1 임베딩 모델 선택</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenAI - 고품질, 유료</span></span><br><span class="line">openai_embeddings = OpenAIEmbeddings(</span><br><span class="line">    model=<span class="string">&quot;text-embedding-3-large&quot;</span>,  <span class="comment"># 3072 차원</span></span><br><span class="line">    <span class="comment"># model=&quot;text-embedding-3-small&quot;,  # 1536 차원 (더 빠름, 저렴)</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 오픈소스 - 무료, 로컬 실행</span></span><br><span class="line">hf_embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;BAAI/bge-large-en-v1.5&quot;</span>,  <span class="comment"># 영어</span></span><br><span class="line">    <span class="comment"># model_name=&quot;BAAI/bge-m3&quot;,  # 다국어</span></span><br><span class="line">    model_kwargs=&#123;<span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;cpu&#x27;</span>&#125;,  <span class="comment"># 또는 &#x27;cuda&#x27;</span></span><br><span class="line">    encode_kwargs=&#123;<span class="string">&#x27;normalize_embeddings&#x27;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 한국어 특화</span></span><br><span class="line">ko_embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;jhgan/ko-sroberta-multitask&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="2-2-차원-축소-OpenAI-Embeddings"><a href="#2-2-차원-축소-OpenAI-Embeddings" class="headerlink" title="2.2 차원 축소 (OpenAI Embeddings)"></a>2.2 차원 축소 (OpenAI Embeddings)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 비용 절감을 위한 차원 축소</span></span><br><span class="line">small_embeddings = OpenAIEmbeddings(</span><br><span class="line">    model=<span class="string">&quot;text-embedding-3-large&quot;</span>,</span><br><span class="line">    dimensions=<span class="number">1024</span>  <span class="comment"># 기본 3072에서 축소</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="2-3-배치-임베딩"><a href="#2-3-배치-임베딩" class="headerlink" title="2.3 배치 임베딩"></a>2.3 배치 임베딩</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대량 문서 임베딩 - 배치 처리</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">batch_embed_documents</span>(<span class="params">docs, embeddings, batch_size=<span class="number">100</span></span>):</span><br><span class="line">    vectorstore = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(docs), batch_size):</span><br><span class="line">        batch = docs[i:i+batch_size]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> vectorstore <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            vectorstore = Chroma.from_documents(</span><br><span class="line">                batch,</span><br><span class="line">                embeddings,</span><br><span class="line">                persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            vectorstore.add_documents(batch)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Processed <span class="subst">&#123;<span class="built_in">min</span>(i+batch_size, <span class="built_in">len</span>(docs))&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(docs)&#125;</span> documents&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vectorstore</span><br></pre></td></tr></table></figure><h2 id="3-검색-최적화"><a href="#3-검색-최적화" class="headerlink" title="3. 검색 최적화"></a>3. 검색 최적화</h2><h3 id="3-1-하이브리드-검색-BM25-Vector"><a href="#3-1-하이브리드-검색-BM25-Vector" class="headerlink" title="3.1 하이브리드 검색 (BM25 + Vector)"></a>3.1 하이브리드 검색 (BM25 + Vector)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> BM25Retriever, EnsembleRetriever</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"></span><br><span class="line"><span class="comment"># 키워드 검색 (BM25)</span></span><br><span class="line">bm25_retriever = BM25Retriever.from_documents(documents)</span><br><span class="line">bm25_retriever.k = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 벡터 검색</span></span><br><span class="line">vectorstore = Chroma.from_documents(documents, embeddings)</span><br><span class="line">vector_retriever = vectorstore.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">5</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 하이브리드 (가중치 조정 가능)</span></span><br><span class="line">hybrid_retriever = EnsembleRetriever(</span><br><span class="line">    retrievers=[bm25_retriever, vector_retriever],</span><br><span class="line">    weights=[<span class="number">0.4</span>, <span class="number">0.6</span>]  <span class="comment"># BM25 40%, Vector 60%</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">results = hybrid_retriever.get_relevant_documents(<span class="string">&quot;query&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="3-2-MMR-Maximum-Marginal-Relevance"><a href="#3-2-MMR-Maximum-Marginal-Relevance" class="headerlink" title="3.2 MMR (Maximum Marginal Relevance)"></a>3.2 MMR (Maximum Marginal Relevance)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 다양성을 고려한 검색 - 중복 방지</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;mmr&quot;</span>,</span><br><span class="line">    search_kwargs=&#123;</span><br><span class="line">        <span class="string">&quot;k&quot;</span>: <span class="number">5</span>,           <span class="comment"># 최종 반환 문서 수</span></span><br><span class="line">        <span class="string">&quot;fetch_k&quot;</span>: <span class="number">20</span>,    <span class="comment"># 초기 후보 문서 수</span></span><br><span class="line">        <span class="string">&quot;lambda_mult&quot;</span>: <span class="number">0.5</span>  <span class="comment"># 0: 최대 다양성, 1: 최대 관련성</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="3-3-재순위화-Re-ranking"><a href="#3-3-재순위화-Re-ranking" class="headerlink" title="3.3 재순위화 (Re-ranking)"></a>3.3 재순위화 (Re-ranking)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ContextualCompressionRetriever</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> CohereRerank</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cohere Reranker 사용</span></span><br><span class="line">compressor = CohereRerank(</span><br><span class="line">    cohere_api_key=<span class="string">&quot;YOUR_API_KEY&quot;</span>,</span><br><span class="line">    top_n=<span class="number">3</span>  <span class="comment"># 상위 3개만 선택</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">    base_compressor=compressor,</span><br><span class="line">    base_retriever=vector_retriever</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 LLM 기반 재순위화</span></span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.document_compressors <span class="keyword">import</span> LLMChainExtractor</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(temperature=<span class="number">0</span>)</span><br><span class="line">compressor = LLMChainExtractor.from_llm(llm)</span><br><span class="line"></span><br><span class="line">compression_retriever = ContextualCompressionRetriever(</span><br><span class="line">    base_compressor=compressor,</span><br><span class="line">    base_retriever=vector_retriever</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="3-4-메타데이터-필터링"><a href="#3-4-메타데이터-필터링" class="headerlink" title="3.4 메타데이터 필터링"></a>3.4 메타데이터 필터링</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 메타데이터 기반 사전 필터링</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_kwargs=&#123;</span><br><span class="line">        <span class="string">&quot;k&quot;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;source&quot;</span>: <span class="string">&quot;technical_docs&quot;</span>,</span><br><span class="line">            <span class="string">&quot;year&quot;</span>: &#123;<span class="string">&quot;$gte&quot;</span>: <span class="number">2023</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 동적 필터링</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_filtered_retriever</span>(<span class="params">vectorstore, category=<span class="literal">None</span>, date_from=<span class="literal">None</span></span>):</span><br><span class="line">    filter_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> category:</span><br><span class="line">        filter_dict[<span class="string">&quot;category&quot;</span>] = category</span><br><span class="line">    <span class="keyword">if</span> date_from:</span><br><span class="line">        filter_dict[<span class="string">&quot;date&quot;</span>] = &#123;<span class="string">&quot;$gte&quot;</span>: date_from&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vectorstore.as_retriever(</span><br><span class="line">        search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">5</span>, <span class="string">&quot;filter&quot;</span>: filter_dict&#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h2 id="4-쿼리-최적화"><a href="#4-쿼리-최적화" class="headerlink" title="4. 쿼리 최적화"></a>4. 쿼리 최적화</h2><h3 id="4-1-쿼리-확장"><a href="#4-1-쿼리-확장" class="headerlink" title="4.1 쿼리 확장"></a>4.1 쿼리 확장</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> LLMChain</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 쿼리 확장 프롬프트</span></span><br><span class="line">query_expansion_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;원래 질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">이 질문과 관련된 3가지 유사한 질문을 생성하세요:</span></span><br><span class="line"><span class="string">1.</span></span><br><span class="line"><span class="string">2.</span></span><br><span class="line"><span class="string">3.&quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">expansion_chain = LLMChain(llm=llm, prompt=query_expansion_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 원본 + 확장 쿼리로 검색</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_with_expansion</span>(<span class="params">question, retriever</span>):</span><br><span class="line">    <span class="comment"># 원본 쿼리로 검색</span></span><br><span class="line">    original_docs = retriever.get_relevant_documents(question)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 쿼리 확장</span></span><br><span class="line">    expanded = expansion_chain.run(question=question)</span><br><span class="line">    expanded_questions = expanded.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 확장된 쿼리로 추가 검색</span></span><br><span class="line">    all_docs = original_docs</span><br><span class="line">    <span class="keyword">for</span> exp_q <span class="keyword">in</span> expanded_questions:</span><br><span class="line">        exp_docs = retriever.get_relevant_documents(exp_q.strip())</span><br><span class="line">        all_docs.extend(exp_docs)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 중복 제거</span></span><br><span class="line">    unique_docs = <span class="built_in">list</span>(&#123;doc.page_content: doc <span class="keyword">for</span> doc <span class="keyword">in</span> all_docs&#125;.values())</span><br><span class="line">    <span class="keyword">return</span> unique_docs[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure><h3 id="4-2-HyDE-Hypothetical-Document-Embeddings"><a href="#4-2-HyDE-Hypothetical-Document-Embeddings" class="headerlink" title="4.2 HyDE (Hypothetical Document Embeddings)"></a>4.2 HyDE (Hypothetical Document Embeddings)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> HypotheticalDocumentEmbedder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가상 답변 생성 후 검색</span></span><br><span class="line">hyde_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">이 질문에 대한 상세한 답변을 작성하세요 (실제 사실 여부와 무관):&quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">hyde_chain = LLMChain(llm=llm, prompt=hyde_prompt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hyde_search</span>(<span class="params">question, retriever</span>):</span><br><span class="line">    <span class="comment"># 1. LLM이 가상 답변 생성</span></span><br><span class="line">    hypothetical_answer = hyde_chain.run(question=question)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 가상 답변의 임베딩으로 검색</span></span><br><span class="line">    docs = retriever.get_relevant_documents(hypothetical_answer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> docs</span><br></pre></td></tr></table></figure><h3 id="4-3-쿼리-재작성"><a href="#4-3-쿼리-재작성" class="headerlink" title="4.3 쿼리 재작성"></a>4.3 쿼리 재작성</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 쿼리 재작성 프롬프트</span></span><br><span class="line">rewrite_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;다음 질문을 검색에 최적화된 형태로 재작성하세요.</span></span><br><span class="line"><span class="string">핵심 키워드를 강조하고, 불필요한 단어는 제거하세요.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">원래 질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">재작성된 질문:&quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">rewrite_chain = LLMChain(llm=llm, prompt=rewrite_prompt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_with_rewrite</span>(<span class="params">question, retriever</span>):</span><br><span class="line">    rewritten = rewrite_chain.run(question=question)</span><br><span class="line">    <span class="keyword">return</span> retriever.get_relevant_documents(rewritten)</span><br></pre></td></tr></table></figure><h2 id="5-프롬프트-엔지니어링"><a href="#5-프롬프트-엔지니어링" class="headerlink" title="5. 프롬프트 엔지니어링"></a>5. 프롬프트 엔지니어링</h2><h3 id="5-1-고급-시스템-프롬프트"><a href="#5-1-고급-시스템-프롬프트" class="headerlink" title="5.1 고급 시스템 프롬프트"></a>5.1 고급 시스템 프롬프트</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line">advanced_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;당신은 정확하고 신뢰할 수 있는 AI 어시스턴트입니다.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">지침:</span></span><br><span class="line"><span class="string">1. 제공된 컨텍스트만을 사용하여 답변하세요</span></span><br><span class="line"><span class="string">2. 컨텍스트에 답이 없으면 &quot;제공된 정보에서 답을 찾을 수 없습니다&quot;라고 답하세요</span></span><br><span class="line"><span class="string">3. 추측하거나 외부 지식을 사용하지 마세요</span></span><br><span class="line"><span class="string">4. 답변에 관련 섹션을 인용하세요</span></span><br><span class="line"><span class="string">5. 간결하고 명확하게 답변하세요</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">컨텍스트:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">답변 (인용 포함):&quot;&quot;&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="5-2-Few-shot-프롬프트"><a href="#5-2-Few-shot-프롬프트" class="headerlink" title="5.2 Few-shot 프롬프트"></a>5.2 Few-shot 프롬프트</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">few_shot_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;다음 예제를 참고하여 답변하세요:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">예제 1:</span></span><br><span class="line"><span class="string">질문: RAG의 장점은?</span></span><br><span class="line"><span class="string">답변: RAG의 주요 장점은 다음과 같습니다:</span></span><br><span class="line"><span class="string">1. 최신 정보 활용 가능</span></span><br><span class="line"><span class="string">2. 환각 현상 감소</span></span><br><span class="line"><span class="string">[출처: RAG Overview, p.5]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">예제 2:</span></span><br><span class="line"><span class="string">질문: 벡터 데이터베이스란?</span></span><br><span class="line"><span class="string">답변: 벡터 데이터베이스는 고차원 벡터를 효율적으로 저장하고 검색하는 데이터베이스입니다.</span></span><br><span class="line"><span class="string">[출처: Vector DB Guide, p.12]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">이제 다음 질문에 답하세요:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">컨텍스트:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">답변:&quot;&quot;&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="5-3-Chain-of-Thought-프롬프트"><a href="#5-3-Chain-of-Thought-프롬프트" class="headerlink" title="5.3 Chain-of-Thought 프롬프트"></a>5.3 Chain-of-Thought 프롬프트</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cot_prompt = PromptTemplate(</span><br><span class="line">    input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">    template=<span class="string">&quot;&quot;&quot;단계별로 생각하며 답변하세요:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">컨텍스트:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">답변 과정:</span></span><br><span class="line"><span class="string">1. 먼저 질문의 핵심을 파악합니다:</span></span><br><span class="line"><span class="string">2. 관련 정보를 컨텍스트에서 찾습니다:</span></span><br><span class="line"><span class="string">3. 찾은 정보를 종합합니다:</span></span><br><span class="line"><span class="string">4. 최종 답변:&quot;&quot;&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="6-응답-생성-최적화"><a href="#6-응답-생성-최적화" class="headerlink" title="6. 응답 생성 최적화"></a>6. 응답 생성 최적화</h2><h3 id="6-1-스트리밍-응답"><a href="#6-1-스트리밍-응답" class="headerlink" title="6.1 스트리밍 응답"></a>6.1 스트리밍 응답</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.callbacks.streaming_stdout <span class="keyword">import</span> StreamingStdOutCallbackHandler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 스트리밍으로 빠른 첫 응답</span></span><br><span class="line">streaming_llm = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;gpt-4o&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,</span><br><span class="line">    streaming=<span class="literal">True</span>,</span><br><span class="line">    callbacks=[StreamingStdOutCallbackHandler()]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=streaming_llm,</span><br><span class="line">    retriever=retriever</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="6-2-응답-캐싱"><a href="#6-2-응답-캐싱" class="headerlink" title="6.2 응답 캐싱"></a>6.2 응답 캐싱</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.cache <span class="keyword">import</span> InMemoryCache, SQLiteCache</span><br><span class="line"><span class="keyword">from</span> langchain.<span class="built_in">globals</span> <span class="keyword">import</span> set_llm_cache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 메모리 캐시</span></span><br><span class="line">set_llm_cache(InMemoryCache())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 영구 캐시</span></span><br><span class="line">set_llm_cache(SQLiteCache(database_path=<span class="string">&quot;.langchain.db&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 동일한 질문에 대해 캐시된 답변 사용</span></span><br><span class="line">result1 = qa_chain.run(<span class="string">&quot;RAG란?&quot;</span>)  <span class="comment"># LLM 호출</span></span><br><span class="line">result2 = qa_chain.run(<span class="string">&quot;RAG란?&quot;</span>)  <span class="comment"># 캐시에서 반환 (빠름)</span></span><br></pre></td></tr></table></figure><h3 id="6-3-토큰-최적화"><a href="#6-3-토큰-최적화" class="headerlink" title="6.3 토큰 최적화"></a>6.3 토큰 최적화</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tiktoken</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_tokens</span>(<span class="params">text, model=<span class="string">&quot;gpt-4&quot;</span></span>):</span><br><span class="line">    encoding = tiktoken.encoding_for_model(model)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(encoding.encode(text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">optimize_context</span>(<span class="params">docs, max_tokens=<span class="number">3000</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;컨텍스트를 토큰 제한 내로 압축&quot;&quot;&quot;</span></span><br><span class="line">    context = <span class="string">&quot;&quot;</span></span><br><span class="line">    total_tokens = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> docs:</span><br><span class="line">        doc_tokens = count_tokens(doc.page_content)</span><br><span class="line">        <span class="keyword">if</span> total_tokens + doc_tokens &lt;= max_tokens:</span><br><span class="line">            context += doc.page_content + <span class="string">&quot;\n\n&quot;</span></span><br><span class="line">            total_tokens += doc_tokens</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> context</span><br></pre></td></tr></table></figure><h2 id="7-평가-및-모니터링"><a href="#7-평가-및-모니터링" class="headerlink" title="7. 평가 및 모니터링"></a>7. 평가 및 모니터링</h2><h3 id="7-1-검색-품질-평가"><a href="#7-1-검색-품질-평가" class="headerlink" title="7.1 검색 품질 평가"></a>7.1 검색 품질 평가</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.evaluation <span class="keyword">import</span> load_evaluator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 관련성 평가</span></span><br><span class="line">relevance_evaluator = load_evaluator(<span class="string">&quot;criteria&quot;</span>, criteria=<span class="string">&quot;relevance&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_retrieval</span>(<span class="params">query, retrieved_docs</span>):</span><br><span class="line">    scores = []</span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> retrieved_docs:</span><br><span class="line">        result = relevance_evaluator.evaluate_strings(</span><br><span class="line">            prediction=doc.page_content,</span><br><span class="line">            <span class="built_in">input</span>=query</span><br><span class="line">        )</span><br><span class="line">        scores.append(result[<span class="string">&#x27;score&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&#x27;avg_score&#x27;</span>: <span class="built_in">sum</span>(scores) / <span class="built_in">len</span>(scores),</span><br><span class="line">        <span class="string">&#x27;scores&#x27;</span>: scores</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 평가 실행</span></span><br><span class="line">eval_result = evaluate_retrieval(</span><br><span class="line">    <span class="string">&quot;RAG의 장점은?&quot;</span>,</span><br><span class="line">    retrieved_docs</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;평균 관련성 점수: <span class="subst">&#123;eval_result[<span class="string">&#x27;avg_score&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="7-2-답변-품질-평가"><a href="#7-2-답변-품질-평가" class="headerlink" title="7.2 답변 품질 평가"></a>7.2 답변 품질 평가</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.evaluation.qa <span class="keyword">import</span> QAEvalChain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 테스트 데이터셋</span></span><br><span class="line">test_questions = [</span><br><span class="line">    &#123;<span class="string">&quot;question&quot;</span>: <span class="string">&quot;RAG란?&quot;</span>, <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;Retrieval-Augmented Generation...&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;question&quot;</span>: <span class="string">&quot;벡터 DB는?&quot;</span>, <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;고차원 벡터를 저장...&quot;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 평가 체인</span></span><br><span class="line">eval_chain = QAEvalChain.from_llm(llm)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 예측 및 평가</span></span><br><span class="line">predictions = []</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> test_questions:</span><br><span class="line">    pred = qa_chain.run(item[<span class="string">&quot;question&quot;</span>])</span><br><span class="line">    predictions.append(&#123;<span class="string">&quot;query&quot;</span>: item[<span class="string">&quot;question&quot;</span>], <span class="string">&quot;result&quot;</span>: pred&#125;)</span><br><span class="line"></span><br><span class="line">graded_outputs = eval_chain.evaluate(</span><br><span class="line">    test_questions,</span><br><span class="line">    predictions,</span><br><span class="line">    question_key=<span class="string">&quot;question&quot;</span>,</span><br><span class="line">    answer_key=<span class="string">&quot;answer&quot;</span>,</span><br><span class="line">    prediction_key=<span class="string">&quot;result&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, output <span class="keyword">in</span> <span class="built_in">enumerate</span>(graded_outputs):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Q: <span class="subst">&#123;test_questions[i][<span class="string">&#x27;question&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Grade: <span class="subst">&#123;output[<span class="string">&#x27;results&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="7-3-성능-모니터링"><a href="#7-3-성능-모니터링" class="headerlink" title="7.3 성능 모니터링"></a>7.3 성능 모니터링</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGMonitor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.metrics = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_query</span>(<span class="params">self, query, retrieval_time, generation_time, num_docs</span>):</span><br><span class="line">        self.metrics.append(&#123;</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now(),</span><br><span class="line">            <span class="string">&#x27;query&#x27;</span>: query,</span><br><span class="line">            <span class="string">&#x27;retrieval_time&#x27;</span>: retrieval_time,</span><br><span class="line">            <span class="string">&#x27;generation_time&#x27;</span>: generation_time,</span><br><span class="line">            <span class="string">&#x27;total_time&#x27;</span>: retrieval_time + generation_time,</span><br><span class="line">            <span class="string">&#x27;num_docs&#x27;</span>: num_docs</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_stats</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.metrics:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;total_queries&#x27;</span>: <span class="built_in">len</span>(self.metrics),</span><br><span class="line">            <span class="string">&#x27;avg_retrieval_time&#x27;</span>: <span class="built_in">sum</span>(m[<span class="string">&#x27;retrieval_time&#x27;</span>] <span class="keyword">for</span> m <span class="keyword">in</span> self.metrics) / <span class="built_in">len</span>(self.metrics),</span><br><span class="line">            <span class="string">&#x27;avg_generation_time&#x27;</span>: <span class="built_in">sum</span>(m[<span class="string">&#x27;generation_time&#x27;</span>] <span class="keyword">for</span> m <span class="keyword">in</span> self.metrics) / <span class="built_in">len</span>(self.metrics),</span><br><span class="line">            <span class="string">&#x27;avg_total_time&#x27;</span>: <span class="built_in">sum</span>(m[<span class="string">&#x27;total_time&#x27;</span>] <span class="keyword">for</span> m <span class="keyword">in</span> self.metrics) / <span class="built_in">len</span>(self.metrics),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예</span></span><br><span class="line">monitor = RAGMonitor()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">monitored_query</span>(<span class="params">question</span>):</span><br><span class="line">    <span class="comment"># 검색 시간 측정</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    docs = retriever.get_relevant_documents(question)</span><br><span class="line">    retrieval_time = time.time() - start</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 생성 시간 측정</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    answer = qa_chain.run(question)</span><br><span class="line">    generation_time = time.time() - start</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 로깅</span></span><br><span class="line">    monitor.log_query(question, retrieval_time, generation_time, <span class="built_in">len</span>(docs))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 통계 확인</span></span><br><span class="line">stats = monitor.get_stats()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;평균 검색 시간: <span class="subst">&#123;stats[<span class="string">&#x27;avg_retrieval_time&#x27;</span>]:<span class="number">.3</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;평균 생성 시간: <span class="subst">&#123;stats[<span class="string">&#x27;avg_generation_time&#x27;</span>]:<span class="number">.3</span>f&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="8-고급-최적화-패턴"><a href="#8-고급-최적화-패턴" class="headerlink" title="8. 고급 최적화 패턴"></a>8. 고급 최적화 패턴</h2><h3 id="8-1-부모-자식-청킹"><a href="#8-1-부모-자식-청킹" class="headerlink" title="8.1 부모-자식 청킹"></a>8.1 부모-자식 청킹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.storage <span class="keyword">import</span> InMemoryStore</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> ParentDocumentRetriever</span><br><span class="line"></span><br><span class="line"><span class="comment"># 부모 문서 저장소</span></span><br><span class="line">parent_store = InMemoryStore()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 자식 청크로 검색, 부모 문서 반환</span></span><br><span class="line">parent_retriever = ParentDocumentRetriever(</span><br><span class="line">    vectorstore=vectorstore,</span><br><span class="line">    docstore=parent_store,</span><br><span class="line">    child_splitter=RecursiveCharacterTextSplitter(chunk_size=<span class="number">400</span>),</span><br><span class="line">    parent_splitter=RecursiveCharacterTextSplitter(chunk_size=<span class="number">2000</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">parent_retriever.add_documents(documents)</span><br></pre></td></tr></table></figure><h3 id="8-2-셀프-쿼리-Self-Query"><a href="#8-2-셀프-쿼리-Self-Query" class="headerlink" title="8.2 셀프 쿼리 (Self-Query)"></a>8.2 셀프 쿼리 (Self-Query)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains.query_constructor.base <span class="keyword">import</span> AttributeInfo</span><br><span class="line"><span class="keyword">from</span> langchain.retrievers.self_query.base <span class="keyword">import</span> SelfQueryRetriever</span><br><span class="line"></span><br><span class="line"><span class="comment"># 메타데이터 정의</span></span><br><span class="line">metadata_field_info = [</span><br><span class="line">    AttributeInfo(</span><br><span class="line">        name=<span class="string">&quot;source&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;문서 출처&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">    AttributeInfo(</span><br><span class="line">        name=<span class="string">&quot;year&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;문서 작성 연도&quot;</span>,</span><br><span class="line">        <span class="built_in">type</span>=<span class="string">&quot;integer&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 자동으로 메타데이터 필터링</span></span><br><span class="line">self_query_retriever = SelfQueryRetriever.from_llm(</span><br><span class="line">    llm,</span><br><span class="line">    vectorstore,</span><br><span class="line">    <span class="string">&quot;기술 문서 데이터베이스&quot;</span>,</span><br><span class="line">    metadata_field_info,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;2023년 이후 작성된 RAG 문서를 찾아줘&quot; -&gt; 자동 필터링</span></span><br><span class="line">docs = self_query_retriever.get_relevant_documents(</span><br><span class="line">    <span class="string">&quot;2023년 이후 작성된 RAG 문서&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="9-비용-최적화"><a href="#9-비용-최적화" class="headerlink" title="9. 비용 최적화"></a>9. 비용 최적화</h2><h3 id="9-1-모델-선택-전략"><a href="#9-1-모델-선택-전략" class="headerlink" title="9.1 모델 선택 전략"></a>9.1 모델 선택 전략</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 간단한 질문 - 저렴한 모델</span></span><br><span class="line">simple_llm = ChatOpenAI(model=<span class="string">&quot;gpt-4o-mini&quot;</span>, temperature=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 복잡한 질문 - 고성능 모델</span></span><br><span class="line">complex_llm = ChatOpenAI(model=<span class="string">&quot;gpt-4o&quot;</span>, temperature=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_query</span>(<span class="params">question</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;질문 복잡도에 따라 모델 선택&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(question.split()) &lt; <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> simple_llm</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> complex_llm</span><br></pre></td></tr></table></figure><h3 id="9-2-임베딩-재사용"><a href="#9-2-임베딩-재사용" class="headerlink" title="9.2 임베딩 재사용"></a>9.2 임베딩 재사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 한 번만 임베딩, 여러 번 재사용</span></span><br><span class="line">vectorstore.persist()  <span class="comment"># 저장</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 나중에 로드 (재임베딩 불필요)</span></span><br><span class="line">vectorstore = Chroma(</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span>,</span><br><span class="line">    embedding_function=embeddings</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="요약-최적화-체크리스트"><a href="#요약-최적화-체크리스트" class="headerlink" title="요약: 최적화 체크리스트"></a>요약: 최적화 체크리스트</h2><h3 id="검색-품질"><a href="#검색-품질" class="headerlink" title="검색 품질"></a>검색 품질</h3><ul><li><input disabled="" type="checkbox"> 적절한 청크 크기 선택 (500-1500 토큰)</li><li><input disabled="" type="checkbox"> 청크 오버랩 설정 (10-20%)</li><li><input disabled="" type="checkbox"> 하이브리드 검색 적용</li><li><input disabled="" type="checkbox"> MMR로 다양성 확보</li><li><input disabled="" type="checkbox"> 재순위화 적용</li><li><input disabled="" type="checkbox"> 메타데이터 필터링 활용</li></ul><h3 id="응답-품질"><a href="#응답-품질" class="headerlink" title="응답 품질"></a>응답 품질</h3><ul><li><input disabled="" type="checkbox"> 명확한 시스템 프롬프트</li><li><input disabled="" type="checkbox"> Few-shot 예제 제공</li><li><input disabled="" type="checkbox"> 출처 인용 요구</li><li><input disabled="" type="checkbox"> 답변 평가 체계 구축</li></ul><h3 id="성능-비용"><a href="#성능-비용" class="headerlink" title="성능&#x2F;비용"></a>성능&#x2F;비용</h3><ul><li><input disabled="" type="checkbox"> 응답 캐싱</li><li><input disabled="" type="checkbox"> 스트리밍 응답</li><li><input disabled="" type="checkbox"> 적절한 모델 선택</li><li><input disabled="" type="checkbox"> 임베딩 재사용</li><li><input disabled="" type="checkbox"> 배치 처리</li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/RAG/">RAG</category>
      
      
      <category domain="https://ckck803.github.io/tags/RAG/">RAG</category>
      
      <category domain="https://ckck803.github.io/tags/Optimization/">Optimization</category>
      
      <category domain="https://ckck803.github.io/tags/Performance/">Performance</category>
      
      <category domain="https://ckck803.github.io/tags/Best-Practices/">Best Practices</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/rag/rag-optimization/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>벡터 데이터베이스 비교 및 선택 가이드</title>
      <link>https://ckck803.github.io/2025/12/29/rag/vector-database-comparison/</link>
      <guid>https://ckck803.github.io/2025/12/29/rag/vector-database-comparison/</guid>
      <pubDate>Mon, 29 Dec 2025 09:32:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/rag.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;벡터-데이터베이스란&quot;&gt;&lt;a href=&quot;#벡터-데이터베이스란&quot; class=&quot;headerlink&quot; title=&quot;벡터 데이터베이스란?&quot;&gt;&lt;/a&gt;벡터 데이터베이스란?&lt;/h2&gt;&lt;p&gt;벡터 데이터베이스는 고차원 벡터 데이터를 효율적으로 저장하고 검색하는 데 특화된 데이터베이스입니다. RAG 시스템의 핵심 구성 요소입니다.&lt;/p&gt;
&lt;h2 id=&quot;주요-벡터-데이터베이스-비교&quot;&gt;&lt;a href=&quot;#주요-벡터-데이터베이스-비교&quot; class=&quot;headerlink&quot; title=&quot;주요 벡터 데이터베이스 비교&quot;&gt;&lt;/a&gt;주요 벡터 데이터베이스 비교&lt;/h2&gt;&lt;h3 id=&quot;1-ChromaDB&quot;&gt;&lt;a href=&quot;#1-ChromaDB&quot; class=&quot;headerlink&quot; title=&quot;1. ChromaDB&quot;&gt;&lt;/a&gt;1. ChromaDB&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;특징:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;오픈소스, 로컬 우선 설계&lt;/li&gt;
&lt;li&gt;Python 친화적&lt;/li&gt;
&lt;li&gt;가볍고 시작하기 쉬움&lt;/li&gt;
&lt;li&gt;임베디드 모드 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;장점:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;✅ 설치 및 설정이 매우 간단&lt;/li&gt;
&lt;li&gt;✅ 로컬 개발에 최적&lt;/li&gt;
&lt;li&gt;✅ 무료 오픈소스&lt;/li&gt;
&lt;li&gt;✅ 메타데이터 필터링 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;단점:&lt;/strong&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/rag.png"></p><h2 id="벡터-데이터베이스란"><a href="#벡터-데이터베이스란" class="headerlink" title="벡터 데이터베이스란?"></a>벡터 데이터베이스란?</h2><p>벡터 데이터베이스는 고차원 벡터 데이터를 효율적으로 저장하고 검색하는 데 특화된 데이터베이스입니다. RAG 시스템의 핵심 구성 요소입니다.</p><h2 id="주요-벡터-데이터베이스-비교"><a href="#주요-벡터-데이터베이스-비교" class="headerlink" title="주요 벡터 데이터베이스 비교"></a>주요 벡터 데이터베이스 비교</h2><h3 id="1-ChromaDB"><a href="#1-ChromaDB" class="headerlink" title="1. ChromaDB"></a>1. ChromaDB</h3><p><strong>특징:</strong></p><ul><li>오픈소스, 로컬 우선 설계</li><li>Python 친화적</li><li>가볍고 시작하기 쉬움</li><li>임베디드 모드 지원</li></ul><p><strong>장점:</strong></p><ul><li>✅ 설치 및 설정이 매우 간단</li><li>✅ 로컬 개발에 최적</li><li>✅ 무료 오픈소스</li><li>✅ 메타데이터 필터링 지원</li></ul><p><strong>단점:</strong></p><ul><li>❌ 대규모 프로덕션 환경에서는 제한적</li><li>❌ 분산 처리 기능 부족</li><li>❌ 고급 기능 제한적</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=docs,</span><br><span class="line">    embedding=embeddings,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>적합한 경우:</strong></p><ul><li>프로토타입 개발</li><li>소규모 프로젝트 (&lt;100만 벡터)</li><li>로컬 개발 환경</li></ul><h3 id="2-Pinecone"><a href="#2-Pinecone" class="headerlink" title="2. Pinecone"></a>2. Pinecone</h3><p><strong>특징:</strong></p><ul><li>완전 관리형 클라우드 서비스</li><li>높은 확장성</li><li>실시간 업데이트</li><li>엔터프라이즈급 성능</li></ul><p><strong>장점:</strong></p><ul><li>✅ 인프라 관리 불필요</li><li>✅ 무제한 확장 가능</li><li>✅ 빠른 쿼리 성능</li><li>✅ 네임스페이스, 메타데이터 필터링</li></ul><p><strong>단점:</strong></p><ul><li>❌ 비용 발생 (무료 플랜 제한적)</li><li>❌ 클라우드 종속성</li><li>❌ 로컬 개발 제한적</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Pinecone</span><br><span class="line"></span><br><span class="line">pinecone.init(</span><br><span class="line">    api_key=<span class="string">&quot;YOUR_API_KEY&quot;</span>,</span><br><span class="line">    environment=<span class="string">&quot;us-west1-gcp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">index_name = <span class="string">&quot;my-index&quot;</span></span><br><span class="line">vectorstore = Pinecone.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embeddings,</span><br><span class="line">    index_name=index_name</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>가격:</strong></p><ul><li>Starter: 무료 (1 pod, 100K 벡터, 5MB 저장)</li><li>Standard: $70&#x2F;month (1 pod)</li><li>Enterprise: 맞춤형</li></ul><p><strong>적합한 경우:</strong></p><ul><li>프로덕션 환경</li><li>대규모 데이터 (수백만~수십억 벡터)</li><li>글로벌 서비스</li></ul><h3 id="3-Weaviate"><a href="#3-Weaviate" class="headerlink" title="3. Weaviate"></a>3. Weaviate</h3><p><strong>특징:</strong></p><ul><li>오픈소스 벡터 데이터베이스</li><li>GraphQL API</li><li>하이브리드 검색 (벡터 + 키워드)</li><li>모듈식 아키텍처</li></ul><p><strong>장점:</strong></p><ul><li>✅ 오픈소스 + 클라우드 옵션</li><li>✅ 강력한 하이브리드 검색</li><li>✅ 멀티테넌시 지원</li><li>✅ RESTful API, GraphQL</li></ul><p><strong>단점:</strong></p><ul><li>❌ 초기 설정이 복잡</li><li>❌ 러닝 커브가 있음</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Weaviate</span><br><span class="line"><span class="keyword">import</span> weaviate</span><br><span class="line"></span><br><span class="line">client = weaviate.Client(</span><br><span class="line">    url=<span class="string">&quot;http://localhost:8080&quot;</span>,</span><br><span class="line">    additional_headers=&#123;<span class="string">&quot;X-OpenAI-Api-Key&quot;</span>: <span class="string">&quot;YOUR_KEY&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">vectorstore = Weaviate.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embeddings,</span><br><span class="line">    client=client,</span><br><span class="line">    index_name=<span class="string">&quot;Document&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>적합한 경우:</strong></p><ul><li>하이브리드 검색 필요</li><li>복잡한 메타데이터 쿼리</li><li>자체 호스팅 선호</li></ul><h3 id="4-Milvus-Zilliz-Cloud"><a href="#4-Milvus-Zilliz-Cloud" class="headerlink" title="4. Milvus &#x2F; Zilliz Cloud"></a>4. Milvus &#x2F; Zilliz Cloud</h3><p><strong>특징:</strong></p><ul><li>오픈소스 고성능 벡터 DB</li><li>GPU 가속 지원</li><li>대규모 데이터 처리</li><li>Zilliz는 관리형 서비스</li></ul><p><strong>장점:</strong></p><ul><li>✅ 매우 빠른 성능</li><li>✅ 대규모 확장성</li><li>✅ 다양한 인덱스 타입</li><li>✅ GPU 가속</li></ul><p><strong>단점:</strong></p><ul><li>❌ 설정 및 운영 복잡</li><li>❌ 리소스 요구사항 높음</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Milvus</span><br><span class="line"></span><br><span class="line">vectorstore = Milvus.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embeddings,</span><br><span class="line">    connection_args=&#123;</span><br><span class="line">        <span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;port&quot;</span>: <span class="string">&quot;19530&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>적합한 경우:</strong></p><ul><li>초대규모 데이터 (수십억 벡터)</li><li>높은 처리량 요구</li><li>GPU 인프라 보유</li></ul><h3 id="5-FAISS-Facebook-AI-Similarity-Search"><a href="#5-FAISS-Facebook-AI-Similarity-Search" class="headerlink" title="5. FAISS (Facebook AI Similarity Search)"></a>5. FAISS (Facebook AI Similarity Search)</h3><p><strong>특징:</strong></p><ul><li>Meta(Facebook)의 오픈소스 라이브러리</li><li>매우 빠른 유사도 검색</li><li>CPU&#x2F;GPU 지원</li><li>파일 기반 저장</li></ul><p><strong>장점:</strong></p><ul><li>✅ 극도로 빠른 검색</li><li>✅ 완전 무료</li><li>✅ 로컬 실행</li><li>✅ 다양한 인덱스 알고리즘</li></ul><p><strong>단점:</strong></p><ul><li>❌ 데이터베이스가 아님 (라이브러리)</li><li>❌ CRUD 제한적</li><li>❌ 분산 처리 불가</li><li>❌ 메타데이터 필터링 약함</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"></span><br><span class="line">vectorstore = FAISS.from_documents(docs, embeddings)</span><br><span class="line">vectorstore.save_local(<span class="string">&quot;faiss_index&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로드</span></span><br><span class="line">vectorstore = FAISS.load_local(</span><br><span class="line">    <span class="string">&quot;faiss_index&quot;</span>,</span><br><span class="line">    embeddings,</span><br><span class="line">    allow_dangerous_deserialization=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>적합한 경우:</strong></p><ul><li>읽기 중심 워크로드</li><li>로컬 개발&#x2F;테스트</li><li>비용 최소화</li></ul><h3 id="6-Qdrant"><a href="#6-Qdrant" class="headerlink" title="6. Qdrant"></a>6. Qdrant</h3><p><strong>특징:</strong></p><ul><li>Rust로 작성된 고성능 벡터 DB</li><li>풍부한 필터링</li><li>클라우드 + 오픈소스</li></ul><p><strong>장점:</strong></p><ul><li>✅ 빠른 성능</li><li>✅ 강력한 필터링</li><li>✅ 사용하기 쉬운 API</li><li>✅ 무료 클라우드 티어</li></ul><p><strong>단점:</strong></p><ul><li>❌ 상대적으로 새로운 프로젝트</li><li>❌ 커뮤니티 규모 작음</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Qdrant</span><br><span class="line"><span class="keyword">from</span> qdrant_client <span class="keyword">import</span> QdrantClient</span><br><span class="line"></span><br><span class="line">client = QdrantClient(host=<span class="string">&quot;localhost&quot;</span>, port=<span class="number">6333</span>)</span><br><span class="line"></span><br><span class="line">vectorstore = Qdrant.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embeddings,</span><br><span class="line">    url=<span class="string">&quot;http://localhost:6333&quot;</span>,</span><br><span class="line">    collection_name=<span class="string">&quot;my_documents&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="7-Elasticsearch"><a href="#7-Elasticsearch" class="headerlink" title="7. Elasticsearch"></a>7. Elasticsearch</h3><p><strong>특징:</strong></p><ul><li>검색 엔진에 벡터 검색 추가</li><li>하이브리드 검색 (BM25 + KNN)</li><li>성숙한 생태계</li></ul><p><strong>장점:</strong></p><ul><li>✅ 기존 ES 인프라 활용</li><li>✅ 강력한 전문 검색</li><li>✅ 풍부한 기능</li><li>✅ 대규모 엔터프라이즈 검증</li></ul><p><strong>단점:</strong></p><ul><li>❌ 순수 벡터 DB 대비 느림</li><li>❌ 복잡한 설정</li><li>❌ 리소스 소모 많음</li></ul><p><strong>적합한 경우:</strong></p><ul><li>기존 Elasticsearch 사용 중</li><li>하이브리드 검색 필수</li><li>전문 검색 + 벡터 검색</li></ul><h3 id="8-pgvector-PostgreSQL"><a href="#8-pgvector-PostgreSQL" class="headerlink" title="8. pgvector (PostgreSQL)"></a>8. pgvector (PostgreSQL)</h3><p><strong>특징:</strong></p><ul><li>PostgreSQL 확장</li><li>기존 RDB에 벡터 검색 추가</li><li>관계형 + 벡터 데이터 통합</li></ul><p><strong>장점:</strong></p><ul><li>✅ 기존 PostgreSQL 활용</li><li>✅ 트랜잭션 지원</li><li>✅ SQL 쿼리 가능</li><li>✅ 무료 오픈소스</li></ul><p><strong>단점:</strong></p><ul><li>❌ 전용 벡터 DB 대비 느림</li><li>❌ 확장성 제한적</li><li>❌ 인덱스 옵션 제한적</li></ul><p><strong>사용 예시:</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> PGVector</span><br><span class="line"></span><br><span class="line">CONNECTION_STRING = <span class="string">&quot;postgresql+psycopg2://user:pass@localhost:5432/vectordb&quot;</span></span><br><span class="line"></span><br><span class="line">vectorstore = PGVector.from_documents(</span><br><span class="line">    docs,</span><br><span class="line">    embeddings,</span><br><span class="line">    connection_string=CONNECTION_STRING,</span><br><span class="line">    collection_name=<span class="string">&quot;my_docs&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>적합한 경우:</strong></p><ul><li>기존 PostgreSQL 사용 중</li><li>관계형 + 벡터 데이터 통합</li><li>중소규모 데이터</li></ul><h2 id="벡터-데이터베이스-선택-기준"><a href="#벡터-데이터베이스-선택-기준" class="headerlink" title="벡터 데이터베이스 선택 기준"></a>벡터 데이터베이스 선택 기준</h2><h3 id="데이터-규모별-추천"><a href="#데이터-규모별-추천" class="headerlink" title="데이터 규모별 추천"></a>데이터 규모별 추천</h3><table><thead><tr><th>데이터 규모</th><th>추천 DB</th><th>이유</th></tr></thead><tbody><tr><td><strong>~10만 벡터</strong></td><td>ChromaDB, FAISS</td><td>간단하고 빠른 로컬 솔루션</td></tr><tr><td><strong>10만~100만</strong></td><td>Qdrant, Weaviate</td><td>적절한 성능과 기능</td></tr><tr><td><strong>100만~1억</strong></td><td>Pinecone, Milvus</td><td>확장성과 성능</td></tr><tr><td><strong>1억 이상</strong></td><td>Milvus, Pinecone</td><td>엔터프라이즈급 확장성</td></tr></tbody></table><h3 id="환경별-추천"><a href="#환경별-추천" class="headerlink" title="환경별 추천"></a>환경별 추천</h3><table><thead><tr><th>환경</th><th>추천 DB</th></tr></thead><tbody><tr><td><strong>로컬 개발</strong></td><td>ChromaDB, FAISS</td></tr><tr><td><strong>프로토타입</strong></td><td>ChromaDB, Qdrant Free</td></tr><tr><td><strong>프로덕션 (클라우드)</strong></td><td>Pinecone, Weaviate Cloud</td></tr><tr><td><strong>프로덕션 (온프레미스)</strong></td><td>Milvus, Weaviate, Qdrant</td></tr><tr><td><strong>기존 PostgreSQL</strong></td><td>pgvector</td></tr><tr><td><strong>기존 Elasticsearch</strong></td><td>Elasticsearch</td></tr></tbody></table><h3 id="기능별-비교"><a href="#기능별-비교" class="headerlink" title="기능별 비교"></a>기능별 비교</h3><table><thead><tr><th></th><th>ChromaDB</th><th>Pinecone</th><th>Weaviate</th><th>Milvus</th><th>FAISS</th><th>Qdrant</th></tr></thead><tbody><tr><td><strong>오픈소스</strong></td><td>✅</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td><strong>관리형 서비스</strong></td><td>❌</td><td>✅</td><td>✅</td><td>✅ (Zilliz)</td><td>❌</td><td>✅</td></tr><tr><td><strong>하이브리드 검색</strong></td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>❌</td><td>✅</td></tr><tr><td><strong>메타데이터 필터</strong></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>제한적</td><td>✅</td></tr><tr><td><strong>확장성</strong></td><td>낮음</td><td>매우 높음</td><td>높음</td><td>매우 높음</td><td>중간</td><td>높음</td></tr><tr><td><strong>설정 난이도</strong></td><td>쉬움</td><td>쉬움</td><td>중간</td><td>어려움</td><td>쉬움</td><td>쉬움</td></tr><tr><td><strong>성능</strong></td><td>중간</td><td>매우 높음</td><td>높음</td><td>매우 높음</td><td>매우 높음</td><td>높음</td></tr></tbody></table><h2 id="비용-비교"><a href="#비용-비교" class="headerlink" title="비용 비교"></a>비용 비교</h2><h3 id="무료-옵션"><a href="#무료-옵션" class="headerlink" title="무료 옵션"></a>무료 옵션</h3><ul><li><strong>ChromaDB</strong>: 완전 무료 (오픈소스)</li><li><strong>FAISS</strong>: 완전 무료 (오픈소스)</li><li><strong>Qdrant</strong>: 무료 티어 (1GB)</li><li><strong>Pinecone</strong>: 무료 스타터 (제한적)</li><li><strong>pgvector</strong>: 완전 무료 (PostgreSQL 필요)</li></ul><h3 id="유료-서비스-예상-비용"><a href="#유료-서비스-예상-비용" class="headerlink" title="유료 서비스 (예상 비용)"></a>유료 서비스 (예상 비용)</h3><ul><li><strong>Pinecone</strong>: $70~수천 달러&#x2F;월</li><li><strong>Weaviate Cloud</strong>: $25~수백 달러&#x2F;월</li><li><strong>Zilliz Cloud</strong>: 사용량 기반</li></ul><h2 id="실전-추천"><a href="#실전-추천" class="headerlink" title="실전 추천"></a>실전 추천</h2><h3 id="시작-단계-MVP-프로토타입"><a href="#시작-단계-MVP-프로토타입" class="headerlink" title="시작 단계 (MVP, 프로토타입)"></a>시작 단계 (MVP, 프로토타입)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ChromaDB 또는 FAISS</span><br><span class="line">→ 빠른 시작, 무료, 로컬 개발</span><br></pre></td></tr></table></figure><h3 id="성장-단계-수만-수십만-사용자"><a href="#성장-단계-수만-수십만-사용자" class="headerlink" title="성장 단계 (수만~수십만 사용자)"></a>성장 단계 (수만~수십만 사용자)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Qdrant (자체 호스팅) 또는 Pinecone (관리형)</span><br><span class="line">→ 적절한 성능과 비용</span><br></pre></td></tr></table></figure><h3 id="엔터프라이즈-단계"><a href="#엔터프라이즈-단계" class="headerlink" title="엔터프라이즈 단계"></a>엔터프라이즈 단계</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Pinecone (편의성) 또는 Milvus (커스터마이징)</span><br><span class="line">→ 최고 성능과 확장성</span><br></pre></td></tr></table></figure><h3 id="기존-인프라-활용"><a href="#기존-인프라-활용" class="headerlink" title="기존 인프라 활용"></a>기존 인프라 활용</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PostgreSQL 사용 중 → pgvector</span><br><span class="line">Elasticsearch 사용 중 → Elasticsearch + KNN</span><br></pre></td></tr></table></figure><h2 id="실습-벡터-DB-성능-비교"><a href="#실습-벡터-DB-성능-비교" class="headerlink" title="실습: 벡터 DB 성능 비교"></a>실습: 벡터 DB 성능 비교</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma, FAISS</span><br><span class="line"></span><br><span class="line"><span class="comment"># 테스트 데이터 준비</span></span><br><span class="line">docs = load_test_documents()  <span class="comment"># 1000개 문서</span></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ChromaDB 테스트</span></span><br><span class="line">start = time.time()</span><br><span class="line">chroma_db = Chroma.from_documents(docs, embeddings)</span><br><span class="line">chroma_time = time.time() - start</span><br><span class="line"></span><br><span class="line"><span class="comment"># FAISS 테스트</span></span><br><span class="line">start = time.time()</span><br><span class="line">faiss_db = FAISS.from_documents(docs, embeddings)</span><br><span class="line">faiss_time = time.time() - start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 검색 성능 테스트</span></span><br><span class="line">query = <span class="string">&quot;RAG 시스템이란?&quot;</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">chroma_results = chroma_db.similarity_search(query, k=<span class="number">5</span>)</span><br><span class="line">chroma_search_time = time.time() - start</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">faiss_results = faiss_db.similarity_search(query, k=<span class="number">5</span>)</span><br><span class="line">faiss_search_time = time.time() - start</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ChromaDB - 생성: <span class="subst">&#123;chroma_time:<span class="number">.2</span>f&#125;</span>s, 검색: <span class="subst">&#123;chroma_search_time:<span class="number">.4</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;FAISS - 생성: <span class="subst">&#123;faiss_time:<span class="number">.2</span>f&#125;</span>s, 검색: <span class="subst">&#123;faiss_search_time:<span class="number">.4</span>f&#125;</span>s&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><h3 id="일반적인-선택"><a href="#일반적인-선택" class="headerlink" title="일반적인 선택"></a>일반적인 선택</h3><ol><li><strong>개발&#x2F;테스트</strong>: ChromaDB</li><li><strong>소규모 프로덕션</strong>: Qdrant (자체 호스팅)</li><li><strong>중대규모 프로덕션</strong>: Pinecone</li><li><strong>초대규모&#x2F;특수 요구</strong>: Milvus</li></ol><p>벡터 데이터베이스는 RAG 시스템의 핵심입니다. 프로젝트의 규모, 예산, 기술 스택을 고려하여 적합한 솔루션을 선택하세요.</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/RAG/">RAG</category>
      
      
      <category domain="https://ckck803.github.io/tags/Vector-Database/">Vector Database</category>
      
      <category domain="https://ckck803.github.io/tags/ChromaDB/">ChromaDB</category>
      
      <category domain="https://ckck803.github.io/tags/Pinecone/">Pinecone</category>
      
      <category domain="https://ckck803.github.io/tags/Weaviate/">Weaviate</category>
      
      <category domain="https://ckck803.github.io/tags/Milvus/">Milvus</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/rag/vector-database-comparison/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>RAG 시스템 구축 가이드</title>
      <link>https://ckck803.github.io/2025/12/29/rag/rag-implementation-guide/</link>
      <guid>https://ckck803.github.io/2025/12/29/rag/rag-implementation-guide/</guid>
      <pubDate>Mon, 29 Dec 2025 09:31:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/rag.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;RAG-시스템-구축-단계&quot;&gt;&lt;a href=&quot;#RAG-시스템-구축-단계&quot; class=&quot;headerlink&quot; title=&quot;RAG 시스템 구축 단계&quot;&gt;&lt;/a&gt;RAG 시스템 구축 단계&lt;/h2&gt;&lt;p&gt;RAG 시스템을 처음부터 구축하는 전체 과정을 단계별로 설명합니다.&lt;/p&gt;
&lt;h2 id=&quot;1-환경-설정&quot;&gt;&lt;a href=&quot;#1-환경-설정&quot; class=&quot;headerlink&quot; title=&quot;1. 환경 설정&quot;&gt;&lt;/a&gt;1. 환경 설정&lt;/h2&gt;&lt;h3 id=&quot;필수-라이브러리-설치&quot;&gt;&lt;a href=&quot;#필수-라이브러리-설치&quot; class=&quot;headerlink&quot; title=&quot;필수 라이브러리 설치&quot;&gt;&lt;/a&gt;필수 라이브러리 설치&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Python 가상환경 생성&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;python -m venv venv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; venv/bin/activate  &lt;span class=&quot;comment&quot;&gt;# Windows: venv&#92;Scripts&#92;activate&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 기본 라이브러리 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install langchain langchain-community langchain-openai&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install chromadb  &lt;span class=&quot;comment&quot;&gt;# 벡터 데이터베이스&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install openai    &lt;span class=&quot;comment&quot;&gt;# OpenAI API&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install tiktoken  &lt;span class=&quot;comment&quot;&gt;# 토큰 카운팅&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install pypdf     &lt;span class=&quot;comment&quot;&gt;# PDF 처리&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pip install python-dotenv&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;환경-변수-설정&quot;&gt;&lt;a href=&quot;#환경-변수-설정&quot; class=&quot;headerlink&quot; title=&quot;환경 변수 설정&quot;&gt;&lt;/a&gt;환경 변수 설정&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# .env 파일 생성&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OPENAI_API_KEY=your-api-key-here&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-문서-준비-및-로딩&quot;&gt;&lt;a href=&quot;#2-문서-준비-및-로딩&quot; class=&quot;headerlink&quot; title=&quot;2. 문서 준비 및 로딩&quot;&gt;&lt;/a&gt;2. 문서 준비 및 로딩&lt;/h2&gt;&lt;h3 id=&quot;2-1-문서-로더-선택&quot;&gt;&lt;a href=&quot;#2-1-문서-로더-선택&quot; class=&quot;headerlink&quot; title=&quot;2.1 문서 로더 선택&quot;&gt;&lt;/a&gt;2.1 문서 로더 선택&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/rag.png"></p><h2 id="RAG-시스템-구축-단계"><a href="#RAG-시스템-구축-단계" class="headerlink" title="RAG 시스템 구축 단계"></a>RAG 시스템 구축 단계</h2><p>RAG 시스템을 처음부터 구축하는 전체 과정을 단계별로 설명합니다.</p><h2 id="1-환경-설정"><a href="#1-환경-설정" class="headerlink" title="1. 환경 설정"></a>1. 환경 설정</h2><h3 id="필수-라이브러리-설치"><a href="#필수-라이브러리-설치" class="headerlink" title="필수 라이브러리 설치"></a>필수 라이브러리 설치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python 가상환경 생성</span></span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># Windows: venv\Scripts\activate</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 라이브러리 설치</span></span><br><span class="line">pip install langchain langchain-community langchain-openai</span><br><span class="line">pip install chromadb  <span class="comment"># 벡터 데이터베이스</span></span><br><span class="line">pip install openai    <span class="comment"># OpenAI API</span></span><br><span class="line">pip install tiktoken  <span class="comment"># 토큰 카운팅</span></span><br><span class="line">pip install pypdf     <span class="comment"># PDF 처리</span></span><br><span class="line">pip install python-dotenv</span><br></pre></td></tr></table></figure><h3 id="환경-변수-설정"><a href="#환경-변수-설정" class="headerlink" title="환경 변수 설정"></a>환경 변수 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># .env 파일 생성</span></span><br><span class="line">OPENAI_API_KEY=your-api-key-here</span><br></pre></td></tr></table></figure><h2 id="2-문서-준비-및-로딩"><a href="#2-문서-준비-및-로딩" class="headerlink" title="2. 문서 준비 및 로딩"></a>2. 문서 준비 및 로딩</h2><h3 id="2-1-문서-로더-선택"><a href="#2-1-문서-로더-선택" class="headerlink" title="2.1 문서 로더 선택"></a>2.1 문서 로더 선택</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> (</span><br><span class="line">    PyPDFLoader,</span><br><span class="line">    TextLoader,</span><br><span class="line">    DirectoryLoader,</span><br><span class="line">    CSVLoader,</span><br><span class="line">    UnstructuredMarkdownLoader</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PDF 파일 로드</span></span><br><span class="line">loader = PyPDFLoader(<span class="string">&quot;document.pdf&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디렉토리 내 모든 문서 로드</span></span><br><span class="line">loader = DirectoryLoader(</span><br><span class="line">    <span class="string">&quot;data/&quot;</span>,</span><br><span class="line">    glob=<span class="string">&quot;**/*.txt&quot;</span>,</span><br><span class="line">    loader_cls=TextLoader</span><br><span class="line">)</span><br><span class="line">documents = loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Markdown 파일 로드</span></span><br><span class="line">loader = UnstructuredMarkdownLoader(<span class="string">&quot;README.md&quot;</span>)</span><br><span class="line">documents = loader.load()</span><br></pre></td></tr></table></figure><h3 id="2-2-다양한-소스-통합"><a href="#2-2-다양한-소스-통합" class="headerlink" title="2.2 다양한 소스 통합"></a>2.2 다양한 소스 통합</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> (</span><br><span class="line">    WebBaseLoader,</span><br><span class="line">    GitbookLoader,</span><br><span class="line">    NotionDirectoryLoader</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 웹 페이지 크롤링</span></span><br><span class="line">web_loader = WebBaseLoader(<span class="string">&quot;https://example.com/docs&quot;</span>)</span><br><span class="line">web_docs = web_loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Notion 문서 로드</span></span><br><span class="line">notion_loader = NotionDirectoryLoader(<span class="string">&quot;notion_export/&quot;</span>)</span><br><span class="line">notion_docs = notion_loader.load()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 모든 문서 통합</span></span><br><span class="line">all_documents = documents + web_docs + notion_docs</span><br></pre></td></tr></table></figure><h2 id="3-문서-분할-Chunking"><a href="#3-문서-분할-Chunking" class="headerlink" title="3. 문서 분할 (Chunking)"></a>3. 문서 분할 (Chunking)</h2><h3 id="3-1-기본-텍스트-분할"><a href="#3-1-기본-텍스트-분할" class="headerlink" title="3.1 기본 텍스트 분할"></a>3.1 기본 텍스트 분할</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 재귀적 문자 분할기 (가장 많이 사용)</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">1000</span>,        <span class="comment"># 청크 크기</span></span><br><span class="line">    chunk_overlap=<span class="number">200</span>,      <span class="comment"># 오버랩 크기</span></span><br><span class="line">    length_function=<span class="built_in">len</span>,</span><br><span class="line">    separators=[<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;\n&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>]  <span class="comment"># 우선순위별 구분자</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">chunks = text_splitter.split_documents(documents)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;총 청크 수: <span class="subst">&#123;<span class="built_in">len</span>(chunks)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="3-2-코드-전용-분할기"><a href="#3-2-코드-전용-분할기" class="headerlink" title="3.2 코드 전용 분할기"></a>3.2 코드 전용 분할기</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> (</span><br><span class="line">    Language,</span><br><span class="line">    RecursiveCharacterTextSplitter</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 코드 분할</span></span><br><span class="line">python_splitter = RecursiveCharacterTextSplitter.from_language(</span><br><span class="line">    language=Language.PYTHON,</span><br><span class="line">    chunk_size=<span class="number">1000</span>,</span><br><span class="line">    chunk_overlap=<span class="number">100</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">python_chunks = python_splitter.split_documents(python_docs)</span><br></pre></td></tr></table></figure><h3 id="3-3-의미-기반-분할"><a href="#3-3-의미-기반-분할" class="headerlink" title="3.3 의미 기반 분할"></a>3.3 의미 기반 분할</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_experimental.text_splitter <span class="keyword">import</span> SemanticChunker</span><br><span class="line"><span class="keyword">from</span> langchain_openai.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 의미론적 유사성 기반 분할</span></span><br><span class="line">semantic_chunker = SemanticChunker(</span><br><span class="line">    OpenAIEmbeddings(),</span><br><span class="line">    breakpoint_threshold_type=<span class="string">&quot;percentile&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">semantic_chunks = semantic_chunker.split_documents(documents)</span><br></pre></td></tr></table></figure><h2 id="4-임베딩-생성"><a href="#4-임베딩-생성" class="headerlink" title="4. 임베딩 생성"></a>4. 임베딩 생성</h2><h3 id="4-1-OpenAI-임베딩"><a href="#4-1-OpenAI-임베딩" class="headerlink" title="4.1 OpenAI 임베딩"></a>4.1 OpenAI 임베딩</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"></span><br><span class="line">embeddings = OpenAIEmbeddings(</span><br><span class="line">    model=<span class="string">&quot;text-embedding-3-small&quot;</span>,  <span class="comment"># 또는 text-embedding-3-large</span></span><br><span class="line">    openai_api_key=os.getenv(<span class="string">&quot;OPENAI_API_KEY&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 단일 텍스트 임베딩</span></span><br><span class="line">vector = embeddings.embed_query(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;벡터 차원: <span class="subst">&#123;<span class="built_in">len</span>(vector)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="4-2-오픈소스-임베딩-모델"><a href="#4-2-오픈소스-임베딩-모델" class="headerlink" title="4.2 오픈소스 임베딩 모델"></a>4.2 오픈소스 임베딩 모델</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 무료 오픈소스 모델 사용</span></span><br><span class="line">embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 한국어 특화 모델</span></span><br><span class="line">embeddings = HuggingFaceEmbeddings(</span><br><span class="line">    model_name=<span class="string">&quot;jhgan/ko-sroberta-multitask&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="5-벡터-데이터베이스-구축"><a href="#5-벡터-데이터베이스-구축" class="headerlink" title="5. 벡터 데이터베이스 구축"></a>5. 벡터 데이터베이스 구축</h2><h3 id="5-1-ChromaDB-로컬"><a href="#5-1-ChromaDB-로컬" class="headerlink" title="5.1 ChromaDB (로컬)"></a>5.1 ChromaDB (로컬)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"></span><br><span class="line"><span class="comment"># 벡터 스토어 생성</span></span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=chunks,</span><br><span class="line">    embedding=embeddings,</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span>  <span class="comment"># 저장 경로</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 저장</span></span><br><span class="line">vectorstore.persist()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 기존 DB 로드</span></span><br><span class="line">vectorstore = Chroma(</span><br><span class="line">    persist_directory=<span class="string">&quot;./chroma_db&quot;</span>,</span><br><span class="line">    embedding_function=embeddings</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="5-2-Pinecone-클라우드"><a href="#5-2-Pinecone-클라우드" class="headerlink" title="5.2 Pinecone (클라우드)"></a>5.2 Pinecone (클라우드)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Pinecone</span><br><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pinecone 초기화</span></span><br><span class="line">pinecone.init(</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;PINECONE_API_KEY&quot;</span>),</span><br><span class="line">    environment=<span class="string">&quot;us-west1-gcp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 인덱스 생성 및 데이터 추가</span></span><br><span class="line">index_name = <span class="string">&quot;my-rag-index&quot;</span></span><br><span class="line">vectorstore = Pinecone.from_documents(</span><br><span class="line">    chunks,</span><br><span class="line">    embeddings,</span><br><span class="line">    index_name=index_name</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="5-3-FAISS-로컬-고성능"><a href="#5-3-FAISS-로컬-고성능" class="headerlink" title="5.3 FAISS (로컬, 고성능)"></a>5.3 FAISS (로컬, 고성능)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"></span><br><span class="line"><span class="comment"># FAISS 벡터 스토어 생성</span></span><br><span class="line">vectorstore = FAISS.from_documents(chunks, embeddings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로컬 저장</span></span><br><span class="line">vectorstore.save_local(<span class="string">&quot;faiss_index&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로드</span></span><br><span class="line">vectorstore = FAISS.load_local(</span><br><span class="line">    <span class="string">&quot;faiss_index&quot;</span>,</span><br><span class="line">    embeddings,</span><br><span class="line">    allow_dangerous_deserialization=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="6-검색기-구성"><a href="#6-검색기-구성" class="headerlink" title="6. 검색기 구성"></a>6. 검색기 구성</h2><h3 id="6-1-기본-유사도-검색"><a href="#6-1-기본-유사도-검색" class="headerlink" title="6.1 기본 유사도 검색"></a>6.1 기본 유사도 검색</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 벡터 스토어를 검색기로 변환</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;similarity&quot;</span>,</span><br><span class="line">    search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">4</span>&#125;  <span class="comment"># 상위 4개 문서 반환</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 검색 테스트</span></span><br><span class="line">docs = retriever.get_relevant_documents(<span class="string">&quot;RAG란 무엇인가?&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> doc <span class="keyword">in</span> docs:</span><br><span class="line">    <span class="built_in">print</span>(doc.page_content[:<span class="number">100</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;---&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="6-2-MMR-Maximum-Marginal-Relevance-검색"><a href="#6-2-MMR-Maximum-Marginal-Relevance-검색" class="headerlink" title="6.2 MMR (Maximum Marginal Relevance) 검색"></a>6.2 MMR (Maximum Marginal Relevance) 검색</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 다양성을 고려한 검색</span></span><br><span class="line">retriever = vectorstore.as_retriever(</span><br><span class="line">    search_type=<span class="string">&quot;mmr&quot;</span>,</span><br><span class="line">    search_kwargs=&#123;</span><br><span class="line">        <span class="string">&quot;k&quot;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&quot;fetch_k&quot;</span>: <span class="number">20</span>,      <span class="comment"># 초기 후보 수</span></span><br><span class="line">        <span class="string">&quot;lambda_mult&quot;</span>: <span class="number">0.5</span>  <span class="comment"># 다양성 가중치 (0~1)</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="6-3-하이브리드-검색-BM25-Vector"><a href="#6-3-하이브리드-검색-BM25-Vector" class="headerlink" title="6.3 하이브리드 검색 (BM25 + Vector)"></a>6.3 하이브리드 검색 (BM25 + Vector)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> BM25Retriever, EnsembleRetriever</span><br><span class="line"></span><br><span class="line"><span class="comment"># BM25 키워드 검색기</span></span><br><span class="line">bm25_retriever = BM25Retriever.from_documents(chunks)</span><br><span class="line">bm25_retriever.k = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 벡터 검색기</span></span><br><span class="line">vector_retriever = vectorstore.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">4</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 하이브리드 검색기</span></span><br><span class="line">ensemble_retriever = EnsembleRetriever(</span><br><span class="line">    retrievers=[bm25_retriever, vector_retriever],</span><br><span class="line">    weights=[<span class="number">0.5</span>, <span class="number">0.5</span>]  <span class="comment"># 각 검색기 가중치</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="7-LLM-설정"><a href="#7-LLM-설정" class="headerlink" title="7. LLM 설정"></a>7. LLM 설정</h2><h3 id="7-1-OpenAI-모델"><a href="#7-1-OpenAI-모델" class="headerlink" title="7.1 OpenAI 모델"></a>7.1 OpenAI 모델</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;gpt-4o&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,  <span class="comment"># 일관성 있는 답변</span></span><br><span class="line">    openai_api_key=os.getenv(<span class="string">&quot;OPENAI_API_KEY&quot;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="7-2-오픈소스-모델-Ollama"><a href="#7-2-오픈소스-모델-Ollama" class="headerlink" title="7.2 오픈소스 모델 (Ollama)"></a>7.2 오픈소스 모델 (Ollama)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Ollama 설치 및 모델 다운로드</span></span><br><span class="line">ollama pull llama3</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> Ollama</span><br><span class="line"></span><br><span class="line">llm = Ollama(model=<span class="string">&quot;llama3&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="8-RAG-체인-구성"><a href="#8-RAG-체인-구성" class="headerlink" title="8. RAG 체인 구성"></a>8. RAG 체인 구성</h2><h3 id="8-1-기본-RetrievalQA-체인"><a href="#8-1-기본-RetrievalQA-체인" class="headerlink" title="8.1 기본 RetrievalQA 체인"></a>8.1 기본 RetrievalQA 체인</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=retriever,</span><br><span class="line">    return_source_documents=<span class="literal">True</span>,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 질문하기</span></span><br><span class="line">result = qa_chain(&#123;<span class="string">&quot;query&quot;</span>: <span class="string">&quot;RAG의 장점은 무엇인가요?&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">&quot;result&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n출처:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> doc <span class="keyword">in</span> result[<span class="string">&quot;source_documents&quot;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;- <span class="subst">&#123;doc.metadata&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="8-2-커스텀-프롬프트-사용"><a href="#8-2-커스텀-프롬프트-사용" class="headerlink" title="8.2 커스텀 프롬프트 사용"></a>8.2 커스텀 프롬프트 사용</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"></span><br><span class="line">prompt_template = <span class="string">&quot;&quot;&quot;당신은 친절한 AI 어시스턴트입니다.</span></span><br><span class="line"><span class="string">아래의 컨텍스트를 사용하여 질문에 답변하세요.</span></span><br><span class="line"><span class="string">답변을 모른다면 모른다고 솔직히 말하세요.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">컨텍스트:</span></span><br><span class="line"><span class="string">&#123;context&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">질문: &#123;question&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">답변:&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">PROMPT = PromptTemplate(</span><br><span class="line">    template=prompt_template,</span><br><span class="line">    input_variables=[<span class="string">&quot;context&quot;</span>, <span class="string">&quot;question&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=retriever,</span><br><span class="line">    chain_type_kwargs=&#123;<span class="string">&quot;prompt&quot;</span>: PROMPT&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="8-3-대화형-RAG-ConversationalRetrievalChain"><a href="#8-3-대화형-RAG-ConversationalRetrievalChain" class="headerlink" title="8.3 대화형 RAG (ConversationalRetrievalChain)"></a>8.3 대화형 RAG (ConversationalRetrievalChain)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationalRetrievalChain</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 메모리</span></span><br><span class="line">memory = ConversationBufferMemory(</span><br><span class="line">    memory_key=<span class="string">&quot;chat_history&quot;</span>,</span><br><span class="line">    return_messages=<span class="literal">True</span>,</span><br><span class="line">    output_key=<span class="string">&quot;answer&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화형 체인</span></span><br><span class="line">conversational_chain = ConversationalRetrievalChain.from_llm(</span><br><span class="line">    llm=llm,</span><br><span class="line">    retriever=retriever,</span><br><span class="line">    memory=memory,</span><br><span class="line">    return_source_documents=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화하기</span></span><br><span class="line">response1 = conversational_chain(&#123;<span class="string">&quot;question&quot;</span>: <span class="string">&quot;RAG란 무엇인가요?&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(response1[<span class="string">&quot;answer&quot;</span>])</span><br><span class="line"></span><br><span class="line">response2 = conversational_chain(&#123;<span class="string">&quot;question&quot;</span>: <span class="string">&quot;그것의 장점은?&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(response2[<span class="string">&quot;answer&quot;</span>])</span><br></pre></td></tr></table></figure><h2 id="9-완전한-RAG-시스템-예제"><a href="#9-완전한-RAG-시스템-예제" class="headerlink" title="9. 완전한 RAG 시스템 예제"></a>9. 완전한 RAG 시스템 예제</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> DirectoryLoader, TextLoader</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings, ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"></span><br><span class="line"><span class="comment"># 환경 변수 로드</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RAGSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_dir, persist_dir=<span class="string">&quot;./chroma_db&quot;</span></span>):</span><br><span class="line">        self.data_dir = data_dir</span><br><span class="line">        self.persist_dir = persist_dir</span><br><span class="line">        self.embeddings = OpenAIEmbeddings()</span><br><span class="line">        self.llm = ChatOpenAI(model=<span class="string">&quot;gpt-4o&quot;</span>, temperature=<span class="number">0</span>)</span><br><span class="line">        self.vectorstore = <span class="literal">None</span></span><br><span class="line">        self.qa_chain = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_documents</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;문서 로드&quot;&quot;&quot;</span></span><br><span class="line">        loader = DirectoryLoader(</span><br><span class="line">            self.data_dir,</span><br><span class="line">            glob=<span class="string">&quot;**/*.txt&quot;</span>,</span><br><span class="line">            loader_cls=TextLoader</span><br><span class="line">        )</span><br><span class="line">        documents = loader.load()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;로드된 문서 수: <span class="subst">&#123;<span class="built_in">len</span>(documents)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> documents</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">split_documents</span>(<span class="params">self, documents</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;문서 분할&quot;&quot;&quot;</span></span><br><span class="line">        text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">            chunk_size=<span class="number">1000</span>,</span><br><span class="line">            chunk_overlap=<span class="number">200</span></span><br><span class="line">        )</span><br><span class="line">        chunks = text_splitter.split_documents(documents)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;생성된 청크 수: <span class="subst">&#123;<span class="built_in">len</span>(chunks)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> chunks</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_vectorstore</span>(<span class="params">self, chunks</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;벡터 스토어 생성&quot;&quot;&quot;</span></span><br><span class="line">        self.vectorstore = Chroma.from_documents(</span><br><span class="line">            documents=chunks,</span><br><span class="line">            embedding=self.embeddings,</span><br><span class="line">            persist_directory=self.persist_dir</span><br><span class="line">        )</span><br><span class="line">        self.vectorstore.persist()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;벡터 스토어 생성 완료&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_vectorstore</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;기존 벡터 스토어 로드&quot;&quot;&quot;</span></span><br><span class="line">        self.vectorstore = Chroma(</span><br><span class="line">            persist_directory=self.persist_dir,</span><br><span class="line">            embedding_function=self.embeddings</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;벡터 스토어 로드 완료&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_qa_chain</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;QA 체인 설정&quot;&quot;&quot;</span></span><br><span class="line">        retriever = self.vectorstore.as_retriever(</span><br><span class="line">            search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">        )</span><br><span class="line">        self.qa_chain = RetrievalQA.from_chain_type(</span><br><span class="line">            llm=self.llm,</span><br><span class="line">            chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">            retriever=retriever,</span><br><span class="line">            return_source_documents=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;QA 체인 설정 완료&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, question</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;질문하기&quot;&quot;&quot;</span></span><br><span class="line">        result = self.qa_chain(&#123;<span class="string">&quot;query&quot;</span>: question&#125;)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;전체 시스템 구축&quot;&quot;&quot;</span></span><br><span class="line">        documents = self.load_documents()</span><br><span class="line">        chunks = self.split_documents(documents)</span><br><span class="line">        self.create_vectorstore(chunks)</span><br><span class="line">        self.setup_qa_chain()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;RAG 시스템 구축 완료!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용 예제</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 시스템 구축</span></span><br><span class="line">    rag = RAGSystem(data_dir=<span class="string">&quot;./data&quot;</span>)</span><br><span class="line">    rag.build()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 또는 기존 시스템 로드</span></span><br><span class="line">    <span class="comment"># rag = RAGSystem(data_dir=&quot;./data&quot;)</span></span><br><span class="line">    <span class="comment"># rag.load_vectorstore()</span></span><br><span class="line">    <span class="comment"># rag.setup_qa_chain()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 질문하기</span></span><br><span class="line">    result = rag.query(<span class="string">&quot;RAG 시스템의 구성 요소는 무엇인가요?&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n답변:&quot;</span>, result[<span class="string">&quot;result&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n출처:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(result[<span class="string">&quot;source_documents&quot;</span>], <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;doc.metadata.get(<span class="string">&#x27;source&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/RAG/">RAG</category>
      
      
      <category domain="https://ckck803.github.io/tags/RAG/">RAG</category>
      
      <category domain="https://ckck803.github.io/tags/Implementation/">Implementation</category>
      
      <category domain="https://ckck803.github.io/tags/LangChain/">LangChain</category>
      
      <category domain="https://ckck803.github.io/tags/Vector-Database/">Vector Database</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/rag/rag-implementation-guide/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>RAG (Retrieval-Augmented Generation) 개요</title>
      <link>https://ckck803.github.io/2025/12/29/rag/what-is-rag/</link>
      <guid>https://ckck803.github.io/2025/12/29/rag/what-is-rag/</guid>
      <pubDate>Mon, 29 Dec 2025 09:30:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/ai/rag.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;RAG란&quot;&gt;&lt;a href=&quot;#RAG란&quot; class=&quot;headerlink&quot; title=&quot;RAG란?&quot;&gt;&lt;/a&gt;RAG란?&lt;/h2&gt;&lt;p&gt;RAG(Retrieval-Augmented Generation)는 대규모 언어 모델(LLM)의 응답을 개선하기 위해 외부 지식 베이스에서 관련 정보를 검색하여 활용하는 기술입니다.&lt;/p&gt;
&lt;h3 id=&quot;RAG의-필요성&quot;&gt;&lt;a href=&quot;#RAG의-필요성&quot; class=&quot;headerlink&quot; title=&quot;RAG의 필요성&quot;&gt;&lt;/a&gt;RAG의 필요성&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;지식 최신성 문제 해결&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LLM은 학습 시점까지의 데이터만 알고 있음&lt;/li&gt;
&lt;li&gt;최신 정보나 실시간 데이터 제공 불가&lt;/li&gt;
&lt;li&gt;RAG를 통해 최신 문서&amp;#x2F;데이터 참조 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;환각(Hallucination) 감소&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LLM이 사실이 아닌 내용을 생성하는 문제&lt;/li&gt;
&lt;li&gt;외부 신뢰할 수 있는 소스 참조로 정확성 향상&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;도메인 특화 지식 제공&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;기업 내부 문서, 특정 도메인 지식 활용&lt;/li&gt;
&lt;li&gt;재학습 없이 특정 분야 전문성 확보&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;비용 효율성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;모델 재학습(Fine-tuning) 대비 저렴&lt;/li&gt;
&lt;li&gt;데이터 업데이트가 용이&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;RAG-작동-원리&quot;&gt;&lt;a href=&quot;#RAG-작동-원리&quot; class=&quot;headerlink&quot; title=&quot;RAG 작동 원리&quot;&gt;&lt;/a&gt;RAG 작동 원리&lt;/h2&gt;&lt;h3 id=&quot;기본-워크플로우&quot;&gt;&lt;a href=&quot;#기본-워크플로우&quot; class=&quot;headerlink&quot; title=&quot;기본 워크플로우&quot;&gt;&lt;/a&gt;기본 워크플로우&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;사용자 질문&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ↓&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1. 질문 임베딩 생성&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ↓&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2. 벡터 DB에서 유사 문서 검색&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ↓&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3. 검색된 문서 + 질문을 LLM에 입력&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ↓&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4. LLM이 컨텍스트 기반 답변 생성&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ↓&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;최종 답변 제공&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;핵심-구성-요소&quot;&gt;&lt;a href=&quot;#핵심-구성-요소&quot; class=&quot;headerlink&quot; title=&quot;핵심 구성 요소&quot;&gt;&lt;/a&gt;핵심 구성 요소&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;문서 처리 (Document Processing)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;문서 수집 및 전처리&lt;/li&gt;
&lt;li&gt;청크 분할 (Chunking)&lt;/li&gt;
&lt;li&gt;임베딩 생성&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;검색 시스템 (Retrieval System)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;벡터 데이터베이스&lt;/li&gt;
&lt;li&gt;유사도 검색 알고리즘&lt;/li&gt;
&lt;li&gt;하이브리드 검색 (키워드 + 벡터)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;생성 모델 (Generation Model)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LLM (GPT, Claude, Llama 등)&lt;/li&gt;
&lt;li&gt;프롬프트 엔지니어링&lt;/li&gt;
&lt;li&gt;컨텍스트 윈도우 관리&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/ai/rag.png"></p><h2 id="RAG란"><a href="#RAG란" class="headerlink" title="RAG란?"></a>RAG란?</h2><p>RAG(Retrieval-Augmented Generation)는 대규모 언어 모델(LLM)의 응답을 개선하기 위해 외부 지식 베이스에서 관련 정보를 검색하여 활용하는 기술입니다.</p><h3 id="RAG의-필요성"><a href="#RAG의-필요성" class="headerlink" title="RAG의 필요성"></a>RAG의 필요성</h3><ol><li><p><strong>지식 최신성 문제 해결</strong></p><ul><li>LLM은 학습 시점까지의 데이터만 알고 있음</li><li>최신 정보나 실시간 데이터 제공 불가</li><li>RAG를 통해 최신 문서&#x2F;데이터 참조 가능</li></ul></li><li><p><strong>환각(Hallucination) 감소</strong></p><ul><li>LLM이 사실이 아닌 내용을 생성하는 문제</li><li>외부 신뢰할 수 있는 소스 참조로 정확성 향상</li></ul></li><li><p><strong>도메인 특화 지식 제공</strong></p><ul><li>기업 내부 문서, 특정 도메인 지식 활용</li><li>재학습 없이 특정 분야 전문성 확보</li></ul></li><li><p><strong>비용 효율성</strong></p><ul><li>모델 재학습(Fine-tuning) 대비 저렴</li><li>데이터 업데이트가 용이</li></ul></li></ol><h2 id="RAG-작동-원리"><a href="#RAG-작동-원리" class="headerlink" title="RAG 작동 원리"></a>RAG 작동 원리</h2><h3 id="기본-워크플로우"><a href="#기본-워크플로우" class="headerlink" title="기본 워크플로우"></a>기본 워크플로우</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">사용자 질문</span><br><span class="line">    ↓</span><br><span class="line">1. 질문 임베딩 생성</span><br><span class="line">    ↓</span><br><span class="line">2. 벡터 DB에서 유사 문서 검색</span><br><span class="line">    ↓</span><br><span class="line">3. 검색된 문서 + 질문을 LLM에 입력</span><br><span class="line">    ↓</span><br><span class="line">4. LLM이 컨텍스트 기반 답변 생성</span><br><span class="line">    ↓</span><br><span class="line">최종 답변 제공</span><br></pre></td></tr></table></figure><h3 id="핵심-구성-요소"><a href="#핵심-구성-요소" class="headerlink" title="핵심 구성 요소"></a>핵심 구성 요소</h3><ol><li><p><strong>문서 처리 (Document Processing)</strong></p><ul><li>문서 수집 및 전처리</li><li>청크 분할 (Chunking)</li><li>임베딩 생성</li></ul></li><li><p><strong>검색 시스템 (Retrieval System)</strong></p><ul><li>벡터 데이터베이스</li><li>유사도 검색 알고리즘</li><li>하이브리드 검색 (키워드 + 벡터)</li></ul></li><li><p><strong>생성 모델 (Generation Model)</strong></p><ul><li>LLM (GPT, Claude, Llama 등)</li><li>프롬프트 엔지니어링</li><li>컨텍스트 윈도우 관리</li></ul></li></ol><h2 id="RAG-vs-Fine-tuning"><a href="#RAG-vs-Fine-tuning" class="headerlink" title="RAG vs Fine-tuning"></a>RAG vs Fine-tuning</h2><table><thead><tr><th>구분</th><th>RAG</th><th>Fine-tuning</th></tr></thead><tbody><tr><td><strong>비용</strong></td><td>낮음</td><td>높음 (GPU, 시간)</td></tr><tr><td><strong>업데이트</strong></td><td>실시간 가능</td><td>재학습 필요</td></tr><tr><td><strong>투명성</strong></td><td>출처 추적 가능</td><td>블랙박스</td></tr><tr><td><strong>정확성</strong></td><td>검색 품질에 의존</td><td>모델에 지식 내재화</td></tr><tr><td><strong>적용 사례</strong></td><td>문서 Q&amp;A, 최신 정보</td><td>특정 스타일, 작업 최적화</td></tr></tbody></table><h2 id="RAG의-장단점"><a href="#RAG의-장단점" class="headerlink" title="RAG의 장단점"></a>RAG의 장단점</h2><h3 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h3><ul><li>✅ 최신 정보 활용 가능</li><li>✅ 출처 추적 및 검증 가능</li><li>✅ 낮은 비용과 빠른 구축</li><li>✅ 도메인 지식 쉽게 추가</li><li>✅ 환각 현상 감소</li></ul><h3 id="단점"><a href="#단점" class="headerlink" title="단점"></a>단점</h3><ul><li>❌ 검색 품질에 따라 성능 변동</li><li>❌ 추가 인프라 필요 (벡터 DB)</li><li>❌ 레이턴시 증가 (검색 단계)</li><li>❌ 복잡한 추론 작업에는 부적합</li><li>❌ 청크 분할 전략에 민감</li></ul><h2 id="RAG-성능-향상-전략"><a href="#RAG-성능-향상-전략" class="headerlink" title="RAG 성능 향상 전략"></a>RAG 성능 향상 전략</h2><h3 id="1-청킹-전략-최적화"><a href="#1-청킹-전략-최적화" class="headerlink" title="1. 청킹 전략 최적화"></a>1. 청킹 전략 최적화</h3><ul><li>고정 크기 vs 의미 기반 분할</li><li>오버랩 설정</li><li>메타데이터 추가</li></ul><h3 id="2-임베딩-모델-선택"><a href="#2-임베딩-모델-선택" class="headerlink" title="2. 임베딩 모델 선택"></a>2. 임베딩 모델 선택</h3><ul><li>OpenAI Embeddings</li><li>Sentence Transformers</li><li>도메인 특화 모델</li></ul><h3 id="3-검색-품질-개선"><a href="#3-검색-품질-개선" class="headerlink" title="3. 검색 품질 개선"></a>3. 검색 품질 개선</h3><ul><li>하이브리드 검색 (BM25 + Vector)</li><li>재순위화 (Re-ranking)</li><li>쿼리 확장 및 재작성</li></ul><h3 id="4-프롬프트-엔지니어링"><a href="#4-프롬프트-엔지니어링" class="headerlink" title="4. 프롬프트 엔지니어링"></a>4. 프롬프트 엔지니어링</h3><ul><li>명확한 지시사항</li><li>Few-shot 예제 제공</li><li>출처 인용 요구</li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/categories/AI/RAG/">RAG</category>
      
      
      <category domain="https://ckck803.github.io/tags/RAG/">RAG</category>
      
      <category domain="https://ckck803.github.io/tags/AI/">AI</category>
      
      <category domain="https://ckck803.github.io/tags/LLM/">LLM</category>
      
      <category domain="https://ckck803.github.io/tags/NLP/">NLP</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/rag/what-is-rag/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>PostgreSQL - Top N 쿼리 확인 방법</title>
      <link>https://ckck803.github.io/2025/12/29/postgresql/top-queries/</link>
      <guid>https://ckck803.github.io/2025/12/29/postgresql/top-queries/</guid>
      <pubDate>Mon, 29 Dec 2025 06:30:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/database/postgresql-logo.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;pg-stat-statements를-이용한-Top-N-쿼리-확인&quot;&gt;&lt;a href=&quot;#pg-stat-statements를-이용한-Top-N-쿼리-확인&quot; class=&quot;headerlink&quot; title=&quot;pg_stat_statements를 이용한 Top N 쿼리 확인&quot;&gt;&lt;/a&gt;pg_stat_statements를 이용한 Top N 쿼리 확인&lt;/h2&gt;&lt;p&gt;PostgreSQL에서 가장 많이 실행되거나 느린 쿼리를 확인하는 방법을 정리합니다.&lt;/p&gt;
&lt;h3 id=&quot;1-pg-stat-statements-확장-설치&quot;&gt;&lt;a href=&quot;#1-pg-stat-statements-확장-설치&quot; class=&quot;headerlink&quot; title=&quot;1. pg_stat_statements 확장 설치&quot;&gt;&lt;/a&gt;1. pg_stat_statements 확장 설치&lt;/h3&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- 확장 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;CREATE&lt;/span&gt; EXTENSION IF &lt;span class=&quot;keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;EXISTS&lt;/span&gt; pg_stat_statements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- 설치 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; pg_available_extensions &lt;span class=&quot;keyword&quot;&gt;WHERE&lt;/span&gt; name &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;pg_stat_statements&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-postgresql-conf-설정&quot;&gt;&lt;a href=&quot;#2-postgresql-conf-설정&quot; class=&quot;headerlink&quot; title=&quot;2. postgresql.conf 설정&quot;&gt;&lt;/a&gt;2. postgresql.conf 설정&lt;/h3&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# postgresql.conf 파일에 추가&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;shared_preload_libraries = &amp;#x27;pg_stat_statements&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 추적할 쿼리 수 (기본값: 5000)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pg_stat_statements.max = 10000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 쿼리 추적 모드 (top: 최상위 쿼리만, all: 중첩 쿼리 포함)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pg_stat_statements.track = all&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;설정 변경 후 PostgreSQL 재시작 필요:&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 재시작&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo systemctl restart postgresql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 또는&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pg_ctl restart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;3-실행-횟수가-많은-Top-N-쿼리&quot;&gt;&lt;a href=&quot;#3-실행-횟수가-많은-Top-N-쿼리&quot; class=&quot;headerlink&quot; title=&quot;3. 실행 횟수가 많은 Top N 쿼리&quot;&gt;&lt;/a&gt;3. 실행 횟수가 많은 Top N 쿼리&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/database/postgresql-logo.png"></p><h2 id="pg-stat-statements를-이용한-Top-N-쿼리-확인"><a href="#pg-stat-statements를-이용한-Top-N-쿼리-확인" class="headerlink" title="pg_stat_statements를 이용한 Top N 쿼리 확인"></a>pg_stat_statements를 이용한 Top N 쿼리 확인</h2><p>PostgreSQL에서 가장 많이 실행되거나 느린 쿼리를 확인하는 방법을 정리합니다.</p><h3 id="1-pg-stat-statements-확장-설치"><a href="#1-pg-stat-statements-확장-설치" class="headerlink" title="1. pg_stat_statements 확장 설치"></a>1. pg_stat_statements 확장 설치</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 확장 설치</span></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pg_stat_statements;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 설치 확인</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> pg_available_extensions <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;pg_stat_statements&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-postgresql-conf-설정"><a href="#2-postgresql-conf-설정" class="headerlink" title="2. postgresql.conf 설정"></a>2. postgresql.conf 설정</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># postgresql.conf 파일에 추가</span><br><span class="line">shared_preload_libraries = &#x27;pg_stat_statements&#x27;</span><br><span class="line"></span><br><span class="line"># 추적할 쿼리 수 (기본값: 5000)</span><br><span class="line">pg_stat_statements.max = 10000</span><br><span class="line"></span><br><span class="line"># 쿼리 추적 모드 (top: 최상위 쿼리만, all: 중첩 쿼리 포함)</span><br><span class="line">pg_stat_statements.track = all</span><br></pre></td></tr></table></figure><p>설정 변경 후 PostgreSQL 재시작 필요:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 재시작</span></span><br><span class="line">sudo systemctl restart postgresql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는</span></span><br><span class="line">pg_ctl restart</span><br></pre></td></tr></table></figure><h3 id="3-실행-횟수가-많은-Top-N-쿼리"><a href="#3-실행-횟수가-많은-Top-N-쿼리" class="headerlink" title="3. 실행 횟수가 많은 Top N 쿼리"></a>3. 실행 횟수가 많은 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    query,</span><br><span class="line">    calls <span class="keyword">AS</span> exec_count,</span><br><span class="line">    total_exec_time,</span><br><span class="line">    mean_exec_time,</span><br><span class="line">    min_exec_time,</span><br><span class="line">    max_exec_time,</span><br><span class="line">    <span class="keyword">rows</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    calls <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="4-평균-실행-시간이-긴-Top-N-쿼리"><a href="#4-평균-실행-시간이-긴-Top-N-쿼리" class="headerlink" title="4. 평균 실행 시간이 긴 Top N 쿼리"></a>4. 평균 실행 시간이 긴 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    query,</span><br><span class="line">    calls <span class="keyword">AS</span> exec_count,</span><br><span class="line">    mean_exec_time,</span><br><span class="line">    min_exec_time,</span><br><span class="line">    max_exec_time,</span><br><span class="line">    stddev_exec_time</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    calls <span class="operator">&gt;</span> <span class="number">10</span>  <span class="comment">-- 최소 10회 이상 실행된 쿼리</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    mean_exec_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="5-총-실행-시간이-긴-Top-N-쿼리"><a href="#5-총-실행-시간이-긴-Top-N-쿼리" class="headerlink" title="5. 총 실행 시간이 긴 Top N 쿼리"></a>5. 총 실행 시간이 긴 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    query,</span><br><span class="line">    calls <span class="keyword">AS</span> exec_count,</span><br><span class="line">    total_exec_time,</span><br><span class="line">    mean_exec_time,</span><br><span class="line">    (total_exec_time <span class="operator">/</span> <span class="built_in">SUM</span>(total_exec_time) <span class="keyword">OVER</span> ()) <span class="operator">*</span> <span class="number">100</span> <span class="keyword">AS</span> percentage,</span><br><span class="line">    <span class="keyword">rows</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    total_exec_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="6-I-O가-많은-Top-N-쿼리"><a href="#6-I-O가-많은-Top-N-쿼리" class="headerlink" title="6. I&#x2F;O가 많은 Top N 쿼리"></a>6. I&#x2F;O가 많은 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    query,</span><br><span class="line">    calls,</span><br><span class="line">    total_exec_time,</span><br><span class="line">    shared_blks_hit,</span><br><span class="line">    shared_blks_read,</span><br><span class="line">    shared_blks_dirtied,</span><br><span class="line">    shared_blks_written,</span><br><span class="line">    temp_blks_read,</span><br><span class="line">    temp_blks_written</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    (shared_blks_hit <span class="operator">+</span> shared_blks_read) <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="7-상세-정보를-포함한-Top-N-쿼리"><a href="#7-상세-정보를-포함한-Top-N-쿼리" class="headerlink" title="7. 상세 정보를 포함한 Top N 쿼리"></a>7. 상세 정보를 포함한 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">substring</span>(query, <span class="number">1</span>, <span class="number">100</span>) <span class="keyword">AS</span> short_query,</span><br><span class="line">    calls,</span><br><span class="line">    ROUND(total_exec_time::<span class="type">numeric</span>, <span class="number">2</span>) <span class="keyword">AS</span> total_time_ms,</span><br><span class="line">    ROUND(mean_exec_time::<span class="type">numeric</span>, <span class="number">2</span>) <span class="keyword">AS</span> avg_time_ms,</span><br><span class="line">    ROUND((<span class="number">100</span> <span class="operator">*</span> total_exec_time <span class="operator">/</span> <span class="built_in">SUM</span>(total_exec_time) <span class="keyword">OVER</span> ())::<span class="type">numeric</span>, <span class="number">2</span>) <span class="keyword">AS</span> percentage,</span><br><span class="line">    <span class="keyword">rows</span> <span class="keyword">AS</span> total_rows,</span><br><span class="line">    ROUND((<span class="keyword">rows</span> <span class="operator">/</span> calls)::<span class="type">numeric</span>, <span class="number">2</span>) <span class="keyword">AS</span> avg_rows_per_call</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    calls <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    total_exec_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="8-현재-실행중인-쿼리-확인"><a href="#8-현재-실행중인-쿼리-확인" class="headerlink" title="8. 현재 실행중인 쿼리 확인"></a>8. 현재 실행중인 쿼리 확인</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 현재 활성 쿼리 확인</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    pid,</span><br><span class="line">    usename,</span><br><span class="line">    application_name,</span><br><span class="line">    client_addr,</span><br><span class="line">    state,</span><br><span class="line">    query_start,</span><br><span class="line">    NOW() <span class="operator">-</span> query_start <span class="keyword">AS</span> duration,</span><br><span class="line">    query</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_activity</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    state <span class="operator">!=</span> <span class="string">&#x27;idle&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> query <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%pg_stat_activity%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    duration <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h3 id="9-느린-쿼리-로깅-설정"><a href="#9-느린-쿼리-로깅-설정" class="headerlink" title="9. 느린 쿼리 로깅 설정"></a>9. 느린 쿼리 로깅 설정</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 현재 세션에만 적용</span></span><br><span class="line"><span class="keyword">SET</span> log_min_duration_statement <span class="operator">=</span> <span class="number">1000</span>;  <span class="comment">-- 1초 이상 쿼리 로깅</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 전역 설정 (postgresql.conf)</span></span><br></pre></td></tr></table></figure><p>postgresql.conf:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 1초 이상 실행되는 쿼리 로깅</span><br><span class="line">log_min_duration_statement = 1000</span><br><span class="line"></span><br><span class="line"># 로그에 추가 정보 포함</span><br><span class="line">log_line_prefix = &#x27;%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h &#x27;</span><br><span class="line">log_statement = &#x27;all&#x27;  # 또는 &#x27;ddl&#x27;, &#x27;mod&#x27;, &#x27;none&#x27;</span><br><span class="line">log_duration = on</span><br><span class="line">log_lock_waits = on</span><br></pre></td></tr></table></figure><h3 id="10-pg-stat-statements-통계-초기화"><a href="#10-pg-stat-statements-통계-초기화" class="headerlink" title="10. pg_stat_statements 통계 초기화"></a>10. pg_stat_statements 통계 초기화</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 모든 통계 초기화</span></span><br><span class="line"><span class="keyword">SELECT</span> pg_stat_statements_reset();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 특정 쿼리 통계만 초기화 (PostgreSQL 12+)</span></span><br><span class="line"><span class="keyword">SELECT</span> pg_stat_statements_reset(userid, dbid, queryid);</span><br></pre></td></tr></table></figure><h3 id="11-유용한-관리-쿼리"><a href="#11-유용한-관리-쿼리" class="headerlink" title="11. 유용한 관리 쿼리"></a>11. 유용한 관리 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 데이터베이스별 통계</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.datname,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> query_count,</span><br><span class="line">    <span class="built_in">SUM</span>(calls) <span class="keyword">AS</span> total_calls,</span><br><span class="line">    ROUND(<span class="built_in">SUM</span>(total_exec_time)::<span class="type">numeric</span>, <span class="number">2</span>) <span class="keyword">AS</span> total_time_ms</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements s</span><br><span class="line">    <span class="keyword">JOIN</span> pg_database d <span class="keyword">ON</span> s.dbid <span class="operator">=</span> d.oid</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    d.datname</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    total_time_ms <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 캐시 히트율 확인</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    query,</span><br><span class="line">    calls,</span><br><span class="line">    shared_blks_hit,</span><br><span class="line">    shared_blks_read,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> (shared_blks_hit <span class="operator">+</span> shared_blks_read) <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">THEN</span> ROUND((shared_blks_hit::<span class="type">numeric</span> <span class="operator">/</span> (shared_blks_hit <span class="operator">+</span> shared_blks_read)) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> cache_hit_ratio</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    pg_stat_statements</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    (shared_blks_hit <span class="operator">+</span> shared_blks_read) <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    cache_hit_ratio <span class="keyword">ASC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h2 id="주요-컬럼-설명"><a href="#주요-컬럼-설명" class="headerlink" title="주요 컬럼 설명"></a>주요 컬럼 설명</h2><ul><li><strong>calls</strong>: 쿼리 실행 횟수</li><li><strong>total_exec_time</strong>: 총 실행 시간 (밀리초)</li><li><strong>mean_exec_time</strong>: 평균 실행 시간 (밀리초)</li><li><strong>rows</strong>: 반환되거나 영향받은 총 행 수</li><li><strong>shared_blks_hit</strong>: 공유 버퍼 캐시에서 읽은 블록 수</li><li><strong>shared_blks_read</strong>: 디스크에서 읽은 블록 수</li><li><strong>temp_blks_read&#x2F;written</strong>: 임시 파일 I&#x2F;O (정렬, 해시 등)</li></ul><h2 id="pg-stat-statements-vs-pg-stat-activity"><a href="#pg-stat-statements-vs-pg-stat-activity" class="headerlink" title="pg_stat_statements vs pg_stat_activity"></a>pg_stat_statements vs pg_stat_activity</h2><ul><li><strong>pg_stat_statements</strong>: 누적 통계 (과거부터 현재까지의 모든 쿼리)</li><li><strong>pg_stat_activity</strong>: 현재 실행 중인 쿼리만 표시</li></ul><h2 id="참고사항"><a href="#참고사항" class="headerlink" title="참고사항"></a>참고사항</h2><ul><li>pg_stat_statements는 PostgreSQL 9.2 이상에서 사용 가능합니다</li><li>shared_preload_libraries 설정 변경 시 PostgreSQL 재시작이 필요합니다</li><li>쿼리는 정규화되어 저장됩니다 (파라미터 값은 ? 또는 $1 등으로 대체)</li><li>프로덕션 환경에서 사용 시 pg_stat_statements.max 값을 적절히 조정하세요</li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/PostgreSQL/">PostgreSQL</category>
      
      
      
      <comments>https://ckck803.github.io/2025/12/29/postgresql/top-queries/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>MySQL - Top N 쿼리 확인 방법</title>
      <link>https://ckck803.github.io/2025/12/29/mysql/top-queries/</link>
      <guid>https://ckck803.github.io/2025/12/29/mysql/top-queries/</guid>
      <pubDate>Mon, 29 Dec 2025 06:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/database/mysql/MySQL.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;MySQL에서 가장 많이 실행되거나 느린 쿼리를 확인하는 방법을 정리합니다.&lt;/p&gt;
&lt;h2 id=&quot;Log-파일-기반-Top-N-쿼리-확인&quot;&gt;&lt;a href=&quot;#Log-파일-기반-Top-N-쿼리-확인&quot; class=&quot;headerlink&quot; title=&quot;Log 파일 기반 Top N 쿼리 확인&quot;&gt;&lt;/a&gt;Log 파일 기반 Top N 쿼리 확인&lt;/h2&gt;&lt;h3 id=&quot;5-Slow-Query-Log-설정&quot;&gt;&lt;a href=&quot;#5-Slow-Query-Log-설정&quot; class=&quot;headerlink&quot; title=&quot;5. Slow Query Log 설정&quot;&gt;&lt;/a&gt;5. Slow Query Log 설정&lt;/h3&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- Slow Query Log 활성화&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;GLOBAL&lt;/span&gt; slow_query_log &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;ON&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- Slow Query 기준 시간 설정 (초 단위)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;GLOBAL&lt;/span&gt; long_query_time &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- Slow Query Log 파일 위치 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SHOW&lt;/span&gt; VARIABLES &lt;span class=&quot;keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;slow_query_log_file&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;-- 인덱스를 사용하지 않는 쿼리도 로깅&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;GLOBAL&lt;/span&gt; log_queries_not_using_indexes &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;ON&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SHOW VARIABLES LIKE &lt;span class=&quot;string&quot;&gt;&amp;#x27;slow_query%&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SHOW VARIABLES LIKE &lt;span class=&quot;string&quot;&gt;&amp;#x27;long_query_time&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SHOW VARIABLES LIKE &lt;span class=&quot;string&quot;&gt;&amp;#x27;slow_query_log_file&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;6-Slow-Query-Log-분석-mysqldumpslow&quot;&gt;&lt;a href=&quot;#6-Slow-Query-Log-분석-mysqldumpslow&quot; class=&quot;headerlink&quot; title=&quot;6. Slow Query Log 분석 (mysqldumpslow)&quot;&gt;&lt;/a&gt;6. Slow Query Log 분석 (mysqldumpslow)&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 가장 느린 쿼리 10개&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysqldumpslow -s t -t 10 /path/to/slow-query.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 가장 많이 실행된 쿼리 10개&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysqldumpslow -s c -t 10 /path/to/slow-query.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 평균 실행 시간이 긴 쿼리 10개&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysqldumpslow -s at -t 10 /path/to/slow-query.log&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;Performance-Schema를-이용한-Top-N-쿼리-확인&quot;&gt;&lt;a href=&quot;#Performance-Schema를-이용한-Top-N-쿼리-확인&quot; class=&quot;headerlink&quot; title=&quot;Performance Schema를 이용한 Top N 쿼리 확인&quot;&gt;&lt;/a&gt;Performance Schema를 이용한 Top N 쿼리 확인&lt;/h2&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/database/mysql/MySQL.png"></p><p>MySQL에서 가장 많이 실행되거나 느린 쿼리를 확인하는 방법을 정리합니다.</p><h2 id="Log-파일-기반-Top-N-쿼리-확인"><a href="#Log-파일-기반-Top-N-쿼리-확인" class="headerlink" title="Log 파일 기반 Top N 쿼리 확인"></a>Log 파일 기반 Top N 쿼리 확인</h2><h3 id="5-Slow-Query-Log-설정"><a href="#5-Slow-Query-Log-설정" class="headerlink" title="5. Slow Query Log 설정"></a>5. Slow Query Log 설정</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- Slow Query Log 활성화</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Slow Query 기준 시간 설정 (초 단위)</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Slow Query Log 파일 위치 확인</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query_log_file&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 인덱스를 사용하지 않는 쿼리도 로깅</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_queries_not_using_indexes <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">SHOW VARIABLES LIKE <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line">SHOW VARIABLES LIKE <span class="string">&#x27;long_query_time&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">SHOW VARIABLES LIKE <span class="string">&#x27;slow_query_log_file&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="6-Slow-Query-Log-분석-mysqldumpslow"><a href="#6-Slow-Query-Log-분석-mysqldumpslow" class="headerlink" title="6. Slow Query Log 분석 (mysqldumpslow)"></a>6. Slow Query Log 분석 (mysqldumpslow)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 가장 느린 쿼리 10개</span></span><br><span class="line">mysqldumpslow -s t -t 10 /path/to/slow-query.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가장 많이 실행된 쿼리 10개</span></span><br><span class="line">mysqldumpslow -s c -t 10 /path/to/slow-query.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 평균 실행 시간이 긴 쿼리 10개</span></span><br><span class="line">mysqldumpslow -s at -t 10 /path/to/slow-query.log</span><br></pre></td></tr></table></figure><h2 id="Performance-Schema를-이용한-Top-N-쿼리-확인"><a href="#Performance-Schema를-이용한-Top-N-쿼리-확인" class="headerlink" title="Performance Schema를 이용한 Top N 쿼리 확인"></a>Performance Schema를 이용한 Top N 쿼리 확인</h2><h3 id="1-Performance-Schema-활성화-확인"><a href="#1-Performance-Schema-활성화-확인" class="headerlink" title="1. Performance Schema 활성화 확인"></a>1. Performance Schema 활성화 확인</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;performance_schema&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-실행-횟수가-많은-Top-N-쿼리"><a href="#2-실행-횟수가-많은-Top-N-쿼리" class="headerlink" title="2. 실행 횟수가 많은 Top N 쿼리"></a>2. 실행 횟수가 많은 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    DIGEST_TEXT <span class="keyword">AS</span> query,</span><br><span class="line">    COUNT_STAR <span class="keyword">AS</span> exec_count,</span><br><span class="line">    AVG_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> avg_time_ms,</span><br><span class="line">    SUM_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> total_time_ms</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    performance_schema.events_statements_summary_by_digest</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    COUNT_STAR <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="3-평균-실행-시간이-긴-Top-N-쿼리"><a href="#3-평균-실행-시간이-긴-Top-N-쿼리" class="headerlink" title="3. 평균 실행 시간이 긴 Top N 쿼리"></a>3. 평균 실행 시간이 긴 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    DIGEST_TEXT <span class="keyword">AS</span> query,</span><br><span class="line">    COUNT_STAR <span class="keyword">AS</span> exec_count,</span><br><span class="line">    AVG_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> avg_time_ms,</span><br><span class="line">    MIN_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> min_time_ms,</span><br><span class="line">    MAX_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> max_time_ms</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    performance_schema.events_statements_summary_by_digest</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    DIGEST_TEXT <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    AVG_TIMER_WAIT <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="4-총-실행-시간이-긴-Top-N-쿼리"><a href="#4-총-실행-시간이-긴-Top-N-쿼리" class="headerlink" title="4. 총 실행 시간이 긴 Top N 쿼리"></a>4. 총 실행 시간이 긴 Top N 쿼리</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    DIGEST_TEXT <span class="keyword">AS</span> query,</span><br><span class="line">    COUNT_STAR <span class="keyword">AS</span> exec_count,</span><br><span class="line">    SUM_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> total_time_ms,</span><br><span class="line">    AVG_TIMER_WAIT <span class="operator">/</span> <span class="number">1000000000</span> <span class="keyword">AS</span> avg_time_ms,</span><br><span class="line">    SUM_ROWS_EXAMINED <span class="keyword">AS</span> total_rows_examined,</span><br><span class="line">    SUM_ROWS_SENT <span class="keyword">AS</span> total_rows_sent</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    performance_schema.events_statements_summary_by_digest</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    DIGEST_TEXT <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    SUM_TIMER_WAIT <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h3 id="7-현재-실행중인-쿼리-확인"><a href="#7-현재-실행중인-쿼리-확인" class="headerlink" title="7. 현재 실행중인 쿼리 확인"></a>7. 현재 실행중인 쿼리 확인</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 현재 실행중인 프로세스 확인</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 또는 더 상세한 정보</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    <span class="keyword">USER</span>,</span><br><span class="line">    HOST,</span><br><span class="line">    DB,</span><br><span class="line">    COMMAND,</span><br><span class="line">    <span class="type">TIME</span>,</span><br><span class="line">    STATE,</span><br><span class="line">    INFO</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    information_schema.PROCESSLIST</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    COMMAND <span class="operator">!=</span> <span class="string">&#x27;Sleep&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="type">TIME</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h3 id="8-Performance-Schema-통계-초기화"><a href="#8-Performance-Schema-통계-초기화" class="headerlink" title="8. Performance Schema 통계 초기화"></a>8. Performance Schema 통계 초기화</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 특정 테이블 통계 초기화</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> performance_schema.events_statements_summary_by_digest;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 전체 Performance Schema 초기화</span></span><br><span class="line"><span class="keyword">CALL</span> sys.ps_truncate_all_tables(<span class="literal">FALSE</span>);</span><br></pre></td></tr></table></figure><h2 id="주요-지표-설명"><a href="#주요-지표-설명" class="headerlink" title="주요 지표 설명"></a>주요 지표 설명</h2><ul><li><strong>COUNT_STAR</strong>: 쿼리 실행 횟수</li><li><strong>AVG_TIMER_WAIT</strong>: 평균 실행 시간 (나노초 단위, 1000000000으로 나누면 밀리초)</li><li><strong>SUM_TIMER_WAIT</strong>: 총 실행 시간</li><li><strong>SUM_ROWS_EXAMINED</strong>: 검사한 총 행 수</li><li><strong>SUM_ROWS_SENT</strong>: 반환한 총 행 수</li></ul><h2 id="참고사항"><a href="#참고사항" class="headerlink" title="참고사항"></a>참고사항</h2><ul><li>Performance Schema는 MySQL 5.6 이상에서 사용 가능합니다</li><li>Performance Schema는 약간의 성능 오버헤드가 있을 수 있습니다</li><li>프로덕션 환경에서는 주의해서 사용하세요</li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/MySQL/">MySQL</category>
      
      
      
      <comments>https://ckck803.github.io/2025/12/29/mysql/top-queries/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Ubuntu Linux에 OpenVPN 설치 및 설정 가이드</title>
      <link>https://ckck803.github.io/2025/12/29/linux/ubuntu-openvpn-install/</link>
      <guid>https://ckck803.github.io/2025/12/29/linux/ubuntu-openvpn-install/</guid>
      <pubDate>Mon, 29 Dec 2025 05:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/linux/linux.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;OpenVPN-개요&quot;&gt;&lt;a href=&quot;#OpenVPN-개요&quot; class=&quot;headerlink&quot; title=&quot;OpenVPN 개요&quot;&gt;&lt;/a&gt;OpenVPN 개요&lt;/h2&gt;&lt;p&gt;OpenVPN은 오픈소스 VPN 솔루션으로, 안전한 원격 접속과 네트워크 간 통신을 제공합니다. SSL&amp;#x2F;TLS를 사용하여 강력한 암호화를 지원하며, 방화벽을 통과하기 쉬운 구조로 설계되어 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;1-OpenVPN-서버-설치&quot;&gt;&lt;a href=&quot;#1-OpenVPN-서버-설치&quot; class=&quot;headerlink&quot; title=&quot;1. OpenVPN 서버 설치&quot;&gt;&lt;/a&gt;1. OpenVPN 서버 설치&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 패키지 목록 업데이트&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt update&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt upgrade -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# OpenVPN 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt install openvpn -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Easy-RSA 설치 (인증서 관리 도구)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt install easy-rsa -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# OpenVPN 버전 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;openvpn --version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 설치된 파일 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dpkg -L openvpn | grep bin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-PKI-Public-Key-Infrastructure-설정&quot;&gt;&lt;a href=&quot;#2-PKI-Public-Key-Infrastructure-설정&quot; class=&quot;headerlink&quot; title=&quot;2. PKI (Public Key Infrastructure) 설정&quot;&gt;&lt;/a&gt;2. PKI (Public Key Infrastructure) 설정&lt;/h2&gt;&lt;h3 id=&quot;Easy-RSA-디렉토리-설정&quot;&gt;&lt;a href=&quot;#Easy-RSA-디렉토리-설정&quot; class=&quot;headerlink&quot; title=&quot;Easy-RSA 디렉토리 설정&quot;&gt;&lt;/a&gt;Easy-RSA 디렉토리 설정&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Easy-RSA 디렉토리 생성&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make-cadir ~/openvpn-ca&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 디렉토리 이동&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; ~/openvpn-ca&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;CA-Certificate-Authority-설정&quot;&gt;&lt;a href=&quot;#CA-Certificate-Authority-설정&quot; class=&quot;headerlink&quot; title=&quot;CA (Certificate Authority) 설정&quot;&gt;&lt;/a&gt;CA (Certificate Authority) 설정&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# vars 파일 편집&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nano vars&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 다음 내용 수정 (예시)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_COUNTRY    &lt;span class=&quot;string&quot;&gt;&amp;quot;KR&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_PROVINCE   &lt;span class=&quot;string&quot;&gt;&amp;quot;Seoul&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_CITY       &lt;span class=&quot;string&quot;&gt;&amp;quot;Seoul&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_ORG        &lt;span class=&quot;string&quot;&gt;&amp;quot;MyCompany&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_EMAIL      &lt;span class=&quot;string&quot;&gt;&amp;quot;admin@example.com&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set_var EASYRSA_REQ_OU         &lt;span class=&quot;string&quot;&gt;&amp;quot;IT Department&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/linux/linux.png"></p><h2 id="OpenVPN-개요"><a href="#OpenVPN-개요" class="headerlink" title="OpenVPN 개요"></a>OpenVPN 개요</h2><p>OpenVPN은 오픈소스 VPN 솔루션으로, 안전한 원격 접속과 네트워크 간 통신을 제공합니다. SSL&#x2F;TLS를 사용하여 강력한 암호화를 지원하며, 방화벽을 통과하기 쉬운 구조로 설계되어 있습니다.</p><h2 id="1-OpenVPN-서버-설치"><a href="#1-OpenVPN-서버-설치" class="headerlink" title="1. OpenVPN 서버 설치"></a>1. OpenVPN 서버 설치</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 패키지 목록 업데이트</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 설치</span></span><br><span class="line">sudo apt install openvpn -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># Easy-RSA 설치 (인증서 관리 도구)</span></span><br><span class="line">sudo apt install easy-rsa -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 버전 확인</span></span><br><span class="line">openvpn --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 설치된 파일 확인</span></span><br><span class="line">dpkg -L openvpn | grep bin</span><br></pre></td></tr></table></figure><h2 id="2-PKI-Public-Key-Infrastructure-설정"><a href="#2-PKI-Public-Key-Infrastructure-설정" class="headerlink" title="2. PKI (Public Key Infrastructure) 설정"></a>2. PKI (Public Key Infrastructure) 설정</h2><h3 id="Easy-RSA-디렉토리-설정"><a href="#Easy-RSA-디렉토리-설정" class="headerlink" title="Easy-RSA 디렉토리 설정"></a>Easy-RSA 디렉토리 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Easy-RSA 디렉토리 생성</span></span><br><span class="line">make-cadir ~/openvpn-ca</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디렉토리 이동</span></span><br><span class="line"><span class="built_in">cd</span> ~/openvpn-ca</span><br></pre></td></tr></table></figure><h3 id="CA-Certificate-Authority-설정"><a href="#CA-Certificate-Authority-설정" class="headerlink" title="CA (Certificate Authority) 설정"></a>CA (Certificate Authority) 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vars 파일 편집</span></span><br><span class="line">nano vars</span><br><span class="line"></span><br><span class="line"><span class="comment"># 다음 내용 수정 (예시)</span></span><br><span class="line">set_var EASYRSA_REQ_COUNTRY    <span class="string">&quot;KR&quot;</span></span><br><span class="line">set_var EASYRSA_REQ_PROVINCE   <span class="string">&quot;Seoul&quot;</span></span><br><span class="line">set_var EASYRSA_REQ_CITY       <span class="string">&quot;Seoul&quot;</span></span><br><span class="line">set_var EASYRSA_REQ_ORG        <span class="string">&quot;MyCompany&quot;</span></span><br><span class="line">set_var EASYRSA_REQ_EMAIL      <span class="string">&quot;admin@example.com&quot;</span></span><br><span class="line">set_var EASYRSA_REQ_OU         <span class="string">&quot;IT Department&quot;</span></span><br></pre></td></tr></table></figure><h3 id="PKI-초기화-및-CA-생성"><a href="#PKI-초기화-및-CA-생성" class="headerlink" title="PKI 초기화 및 CA 생성"></a>PKI 초기화 및 CA 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># PKI 초기화</span></span><br><span class="line">./easyrsa init-pki</span><br><span class="line"></span><br><span class="line"><span class="comment"># CA 생성 (비밀번호 설정 필요)</span></span><br><span class="line">./easyrsa build-ca</span><br><span class="line"></span><br><span class="line"><span class="comment"># CA 인증서 확인</span></span><br><span class="line"><span class="built_in">ls</span> pki/ca.crt</span><br></pre></td></tr></table></figure><h2 id="3-서버-인증서-및-키-생성"><a href="#3-서버-인증서-및-키-생성" class="headerlink" title="3. 서버 인증서 및 키 생성"></a>3. 서버 인증서 및 키 생성</h2><h3 id="서버-인증서-생성"><a href="#서버-인증서-생성" class="headerlink" title="서버 인증서 생성"></a>서버 인증서 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 서버 인증서 요청 생성 (nopass: 비밀번호 없이)</span></span><br><span class="line">./easyrsa gen-req server nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서버 인증서 서명</span></span><br><span class="line">./easyrsa sign-req server server</span><br><span class="line"></span><br><span class="line"><span class="comment"># DH (Diffie-Hellman) 파라미터 생성 (시간이 오래 걸릴 수 있음)</span></span><br><span class="line">./easyrsa gen-dh</span><br><span class="line"></span><br><span class="line"><span class="comment"># TLS 인증키 생성</span></span><br><span class="line">openvpn --genkey secret ta.key</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Using Easy-RSA <span class="string">&#x27;vars&#x27;</span> configuration:</span><br><span class="line">* /home/ubuntu/openvpn-ca/vars</span><br><span class="line"></span><br><span class="line">Using SSL:</span><br><span class="line">* openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)</span><br><span class="line">You are about to sign the following certificate:</span><br><span class="line">Please check over the details shown below <span class="keyword">for</span> accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line"><span class="built_in">source</span> or that you have verified the request checksum with the sender.</span><br><span class="line">Request subject, to be signed as a server certificate</span><br><span class="line"><span class="keyword">for</span> <span class="string">&#x27;825&#x27;</span> days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = server</span><br><span class="line"></span><br><span class="line">Type the word <span class="string">&#x27;yes&#x27;</span> to <span class="built_in">continue</span>, or any other input to abort.</span><br><span class="line">  Confirm request details: <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Using configuration from /home/ubuntu/openvpn-ca/pki/openssl-easyrsa.cnf</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> /home/ubuntu/openvpn-ca/pki/private/ca.key:</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject<span class="string">&#x27;s Distinguished Name is as follows</span></span><br><span class="line"><span class="string">commonName            :ASN.1 12:&#x27;</span>server<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Certificate is to be certified until Apr  1 17:15:48 2028 GMT (825 days)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Write out database with 1 new entries</span></span><br><span class="line"><span class="string">Database updated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Notice</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">Certificate created at:</span></span><br><span class="line"><span class="string">* /home/ubuntu/openvpn-ca/pki/issued/server.crt</span></span><br></pre></td></tr></table></figure><h3 id="생성된-파일-확인"><a href="#생성된-파일-확인" class="headerlink" title="생성된 파일 확인"></a>생성된 파일 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> pki/issued/server.crt        <span class="comment"># 서버 인증서</span></span><br><span class="line"><span class="built_in">ls</span> pki/private/server.key       <span class="comment"># 서버 개인키</span></span><br><span class="line"><span class="built_in">ls</span> pki/dh.pem                   <span class="comment"># DH 파라미터</span></span><br><span class="line"><span class="built_in">ls</span> ta.key                       <span class="comment"># TLS 인증키</span></span><br></pre></td></tr></table></figure><h2 id="4-서버-설정-파일-구성"><a href="#4-서버-설정-파일-구성" class="headerlink" title="4. 서버 설정 파일 구성"></a>4. 서버 설정 파일 구성</h2><h3 id="인증서-및-키-파일-복사"><a href="#인증서-및-키-파일-복사" class="headerlink" title="인증서 및 키 파일 복사"></a>인증서 및 키 파일 복사</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># OpenVPN 디렉토리로 파일 복사</span></span><br><span class="line">sudo <span class="built_in">cp</span> pki/ca.crt /etc/openvpn/server/</span><br><span class="line">sudo <span class="built_in">cp</span> pki/issued/server.crt /etc/openvpn/server/</span><br><span class="line">sudo <span class="built_in">cp</span> pki/private/server.key /etc/openvpn/server/</span><br><span class="line">sudo <span class="built_in">cp</span> pki/dh.pem /etc/openvpn/server/</span><br><span class="line">sudo <span class="built_in">cp</span> ta.key /etc/openvpn/server/</span><br></pre></td></tr></table></figure><h3 id="서버-설정-파일-생성"><a href="#서버-설정-파일-생성" class="headerlink" title="서버 설정 파일 생성"></a>서버 설정 파일 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 샘플 설정 파일 복사 (존재하는 경우)</span></span><br><span class="line">sudo <span class="built_in">cp</span> /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 직접 생성</span></span><br><span class="line">sudo nano /etc/openvpn/server/server.conf</span><br></pre></td></tr></table></figure><h3 id="서버-설정-파일-내용-server-conf"><a href="#서버-설정-파일-내용-server-conf" class="headerlink" title="서버 설정 파일 내용 (server.conf)"></a>서버 설정 파일 내용 (server.conf)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 포트 설정</span><br><span class="line">port 1194</span><br><span class="line"></span><br><span class="line"># 프로토콜 (udp 또는 tcp)</span><br><span class="line">proto udp</span><br><span class="line"></span><br><span class="line"># 가상 네트워크 인터페이스</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line"># 인증서 및 키 파일 경로</span><br><span class="line">ca ca.crt</span><br><span class="line">cert server.crt</span><br><span class="line">key server.key</span><br><span class="line">dh dh.pem</span><br><span class="line"></span><br><span class="line"># VPN 서브넷 설정</span><br><span class="line">server 10.8.0.0 255.255.255.0</span><br><span class="line"></span><br><span class="line"># 클라이언트 설정 유지</span><br><span class="line">ifconfig-pool-persist /var/log/openvpn/ipp.txt</span><br><span class="line"></span><br><span class="line"># 클라이언트에게 기본 게이트웨이 푸시 (모든 트래픽을 VPN으로)</span><br><span class="line">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span><br><span class="line"></span><br><span class="line"># DNS 서버 푸시</span><br><span class="line">push &quot;dhcp-option DNS 8.8.8.8&quot;</span><br><span class="line">push &quot;dhcp-option DNS 8.8.4.4&quot;</span><br><span class="line"></span><br><span class="line"># 클라이언트 간 통신 허용 (선택사항)</span><br><span class="line">client-to-client</span><br><span class="line"></span><br><span class="line"># 연결 유지</span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line"># TLS 인증</span><br><span class="line">tls-auth ta.key 0</span><br><span class="line"></span><br><span class="line"># 암호화 알고리즘</span><br><span class="line">cipher AES-256-GCM</span><br><span class="line">auth SHA256</span><br><span class="line"></span><br><span class="line"># 압축 (보안상 비활성화 권장)</span><br><span class="line">;comp-lzo</span><br><span class="line"></span><br><span class="line"># 최대 클라이언트 수</span><br><span class="line">max-clients 10</span><br><span class="line"></span><br><span class="line"># 권한 낮추기 (보안 강화)</span><br><span class="line">user nobody</span><br><span class="line">group nogroup</span><br><span class="line"></span><br><span class="line"># 재시작 시 키 유지</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line"># 로그 설정</span><br><span class="line">status /var/log/openvpn/openvpn-status.log</span><br><span class="line">log-append /var/log/openvpn/openvpn.log</span><br><span class="line">verb 3</span><br><span class="line"></span><br><span class="line"># 명시적 종료 알림</span><br><span class="line">explicit-exit-notify 1</span><br></pre></td></tr></table></figure><h3 id="로그-디렉토리-생성"><a href="#로그-디렉토리-생성" class="headerlink" title="로그 디렉토리 생성"></a>로그 디렉토리 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /var/log/openvpn</span><br><span class="line">sudo <span class="built_in">chown</span> nobody:nogroup /var/log/openvpn</span><br></pre></td></tr></table></figure><h2 id="5-네트워크-설정"><a href="#5-네트워크-설정" class="headerlink" title="5. 네트워크 설정"></a>5. 네트워크 설정</h2><h3 id="IP-포워딩-활성화"><a href="#IP-포워딩-활성화" class="headerlink" title="IP 포워딩 활성화"></a>IP 포워딩 활성화</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sysctl 설정 편집</span></span><br><span class="line">sudo nano /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 다음 라인 주석 해제 또는 추가</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 적용</span></span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure><h3 id="방화벽-설정-UFW-사용-시"><a href="#방화벽-설정-UFW-사용-시" class="headerlink" title="방화벽 설정 (UFW 사용 시)"></a>방화벽 설정 (UFW 사용 시)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 기본 인터페이스 확인</span></span><br><span class="line">ip route list default</span><br><span class="line"></span><br><span class="line"><span class="comment"># NAT 설정을 위한 before.rules 편집</span></span><br><span class="line">sudo nano /etc/ufw/before.rules</span><br><span class="line"></span><br><span class="line"><span class="comment"># *nat 섹션을 파일 맨 위에 추가 (COMMIT 전)</span></span><br><span class="line"><span class="comment"># NAT table rules</span></span><br><span class="line">*nat</span><br><span class="line">:POSTROUTING ACCEPT [0:0]</span><br><span class="line"><span class="comment"># OpenVPN NAT 규칙 (eth0는 실제 인터페이스명으로 변경)</span></span><br><span class="line">-A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE</span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># UFW 포워딩 정책 변경</span></span><br><span class="line">sudo nano /etc/default/ufw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 다음 라인 수정</span></span><br><span class="line">DEFAULT_FORWARD_POLICY=<span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 포트 허용</span></span><br><span class="line">sudo ufw allow 1194/udp</span><br><span class="line">sudo ufw allow OpenSSH</span><br><span class="line"></span><br><span class="line"><span class="comment"># UFW 재시작</span></span><br><span class="line">sudo ufw <span class="built_in">disable</span></span><br><span class="line">sudo ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><h3 id="방화벽-설정-iptables-직접-사용-시"><a href="#방화벽-설정-iptables-직접-사용-시" class="headerlink" title="방화벽 설정 (iptables 직접 사용 시)"></a>방화벽 설정 (iptables 직접 사용 시)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NAT 규칙 추가 (eth0는 실제 인터페이스명으로 변경)</span></span><br><span class="line">sudo iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 포트 허용</span></span><br><span class="line">sudo iptables -A INPUT -p udp --dport 1194 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 규칙 저장</span></span><br><span class="line">sudo apt install iptables-persistent</span><br><span class="line">sudo netfilter-persistent save</span><br></pre></td></tr></table></figure><h2 id="6-OpenVPN-서버-시작"><a href="#6-OpenVPN-서버-시작" class="headerlink" title="6. OpenVPN 서버 시작"></a>6. OpenVPN 서버 시작</h2><h3 id="서비스-시작-및-활성화"><a href="#서비스-시작-및-활성화" class="headerlink" title="서비스 시작 및 활성화"></a>서비스 시작 및 활성화</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># OpenVPN 서버 시작</span></span><br><span class="line">sudo systemctl start openvpn-server@server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 부팅 시 자동 시작 설정</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> openvpn-server@server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 상태 확인</span></span><br><span class="line">sudo systemctl status openvpn-server@server</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip-172-31-32-24:~/openvpn-ca$ sudo systemctl status openvpn@server</span><br><span class="line">● openvpn@server.service - OpenVPN connection to server</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; preset: enabled)</span><br><span class="line">     Active: active (running) since Sun 2025-12-28 17:18:08 UTC; 10s ago</span><br><span class="line">       Docs: man:openvpn(8)</span><br><span class="line">             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage</span><br><span class="line">             https://community.openvpn.net/openvpn/wiki/HOWTO</span><br><span class="line">   Main PID: 2355 (openvpn)</span><br><span class="line">     Status: <span class="string">&quot;Initialization Sequence Completed&quot;</span></span><br><span class="line">      Tasks: 1 (<span class="built_in">limit</span>: 10)</span><br><span class="line">     Memory: 1.4M (peak: 1.6M)</span><br><span class="line">        CPU: 18ms</span><br><span class="line">     CGroup: /system.slice/system-openvpn.slice/openvpn@server.service</span><br><span class="line">             └─2355 /usr/sbin/openvpn --daemon ovpn-server --status /run/openvpn/server.status 10 --<span class="built_in">cd</span> /etc/openvpn --script-security 2 --config /etc/openvpn/server.conf --writepid /run/openvpn/server.pid</span><br></pre></td></tr></table></figure><h3 id="로그-확인"><a href="#로그-확인" class="headerlink" title="로그 확인"></a>로그 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 실시간 로그 모니터링</span></span><br><span class="line">sudo <span class="built_in">tail</span> -f /var/log/openvpn/openvpn.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시스템 로그 확인</span></span><br><span class="line">sudo journalctl -u openvpn-server@server -f</span><br></pre></td></tr></table></figure><h3 id="네트워크-인터페이스-확인"><a href="#네트워크-인터페이스-확인" class="headerlink" title="네트워크 인터페이스 확인"></a>네트워크 인터페이스 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tun0 인터페이스 확인</span></span><br><span class="line">ip addr show tun0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 라우팅 테이블 확인</span></span><br><span class="line">ip route</span><br></pre></td></tr></table></figure><h2 id="7-클라이언트-인증서-생성"><a href="#7-클라이언트-인증서-생성" class="headerlink" title="7. 클라이언트 인증서 생성"></a>7. 클라이언트 인증서 생성</h2><h3 id="클라이언트-인증서-생성-스크립트"><a href="#클라이언트-인증서-생성-스크립트" class="headerlink" title="클라이언트 인증서 생성 스크립트"></a>클라이언트 인증서 생성 스크립트</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Easy-RSA 디렉토리로 이동</span></span><br><span class="line"><span class="built_in">cd</span> ~/openvpn-ca</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트 인증서 생성 (client1을 원하는 이름으로 변경)</span></span><br><span class="line">./easyrsa gen-req client1 nopass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트 인증서 서명</span></span><br><span class="line">./easyrsa sign-req client client1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트 파일 확인</span></span><br><span class="line"><span class="built_in">ls</span> pki/issued/client1.crt</span><br><span class="line"><span class="built_in">ls</span> pki/private/client1.key</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Common Name (eg: your user, host, or server name) [client1]:ㅇ demo1</span><br><span class="line"></span><br><span class="line">Notice</span><br><span class="line">------</span><br><span class="line">Private-Key and Public-Certificate-Request files created.</span><br><span class="line">Your files are:</span><br><span class="line">* req: /home/ubuntu/openvpn-ca/pki/reqs/client1.req</span><br><span class="line">* key: /home/ubuntu/openvpn-ca/pki/private/client1.key</span><br><span class="line"></span><br><span class="line">Using Easy-RSA <span class="string">&#x27;vars&#x27;</span> configuration:</span><br><span class="line">* /home/ubuntu/openvpn-ca/vars</span><br><span class="line"></span><br><span class="line">Using SSL:</span><br><span class="line">* openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)</span><br><span class="line">You are about to sign the following certificate:</span><br><span class="line">Please check over the details shown below <span class="keyword">for</span> accuracy. Note that this request</span><br><span class="line">has not been cryptographically verified. Please be sure it came from a trusted</span><br><span class="line"><span class="built_in">source</span> or that you have verified the request checksum with the sender.</span><br><span class="line">Request subject, to be signed as a client certificate</span><br><span class="line"><span class="keyword">for</span> <span class="string">&#x27;825&#x27;</span> days:</span><br><span class="line"></span><br><span class="line">subject=</span><br><span class="line">    commonName                = demo1</span><br><span class="line"></span><br><span class="line">Type the word <span class="string">&#x27;yes&#x27;</span> to <span class="built_in">continue</span>, or any other input to abort.</span><br><span class="line">  Confirm request details: ㅛ<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Using configuration from /home/ubuntu/openvpn-ca/pki/openssl-easyrsa.cnf</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> /home/ubuntu/openvpn-ca/pki/private/ca.key:</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">The Subject<span class="string">&#x27;s Distinguished Name is as follows</span></span><br><span class="line"><span class="string">commonName            :ASN.1 12:&#x27;</span>demo1<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Certificate is to be certified until Apr  1 17:20:09 2028 GMT (825 days)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Write out database with 1 new entries</span></span><br><span class="line"><span class="string">Database updated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Notice</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">Certificate created at:</span></span><br><span class="line"><span class="string">* /home/ubuntu/openvpn-ca/pki/issued/client1.crt</span></span><br></pre></td></tr></table></figure><h3 id="클라이언트-설정-디렉토리-생성"><a href="#클라이언트-설정-디렉토리-생성" class="headerlink" title="클라이언트 설정 디렉토리 생성"></a>클라이언트 설정 디렉토리 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 클라이언트 설정 디렉토리 생성</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/client-configs/files</span><br><span class="line"></span><br><span class="line"><span class="comment"># 베이스 설정 파일 생성</span></span><br><span class="line">nano ~/client-configs/base.conf</span><br></pre></td></tr></table></figure><h3 id="클라이언트-베이스-설정-base-conf"><a href="#클라이언트-베이스-설정-base-conf" class="headerlink" title="클라이언트 베이스 설정 (base.conf)"></a>클라이언트 베이스 설정 (base.conf)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">client</span><br><span class="line">dev tun</span><br><span class="line">proto udp</span><br><span class="line"></span><br><span class="line"># 서버 주소와 포트 (YOUR_SERVER_IP를 실제 IP로 변경)</span><br><span class="line">remote YOUR_SERVER_IP 1194</span><br><span class="line"></span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line"></span><br><span class="line"># 권한 낮추기</span><br><span class="line">user nobody</span><br><span class="line">group nogroup</span><br><span class="line"></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line"># 인증서 확인</span><br><span class="line">remote-cert-tls server</span><br><span class="line"></span><br><span class="line">cipher AES-256-GCM</span><br><span class="line">auth SHA256</span><br><span class="line"></span><br><span class="line">key-direction 1</span><br><span class="line"></span><br><span class="line">verb 3</span><br></pre></td></tr></table></figure><h3 id="클라이언트-설정-생성-스크립트"><a href="#클라이언트-설정-생성-스크립트" class="headerlink" title="클라이언트 설정 생성 스크립트"></a>클라이언트 설정 생성 스크립트</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설정 생성 스크립트 작성</span></span><br><span class="line">nano ~/client-configs/make_config.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 첫 번째 인자: 클라이언트 이름</span></span><br><span class="line">KEY_DIR=~/openvpn-ca/pki</span><br><span class="line">OUTPUT_DIR=~/client-configs/files</span><br><span class="line">BASE_CONFIG=~/client-configs/base.conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$&#123;BASE_CONFIG&#125;</span> \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">&#x27;&lt;ca&gt;&#x27;</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/ca.crt \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">&#x27;&lt;/ca&gt;\n&lt;cert&gt;&#x27;</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/issued/<span class="variable">$&#123;1&#125;</span>.crt \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">&#x27;&lt;/cert&gt;\n&lt;key&gt;&#x27;</span>) \</span><br><span class="line">    <span class="variable">$&#123;KEY_DIR&#125;</span>/private/<span class="variable">$&#123;1&#125;</span>.key \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">&#x27;&lt;/key&gt;\n&lt;tls-auth&gt;&#x27;</span>) \</span><br><span class="line">    ~/openvpn-ca/ta.key \</span><br><span class="line">    &lt;(<span class="built_in">echo</span> -e <span class="string">&#x27;&lt;/tls-auth&gt;&#x27;</span>) \</span><br><span class="line">    &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;1&#125;</span>.ovpn</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 실행 권한 부여</span></span><br><span class="line"><span class="built_in">chmod</span> +x ~/client-configs/make_config.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트 설정 파일 생성</span></span><br><span class="line"><span class="built_in">cd</span> ~/client-configs</span><br><span class="line">./make_config.sh client1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 생성된 파일 확인</span></span><br><span class="line"><span class="built_in">ls</span> ~/client-configs/files/</span><br></pre></td></tr></table></figure><h2 id="8-클라이언트-연결"><a href="#8-클라이언트-연결" class="headerlink" title="8. 클라이언트 연결"></a>8. 클라이언트 연결</h2><h3 id="Linux-클라이언트"><a href="#Linux-클라이언트" class="headerlink" title="Linux 클라이언트"></a>Linux 클라이언트</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># OpenVPN 클라이언트 설치</span></span><br><span class="line">sudo apt install openvpn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 파일로 연결</span></span><br><span class="line">sudo openvpn --config client1.ovpn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 백그라운드 서비스로 실행</span></span><br><span class="line">sudo <span class="built_in">cp</span> client1.ovpn /etc/openvpn/client/</span><br><span class="line">sudo systemctl start openvpn-client@client1</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> openvpn-client@client1</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo journalctl -u openvpn@server -f</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: TCP connection established with [AF_INET]180.229.206.205:56590</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 TLS: Initial packet from [AF_INET]180.229.206.205:56590, sid=09a1036e 53265092</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 VERIFY OK: depth=1, CN=Easy-RSA CA</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 VERIFY OK: depth=0, CN=demo1</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_VER=3.11.3</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_PLAT=mac</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_NCP=2</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_TCPNL=1</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_PROTO=8094</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_MTU=1600</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_CIPHERS=AES-128-CBC:AES-192-CBC:AES-256-CBC:AES-128-GCM:AES-192-GCM:AES-256-GCM:CHACHA20-POLY1305</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_AUTO_SESS=1</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_GUI_VER=OCmacOS_3.8.1-5790</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 peer info: IV_SSO=webauth,crtext</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 TLS: move_session: dest=TM_ACTIVE src=TM_INITIAL reinit_src=1</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 TLS: tls_multi_process: initial untrusted session promoted to trusted</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 Control Channel: TLSv1.3, cipher TLSv1.3 TLS_AES_256_GCM_SHA384, peer certificate: 2048 bits RSA, signature: RSA-SHA256, peer temporary key: 253 bits X25519</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: 180.229.206.205:56590 [demo1] Peer Connection Initiated with [AF_INET]180.229.206.205:56590</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 MULTI_sva: pool returned IPv4=10.8.0.6, IPv6=(Not enabled)</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 MULTI: Learn: 10.8.0.6 -&gt; demo1/180.229.206.205:56590</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 MULTI: primary virtual IP <span class="keyword">for</span> demo1/180.229.206.205:56590: 10.8.0.6</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 SENT CONTROL [demo1]: <span class="string">&#x27;PUSH_REPLY,redirect-gateway def1 bypass-dhcp,dhcp-option DNS 8.8.8.8,route 10.8.0.1,topology net30,ping 10,ping-restart 120,ifconfig 10.8.0.6 10.8.0.5,peer-id 0,cipher AES-256-GCM,protocol-flags cc-exit tls-ekm dyn-tls-crypt,tun-mtu 1500&#x27;</span> (status=1)</span><br><span class="line">Dec 28 18:33:20 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 PUSH: Received control message: <span class="string">&#x27;PUSH_REQUEST&#x27;</span></span><br><span class="line">Dec 28 18:33:21 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 Data Channel: cipher <span class="string">&#x27;AES-256-GCM&#x27;</span>, peer-id: 0</span><br><span class="line">Dec 28 18:33:21 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 Timers: ping 10, ping-restart 240</span><br><span class="line">Dec 28 18:33:21 ip-172-31-32-24 ovpn-server[2692]: demo1/180.229.206.205:56590 Protocol options: protocol-flags cc-exit tls-ekm dyn-tls-crypt</span><br></pre></td></tr></table></figure><h3 id="Windows-클라이언트"><a href="#Windows-클라이언트" class="headerlink" title="Windows 클라이언트"></a>Windows 클라이언트</h3><ol><li><a href="https://openvpn.net/community-downloads/">OpenVPN GUI</a> 다운로드 및 설치</li><li>client1.ovpn 파일을 <code>C:\Program Files\OpenVPN\config\</code> 디렉토리에 복사</li><li>OpenVPN GUI 실행 후 연결</li></ol><h3 id="macOS-클라이언트"><a href="#macOS-클라이언트" class="headerlink" title="macOS 클라이언트"></a>macOS 클라이언트</h3><ol><li><a href="https://tunnelblick.net/">Tunnelblick</a> 다운로드 및 설치</li><li>client1.ovpn 파일을 더블클릭하여 Tunnelblick에 추가</li><li>Tunnelblick에서 연결</li></ol><h3 id="Android-iOS"><a href="#Android-iOS" class="headerlink" title="Android&#x2F;iOS"></a>Android&#x2F;iOS</h3><ol><li>앱스토어에서 “OpenVPN Connect” 설치</li><li>client1.ovpn 파일을 기기로 전송</li><li>앱에서 파일 가져오기 후 연결</li></ol><h2 id="9-연결-확인-및-문제-해결"><a href="#9-연결-확인-및-문제-해결" class="headerlink" title="9. 연결 확인 및 문제 해결"></a>9. 연결 확인 및 문제 해결</h2><h3 id="서버에서-연결-확인"><a href="#서버에서-연결-확인" class="headerlink" title="서버에서 연결 확인"></a>서버에서 연결 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 연결된 클라이언트 확인</span></span><br><span class="line">sudo <span class="built_in">cat</span> /var/log/openvpn/openvpn-status.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실시간 연결 모니터링</span></span><br><span class="line">sudo <span class="built_in">tail</span> -f /var/log/openvpn/openvpn-status.log</span><br></pre></td></tr></table></figure><h3 id="클라이언트에서-연결-확인"><a href="#클라이언트에서-연결-확인" class="headerlink" title="클라이언트에서 연결 확인"></a>클라이언트에서 연결 확인</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># VPN IP 확인</span></span><br><span class="line">ip addr show tun0</span><br><span class="line"></span><br><span class="line"><span class="comment"># VPN을 통한 라우팅 확인</span></span><br><span class="line">ip route</span><br><span class="line"></span><br><span class="line"><span class="comment"># 외부 IP 확인 (VPN 서버 IP가 나와야 함)</span></span><br><span class="line">curl ifconfig.me</span><br></pre></td></tr></table></figure><h3 id="일반적인-문제-해결"><a href="#일반적인-문제-해결" class="headerlink" title="일반적인 문제 해결"></a>일반적인 문제 해결</h3><h4 id="연결이-안-될-때"><a href="#연결이-안-될-때" class="headerlink" title="연결이 안 될 때"></a>연결이 안 될 때</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 방화벽 상태 확인</span></span><br><span class="line">sudo ufw status</span><br><span class="line">sudo iptables -L -n -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 서비스 상태 확인</span></span><br><span class="line">sudo systemctl status openvpn-server@server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 확인</span></span><br><span class="line">sudo journalctl -u openvpn-server@server -n 50</span><br></pre></td></tr></table></figure><h4 id="IP-포워딩-확인"><a href="#IP-포워딩-확인" class="headerlink" title="IP 포워딩 확인"></a>IP 포워딩 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># IP 포워딩 활성화 여부 확인</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="comment"># 1이어야 함</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 재설정</span></span><br><span class="line">sudo sysctl -w net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure><h4 id="DNS-문제"><a href="#DNS-문제" class="headerlink" title="DNS 문제"></a>DNS 문제</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 클라이언트 설정 파일에 DNS 푸시 추가</span></span><br><span class="line">push <span class="string">&quot;dhcp-option DNS 8.8.8.8&quot;</span></span><br><span class="line">push <span class="string">&quot;dhcp-option DNS 1.1.1.1&quot;</span></span><br></pre></td></tr></table></figure><h2 id="10-보안-강화"><a href="#10-보안-강화" class="headerlink" title="10. 보안 강화"></a>10. 보안 강화</h2><h3 id="강력한-암호화-설정"><a href="#강력한-암호화-설정" class="headerlink" title="강력한 암호화 설정"></a>강력한 암호화 설정</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># server.conf에 추가</span><br><span class="line">cipher AES-256-GCM</span><br><span class="line">auth SHA512</span><br><span class="line">tls-version-min 1.2</span><br><span class="line">tls-cipher TLS-DHE-RSA-WITH-AES-256-GCM-SHA384:TLS-DHE-RSA-WITH-AES-256-CBC-SHA256</span><br></pre></td></tr></table></figure><h3 id="인증서-폐기-CRL"><a href="#인증서-폐기-CRL" class="headerlink" title="인증서 폐기 (CRL)"></a>인증서 폐기 (CRL)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 클라이언트 인증서 폐기</span></span><br><span class="line"><span class="built_in">cd</span> ~/openvpn-ca</span><br><span class="line">./easyrsa revoke client1</span><br><span class="line">./easyrsa gen-crl</span><br><span class="line"></span><br><span class="line"><span class="comment"># CRL 파일 복사</span></span><br><span class="line">sudo <span class="built_in">cp</span> ~/openvpn-ca/pki/crl.pem /etc/openvpn/server/</span><br><span class="line"></span><br><span class="line"><span class="comment"># server.conf에 추가</span></span><br><span class="line">crl-verify crl.pem</span><br></pre></td></tr></table></figure><h3 id="Fail2ban-설정"><a href="#Fail2ban-설정" class="headerlink" title="Fail2ban 설정"></a>Fail2ban 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fail2ban 설치</span></span><br><span class="line">sudo apt install fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenVPN 필터 생성</span></span><br><span class="line">sudo nano /etc/fail2ban/filter.d/openvpn.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Definition]</span><br><span class="line">failregex = ^.*TLS Error: TLS key negotiation failed to occur within.*&lt;HOST&gt;</span><br><span class="line">            ^.*Connection reset, restarting.*&lt;HOST&gt;</span><br><span class="line">            ^.*TLS handshake failed.*&lt;HOST&gt;</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Jail 설정</span></span><br><span class="line">sudo nano /etc/fail2ban/jail.local</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[openvpn]</span><br><span class="line">enabled = true</span><br><span class="line">port = 1194</span><br><span class="line">protocol = udp</span><br><span class="line">filter = openvpn</span><br><span class="line">logpath = /var/log/openvpn/openvpn.log</span><br><span class="line">maxretry = 3</span><br><span class="line">bantime = 600</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fail2ban 재시작</span></span><br><span class="line">sudo systemctl restart fail2ban</span><br><span class="line">sudo fail2ban-client status openvpn</span><br></pre></td></tr></table></figure><h2 id="11-성능-최적화"><a href="#11-성능-최적화" class="headerlink" title="11. 성능 최적화"></a>11. 성능 최적화</h2><h3 id="압축-설정"><a href="#압축-설정" class="headerlink" title="압축 설정"></a>압축 설정</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># server.conf와 client.conf에 추가</span><br><span class="line"># 압축은 VORACLE 공격 위험이 있으므로 주의</span><br><span class="line">compress lz4-v2</span><br><span class="line">push &quot;compress lz4-v2&quot;</span><br></pre></td></tr></table></figure><h3 id="TCP-최적화-UDP-사용-시-불필요"><a href="#TCP-최적화-UDP-사용-시-불필요" class="headerlink" title="TCP 최적화 (UDP 사용 시 불필요)"></a>TCP 최적화 (UDP 사용 시 불필요)</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># TCP 사용 시 성능 향상</span><br><span class="line">tcp-nodelay</span><br></pre></td></tr></table></figure><h3 id="MTU-최적화"><a href="#MTU-최적화" class="headerlink" title="MTU 최적화"></a>MTU 최적화</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 최적 MTU 값 찾기 (클라이언트에서)</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 vpn_server_ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># server.conf에 추가</span></span><br><span class="line">tun-mtu 1500</span><br><span class="line">mssfix 1450</span><br></pre></td></tr></table></figure><h2 id="12-모니터링-및-로깅"><a href="#12-모니터링-및-로깅" class="headerlink" title="12. 모니터링 및 로깅"></a>12. 모니터링 및 로깅</h2><h3 id="상태-파일-모니터링"><a href="#상태-파일-모니터링" class="headerlink" title="상태 파일 모니터링"></a>상태 파일 모니터링</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 연결 상태 주기적으로 확인</span></span><br><span class="line">watch -n 5 <span class="string">&#x27;sudo cat /var/log/openvpn/openvpn-status.log&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="대역폭-모니터링"><a href="#대역폭-모니터링" class="headerlink" title="대역폭 모니터링"></a>대역폭 모니터링</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># iftop 설치</span></span><br><span class="line">sudo apt install iftop</span><br><span class="line"></span><br><span class="line"><span class="comment"># tun0 인터페이스 모니터링</span></span><br><span class="line">sudo iftop -i tun0</span><br></pre></td></tr></table></figure><h3 id="로그-레벨-조정"><a href="#로그-레벨-조정" class="headerlink" title="로그 레벨 조정"></a>로그 레벨 조정</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># server.conf에서 로그 레벨 설정</span><br><span class="line">verb 3  # 0-11, 3이 기본값 (권장)</span><br></pre></td></tr></table></figure><h2 id="13-백업-및-복구"><a href="#13-백업-및-복구" class="headerlink" title="13. 백업 및 복구"></a>13. 백업 및 복구</h2><h3 id="중요-파일-백업"><a href="#중요-파일-백업" class="headerlink" title="중요 파일 백업"></a>중요 파일 백업</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 백업할 파일 목록</span></span><br><span class="line"><span class="comment"># - /etc/openvpn/server/*</span></span><br><span class="line"><span class="comment"># - ~/openvpn-ca/pki/*</span></span><br><span class="line"><span class="comment"># - /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># - /etc/ufw/before.rules (UFW 사용 시)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 백업 스크립트</span></span><br><span class="line">tar -czf openvpn-backup-$(<span class="built_in">date</span> +%Y%m%d).tar.gz \</span><br><span class="line">    /etc/openvpn/server/ \</span><br><span class="line">    ~/openvpn-ca/pki/ \</span><br><span class="line">    /etc/sysctl.conf \</span><br><span class="line">    /etc/ufw/before.rules</span><br></pre></td></tr></table></figure><h2 id="14-고급-설정"><a href="#14-고급-설정" class="headerlink" title="14. 고급 설정"></a>14. 고급 설정</h2><h3 id="특정-서브넷만-VPN으로-라우팅"><a href="#특정-서브넷만-VPN으로-라우팅" class="headerlink" title="특정 서브넷만 VPN으로 라우팅"></a>특정 서브넷만 VPN으로 라우팅</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 클라이언트 설정에서 redirect-gateway 제거하고</span><br><span class="line"># 특정 네트워크만 라우팅</span><br><span class="line">route 192.168.1.0 255.255.255.0</span><br><span class="line">route 10.0.0.0 255.255.255.0</span><br></pre></td></tr></table></figure><h3 id="클라이언트별-고정-IP-할당"><a href="#클라이언트별-고정-IP-할당" class="headerlink" title="클라이언트별 고정 IP 할당"></a>클라이언트별 고정 IP 할당</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 클라이언트 설정 디렉토리 생성</span></span><br><span class="line">sudo <span class="built_in">mkdir</span> /etc/openvpn/ccd</span><br><span class="line"></span><br><span class="line"><span class="comment"># server.conf에 추가</span></span><br><span class="line">client-config-dir ccd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 클라이언트별 설정</span></span><br><span class="line">sudo nano /etc/openvpn/ccd/client1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ifconfig-push 10.8.0.100 255.255.255.0</span><br></pre></td></tr></table></figure><h3 id="클라이언트에서-서버-LAN-접근"><a href="#클라이언트에서-서버-LAN-접근" class="headerlink" title="클라이언트에서 서버 LAN 접근"></a>클라이언트에서 서버 LAN 접근</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># server.conf에 추가 (192.168.1.0은 서버 LAN 서브넷)</span><br><span class="line">push &quot;route 192.168.1.0 255.255.255.0&quot;</span><br><span class="line"></span><br><span class="line"># 서버 방화벽에서 포워딩 허용</span><br><span class="line">sudo iptables -A FORWARD -i tun0 -o eth0 -s 10.8.0.0/24 -d 192.168.1.0/24 -j ACCEPT</span><br><span class="line">sudo iptables -A FORWARD -i eth0 -o tun0 -s 192.168.1.0/24 -d 10.8.0.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://openvpn.net/community-resources/">OpenVPN 공식 문서</a></li><li><a href="https://easy-rsa.readthedocs.io/">Easy-RSA 문서</a></li><li><a href="https://ubuntu.com/server/docs/service-openvpn">Ubuntu Server Guide - OpenVPN</a></li><li><a href="https://community.openvpn.net/openvpn/wiki/Hardening">OpenVPN Hardening Guide</a></li><li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-an-openvpn-server-on-ubuntu-20-04">Digital Ocean - OpenVPN on Ubuntu</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/Linux/">Linux</category>
      
      
      <category domain="https://ckck803.github.io/tags/Linux/">Linux</category>
      
      <category domain="https://ckck803.github.io/tags/VPN/">VPN</category>
      
      <category domain="https://ckck803.github.io/tags/Security/">Security</category>
      
      <category domain="https://ckck803.github.io/tags/Ubuntu/">Ubuntu</category>
      
      <category domain="https://ckck803.github.io/tags/OpenVPN/">OpenVPN</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/linux/ubuntu-openvpn-install/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Fail2ban 설치 및 사용 가이드</title>
      <link>https://ckck803.github.io/2025/12/29/linux/fail2ban-guide/</link>
      <guid>https://ckck803.github.io/2025/12/29/linux/fail2ban-guide/</guid>
      <pubDate>Mon, 29 Dec 2025 03:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/linux/linux.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Fail2ban-개요&quot;&gt;&lt;a href=&quot;#Fail2ban-개요&quot; class=&quot;headerlink&quot; title=&quot;Fail2ban 개요&quot;&gt;&lt;/a&gt;Fail2ban 개요&lt;/h2&gt;&lt;p&gt;Fail2ban은 로그 파일을 모니터링하여 악의적인 활동(무차별 대입 공격, 포트 스캔 등)을 탐지하고 자동으로 차단하는 침입 방지 소프트웨어입니다. &lt;/p&gt;
&lt;h3 id=&quot;주요-기능&quot;&gt;&lt;a href=&quot;#주요-기능&quot; class=&quot;headerlink&quot; title=&quot;주요 기능&quot;&gt;&lt;/a&gt;주요 기능&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;로그 파일 실시간 모니터링&lt;/li&gt;
&lt;li&gt;정규표현식 기반 패턴 매칭&lt;/li&gt;
&lt;li&gt;자동 IP 차단 (iptables, firewalld, ufw 등)&lt;/li&gt;
&lt;li&gt;시간 기반 자동 차단 해제&lt;/li&gt;
&lt;li&gt;이메일 알림 기능&lt;/li&gt;
&lt;li&gt;다양한 서비스 지원 (SSH, Apache, Nginx, MySQL 등)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;작동-원리&quot;&gt;&lt;a href=&quot;#작동-원리&quot; class=&quot;headerlink&quot; title=&quot;작동 원리&quot;&gt;&lt;/a&gt;작동 원리&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;로그 모니터링&lt;/strong&gt;: Fail2ban은 지정된 로그 파일을 실시간으로 감시합니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;패턴 매칭&lt;/strong&gt;: 설정된 정규표현식 패턴(filter)과 로그를 비교합니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;실패 횟수 카운트&lt;/strong&gt;: 특정 IP에서 실패가 발생할 때마다 카운트를 증가시킵니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;차단 실행&lt;/strong&gt;: 설정된 임계값(maxretry)을 초과하면 해당 IP를 차단합니다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;자동 해제&lt;/strong&gt;: 설정된 시간(bantime) 후 자동으로 차단을 해제합니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;1-설치&quot;&gt;&lt;a href=&quot;#1-설치&quot; class=&quot;headerlink&quot; title=&quot;1. 설치&quot;&gt;&lt;/a&gt;1. 설치&lt;/h2&gt;&lt;h4 id=&quot;Ubuntu-Debian&quot;&gt;&lt;a href=&quot;#Ubuntu-Debian&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu&amp;#x2F;Debian&quot;&gt;&lt;/a&gt;Ubuntu&amp;#x2F;Debian&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 패키지 업데이트&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt update&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# Fail2ban 설치&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt install fail2ban -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 서비스 시작 및 자동 시작 설정&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo systemctl start fail2ban&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo systemctl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; fail2ban&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 상태 확인&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo systemctl status fail2ban&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/linux/linux.png"></p><h2 id="Fail2ban-개요"><a href="#Fail2ban-개요" class="headerlink" title="Fail2ban 개요"></a>Fail2ban 개요</h2><p>Fail2ban은 로그 파일을 모니터링하여 악의적인 활동(무차별 대입 공격, 포트 스캔 등)을 탐지하고 자동으로 차단하는 침입 방지 소프트웨어입니다. </p><h3 id="주요-기능"><a href="#주요-기능" class="headerlink" title="주요 기능"></a>주요 기능</h3><ul><li>로그 파일 실시간 모니터링</li><li>정규표현식 기반 패턴 매칭</li><li>자동 IP 차단 (iptables, firewalld, ufw 등)</li><li>시간 기반 자동 차단 해제</li><li>이메일 알림 기능</li><li>다양한 서비스 지원 (SSH, Apache, Nginx, MySQL 등)</li></ul><h3 id="작동-원리"><a href="#작동-원리" class="headerlink" title="작동 원리"></a>작동 원리</h3><ol><li><strong>로그 모니터링</strong>: Fail2ban은 지정된 로그 파일을 실시간으로 감시합니다.</li><li><strong>패턴 매칭</strong>: 설정된 정규표현식 패턴(filter)과 로그를 비교합니다.</li><li><strong>실패 횟수 카운트</strong>: 특정 IP에서 실패가 발생할 때마다 카운트를 증가시킵니다.</li><li><strong>차단 실행</strong>: 설정된 임계값(maxretry)을 초과하면 해당 IP를 차단합니다.</li><li><strong>자동 해제</strong>: 설정된 시간(bantime) 후 자동으로 차단을 해제합니다.</li></ol><h2 id="1-설치"><a href="#1-설치" class="headerlink" title="1. 설치"></a>1. 설치</h2><h4 id="Ubuntu-Debian"><a href="#Ubuntu-Debian" class="headerlink" title="Ubuntu&#x2F;Debian"></a>Ubuntu&#x2F;Debian</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 패키지 업데이트</span></span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban 설치</span></span><br><span class="line">sudo apt install fail2ban -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 시작 및 자동 시작 설정</span></span><br><span class="line">sudo systemctl start fail2ban</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> fail2ban</span><br><span class="line"><span class="comment"># 상태 확인</span></span><br><span class="line">sudo systemctl status fail2ban</span><br></pre></td></tr></table></figure><h4 id="CentOS-RHEL"><a href="#CentOS-RHEL" class="headerlink" title="CentOS&#x2F;RHEL"></a>CentOS&#x2F;RHEL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># EPEL 저장소 활성화</span></span><br><span class="line">sudo yum install epel-release -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban 설치</span></span><br><span class="line">sudo yum install fail2ban fail2ban-systemd -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 시작 및 자동 시작 설정</span></span><br><span class="line">sudo systemctl start fail2ban</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 상태 확인</span></span><br><span class="line">sudo systemctl status fail2ban</span><br></pre></td></tr></table></figure><h4 id="상태-확인"><a href="#상태-확인" class="headerlink" title="상태 확인"></a>상태 확인</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&gt; sudo systemctl status fail2ban</span><br><span class="line"></span><br><span class="line">● fail2ban.service - Fail2Ban Service</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/fail2ban.service; enabled; preset: enabled)</span><br><span class="line">     Active: active (running) since Thu 2025-10-30 23:11:05 KST; 1 month 29 days ago</span><br><span class="line">       Docs: man:fail2ban(1)</span><br><span class="line">   Main PID: 1267 (fail2ban-server)</span><br><span class="line">      Tasks: 5 (<span class="built_in">limit</span>: 37661)</span><br><span class="line">     Memory: 48.9M (peak: 79.8M)</span><br><span class="line">        CPU: 44min 41.012s</span><br><span class="line">     CGroup: /system.slice/fail2ban.service</span><br><span class="line">             └─1267 /usr/bin/python3 /usr/bin/fail2ban-server -xf start</span><br></pre></td></tr></table></figure><h4 id="버전-확인"><a href="#버전-확인" class="headerlink" title="버전 확인"></a>버전 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fail2ban-server --version</span><br></pre></td></tr></table></figure><h2 id="2-기본-설정"><a href="#2-기본-설정" class="headerlink" title="2. 기본 설정"></a>2. 기본 설정</h2><h4 id="설정-파일-구조"><a href="#설정-파일-구조" class="headerlink" title="설정 파일 구조"></a>설정 파일 구조</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/fail2ban/</span><br><span class="line">├── fail2ban.conf          <span class="comment"># Fail2ban 데몬 설정 (수정 X)</span></span><br><span class="line">├── fail2ban.local         <span class="comment"># fail2ban.conf 오버라이드용</span></span><br><span class="line">├── jail.conf              <span class="comment"># Jail 기본 설정 (수정 X)</span></span><br><span class="line">├── jail.local             <span class="comment"># jail.conf 오버라이드용 (주요 설정 파일)</span></span><br><span class="line">├── jail.d/                <span class="comment"># 개별 jail 설정 디렉토리</span></span><br><span class="line">├── filter.d/              <span class="comment"># 필터 정의 파일들</span></span><br><span class="line">├── action.d/              <span class="comment"># 액션 정의 파일들</span></span><br><span class="line">└── fail2ban.d/            <span class="comment"># fail2ban 추가 설정</span></span><br></pre></td></tr></table></figure><h4 id="jail-local-생성"><a href="#jail-local-생성" class="headerlink" title="jail.local 생성"></a>jail.local 생성</h4><p>Fail2ban의 기본 설정 파일은 <strong>&#x2F;etc&#x2F;fail2ban&#x2F;jail.conf</strong> 에 있습니다. 그러나 기본 파일을 직접 수정하는 것은 업데이트 시 덮어쓰여질 수 있으므로, <strong>로컬 설정 파일</strong>인 <code>/etc/fail2ban/jail.local</code>을 만들어 사용자 설정을 오버라이드하는 것이 좋습니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 원본 설정 파일을 직접 수정하지 않고 `.local` 파일을 생성하여 설정을 오버라이드합니다.</span></span><br><span class="line"><span class="comment"># jail.conf를 복사하여 jail.local 생성</span></span><br><span class="line">sudo <span class="built_in">cp</span> /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 직접 생성</span></span><br><span class="line">sudo vim /etc/fail2ban/jail.local</span><br></pre></td></tr></table></figure><h4 id="기본-설정-예시"><a href="#기본-설정-예시" class="headerlink" title="기본 설정 예시"></a>기본 설정 예시</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># 무시할 IP 목록 (쉼표 또는 공백으로 구분)</span></span><br><span class="line"><span class="attr">ignoreip</span> = <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> ::<span class="number">1</span> <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 차단 시간 (초) - 10분</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">10</span>m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 차단 전 관찰 시간 (초) - 10분</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최대 재시도 횟수</span></span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 관리자 이메일 (알림 받을 주소)</span></span><br><span class="line"><span class="attr">destemail</span> = admin@example.com</span><br><span class="line"><span class="attr">sender</span> = fail2ban@example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이메일 알림 액션</span></span><br><span class="line"><span class="attr">action</span> = %(action_mwl)s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 차단 방법 (iptables, firewalld 등)</span></span><br><span class="line"><span class="attr">banaction</span> = iptables-multiport</span><br></pre></td></tr></table></figure><h3 id="주요-파라미터-설명"><a href="#주요-파라미터-설명" class="headerlink" title="주요 파라미터 설명"></a>주요 파라미터 설명</h3><ul><li><strong>bantime</strong>: IP 차단 유지 시간 (예: 10m, 1h, 1d, -1은 영구)</li><li><strong>findtime</strong>: 실패 횟수를 세는 기간</li><li><strong>maxretry</strong>: findtime 동안 허용되는 최대 실패 횟수</li><li><strong>ignoreip</strong>: 차단하지 않을 IP 주소 또는 대역</li><li><strong>destemail</strong>: 알림을 받을 이메일 주소</li><li><strong>action</strong>: 차단 시 실행할 액션</li></ul><h2 id="3-Jail-설정"><a href="#3-Jail-설정" class="headerlink" title="3. Jail 설정"></a>3. Jail 설정</h2><p>Jail은 특정 서비스에 대한 보호 규칙을 정의합니다.</p><h4 id="SSH-보호-설정"><a href="#SSH-보호-설정" class="headerlink" title="SSH 보호 설정"></a>SSH 보호 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = ssh,<span class="number">22</span></span><br><span class="line"><span class="attr">filter</span> = sshd</span><br><span class="line"><span class="attr">logpath</span> = /var/log/auth.log    <span class="comment"># Ubuntu/Debian</span></span><br><span class="line"><span class="comment"># logpath = /var/log/secure     # CentOS/RHEL</span></span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br></pre></td></tr></table></figure><h4 id="Apache-보호-설정"><a href="#Apache-보호-설정" class="headerlink" title="Apache 보호 설정"></a>Apache 보호 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[apache-auth]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = apache-auth</span><br><span class="line"><span class="attr">logpath</span> = /var/log/apache2/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br><span class="line"></span><br><span class="line"><span class="section">[apache-badbots]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = apache-badbots</span><br><span class="line"><span class="attr">logpath</span> = /var/log/apache2/access.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">24</span>h</span><br><span class="line"></span><br><span class="line"><span class="section">[apache-noscript]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = apache-noscript</span><br><span class="line"><span class="attr">logpath</span> = /var/log/apache2/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br></pre></td></tr></table></figure><h4 id="Nginx-보호-설정"><a href="#Nginx-보호-설정" class="headerlink" title="Nginx 보호 설정"></a>Nginx 보호 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[nginx-http-auth]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-http-auth</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br><span class="line"></span><br><span class="line"><span class="section">[nginx-limit-req]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-limit-req</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">60</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br><span class="line"></span><br><span class="line"><span class="section">[nginx-botsearch]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-botsearch</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/access.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">24</span>h</span><br></pre></td></tr></table></figure><h4 id="MySQL-보호-설정"><a href="#MySQL-보호-설정" class="headerlink" title="MySQL 보호 설정"></a>MySQL 보호 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld-auth]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">filter</span> = mysqld-auth</span><br><span class="line"><span class="attr">logpath</span> = /var/log/mysql/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br></pre></td></tr></table></figure><h4 id="개별-Jail-파일-생성"><a href="#개별-Jail-파일-생성" class="headerlink" title="개별 Jail 파일 생성"></a>개별 Jail 파일 생성</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># jail.d 디렉토리에 개별 설정 생성</span></span><br><span class="line">sudo vim /etc/fail2ban/jail.d/sshd.local</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">2222</span>           <span class="comment"># 사용자 정의 SSH 포트</span></span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">24</span>h</span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br></pre></td></tr></table></figure><h2 id="4-필터-Filter-설정"><a href="#4-필터-Filter-설정" class="headerlink" title="4. 필터 (Filter) 설정"></a>4. 필터 (Filter) 설정</h2><p>필터는 로그에서 실패를 감지하는 정규표현식 패턴을 정의합니다.</p><h4 id="기본-제공-필터-확인"><a href="#기본-제공-필터-확인" class="headerlink" title="기본 제공 필터 확인"></a>기본 제공 필터 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> /etc/fail2ban/filter.d/</span><br></pre></td></tr></table></figure><h4 id="사용자-정의-필터-생성"><a href="#사용자-정의-필터-생성" class="headerlink" title="사용자 정의 필터 생성"></a>사용자 정의 필터 생성</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/fail2ban/filter.d/custom-app.conf</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="comment"># 실패 패턴 정의</span></span><br><span class="line"><span class="attr">failregex</span> = ^&lt;HOST&gt; .* <span class="string">&quot;POST /login HTTP.*&quot;</span> <span class="number">401</span></span><br><span class="line">            ^&lt;HOST&gt; .* &quot;Authentication failed for user&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 성공 패턴 정의 (선택사항)</span></span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><h4 id="필터-테스트"><a href="#필터-테스트" class="headerlink" title="필터 테스트"></a>필터 테스트</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 필터가 로그와 매칭되는지 테스트</span></span><br><span class="line">fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 사용자 정의 패턴 테스트</span></span><br><span class="line">fail2ban-regex /var/log/myapp.log /etc/fail2ban/filter.d/custom-app.conf</span><br></pre></td></tr></table></figure><h2 id="5-액션-Action-설정"><a href="#5-액션-Action-설정" class="headerlink" title="5. 액션 (Action) 설정"></a>5. 액션 (Action) 설정</h2><p>액션은 차단 시 실행할 동작을 정의합니다.</p><h4 id="기본-제공-액션-확인"><a href="#기본-제공-액션-확인" class="headerlink" title="기본 제공 액션 확인"></a>기본 제공 액션 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> /etc/fail2ban/action.d/</span><br></pre></td></tr></table></figure><h4 id="주요-액션"><a href="#주요-액션" class="headerlink" title="주요 액션"></a>주요 액션</h4><ul><li><strong>iptables-multiport</strong>: 여러 포트를 한 번에 차단</li><li><strong>iptables-allports</strong>: 모든 포트 차단</li><li><strong>firewalld-cmd</strong>: firewalld 사용</li><li><strong>sendmail-whois</strong>: 이메일 알림 + WHOIS 정보</li></ul><h4 id="이메일-알림-설정"><a href="#이메일-알림-설정" class="headerlink" title="이메일 알림 설정"></a>이메일 알림 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># 이메일 액션 선택</span></span><br><span class="line"><span class="comment"># action_: 차단만 실행</span></span><br><span class="line"><span class="comment"># action_mw: 차단 + 이메일 알림</span></span><br><span class="line"><span class="comment"># action_mwl: 차단 + 이메일 알림 + 로그 포함</span></span><br><span class="line"></span><br><span class="line"><span class="attr">action</span> = %(action_mwl)s</span><br><span class="line"></span><br><span class="line"><span class="attr">destemail</span> = admin@example.com</span><br><span class="line"><span class="attr">sender</span> = fail2ban@hostname</span><br><span class="line"><span class="attr">mta</span> = sendmail</span><br></pre></td></tr></table></figure><h4 id="사용자-정의-액션-생성"><a href="#사용자-정의-액션-생성" class="headerlink" title="사용자 정의 액션 생성"></a>사용자 정의 액션 생성</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/fail2ban/action.d/custom-notify.conf</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[Definition]</span><br><span class="line"><span class="comment"># 차단 시 실행할 명령</span></span><br><span class="line">actionban = curl -X POST https://api.example.com/alert \</span><br><span class="line">            -d <span class="string">&quot;ip=&lt;ip&gt;&amp;service=&lt;name&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 차단 해제 시 실행할 명령</span></span><br><span class="line">actionunban = curl -X POST https://api.example.com/unblock \</span><br><span class="line">              -d <span class="string">&quot;ip=&lt;ip&gt;&amp;service=&lt;name&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">[Init]</span><br><span class="line"><span class="comment"># 초기화 파라미터</span></span><br><span class="line">name = default</span><br></pre></td></tr></table></figure><h2 id="6-관리-명령어"><a href="#6-관리-명령어" class="headerlink" title="6. 관리 명령어"></a>6. 관리 명령어</h2><h4 id="서비스-관리"><a href="#서비스-관리" class="headerlink" title="서비스 관리"></a>서비스 관리</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 서비스 시작</span></span><br><span class="line">sudo systemctl start fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 중지</span></span><br><span class="line">sudo systemctl stop fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 재시작</span></span><br><span class="line">sudo systemctl restart fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 서비스 상태 확인</span></span><br><span class="line">sudo systemctl status fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 다시 로드</span></span><br><span class="line">sudo systemctl reload fail2ban</span><br><span class="line">sudo fail2ban-client reload</span><br></pre></td></tr></table></figure><h4 id="fail2ban-client-명령어"><a href="#fail2ban-client-명령어" class="headerlink" title="fail2ban-client 명령어"></a>fail2ban-client 명령어</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 전체 상태 확인</span></span><br><span class="line">sudo fail2ban-client status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 jail 상태 확인</span></span><br><span class="line">sudo fail2ban-client status sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 활성화된 jail 목록</span></span><br><span class="line">sudo fail2ban-client status</span><br><span class="line"></span><br><span class="line"><span class="comment"># jail 시작/중지</span></span><br><span class="line">sudo fail2ban-client start sshd</span><br><span class="line">sudo fail2ban-client stop sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># jail 다시 로드</span></span><br><span class="line">sudo fail2ban-client reload sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 확인</span></span><br><span class="line">sudo fail2ban-client get sshd bantime</span><br><span class="line">sudo fail2ban-client get sshd maxretry</span><br></pre></td></tr></table></figure><h4 id="IP-차단-관리"><a href="#IP-차단-관리" class="headerlink" title="IP 차단 관리"></a>IP 차단 관리</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 현재 차단된 IP 확인</span></span><br><span class="line">sudo fail2ban-client status sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 수동으로 IP 차단</span></span><br><span class="line">sudo fail2ban-client <span class="built_in">set</span> sshd banip 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># IP 차단 해제</span></span><br><span class="line">sudo fail2ban-client <span class="built_in">set</span> sshd unbanip 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 모든 IP 차단 해제</span></span><br><span class="line">sudo fail2ban-client unban --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 jail의 모든 IP 차단 해제</span></span><br><span class="line">sudo fail2ban-client <span class="built_in">set</span> sshd unbanip --all</span><br></pre></td></tr></table></figure><h4 id="로그-확인"><a href="#로그-확인" class="headerlink" title="로그 확인"></a>로그 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fail2ban 로그 확인</span></span><br><span class="line">sudo <span class="built_in">tail</span> -f /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 차단 이벤트만 확인</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 IP 관련 로그</span></span><br><span class="line">sudo grep <span class="string">&quot;192.168.1.100&quot;</span> /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 최근 차단된 IP 목록</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | <span class="built_in">tail</span> -20</span><br><span class="line"></span><br><span class="line"><span class="comment"># journalctl 사용 (systemd)</span></span><br><span class="line">sudo journalctl -u fail2ban -f</span><br><span class="line">sudo journalctl -u fail2ban --since <span class="string">&quot;1 hour ago&quot;</span></span><br></pre></td></tr></table></figure><h2 id="7-iptables-방화벽-확인"><a href="#7-iptables-방화벽-확인" class="headerlink" title="7. iptables&#x2F;방화벽 확인"></a>7. iptables&#x2F;방화벽 확인</h2><h4 id="iptables로-차단-규칙-확인"><a href="#iptables로-차단-규칙-확인" class="headerlink" title="iptables로 차단 규칙 확인"></a>iptables로 차단 규칙 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fail2ban 체인 확인</span></span><br><span class="line">sudo iptables -L fail2ban-sshd -v -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 iptables 규칙</span></span><br><span class="line">sudo iptables -L -n -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 차단된 IP 확인</span></span><br><span class="line">sudo iptables -L -n | grep -i reject</span><br></pre></td></tr></table></figure><h4 id="firewalld-사용-시"><a href="#firewalld-사용-시" class="headerlink" title="firewalld 사용 시"></a>firewalld 사용 시</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Rich rules 확인</span></span><br><span class="line">sudo firewall-cmd --list-rich-rules</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban zone 확인</span></span><br><span class="line">sudo firewall-cmd --zone=drop --list-sources</span><br></pre></td></tr></table></figure><h2 id="8-모니터링-및-통계"><a href="#8-모니터링-및-통계" class="headerlink" title="8. 모니터링 및 통계"></a>8. 모니터링 및 통계</h2><h4 id="차단-통계-확인"><a href="#차단-통계-확인" class="headerlink" title="차단 통계 확인"></a>차단 통계 확인</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># jail별 차단된 IP 수 확인</span></span><br><span class="line">sudo fail2ban-client status | grep <span class="string">&quot;Jail list&quot;</span></span><br><span class="line">sudo fail2ban-client status sshd | grep <span class="string">&quot;Currently banned&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그에서 차단 통계 추출</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가장 많이 차단된 IP Top 10</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | grep -oP <span class="string">&#x27;\d+\.\d+\.\d+\.\d+&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 날짜별 차단 통계</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br></pre></td></tr></table></figure><h4 id="실시간-모니터링-스크립트"><a href="#실시간-모니터링-스크립트" class="headerlink" title="실시간 모니터링 스크립트"></a>실시간 모니터링 스크립트</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># fail2ban-monitor.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Fail2ban Status ===&quot;</span></span><br><span class="line">sudo fail2ban-client status</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Currently Banned IPs (sshd) ===&quot;</span></span><br><span class="line">sudo fail2ban-client status sshd | grep <span class="string">&quot;Banned IP list&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Recent Ban Events ===&quot;</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | <span class="built_in">tail</span> -10</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n=== Top 5 Banned IPs ===&quot;</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | grep -oP <span class="string">&#x27;\d+\.\d+\.\d+\.\d+&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -5</span><br></pre></td></tr></table></figure><h2 id="9-고급-설정"><a href="#9-고급-설정" class="headerlink" title="9. 고급 설정"></a>9. 고급 설정</h2><h4 id="영구-차단-설정"><a href="#영구-차단-설정" class="headerlink" title="영구 차단 설정"></a>영구 차단 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = ssh</span><br><span class="line"><span class="attr">filter</span> = sshd</span><br><span class="line"><span class="attr">logpath</span> = /var/log/auth.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br><span class="line"><span class="attr">bantime</span> = -<span class="number">1</span>          <span class="comment"># 영구 차단</span></span><br></pre></td></tr></table></figure><h4 id="증분-차단-시간-Incremental-Ban"><a href="#증분-차단-시간-Incremental-Ban" class="headerlink" title="증분 차단 시간 (Incremental Ban)"></a>증분 차단 시간 (Incremental Ban)</h4><p>반복적으로 차단되는 IP에 대해 차단 시간을 점진적으로 늘립니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/fail2ban/jail.d/recidive.local</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[recidive]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">filter</span> = recidive</span><br><span class="line"><span class="attr">logpath</span> = /var/log/fail2ban.log</span><br><span class="line"><span class="attr">action</span> = iptables-allports[name=recidive]</span><br><span class="line">         sendmail-whois-lines<span class="section">[name=recidive, logpath=/var/log/fail2ban.log]</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>w          <span class="comment"># 1주일</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">1</span>d         <span class="comment"># 하루 동안</span></span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span>          <span class="comment"># 3번 차단되면</span></span><br></pre></td></tr></table></figure><h4 id="국가별-IP-차단"><a href="#국가별-IP-차단" class="headerlink" title="국가별 IP 차단"></a>국가별 IP 차단</h4><p>GeoIP를 사용하여 특정 국가의 IP를 차단합니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># GeoIP 설치</span></span><br><span class="line">sudo apt install geoip-bin geoip-database</span><br><span class="line"></span><br><span class="line"><span class="comment"># 필터 생성</span></span><br><span class="line">sudo vim /etc/fail2ban/filter.d/geoip.conf</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="comment"># Python 스크립트를 사용한 GeoIP 체크</span></span><br><span class="line"><span class="attr">failregex</span> = &lt;HOST&gt;</span><br><span class="line"></span><br><span class="line"><span class="section">[geoip]</span></span><br><span class="line"><span class="comment"># 차단할 국가 코드 (ISO 2자리)</span></span><br><span class="line"><span class="attr">country</span> = CN,RU,KP</span><br></pre></td></tr></table></figure><h4 id="화이트리스트-설정"><a href="#화이트리스트-설정" class="headerlink" title="화이트리스트 설정"></a>화이트리스트 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># 절대 차단하지 않을 IP</span></span><br><span class="line"><span class="attr">ignoreip</span> = <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> ::<span class="number">1</span></span><br><span class="line">           192.168.1.0/24</span><br><span class="line">           10.0.0.0/8</span><br><span class="line">           your.trusted.ip.address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 또는 파일로 관리</span></span><br><span class="line"><span class="attr">ignoreip</span> = %(ignoreip)s</span><br><span class="line"><span class="attr">ignorecommand</span> = cat /etc/fail2ban/whitelist.conf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 화이트리스트 파일 생성</span></span><br><span class="line">sudo vim /etc/fail2ban/whitelist.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.1.100</span><br><span class="line">203.0.113.0/24</span><br></pre></td></tr></table></figure><h4 id="systemd-통합-설정"><a href="#systemd-통합-설정" class="headerlink" title="systemd 통합 설정"></a>systemd 통합 설정</h4><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="comment"># systemd journal 사용</span></span><br><span class="line"><span class="attr">backend</span> = systemd</span><br><span class="line"></span><br><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">filter</span> = sshd</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br><span class="line"><span class="comment"># logpath 대신 backend 사용</span></span><br><span class="line"><span class="attr">backend</span> = systemd</span><br></pre></td></tr></table></figure><h2 id="10-문제-해결"><a href="#10-문제-해결" class="headerlink" title="10. 문제 해결"></a>10. 문제 해결</h2><h4 id="설정-검증"><a href="#설정-검증" class="headerlink" title="설정 검증"></a>설정 검증</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설정 파일 문법 검사</span></span><br><span class="line">sudo fail2ban-client -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 jail 테스트</span></span><br><span class="line">sudo fail2ban-client -vvv start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 디버그 모드로 실행</span></span><br><span class="line">sudo fail2ban-client -x -v start</span><br></pre></td></tr></table></figure><h4 id="일반적인-문제"><a href="#일반적인-문제" class="headerlink" title="일반적인 문제"></a>일반적인 문제</h4><h4 id="Fail2ban이-시작되지-않음"><a href="#Fail2ban이-시작되지-않음" class="headerlink" title="Fail2ban이 시작되지 않음"></a>Fail2ban이 시작되지 않음</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 로그 확인</span></span><br><span class="line">sudo <span class="built_in">tail</span> -100 /var/log/fail2ban.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 설정 검증</span></span><br><span class="line">sudo fail2ban-client -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemd 상태</span></span><br><span class="line">sudo systemctl status fail2ban -l</span><br></pre></td></tr></table></figure><h4 id="차단이-작동하지-않음"><a href="#차단이-작동하지-않음" class="headerlink" title="차단이 작동하지 않음"></a>차단이 작동하지 않음</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># jail이 활성화되었는지 확인</span></span><br><span class="line">sudo fail2ban-client status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 파일 경로 확인</span></span><br><span class="line"><span class="built_in">ls</span> -la /var/log/auth.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 필터 테스트</span></span><br><span class="line">fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 권한 확인</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 644 /var/log/auth.log</span><br></pre></td></tr></table></figure><h4 id="로그-파일을-찾을-수-없음"><a href="#로그-파일을-찾을-수-없음" class="headerlink" title="로그 파일을 찾을 수 없음"></a>로그 파일을 찾을 수 없음</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SELinux 확인 (CentOS/RHEL)</span></span><br><span class="line">sudo ausearch -c <span class="string">&#x27;fail2ban-server&#x27;</span> --raw | audit2allow -M my-fail2ban</span><br><span class="line">sudo semodule -i my-fail2ban.pp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 파일 확인</span></span><br><span class="line">sudo journalctl -u fail2ban | grep <span class="string">&quot;File not found&quot;</span></span><br></pre></td></tr></table></figure><h4 id="이메일-알림이-작동하지-않음"><a href="#이메일-알림이-작동하지-않음" class="headerlink" title="이메일 알림이 작동하지 않음"></a>이메일 알림이 작동하지 않음</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sendmail 또는 postfix 설치 확인</span></span><br><span class="line"><span class="built_in">which</span> sendmail</span><br><span class="line"></span><br><span class="line"><span class="comment"># sendmail 설치</span></span><br><span class="line">sudo apt install sendmail    <span class="comment"># Ubuntu/Debian</span></span><br><span class="line">sudo yum install sendmail    <span class="comment"># CentOS/RHEL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 테스트 메일 발송</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test&quot;</span> | mail -s <span class="string">&quot;Test&quot;</span> admin@example.com</span><br></pre></td></tr></table></figure><h3 id="수동-데이터베이스-초기화"><a href="#수동-데이터베이스-초기화" class="headerlink" title="수동 데이터베이스 초기화"></a>수동 데이터베이스 초기화</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fail2ban 중지</span></span><br><span class="line">sudo systemctl stop fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 데이터베이스 삭제</span></span><br><span class="line">sudo <span class="built_in">rm</span> /var/lib/fail2ban/fail2ban.sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban 시작</span></span><br><span class="line">sudo systemctl start fail2ban</span><br></pre></td></tr></table></figure><h2 id="11-성능-최적화"><a href="#11-성능-최적화" class="headerlink" title="11. 성능 최적화"></a>11. 성능 최적화</h2><h3 id="로그-폴링-간격-조정"><a href="#로그-폴링-간격-조정" class="headerlink" title="로그 폴링 간격 조정"></a>로그 폴링 간격 조정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/fail2ban/fail2ban.conf</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Definition]</span></span><br><span class="line"><span class="comment"># 로그 파일 확인 간격 (초)</span></span><br><span class="line"><span class="attr">logtarget</span> = /var/log/fail2ban.log</span><br><span class="line"><span class="attr">loglevel</span> = INFO</span><br><span class="line"><span class="attr">syslogsocket</span> = auto</span><br><span class="line"></span><br><span class="line"><span class="comment"># 데이터베이스 설정</span></span><br><span class="line"><span class="attr">dbfile</span> = /var/lib/fail2ban/fail2ban.sqlite3</span><br><span class="line"><span class="attr">dbpurgeage</span> = <span class="number">86400</span>    <span class="comment"># 1일 후 오래된 항목 삭제</span></span><br></pre></td></tr></table></figure><h3 id="jail별-최적화"><a href="#jail별-최적화" class="headerlink" title="jail별 최적화"></a>jail별 최적화</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="comment"># 로그 인코딩 지정</span></span><br><span class="line"><span class="attr">logencoding</span> = auto</span><br><span class="line"></span><br><span class="line"><span class="comment"># 날짜 형식 지정</span></span><br><span class="line"><span class="attr">datepattern</span> = &#123;^LN-BEG&#125;</span><br></pre></td></tr></table></figure><h2 id="12-백업-및-복구"><a href="#12-백업-및-복구" class="headerlink" title="12. 백업 및 복구"></a>12. 백업 및 복구</h2><h3 id="설정-백업"><a href="#설정-백업" class="headerlink" title="설정 백업"></a>설정 백업</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설정 파일 백업</span></span><br><span class="line">sudo tar -czf fail2ban-config-backup-$(<span class="built_in">date</span> +%Y%m%d).tar.gz \</span><br><span class="line">  /etc/fail2ban/jail.local \</span><br><span class="line">  /etc/fail2ban/jail.d/ \</span><br><span class="line">  /etc/fail2ban/filter.d/*.<span class="built_in">local</span> \</span><br><span class="line">  /etc/fail2ban/action.d/*.<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 데이터베이스 백업</span></span><br><span class="line">sudo <span class="built_in">cp</span> /var/lib/fail2ban/fail2ban.sqlite3 \</span><br><span class="line">  /backup/fail2ban.sqlite3.$(<span class="built_in">date</span> +%Y%m%d)</span><br></pre></td></tr></table></figure><h3 id="복구"><a href="#복구" class="headerlink" title="복구"></a>복구</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 설정 복구</span></span><br><span class="line">sudo tar -xzf fail2ban-config-backup-20241229.tar.gz -C /</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban 재시작</span></span><br><span class="line">sudo systemctl restart fail2ban</span><br></pre></td></tr></table></figure><h2 id="13-보안-베스트-프랙티스"><a href="#13-보안-베스트-프랙티스" class="headerlink" title="13. 보안 베스트 프랙티스"></a>13. 보안 베스트 프랙티스</h2><h3 id="권장-설정"><a href="#권장-설정" class="headerlink" title="권장 설정"></a>권장 설정</h3><ol><li><strong>적절한 bantime 설정</strong>: 너무 짧으면 효과 없음, 너무 길면 오탐 시 문제</li><li><strong>maxretry 조정</strong>: 서비스 특성에 맞게 설정 (SSH: 3-5, 웹: 5-10)</li><li><strong>ignoreip 관리</strong>: 신뢰할 수 있는 IP만 추가</li><li><strong>로그 모니터링</strong>: 정기적으로 차단 로그 검토</li><li><strong>recidive jail 활성화</strong>: 반복 공격자 장기 차단</li><li><strong>이메일 알림 설정</strong>: 중요한 이벤트 즉시 파악</li></ol><h3 id="추가-보안-조치"><a href="#추가-보안-조치" class="headerlink" title="추가 보안 조치"></a>추가 보안 조치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SSH 포트 변경 (기본 22번에서 변경)</span></span><br><span class="line"><span class="comment"># /etc/ssh/sshd_config</span></span><br><span class="line">Port 2222</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH 키 기반 인증 사용</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># root 직접 로그인 차단</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fail2ban jail 설정 업데이트</span></span><br><span class="line">[sshd]</span><br><span class="line">port = 2222</span><br></pre></td></tr></table></figure><h2 id="14-대안-및-보완-도구"><a href="#14-대안-및-보완-도구" class="headerlink" title="14. 대안 및 보완 도구"></a>14. 대안 및 보완 도구</h2><h3 id="함께-사용하면-좋은-도구"><a href="#함께-사용하면-좋은-도구" class="headerlink" title="함께 사용하면 좋은 도구"></a>함께 사용하면 좋은 도구</h3><ul><li><strong>DenyHosts</strong>: SSH 전용 차단 도구</li><li><strong>CSF (ConfigServer Security &amp; Firewall)</strong>: 종합 방화벽 솔루�</li><li><strong>ModSecurity</strong>: 웹 애플리케이션 방화벽 (WAF)</li><li><strong>OSSEC</strong>: 호스트 기반 침입 탐지 시스템</li><li><strong>Snort&#x2F;Suricata</strong>: 네트워크 침입 탐지 시스템</li></ul><h2 id="15-실전-예제"><a href="#15-실전-예제" class="headerlink" title="15. 실전 예제"></a>15. 실전 예제</h2><h3 id="완전한-설정-예제"><a href="#완전한-설정-예제" class="headerlink" title="완전한 설정 예제"></a>완전한 설정 예제</h3><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/fail2ban/jail.local</span></span><br><span class="line"></span><br><span class="line"><span class="section">[DEFAULT]</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>h</span><br><span class="line"><span class="attr">findtime</span> = <span class="number">10</span>m</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">5</span></span><br><span class="line"><span class="attr">destemail</span> = admin@example.com</span><br><span class="line"><span class="attr">sender</span> = fail2ban@server.example.com</span><br><span class="line"><span class="attr">action</span> = %(action_mwl)s</span><br><span class="line"><span class="attr">ignoreip</span> = <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="section">[sshd]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = ssh,<span class="number">2222</span></span><br><span class="line"><span class="attr">filter</span> = sshd</span><br><span class="line"><span class="attr">logpath</span> = /var/log/auth.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">bantime</span> = <span class="number">24</span>h</span><br><span class="line"></span><br><span class="line"><span class="section">[nginx-http-auth]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-http-auth</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="section">[nginx-limit-req]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">port</span> = http,https</span><br><span class="line"><span class="attr">filter</span> = nginx-limit-req</span><br><span class="line"><span class="attr">logpath</span> = /var/log/nginx/error.log</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">findtime</span> = <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="section">[recidive]</span></span><br><span class="line"><span class="attr">enabled</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">filter</span> = recidive</span><br><span class="line"><span class="attr">logpath</span> = /var/log/fail2ban.log</span><br><span class="line"><span class="attr">bantime</span> = <span class="number">1</span>w</span><br><span class="line"><span class="attr">findtime</span> = <span class="number">1</span>d</span><br><span class="line"><span class="attr">maxretry</span> = <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="모니터링-대시보드-스크립트"><a href="#모니터링-대시보드-스크립트" class="headerlink" title="모니터링 대시보드 스크립트"></a>모니터링 대시보드 스크립트</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># /usr/local/bin/fail2ban-dashboard.sh</span></span><br><span class="line"></span><br><span class="line">clear</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;╔════════════════════════════════════════════════════╗&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;║         Fail2ban Monitoring Dashboard              ║&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;╚════════════════════════════════════════════════════╝&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 상태</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;📊 Overall Status:&quot;</span></span><br><span class="line">sudo fail2ban-client status</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jail별 차단 현황</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;🔒 Banned IPs by Jail:&quot;</span></span><br><span class="line"><span class="keyword">for</span> jail <span class="keyword">in</span> $(sudo fail2ban-client status | grep <span class="string">&quot;Jail list&quot;</span> | sed <span class="string">&#x27;s/.*://;s/,//g&#x27;</span>); <span class="keyword">do</span></span><br><span class="line">    banned=$(sudo fail2ban-client status <span class="variable">$jail</span> | grep <span class="string">&quot;Currently banned&quot;</span> | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line">    total=$(sudo fail2ban-client status <span class="variable">$jail</span> | grep <span class="string">&quot;Total banned&quot;</span> | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  - <span class="variable">$jail</span>: Currently <span class="variable">$banned</span> | Total <span class="variable">$total</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 최근 차단 이벤트</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;📝 Recent Ban Events (Last 10):&quot;</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | <span class="built_in">tail</span> -10 | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  <span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Top 공격 IP</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;🎯 Top 10 Attacking IPs:&quot;</span></span><br><span class="line">sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.<span class="built_in">log</span> | grep -oP <span class="string">&#x27;\d+\.\d+\.\d+\.\d+&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 통계</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;📈 Statistics:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  Total bans today: <span class="subst">$(sudo grep <span class="string">&quot;Ban&quot;</span> /var/log/fail2ban.log | grep <span class="string">&quot;<span class="subst">$(date +%Y-%m-%d)</span>&quot;</span> | wc -l)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;  Active jails: <span class="subst">$(sudo fail2ban-client status | grep <span class="string">&quot;Number of jail&quot;</span> | awk &#x27;&#123;print $NF&#125;&#x27;)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>실행 권한 부여:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/fail2ban-dashboard.sh</span><br><span class="line">sudo /usr/local/bin/fail2ban-dashboard.sh</span><br></pre></td></tr></table></figure><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://fail2ban.readthedocs.io/">Fail2ban 공식 문서</a></li><li><a href="https://github.com/fail2ban/fail2ban">Fail2ban GitHub</a></li><li><a href="https://www.fail2ban.org/wiki/">Fail2ban Wiki</a></li><li><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-20-04">DigitalOcean: How To Protect SSH with Fail2Ban</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/Linux/">Linux</category>
      
      
      <category domain="https://ckck803.github.io/tags/Linux/">Linux</category>
      
      <category domain="https://ckck803.github.io/tags/Security/">Security</category>
      
      <category domain="https://ckck803.github.io/tags/Fail2ban/">Fail2ban</category>
      
      <category domain="https://ckck803.github.io/tags/SSH/">SSH</category>
      
      <category domain="https://ckck803.github.io/tags/Firewall/">Firewall</category>
      
      
      <comments>https://ckck803.github.io/2025/12/29/linux/fail2ban-guide/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Network] NAT Gateway 란?</title>
      <link>https://ckck803.github.io/2025/12/28/computer-science/network/nat-gateway/</link>
      <guid>https://ckck803.github.io/2025/12/28/computer-science/network/nat-gateway/</guid>
      <pubDate>Sun, 28 Dec 2025 14:00:00 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;NAT-Gateway-란&quot;&gt;&lt;a href=&quot;#NAT-Gateway-란&quot; class=&quot;headerlink&quot; title=&quot;NAT Gateway 란?&quot;&gt;&lt;/a&gt;NAT Gateway 란?&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;NAT Gateway&lt;/strong&gt;는 Network Address Translation의 약자로, 프라이빗 네트워크의 리소스가 인터넷과 통신할 수 있도록 IP 주소를 변환해주는 관리형 네트워크 서비스입니다. 주로 프라이빗 서브넷의 인스턴스들이 외부 인터넷에 접근할 수 있게 하면서도, 외부에서 직접적인 인바운드 연결은 차단하는 역할을 합니다.&lt;/p&gt;
&lt;h2 id=&quot;NAT의-기본-개념&quot;&gt;&lt;a href=&quot;#NAT의-기본-개념&quot; class=&quot;headerlink&quot; title=&quot;NAT의 기본 개념&quot;&gt;&lt;/a&gt;NAT의 기본 개념&lt;/h2&gt;&lt;h3 id=&quot;NAT-Network-Address-Translation&quot;&gt;&lt;a href=&quot;#NAT-Network-Address-Translation&quot; class=&quot;headerlink&quot; title=&quot;NAT (Network Address Translation)&quot;&gt;&lt;/a&gt;NAT (Network Address Translation)&lt;/h3&gt;&lt;p&gt;NAT는 IP 패킷의 송신지 또는 목적지 IP 주소를 변환하는 기술입니다.&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;프라이빗 IP → NAT → 퍼블릭 IP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.0.1.5    → NAT → 203.0.113.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.0.1.10   → NAT → 203.0.113.5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10.0.1.15   → NAT → 203.0.113.5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;NAT가-필요한-이유&quot;&gt;&lt;a href=&quot;#NAT가-필요한-이유&quot; class=&quot;headerlink&quot; title=&quot;NAT가 필요한 이유&quot;&gt;&lt;/a&gt;NAT가 필요한 이유&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;IPv4 주소 고갈 문제 해결&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;제한된 퍼블릭 IP 주소를 효율적으로 사용&lt;/li&gt;
&lt;li&gt;하나의 퍼블릭 IP로 여러 프라이빗 IP 리소스 관리&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;보안 강화&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;내부 네트워크 구조 은닉&lt;/li&gt;
&lt;li&gt;외부에서 직접 접근 차단&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;유연한 네트워크 구성&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;내부 IP 체계를 자유롭게 설계&lt;/li&gt;
&lt;li&gt;외부 네트워크 변경 시 내부 영향 최소화&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;NAT-Gateway-vs-NAT-Instance&quot;&gt;&lt;a href=&quot;#NAT-Gateway-vs-NAT-Instance&quot; class=&quot;headerlink&quot; title=&quot;NAT Gateway vs NAT Instance&quot;&gt;&lt;/a&gt;NAT Gateway vs NAT Instance&lt;/h2&gt;&lt;h3 id=&quot;NAT-Gateway&quot;&gt;&lt;a href=&quot;#NAT-Gateway&quot; class=&quot;headerlink&quot; title=&quot;NAT Gateway&quot;&gt;&lt;/a&gt;NAT Gateway&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="NAT-Gateway-란"><a href="#NAT-Gateway-란" class="headerlink" title="NAT Gateway 란?"></a>NAT Gateway 란?</h2><p><strong>NAT Gateway</strong>는 Network Address Translation의 약자로, 프라이빗 네트워크의 리소스가 인터넷과 통신할 수 있도록 IP 주소를 변환해주는 관리형 네트워크 서비스입니다. 주로 프라이빗 서브넷의 인스턴스들이 외부 인터넷에 접근할 수 있게 하면서도, 외부에서 직접적인 인바운드 연결은 차단하는 역할을 합니다.</p><h2 id="NAT의-기본-개념"><a href="#NAT의-기본-개념" class="headerlink" title="NAT의 기본 개념"></a>NAT의 기본 개념</h2><h3 id="NAT-Network-Address-Translation"><a href="#NAT-Network-Address-Translation" class="headerlink" title="NAT (Network Address Translation)"></a>NAT (Network Address Translation)</h3><p>NAT는 IP 패킷의 송신지 또는 목적지 IP 주소를 변환하는 기술입니다.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">프라이빗 IP → NAT → 퍼블릭 IP</span><br><span class="line">10.0.1.5    → NAT → 203.0.113.5</span><br><span class="line">10.0.1.10   → NAT → 203.0.113.5</span><br><span class="line">10.0.1.15   → NAT → 203.0.113.5</span><br></pre></td></tr></table></figure><h3 id="NAT가-필요한-이유"><a href="#NAT가-필요한-이유" class="headerlink" title="NAT가 필요한 이유"></a>NAT가 필요한 이유</h3><ol><li><p><strong>IPv4 주소 고갈 문제 해결</strong></p><ul><li>제한된 퍼블릭 IP 주소를 효율적으로 사용</li><li>하나의 퍼블릭 IP로 여러 프라이빗 IP 리소스 관리</li></ul></li><li><p><strong>보안 강화</strong></p><ul><li>내부 네트워크 구조 은닉</li><li>외부에서 직접 접근 차단</li></ul></li><li><p><strong>유연한 네트워크 구성</strong></p><ul><li>내부 IP 체계를 자유롭게 설계</li><li>외부 네트워크 변경 시 내부 영향 최소화</li></ul></li></ol><h2 id="NAT-Gateway-vs-NAT-Instance"><a href="#NAT-Gateway-vs-NAT-Instance" class="headerlink" title="NAT Gateway vs NAT Instance"></a>NAT Gateway vs NAT Instance</h2><h3 id="NAT-Gateway"><a href="#NAT-Gateway" class="headerlink" title="NAT Gateway"></a>NAT Gateway</h3><p>AWS, GCP 등 클라우드 제공업체가 관리하는 관리형 서비스</p><p><strong>장점:</strong></p><ul><li>높은 가용성 (자동 이중화)</li><li>자동 확장 (최대 45Gbps)</li><li>관리 부담 없음</li><li>보안 그룹 불필요</li></ul><p><strong>단점:</strong></p><ul><li>시간당 과금</li><li>데이터 전송량 과금</li><li>보안 그룹 미지원</li><li>Bastion Host로 사용 불가</li></ul><h3 id="NAT-Instance"><a href="#NAT-Instance" class="headerlink" title="NAT Instance"></a>NAT Instance</h3><p>사용자가 직접 관리하는 EC2 인스턴스</p><p><strong>장점:</strong></p><ul><li>비용 절감 가능 (소규모의 경우)</li><li>보안 그룹 사용 가능</li><li>Bastion Host로 활용 가능</li><li>커스터마이징 가능</li></ul><p><strong>단점:</strong></p><ul><li>관리 부담 (패치, 업데이트)</li><li>가용성 직접 관리 필요</li><li>성능 제한 (인스턴스 타입에 따라)</li><li>Single Point of Failure 위험</li></ul><h2 id="AWS-NAT-Gateway-아키텍처"><a href="#AWS-NAT-Gateway-아키텍처" class="headerlink" title="AWS NAT Gateway 아키텍처"></a>AWS NAT Gateway 아키텍처</h2><h3 id="기본-구성"><a href="#기본-구성" class="headerlink" title="기본 구성"></a>기본 구성</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────┐</span><br><span class="line">│                  VPC (10.0.0.0/16)              │</span><br><span class="line">│                                                 │</span><br><span class="line">│  ┌────────────────────┐  ┌──────────────────┐  │</span><br><span class="line">│  │ Public Subnet      │  │ Private Subnet   │  │</span><br><span class="line">│  │ (10.0.1.0/24)      │  │ (10.0.2.0/24)    │  │</span><br><span class="line">│  │                    │  │                  │  │</span><br><span class="line">│  │  ┌──────────────┐  │  │  ┌────────────┐  │  │</span><br><span class="line">│  │  │ NAT Gateway  │  │  │  │  Instance  │  │  │</span><br><span class="line">│  │  │ (Public IP)  │◄─┼──┼──│ (Private)  │  │  │</span><br><span class="line">│  │  └──────┬───────┘  │  │  └────────────┘  │  │</span><br><span class="line">│  │         │          │  │                  │  │</span><br><span class="line">│  └─────────┼──────────┘  └──────────────────┘  │</span><br><span class="line">│            │                                    │</span><br><span class="line">└────────────┼────────────────────────────────────┘</span><br><span class="line">             │</span><br><span class="line">             ▼</span><br><span class="line">    Internet Gateway</span><br><span class="line">             │</span><br><span class="line">             ▼</span><br><span class="line">         Internet</span><br></pre></td></tr></table></figure><h3 id="라우팅-테이블-구성"><a href="#라우팅-테이블-구성" class="headerlink" title="라우팅 테이블 구성"></a>라우팅 테이블 구성</h3><p><strong>Public Subnet 라우팅 테이블:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Destination       Target</span><br><span class="line">10.0.0.0/16      local</span><br><span class="line">0.0.0.0/0        igw-xxxxx (Internet Gateway)</span><br></pre></td></tr></table></figure><p><strong>Private Subnet 라우팅 테이블:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Destination       Target</span><br><span class="line">10.0.0.0/16      local</span><br><span class="line">0.0.0.0/0        nat-xxxxx (NAT Gateway)</span><br></pre></td></tr></table></figure><h2 id="NAT-Gateway-동작-방식"><a href="#NAT-Gateway-동작-방식" class="headerlink" title="NAT Gateway 동작 방식"></a>NAT Gateway 동작 방식</h2><h3 id="아웃바운드-트래픽-흐름"><a href="#아웃바운드-트래픽-흐름" class="headerlink" title="아웃바운드 트래픽 흐름"></a>아웃바운드 트래픽 흐름</h3><ol><li><strong>프라이빗 인스턴스 → 인터넷</strong><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. Private Instance (10.0.2.10) → 외부 서버 (93.184.216.34)</span><br><span class="line">   Source: 10.0.2.10:50000</span><br><span class="line">   Dest: 93.184.216.34:443</span><br><span class="line"></span><br><span class="line">2. NAT Gateway에서 주소 변환</span><br><span class="line">   Source: 52.1.2.3:10000 (NAT Gateway Public IP)</span><br><span class="line">   Dest: 93.184.216.34:443</span><br><span class="line"></span><br><span class="line">3. 외부 서버로 전송</span><br><span class="line"></span><br><span class="line">4. 응답 수신</span><br><span class="line">   Source: 93.184.216.34:443</span><br><span class="line">   Dest: 52.1.2.3:10000</span><br><span class="line"></span><br><span class="line">5. NAT Gateway에서 역변환</span><br><span class="line">   Source: 93.184.216.34:443</span><br><span class="line">   Dest: 10.0.2.10:50000</span><br><span class="line"></span><br><span class="line">6. Private Instance로 전달</span><br></pre></td></tr></table></figure></li></ol><h3 id="인바운드-트래픽-차단"><a href="#인바운드-트래픽-차단" class="headerlink" title="인바운드 트래픽 차단"></a>인바운드 트래픽 차단</h3><p>NAT Gateway는 아웃바운드 연결만 허용하고, 외부에서 시작되는 인바운드 연결은 자동으로 차단됩니다.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">❌ Internet → NAT Gateway → Private Instance (불가능)</span><br><span class="line">✅ Private Instance → NAT Gateway → Internet (가능)</span><br></pre></td></tr></table></figure><h2 id="NAT-Gateway-고가용성-구성"><a href="#NAT-Gateway-고가용성-구성" class="headerlink" title="NAT Gateway 고가용성 구성"></a>NAT Gateway 고가용성 구성</h2><h3 id="Multi-AZ-구성"><a href="#Multi-AZ-구성" class="headerlink" title="Multi-AZ 구성"></a>Multi-AZ 구성</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────────┐</span><br><span class="line">│                    VPC                              │</span><br><span class="line">│                                                     │</span><br><span class="line">│  ┌──────────────────┐      ┌──────────────────┐    │</span><br><span class="line">│  │  AZ-A            │      │  AZ-B            │    │</span><br><span class="line">│  │                  │      │                  │    │</span><br><span class="line">│  │  Public Subnet   │      │  Public Subnet   │    │</span><br><span class="line">│  │  ┌────────────┐  │      │  ┌────────────┐  │    │</span><br><span class="line">│  │  │NAT Gateway │  │      │  │NAT Gateway │  │    │</span><br><span class="line">│  │  │     A      │  │      │  │     B      │  │    │</span><br><span class="line">│  │  └─────┬──────┘  │      │  └─────┬──────┘  │    │</span><br><span class="line">│  │        │         │      │        │         │    │</span><br><span class="line">│  │ Private Subnet   │      │ Private Subnet   │    │</span><br><span class="line">│  │  ┌──────────┐    │      │  ┌──────────┐    │    │</span><br><span class="line">│  │  │Instance  │────┼──┐   │  │Instance  │    │    │</span><br><span class="line">│  │  │    A     │    │  │   │  │    B     │────┼──┐ │</span><br><span class="line">│  │  └──────────┘    │  │   │  └──────────┘    │  │ │</span><br><span class="line">│  │                  │  │   │                  │  │ │</span><br><span class="line">│  └──────────────────┘  │   └──────────────────┘  │ │</span><br><span class="line">│                        │                         │ │</span><br><span class="line">│       라우팅: NAT-A ───┘         라우팅: NAT-B ───┘ │</span><br><span class="line">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure><p>각 가용 영역(AZ)마다 NAT Gateway를 배치하여 고가용성을 확보합니다.</p><h2 id="NAT-Gateway-설정-AWS-예시"><a href="#NAT-Gateway-설정-AWS-예시" class="headerlink" title="NAT Gateway 설정 (AWS 예시)"></a>NAT Gateway 설정 (AWS 예시)</h2><h3 id="1-NAT-Gateway-생성"><a href="#1-NAT-Gateway-생성" class="headerlink" title="1. NAT Gateway 생성"></a>1. NAT Gateway 생성</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># AWS CLI를 통한 NAT Gateway 생성</span></span><br><span class="line">aws ec2 create-nat-gateway \</span><br><span class="line">    --subnet-id subnet-1234567890abcdef0 \</span><br><span class="line">    --allocation-id eipalloc-1234567890abcdef0</span><br></pre></td></tr></table></figure><h3 id="2-라우팅-테이블-설정"><a href="#2-라우팅-테이블-설정" class="headerlink" title="2. 라우팅 테이블 설정"></a>2. 라우팅 테이블 설정</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 라우팅 테이블 생성</span></span><br><span class="line">aws ec2 create-route-table \</span><br><span class="line">    --vpc-id vpc-1234567890abcdef0</span><br><span class="line"></span><br><span class="line"><span class="comment"># NAT Gateway로 가는 라우트 추가</span></span><br><span class="line">aws ec2 create-route \</span><br><span class="line">    --route-table-id rtb-1234567890abcdef0 \</span><br><span class="line">    --destination-cidr-block 0.0.0.0/0 \</span><br><span class="line">    --nat-gateway-id nat-1234567890abcdef0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프라이빗 서브넷과 라우팅 테이블 연결</span></span><br><span class="line">aws ec2 associate-route-table \</span><br><span class="line">    --route-table-id rtb-1234567890abcdef0 \</span><br><span class="line">    --subnet-id subnet-0987654321fedcba0</span><br></pre></td></tr></table></figure><h3 id="3-Terraform-설정-예시"><a href="#3-Terraform-설정-예시" class="headerlink" title="3. Terraform 설정 예시"></a>3. Terraform 설정 예시</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Elastic IP 생성</span><br><span class="line">resource &quot;aws_eip&quot; &quot;nat&quot; &#123;</span><br><span class="line">  vpc = true</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;nat-gateway-eip&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># NAT Gateway 생성</span><br><span class="line">resource &quot;aws_nat_gateway&quot; &quot;main&quot; &#123;</span><br><span class="line">  allocation_id = aws_eip.nat.id</span><br><span class="line">  subnet_id     = aws_subnet.public.id</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;main-nat-gateway&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # Internet Gateway가 먼저 생성되어야 함</span><br><span class="line">  depends_on = [aws_internet_gateway.main]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Private 서브넷 라우팅 테이블</span><br><span class="line">resource &quot;aws_route_table&quot; &quot;private&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.main.id</span><br><span class="line"></span><br><span class="line">  route &#123;</span><br><span class="line">    cidr_block     = &quot;0.0.0.0/0&quot;</span><br><span class="line">    nat_gateway_id = aws_nat_gateway.main.id</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;private-route-table&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 라우팅 테이블 연결</span><br><span class="line">resource &quot;aws_route_table_association&quot; &quot;private&quot; &#123;</span><br><span class="line">  subnet_id      = aws_subnet.private.id</span><br><span class="line">  route_table_id = aws_route_table.private.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="NAT-Gateway-사용-사례"><a href="#NAT-Gateway-사용-사례" class="headerlink" title="NAT Gateway 사용 사례"></a>NAT Gateway 사용 사례</h2><h3 id="1-데이터베이스-서버의-외부-통신"><a href="#1-데이터베이스-서버의-외부-통신" class="headerlink" title="1. 데이터베이스 서버의 외부 통신"></a>1. 데이터베이스 서버의 외부 통신</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">프라이빗 서브넷의 RDS → NAT Gateway → 외부 API</span><br></pre></td></tr></table></figure><ul><li>보안 패치 다운로드</li><li>외부 API 호출</li><li>백업 데이터 전송</li></ul><h3 id="2-프라이빗-컴퓨팅-리소스의-인터넷-접근"><a href="#2-프라이빗-컴퓨팅-리소스의-인터넷-접근" class="headerlink" title="2. 프라이빗 컴퓨팅 리소스의 인터넷 접근"></a>2. 프라이빗 컴퓨팅 리소스의 인터넷 접근</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Lambda (VPC 내부) → NAT Gateway → 외부 서비스</span><br><span class="line">ECS Task (Private) → NAT Gateway → Docker Hub</span><br></pre></td></tr></table></figure><h3 id="3-소프트웨어-업데이트-및-패키지-설치"><a href="#3-소프트웨어-업데이트-및-패키지-설치" class="headerlink" title="3. 소프트웨어 업데이트 및 패키지 설치"></a>3. 소프트웨어 업데이트 및 패키지 설치</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 프라이빗 EC2에서 패키지 설치</span></span><br><span class="line">sudo yum update -y</span><br><span class="line">sudo yum install -y nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># NAT Gateway를 통해 yum 저장소 접근</span></span><br></pre></td></tr></table></figure><h3 id="4-마이크로서비스-아키텍처"><a href="#4-마이크로서비스-아키텍처" class="headerlink" title="4. 마이크로서비스 아키텍처"></a>4. 마이크로서비스 아키텍처</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Private Subnet:</span><br><span class="line">├─ API Service → NAT Gateway → 외부 결제 API</span><br><span class="line">├─ Worker Service → NAT Gateway → 외부 이메일 서비스</span><br><span class="line">└─ Batch Job → NAT Gateway → 외부 데이터 소스</span><br></pre></td></tr></table></figure><h2 id="NAT-Gateway-vs-Internet-Gateway"><a href="#NAT-Gateway-vs-Internet-Gateway" class="headerlink" title="NAT Gateway vs Internet Gateway"></a>NAT Gateway vs Internet Gateway</h2><table><thead><tr><th>특징</th><th>NAT Gateway</th><th>Internet Gateway</th></tr></thead><tbody><tr><td>위치</td><td>Public Subnet</td><td>VPC 레벨</td></tr><tr><td>주요 역할</td><td>Private → Internet</td><td>Public ↔ Internet</td></tr><tr><td>IP 변환</td><td>수행 (Private → Public)</td><td>수행하지 않음</td></tr><tr><td>인바운드</td><td>차단</td><td>허용</td></tr><tr><td>아웃바운드</td><td>허용</td><td>허용</td></tr><tr><td>비용</td><td>시간당 + 데이터 전송량</td><td>무료 (데이터 전송량만)</td></tr></tbody></table><h2 id="비용-최적화-방법"><a href="#비용-최적화-방법" class="headerlink" title="비용 최적화 방법"></a>비용 최적화 방법</h2><h3 id="1-NAT-Gateway-통합"><a href="#1-NAT-Gateway-통합" class="headerlink" title="1. NAT Gateway 통합"></a>1. NAT Gateway 통합</h3><p>여러 프라이빗 서브넷이 하나의 NAT Gateway를 공유하도록 설정</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Multiple Private Subnets → Single NAT Gateway</span><br></pre></td></tr></table></figure><h3 id="2-VPC-Endpoint-활용"><a href="#2-VPC-Endpoint-활용" class="headerlink" title="2. VPC Endpoint 활용"></a>2. VPC Endpoint 활용</h3><p>AWS 서비스 접근 시 NAT Gateway 대신 VPC Endpoint 사용</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># S3 VPC Endpoint</span><br><span class="line">resource &quot;aws_vpc_endpoint&quot; &quot;s3&quot; &#123;</span><br><span class="line">  vpc_id       = aws_vpc.main.id</span><br><span class="line">  service_name = &quot;com.amazonaws.region.s3&quot;</span><br><span class="line"></span><br><span class="line">  route_table_ids = [aws_route_table.private.id]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>비용 절감:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Before: Private Instance → NAT Gateway → S3 (데이터 전송 비용 발생)</span><br><span class="line">After:  Private Instance → VPC Endpoint → S3 (비용 없음)</span><br></pre></td></tr></table></figure><h3 id="3-데이터-전송-최소화"><a href="#3-데이터-전송-최소화" class="headerlink" title="3. 데이터 전송 최소화"></a>3. 데이터 전송 최소화</h3><ul><li>불필요한 외부 API 호출 줄이기</li><li>캐싱 활용</li><li>배치 처리로 요청 횟수 감소</li></ul><h3 id="4-NAT-Instance-고려"><a href="#4-NAT-Instance-고려" class="headerlink" title="4. NAT Instance 고려"></a>4. NAT Instance 고려</h3><p>트래픽이 적은 개발&#x2F;테스트 환경에서는 NAT Instance 사용 검토</p><h2 id="모니터링-및-트러블슈팅"><a href="#모니터링-및-트러블슈팅" class="headerlink" title="모니터링 및 트러블슈팅"></a>모니터링 및 트러블슈팅</h2><h3 id="CloudWatch-메트릭"><a href="#CloudWatch-메트릭" class="headerlink" title="CloudWatch 메트릭"></a>CloudWatch 메트릭</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NAT Gateway 모니터링</span></span><br><span class="line">- BytesInFromDestination: 인터넷 → NAT Gateway</span><br><span class="line">- BytesInFromSource: 프라이빗 서브넷 → NAT Gateway</span><br><span class="line">- BytesOutToDestination: NAT Gateway → 인터넷</span><br><span class="line">- BytesOutToSource: NAT Gateway → 프라이빗 서브넷</span><br><span class="line">- ConnectionAttemptCount: 연결 시도 횟수</span><br><span class="line">- ConnectionEstablishedCount: 성공한 연결 수</span><br><span class="line">- ErrorPortAllocation: 포트 할당 오류</span><br><span class="line">- PacketsDropCount: 드롭된 패킷 수</span><br></pre></td></tr></table></figure><h3 id="일반적인-문제-해결"><a href="#일반적인-문제-해결" class="headerlink" title="일반적인 문제 해결"></a>일반적인 문제 해결</h3><p><strong>1. 프라이빗 인스턴스가 인터넷 접근 불가</strong></p><p>체크리스트:</p><ul><li>NAT Gateway가 Public Subnet에 있는지 확인</li><li>Elastic IP가 NAT Gateway에 연결되어 있는지 확인</li><li>Private Subnet의 라우팅 테이블에 NAT Gateway가 설정되어 있는지 확인</li><li>보안 그룹과 Network ACL 확인</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 라우팅 테이블 확인</span></span><br><span class="line">aws ec2 describe-route-tables --route-table-id rtb-xxxxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># NAT Gateway 상태 확인</span></span><br><span class="line">aws ec2 describe-nat-gateways --nat-gateway-ids nat-xxxxx</span><br></pre></td></tr></table></figure><p><strong>2. 연결 타임아웃</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NAT Gateway 상태가 &#x27;available&#x27;인지 확인</span></span><br><span class="line">aws ec2 describe-nat-gateways \</span><br><span class="line">    --nat-gateway-ids nat-xxxxx \</span><br><span class="line">    --query <span class="string">&#x27;NatGateways[0].State&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VPC Flow Logs 확인</span></span><br><span class="line">aws ec2 describe-flow-logs --filter <span class="string">&quot;Name=resource-id,Values=eni-xxxxx&quot;</span></span><br></pre></td></tr></table></figure><p><strong>3. 포트 할당 오류</strong></p><p>NAT Gateway는 하나의 IP에서 약 55,000개의 동시 연결 지원. 초과 시:</p><ul><li>여러 NAT Gateway 사용</li><li>연결 풀링 최적화</li><li>불필요한 연결 종료</li></ul><h2 id="보안-모범-사례"><a href="#보안-모범-사례" class="headerlink" title="보안 모범 사례"></a>보안 모범 사례</h2><h3 id="1-Network-ACL-설정"><a href="#1-Network-ACL-설정" class="headerlink" title="1. Network ACL 설정"></a>1. Network ACL 설정</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Inbound Rules (Private Subnet):</span><br><span class="line">- Allow from NAT Gateway IP</span><br><span class="line">- Deny all other</span><br><span class="line"></span><br><span class="line">Outbound Rules (Private Subnet):</span><br><span class="line">- Allow to 0.0.0.0/0</span><br></pre></td></tr></table></figure><h3 id="2-최소-권한-원칙"><a href="#2-최소-권한-원칙" class="headerlink" title="2. 최소 권한 원칙"></a>2. 최소 권한 원칙</h3><p>프라이빗 리소스는 필요한 외부 엔드포인트만 접근하도록 제한</p><h3 id="3-VPC-Flow-Logs-활성화"><a href="#3-VPC-Flow-Logs-활성화" class="headerlink" title="3. VPC Flow Logs 활성화"></a>3. VPC Flow Logs 활성화</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource &quot;aws_flow_log&quot; &quot;nat_gateway&quot; &#123;</span><br><span class="line">  vpc_id          = aws_vpc.main.id</span><br><span class="line">  traffic_type    = &quot;ALL&quot;</span><br><span class="line">  iam_role_arn    = aws_iam_role.flow_logs.arn</span><br><span class="line">  log_destination = aws_cloudwatch_log_group.flow_logs.arn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-정기적인-모니터링"><a href="#4-정기적인-모니터링" class="headerlink" title="4. 정기적인 모니터링"></a>4. 정기적인 모니터링</h3><ul><li>비정상적인 트래픽 패턴 탐지</li><li>비용 이상 증가 알림 설정</li><li>연결 실패 로그 검토</li></ul><h2 id="NAT-Gateway의-장단점"><a href="#NAT-Gateway의-장단점" class="headerlink" title="NAT Gateway의 장단점"></a>NAT Gateway의 장단점</h2><h3 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h3><ol><li><strong>높은 가용성</strong>: 자동으로 이중화되어 단일 장애 지점 제거</li><li><strong>확장성</strong>: 자동으로 최대 45Gbps까지 확장</li><li><strong>관리 편의성</strong>: 패치, 업데이트 불필요</li><li><strong>보안</strong>: 외부에서 시작되는 연결 자동 차단</li><li><strong>성능</strong>: 높은 대역폭과 낮은 지연시간</li></ol><h3 id="단점"><a href="#단점" class="headerlink" title="단점"></a>단점</h3><ol><li><strong>비용</strong>: 시간당 요금 + 데이터 전송 비용</li><li><strong>유연성 제한</strong>: 커스터마이징 불가</li><li><strong>보안 그룹 미지원</strong>: Network ACL만 사용 가능</li><li><strong>포트 포워딩 불가</strong>: 인바운드 연결 설정 불가</li></ol><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html">AWS NAT Gateway Documentation</a></li><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-comparison.html">NAT Gateway vs NAT Instance</a></li><li><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html">VPC Endpoints</a></li><li><a href="https://cloud.google.com/nat/docs/overview">Google Cloud NAT</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/CS/">CS</category>
      
      <category domain="https://ckck803.github.io/categories/CS/Network/">Network</category>
      
      
      
      <comments>https://ckck803.github.io/2025/12/28/computer-science/network/nat-gateway/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[쿠버네티스] - Health Probes (Startup, Liveness, Readiness)</title>
      <link>https://ckck803.github.io/2025/12/26/k8s/pod/health-probes/</link>
      <guid>https://ckck803.github.io/2025/12/26/k8s/pod/health-probes/</guid>
      <pubDate>Fri, 26 Dec 2025 01:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/k8s/k8s.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;개요&quot;&gt;&lt;a href=&quot;#개요&quot; class=&quot;headerlink&quot; title=&quot;개요&quot;&gt;&lt;/a&gt;개요&lt;/h2&gt;&lt;p&gt;쿠버네티스는 컨테이너의 상태를 모니터링하고 관리하기 위해 세 가지 유형의 Health Probe를 제공합니다:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Startup Probe&lt;/strong&gt;: 컨테이너가 시작되었는지 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Liveness Probe&lt;/strong&gt;: 컨테이너가 정상적으로 실행 중인지 확인&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Readiness Probe&lt;/strong&gt;: 컨테이너가 트래픽을 받을 준비가 되었는지 확인&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Probe-메커니즘&quot;&gt;&lt;a href=&quot;#Probe-메커니즘&quot; class=&quot;headerlink&quot; title=&quot;Probe 메커니즘&quot;&gt;&lt;/a&gt;Probe 메커니즘&lt;/h2&gt;&lt;p&gt;모든 Probe는 다음 세 가지 방식 중 하나로 동작합니다:&lt;/p&gt;
&lt;h3 id=&quot;1-HTTP-GET-요청&quot;&gt;&lt;a href=&quot;#1-HTTP-GET-요청&quot; class=&quot;headerlink&quot; title=&quot;1. HTTP GET 요청&quot;&gt;&lt;/a&gt;1. HTTP GET 요청&lt;/h3&gt;&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;httpGet:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/healthz&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;port:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;8080&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;httpHeaders:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;bullet&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Custom-Header&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;value:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;Awesome&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;scheme:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;HTTP&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;# or HTTPS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;지정된 경로로 HTTP GET 요청을 보냅니다&lt;/li&gt;
&lt;li&gt;200-399 범위의 상태 코드를 반환하면 성공&lt;/li&gt;
&lt;li&gt;그 외의 코드는 실패로 간주&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-TCP-Socket-연결&quot;&gt;&lt;a href=&quot;#2-TCP-Socket-연결&quot; class=&quot;headerlink&quot; title=&quot;2. TCP Socket 연결&quot;&gt;&lt;/a&gt;2. TCP Socket 연결&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/k8s/k8s.png"></p><h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><p>쿠버네티스는 컨테이너의 상태를 모니터링하고 관리하기 위해 세 가지 유형의 Health Probe를 제공합니다:</p><ul><li><strong>Startup Probe</strong>: 컨테이너가 시작되었는지 확인</li><li><strong>Liveness Probe</strong>: 컨테이너가 정상적으로 실행 중인지 확인</li><li><strong>Readiness Probe</strong>: 컨테이너가 트래픽을 받을 준비가 되었는지 확인</li></ul><h2 id="Probe-메커니즘"><a href="#Probe-메커니즘" class="headerlink" title="Probe 메커니즘"></a>Probe 메커니즘</h2><p>모든 Probe는 다음 세 가지 방식 중 하나로 동작합니다:</p><h3 id="1-HTTP-GET-요청"><a href="#1-HTTP-GET-요청" class="headerlink" title="1. HTTP GET 요청"></a>1. HTTP GET 요청</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">httpGet:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">httpHeaders:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Custom-Header</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">Awesome</span></span><br><span class="line">  <span class="attr">scheme:</span> <span class="string">HTTP</span>  <span class="comment"># or HTTPS</span></span><br></pre></td></tr></table></figure><ul><li>지정된 경로로 HTTP GET 요청을 보냅니다</li><li>200-399 범위의 상태 코드를 반환하면 성공</li><li>그 외의 코드는 실패로 간주</li></ul><h3 id="2-TCP-Socket-연결"><a href="#2-TCP-Socket-연결" class="headerlink" title="2. TCP Socket 연결"></a>2. TCP Socket 연결</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">tcpSocket:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><ul><li>지정된 포트로 TCP 연결을 시도합니다</li><li>연결이 성공하면 성공</li><li>연결이 실패하면 실패로 간주</li></ul><h3 id="3-Exec-명령-실행"><a href="#3-Exec-명령-실행" class="headerlink" title="3. Exec 명령 실행"></a>3. Exec 명령 실행</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">exec:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/tmp/healthy</span></span><br></pre></td></tr></table></figure><ul><li>컨테이너 내부에서 명령을 실행합니다</li><li>Exit code 0을 반환하면 성공</li><li>그 외의 코드는 실패로 간주</li></ul><h2 id="Probe-공통-설정"><a href="#Probe-공통-설정" class="headerlink" title="Probe 공통 설정"></a>Probe 공통 설정</h2><p>모든 Probe에서 사용할 수 있는 공통 파라미터:</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">initialDelaySeconds:</span> <span class="number">0</span>      <span class="comment"># 컨테이너 시작 후 probe 시작 전 대기 시간 (기본: 0초)</span></span><br><span class="line"><span class="attr">periodSeconds:</span> <span class="number">10</span>           <span class="comment"># probe 실행 간격 (기본: 10초)</span></span><br><span class="line"><span class="attr">timeoutSeconds:</span> <span class="number">1</span>           <span class="comment"># probe 타임아웃 시간 (기본: 1초)</span></span><br><span class="line"><span class="attr">successThreshold:</span> <span class="number">1</span>         <span class="comment"># 실패 후 성공으로 간주하기 위한 연속 성공 횟수 (기본: 1)</span></span><br><span class="line"><span class="attr">failureThreshold:</span> <span class="number">3</span>         <span class="comment"># 성공 후 실패로 간주하기 위한 연속 실패 횟수 (기본: 3)</span></span><br></pre></td></tr></table></figure><h2 id="📍-1-Startup-Probe-기동은-끝났니"><a href="#📍-1-Startup-Probe-기동은-끝났니" class="headerlink" title="📍 1. Startup Probe - 기동은 끝났니?"></a>📍 1. Startup Probe - 기동은 끝났니?</h2><h3 id="목적"><a href="#목적" class="headerlink" title="목적"></a>목적</h3><ul><li>컨테이너 애플리케이션이 <strong>시작되었는지</strong> 확인</li><li>시작이 느린 애플리케이션(레거시 애플리케이션 등)을 보호</li></ul><h3 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h3><ul><li>Startup Probe가 성공하기 전까지 Liveness와 Readiness Probe는 비활성화됩니다</li><li>Startup Probe가 실패하면 kubelet이 컨테이너를 종료하고 재시작 정책에 따라 처리합니다</li><li>Startup Probe는 한 번만 성공하면 더 이상 실행되지 않습니다</li></ul><h3 id="사용-시나리오"><a href="#사용-시나리오" class="headerlink" title="사용 시나리오"></a>사용 시나리오</h3><ul><li>시작 시간이 오래 걸리는 애플리케이션 (예: JVM 기반 애플리케이션)</li><li>초기화 작업이 많은 애플리케이션</li><li>데이터베이스 마이그레이션이 필요한 애플리케이션</li></ul><h3 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">startup-probe-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">startupProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/startup</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">30</span>    <span class="comment"># 최대 300초(10초 * 30회) 동안 시작 대기</span></span><br><span class="line">      <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>위 예제에서:</p><ul><li>10초마다 <code>/startup</code> 엔드포인트를 확인</li><li>최대 300초(30번 실패)까지 시작을 기다립니다</li><li>1번 성공하면 애플리케이션이 시작된 것으로 간주</li></ul><h2 id="📍-2-Liveness-Probe-살아있니"><a href="#📍-2-Liveness-Probe-살아있니" class="headerlink" title="📍 2. Liveness Probe - 살아있니?"></a>📍 2. Liveness Probe - 살아있니?</h2><h3 id="목적-1"><a href="#목적-1" class="headerlink" title="목적"></a>목적</h3><ul><li>컨테이너가 <strong>정상적으로 실행 중인지</strong> 확인</li><li>데드락, 무한 루프 등으로 응답하지 않는 컨테이너를 감지</li></ul><h3 id="특징-1"><a href="#특징-1" class="headerlink" title="특징"></a>특징</h3><ul><li>Liveness Probe가 실패하면 kubelet이 컨테이너를 종료하고 재시작 정책에 따라 처리합니다</li><li>컨테이너를 재시작하여 문제를 해결할 수 있는 경우에만 사용해야 합니다</li></ul><h3 id="사용-시나리오-1"><a href="#사용-시나리오-1" class="headerlink" title="사용 시나리오"></a>사용 시나리오</h3><ul><li>데드락 상태에 빠질 수 있는 애플리케이션</li><li>메모리 누수로 인해 응답 불가 상태가 될 수 있는 애플리케이션</li><li>내부 상태가 손상되어 재시작이 필요한 경우</li></ul><h3 id="주의사항"><a href="#주의사항" class="headerlink" title="주의사항"></a>주의사항</h3><ul><li>너무 민감하게 설정하면 불필요한 재시작이 발생할 수 있습니다</li><li>Liveness Probe는 복구 가능한 상황이 아닌 경우에만 실패해야 합니다</li><li>외부 의존성(DB, 외부 API 등)을 체크하지 않는 것이 좋습니다</li></ul><h3 id="예제-1"><a href="#예제-1" class="headerlink" title="예제"></a>예제</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">liveness-probe-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># TCP Socket 예제</span></span><br><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">tcpSocket:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Exec 예제</span></span><br><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">exec:</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pgrep</span> <span class="string">-f</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h2 id="📍-3-Readiness-Probe-트래픽-받아도-되니"><a href="#📍-3-Readiness-Probe-트래픽-받아도-되니" class="headerlink" title="📍 3. Readiness Probe - 트래픽 받아도 되니?"></a>📍 3. Readiness Probe - 트래픽 받아도 되니?</h2><h3 id="목적-2"><a href="#목적-2" class="headerlink" title="목적"></a>목적</h3><ul><li>컨테이너가 <strong>트래픽을 받을 준비</strong>가 되었는지 확인</li><li>요청을 처리할 준비가 안 된 Pod로 트래픽이 전달되는 것을 방지</li></ul><h3 id="특징-2"><a href="#특징-2" class="headerlink" title="특징"></a>특징</h3><ul><li>Readiness Probe가 실패하면 Pod의 IP 주소가 Service의 엔드포인트에서 제거됩니다</li><li>컨테이너는 종료되지 않고 계속 실행됩니다</li><li>Probe가 다시 성공하면 엔드포인트에 다시 추가됩니다</li></ul><h3 id="사용-시나리오-2"><a href="#사용-시나리오-2" class="headerlink" title="사용 시나리오"></a>사용 시나리오</h3><ul><li>초기 데이터 로딩이 필요한 애플리케이션</li><li>외부 서비스와의 연결이 필요한 애플리케이션</li><li>웜업 시간이 필요한 애플리케이션</li><li>일시적으로 과부하 상태인 경우 트래픽을 받지 않도록 설정</li></ul><h3 id="예제-2"><a href="#예제-2" class="headerlink" title="예제"></a>예제</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">readiness-probe-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">readinessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">successThreshold:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="Readiness-Gate"><a href="#Readiness-Gate" class="headerlink" title="Readiness Gate"></a>Readiness Gate</h3><p>더 복잡한 준비 상태 로직이 필요한 경우 Readiness Gate를 사용할 수 있습니다:</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-with-readiness-gate</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">readinessGates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">conditionType:</span> <span class="string">&quot;www.example.com/feature-1&quot;</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br></pre></td></tr></table></figure><h2 id="세-가지-Probe-조합-사용"><a href="#세-가지-Probe-조합-사용" class="headerlink" title="세 가지 Probe 조합 사용"></a>세 가지 Probe 조합 사용</h2><p>실제 프로덕션 환경에서는 세 가지 Probe를 함께 사용하는 것이 권장됩니다:</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Startup Probe: 애플리케이션이 시작될 때까지 최대 5분 대기</span></span><br><span class="line">        <span class="attr">startupProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/startup</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Liveness Probe: 애플리케이션이 살아있는지 확인</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">0</span>  <span class="comment"># startup probe가 끝나면 바로 시작</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Readiness Probe: 트래픽을 받을 준비가 되었는지 확인</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="Probe-동작-흐름"><a href="#Probe-동작-흐름" class="headerlink" title="Probe 동작 흐름"></a>Probe 동작 흐름</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">컨테이너 시작</span><br><span class="line">    ↓</span><br><span class="line">Startup Probe 실행 (성공할 때까지)</span><br><span class="line">    ↓</span><br><span class="line">Liveness Probe 활성화 (주기적으로 실행)</span><br><span class="line">Readiness Probe 활성화 (주기적으로 실행)</span><br><span class="line">    ↓</span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ Liveness 실패 → 컨테이너 재시작     │</span><br><span class="line">│ Readiness 실패 → Service에서 제거   │</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure><h2 id="Spring-Boot-애플리케이션-예제"><a href="#Spring-Boot-애플리케이션-예제" class="headerlink" title="Spring Boot 애플리케이션 예제"></a>Spring Boot 애플리케이션 예제</h2><p>Spring Boot 2.3+ 버전은 기본적으로 Health Endpoint를 제공합니다:</p><h3 id="1-의존성-추가"><a href="#1-의존성-추가" class="headerlink" title="1. 의존성 추가"></a>1. 의존성 추가</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-application-yml-설정"><a href="#2-application-yml-설정" class="headerlink" title="2. application.yml 설정"></a>2. application.yml 설정</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">probes:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">livenessState:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">readinessState:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="3-Kubernetes-Deployment"><a href="#3-Kubernetes-Deployment" class="headerlink" title="3. Kubernetes Deployment"></a>3. Kubernetes Deployment</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spring-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">spring-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spring-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">startupProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/readiness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="4-커스텀-Health-Indicator"><a href="#4-커스텀-Health-Indicator" class="headerlink" title="4. 커스텀 Health Indicator"></a>4. 커스텀 Health Indicator</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.Health;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 커스텀 헬스 체크 로직</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isHealthy</span> <span class="operator">=</span> checkDatabaseConnection() &amp;&amp; checkExternalService();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isHealthy) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.up()</span><br><span class="line">                .withDetail(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;connected&quot;</span>)</span><br><span class="line">                .withDetail(<span class="string">&quot;externalService&quot;</span>, <span class="string">&quot;available&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Health.down()</span><br><span class="line">            .withDetail(<span class="string">&quot;reason&quot;</span>, <span class="string">&quot;Database or external service unavailable&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkDatabaseConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// DB 연결 체크 로직</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkExternalService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 외부 서비스 체크 로직</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><h3 id="1-Startup-Probe"><a href="#1-Startup-Probe" class="headerlink" title="1. Startup Probe"></a>1. Startup Probe</h3><ul><li>시작 시간이 긴 애플리케이션에만 사용</li><li><code>failureThreshold * periodSeconds</code> &#x3D; 최대 시작 시간보다 크게 설정</li><li>한 번 성공하면 더 이상 실행되지 않으므로 충분한 여유를 둘 것</li></ul><h3 id="2-Liveness-Probe"><a href="#2-Liveness-Probe" class="headerlink" title="2. Liveness Probe"></a>2. Liveness Probe</h3><ul><li>가벼운 체크를 수행 (데이터베이스 연결 등 외부 의존성 제외)</li><li>재시작으로 해결할 수 있는 문제만 감지</li><li><code>initialDelaySeconds</code>는 Startup Probe 사용 시 0으로 설정</li><li><code>failureThreshold</code>를 너무 낮게 설정하지 말 것 (false positive 방지)</li></ul><h3 id="3-Readiness-Probe"><a href="#3-Readiness-Probe" class="headerlink" title="3. Readiness Probe"></a>3. Readiness Probe</h3><ul><li>외부 의존성(DB, 캐시, 외부 API) 체크 포함 가능</li><li><code>periodSeconds</code>를 짧게 설정하여 빠른 복구 가능하도록 설정</li><li>배포 중 무중단 배포를 위해 필수적</li></ul><h3 id="4-공통"><a href="#4-공통" class="headerlink" title="4. 공통"></a>4. 공통</h3><ul><li><code>/health</code> 엔드포인트는 인증 없이 접근 가능하도록 설정</li><li>Probe 엔드포인트는 로깅을 제외하거나 레벨을 낮게 설정 (로그 과다 생성 방지)</li><li>프로덕션 환경에서는 세 가지 Probe를 모두 설정하는 것을 권장</li></ul><h2 id="트러블슈팅"><a href="#트러블슈팅" class="headerlink" title="트러블슈팅"></a>트러블슈팅</h2><h3 id="CrashLoopBackOff"><a href="#CrashLoopBackOff" class="headerlink" title="CrashLoopBackOff"></a>CrashLoopBackOff</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Pod 상태 확인</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 확인</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --previous</span><br></pre></td></tr></table></figure><p><strong>원인</strong>:</p><ul><li>Liveness Probe 실패로 인한 반복적인 재시작</li><li>Startup Probe의 <code>failureThreshold</code> 설정이 너무 낮음</li></ul><p><strong>해결</strong>:</p><ul><li>Probe 설정을 완화 (<code>failureThreshold</code>, <code>timeoutSeconds</code> 증가)</li><li>애플리케이션 시작 시간 최적화</li></ul><h3 id="Pod가-Service에-등록되지-않음"><a href="#Pod가-Service에-등록되지-않음" class="headerlink" title="Pod가 Service에 등록되지 않음"></a>Pod가 Service에 등록되지 않음</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Service 엔드포인트 확인</span></span><br><span class="line">kubectl get endpoints &lt;service-name&gt;</span><br></pre></td></tr></table></figure><p><strong>원인</strong>:</p><ul><li>Readiness Probe 실패</li></ul><p><strong>해결</strong>:</p><ul><li>Readiness Probe 엔드포인트 확인</li><li>애플리케이션 로그에서 에러 확인</li><li>외부 의존성(DB, API) 연결 상태 확인</li></ul><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Kubernetes 공식 문서 - Configure Liveness, Readiness and Startup Probes</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html">Spring Boot Actuator 문서</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Kubernetes/">Kubernetes</category>
      
      <category domain="https://ckck803.github.io/categories/Kubernetes/%EC%9B%8C%ED%81%AC%EB%A1%9C%EB%93%9C/">워크로드</category>
      
      
      <category domain="https://ckck803.github.io/tags/k8s/">k8s</category>
      
      <category domain="https://ckck803.github.io/tags/probe/">probe</category>
      
      <category domain="https://ckck803.github.io/tags/health-check/">health-check</category>
      
      <category domain="https://ckck803.github.io/tags/startup/">startup</category>
      
      <category domain="https://ckck803.github.io/tags/liveness/">liveness</category>
      
      <category domain="https://ckck803.github.io/tags/readiness/">readiness</category>
      
      
      <comments>https://ckck803.github.io/2025/12/26/k8s/pod/health-probes/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[QueryDSL] Transform 사용 시 HikariCP Connection Leak 문제 해결</title>
      <link>https://ckck803.github.io/2025/12/25/spring/querydsl-transform-connection-leak/</link>
      <guid>https://ckck803.github.io/2025/12/25/spring/querydsl-transform-connection-leak/</guid>
      <pubDate>Wed, 24 Dec 2025 15:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/JPA/querydsl/querydsl.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;QueryDSL-Transform-사용-시-HikariCP-Connection-Leak-문제&quot;&gt;&lt;a href=&quot;#QueryDSL-Transform-사용-시-HikariCP-Connection-Leak-문제&quot; class=&quot;headerlink&quot; title=&quot;QueryDSL Transform 사용 시 HikariCP Connection Leak 문제&quot;&gt;&lt;/a&gt;QueryDSL Transform 사용 시 HikariCP Connection Leak 문제&lt;/h1&gt;&lt;p&gt;QueryDSL의 &lt;code&gt;transform()&lt;/code&gt; 메서드는 쿼리 결과를 그룹화하고 Map으로 변환할 때 매우 유용한 기능입니다. 하지만 부적절하게 사용할 경우 심각한 데이터베이스 커넥션 누수(Connection Leak)를 발생시킬 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;문제-상황&quot;&gt;&lt;a href=&quot;#문제-상황&quot; class=&quot;headerlink&quot; title=&quot;문제 상황&quot;&gt;&lt;/a&gt;문제 상황&lt;/h2&gt;&lt;p&gt;운영 중인 서비스에서 다음과 같은 에러가 발생했습니다:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HikariPool-1 - Connection is not available, request timed out after 30000ms.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;DB 커넥션 수는 POD 당 20개(max-connection-pool) 로 충분한 상태였고, 트랜잭션이 길게 잡히는 슬로우 쿼리도 없는 상황이라 아무래도 Connection Leak 이 발생하는 상황이라 생각 했습니다.&lt;/p&gt;
&lt;h2 id=&quot;원인-분석&quot;&gt;&lt;a href=&quot;#원인-분석&quot; class=&quot;headerlink&quot; title=&quot;원인 분석&quot;&gt;&lt;/a&gt;원인 분석&lt;/h2&gt;&lt;h3 id=&quot;QueryDSL의-transform-메서드-특징&quot;&gt;&lt;a href=&quot;#QueryDSL의-transform-메서드-특징&quot; class=&quot;headerlink&quot; title=&quot;QueryDSL의 transform() 메서드 특징&quot;&gt;&lt;/a&gt;QueryDSL의 transform() 메서드 특징&lt;/h3&gt;&lt;p&gt;문제의 원인은 QueryDSL의 &lt;code&gt;transform()&lt;/code&gt; 메서드의 내부 동작 방식에 있었습니다.&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/JPA/querydsl/querydsl.png"></p><h1 id="QueryDSL-Transform-사용-시-HikariCP-Connection-Leak-문제"><a href="#QueryDSL-Transform-사용-시-HikariCP-Connection-Leak-문제" class="headerlink" title="QueryDSL Transform 사용 시 HikariCP Connection Leak 문제"></a>QueryDSL Transform 사용 시 HikariCP Connection Leak 문제</h1><p>QueryDSL의 <code>transform()</code> 메서드는 쿼리 결과를 그룹화하고 Map으로 변환할 때 매우 유용한 기능입니다. 하지만 부적절하게 사용할 경우 심각한 데이터베이스 커넥션 누수(Connection Leak)를 발생시킬 수 있습니다.</p><h2 id="문제-상황"><a href="#문제-상황" class="headerlink" title="문제 상황"></a>문제 상황</h2><p>운영 중인 서비스에서 다음과 같은 에러가 발생했습니다:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HikariPool-1 - Connection is not available, request timed out after 30000ms.</span><br></pre></td></tr></table></figure><p>DB 커넥션 수는 POD 당 20개(max-connection-pool) 로 충분한 상태였고, 트랜잭션이 길게 잡히는 슬로우 쿼리도 없는 상황이라 아무래도 Connection Leak 이 발생하는 상황이라 생각 했습니다.</p><h2 id="원인-분석"><a href="#원인-분석" class="headerlink" title="원인 분석"></a>원인 분석</h2><h3 id="QueryDSL의-transform-메서드-특징"><a href="#QueryDSL의-transform-메서드-특징" class="headerlink" title="QueryDSL의 transform() 메서드 특징"></a>QueryDSL의 transform() 메서드 특징</h3><p>문제의 원인은 QueryDSL의 <code>transform()</code> 메서드의 내부 동작 방식에 있었습니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 문제가 되는 코드 예시</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Long, List&lt;OrderItem&gt;&gt; <span class="title function_">getOrderItemsByOrderId</span><span class="params">(List&lt;Long&gt; orderIds)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryFactory</span><br><span class="line">        .selectFrom(orderItem)</span><br><span class="line">        .where(orderItem.orderId.in(orderIds))</span><br><span class="line">        .transform(</span><br><span class="line">            groupBy(orderItem.orderId)</span><br><span class="line">            .as(list(orderItem))</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>일반적인 QueryDSL 종료 메서드들:</p><ul><li><code>fetch()</code> - 결과 리스트 조회</li><li><code>fetchOne()</code> - 단일 결과 조회</li><li><code>fetchFirst()</code> - 첫 번째 결과 조회</li><li><code>fetchCount()</code> - 카운트 조회</li></ul><p>이 메서드들은 모두 <code>queryTerminationMethods</code>에 등록되어 있어 <strong>쿼리 실행 후 자동으로 리소스를 정리</strong>합니다.</p><h3 id="transform-의-다른-점"><a href="#transform-의-다른-점" class="headerlink" title="transform()의 다른 점"></a>transform()의 다른 점</h3><p>하지만 <code>transform()</code> 메서드는:</p><ol><li>내부적으로 <code>iterate()</code> 메서드를 사용</li><li><code>iterate()</code>는 쿼리 종료 메서드가 아님</li><li>JPA EntityManager가 <strong>커넥션을 자동으로 반환하지 않음</strong></li><li>메서드 실행이 끝나도 커넥션이 계속 점유됨</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// QueryDSL 내부 코드 (단순화)</span></span><br><span class="line"><span class="keyword">public</span> &lt;RT&gt; RT <span class="title function_">transform</span><span class="params">(ResultTransformer&lt;RT&gt; transformer)</span> &#123;</span><br><span class="line">    <span class="comment">// iterate()를 사용 - 이것이 문제!</span></span><br><span class="line">    <span class="keyword">return</span> transformer.transform(<span class="built_in">this</span>.iterate());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="커넥션-누수-시나리오"><a href="#커넥션-누수-시나리오" class="headerlink" title="커넥션 누수 시나리오"></a>커넥션 누수 시나리오</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[요청 1] transform() 호출 → 커넥션 1 획득 → 쿼리 실행 → 커넥션 반환 안됨 ❌</span><br><span class="line">[요청 2] transform() 호출 → 커넥션 2 획득 → 쿼리 실행 → 커넥션 반환 안됨 ❌</span><br><span class="line">[요청 3] transform() 호출 → 커넥션 3 획득 → 쿼리 실행 → 커넥션 반환 안됨 ❌</span><br><span class="line">...</span><br><span class="line">[요청 N] transform() 호출 → 사용 가능한 커넥션 없음 → 30초 대기 → 타임아웃 💥</span><br></pre></td></tr></table></figure><h2 id="해결-방법"><a href="#해결-방법" class="headerlink" title="해결 방법"></a>해결 방법</h2><h3 id="해결책-Transactional-readOnly-true-추가"><a href="#해결책-Transactional-readOnly-true-추가" class="headerlink" title="해결책: @Transactional(readOnly &#x3D; true) 추가"></a>해결책: @Transactional(readOnly &#x3D; true) 추가</h3><p>가장 간단하고 확실한 해결책은 <code>@Transactional</code> 어노테이션을 추가하는 것입니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Long, List&lt;OrderItem&gt;&gt; <span class="title function_">getOrderItemsByOrderId</span><span class="params">(List&lt;Long&gt; orderIds)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryFactory</span><br><span class="line">        .selectFrom(orderItem)</span><br><span class="line">        .where(orderItem.orderId.in(orderIds))</span><br><span class="line">        .transform(</span><br><span class="line">            groupBy(orderItem.orderId)</span><br><span class="line">            .as(list(orderItem))</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="왜-Transactional이-문제를-해결하는가"><a href="#왜-Transactional이-문제를-해결하는가" class="headerlink" title="왜 @Transactional이 문제를 해결하는가?"></a>왜 @Transactional이 문제를 해결하는가?</h3><p><code>@Transactional</code> 어노테이션을 추가하면:</p><ol><li><p><strong>Spring의 트랜잭션 관리 활성화</strong></p><ul><li><code>JpaTransactionManager</code>가 메서드 실행을 관리</li></ul></li><li><p><strong>메서드 완료 시 정리 작업 보장</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Spring 트랜잭션 매니저의 내부 동작 (단순화)</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 비즈니스 로직 실행</span></span><br><span class="line">    result = method.invoke();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 트랜잭션 커밋</span></span><br><span class="line">    transactionManager.commit();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// 정리 작업 - 여기서 커넥션 반환!</span></span><br><span class="line">    transactionManager.doCleanupAfterCompletion();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>EntityManager와 커넥션 해제</strong></p><ul><li><code>doCleanupAfterCompletion()</code>에서 모든 리소스 정리</li><li>EntityManager 닫기</li><li><strong>데이터베이스 커넥션을 HikariCP 풀에 반환</strong></li></ul></li></ol><h3 id="readOnly-true의-추가-이점"><a href="#readOnly-true의-추가-이점" class="headerlink" title="readOnly &#x3D; true의 추가 이점"></a>readOnly &#x3D; true의 추가 이점</h3><p><code>@Transactional(readOnly = true)</code>를 사용하면:</p><ol><li><p><strong>성능 최적화</strong></p><ul><li>Hibernate가 Dirty Checking을 하지 않음</li><li>스냅샷 저장 안함</li><li>플러시 모드를 <code>MANUAL</code>로 설정</li></ul></li><li><p><strong>명확한 의도 표현</strong></p><ul><li>이 메서드가 읽기 전용임을 명시</li><li>실수로 데이터를 수정하는 것을 방지</li></ul></li><li><p><strong>데이터베이스 최적화</strong></p><ul><li>일부 데이터베이스는 읽기 전용 트랜잭션을 최적화</li><li>Read Replica로 라우팅 가능 (설정에 따라)</li></ul></li></ol><h2 id="대안적인-해결-방법"><a href="#대안적인-해결-방법" class="headerlink" title="대안적인 해결 방법"></a>대안적인 해결 방법</h2><h3 id="1-fetch-로-조회-후-애플리케이션에서-그룹화"><a href="#1-fetch-로-조회-후-애플리케이션에서-그룹화" class="headerlink" title="1. fetch()로 조회 후 애플리케이션에서 그룹화"></a>1. fetch()로 조회 후 애플리케이션에서 그룹화</h3><p>transform()을 사용하지 않고 애플리케이션 레벨에서 그룹화:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;Long, List&lt;OrderItem&gt;&gt; <span class="title function_">getOrderItemsByOrderId</span><span class="params">(List&lt;Long&gt; orderIds)</span> &#123;</span><br><span class="line">    List&lt;OrderItem&gt; items = queryFactory</span><br><span class="line">        .selectFrom(orderItem)</span><br><span class="line">        .where(orderItem.orderId.in(orderIds))</span><br><span class="line">        .fetch();  <span class="comment">// 일반적인 종료 메서드 사용</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Java Stream으로 그룹화</span></span><br><span class="line">    <span class="keyword">return</span> items.stream()</span><br><span class="line">        .collect(Collectors.groupingBy(OrderItem::getOrderId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>장점:</strong></p><ul><li>커넥션 누수 위험 없음</li><li><code>@Transactional</code> 없이도 안전</li></ul><p><strong>단점:</strong></p><ul><li>애플리케이션 메모리에서 그룹화 처리</li><li>대용량 데이터에서는 메모리 부담</li></ul><h3 id="2-네이티브-쿼리-사용"><a href="#2-네이티브-쿼리-사용" class="headerlink" title="2. 네이티브 쿼리 사용"></a>2. 네이티브 쿼리 사용</h3><p>복잡한 그룹화가 필요한 경우 네이티브 쿼리 고려:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(value = &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    SELECT o.order_id, o.item_name, o.quantity</span></span><br><span class="line"><span class="meta">    FROM order_items o</span></span><br><span class="line"><span class="meta">    WHERE o.order_id IN :orderIds</span></span><br><span class="line"><span class="meta">    ORDER BY o.order_id</span></span><br><span class="line"><span class="meta">    &quot;&quot;&quot;, nativeQuery = true)</span></span><br><span class="line">List&lt;OrderItemProjection&gt; <span class="title function_">findOrderItemsByOrderIds</span><span class="params">(<span class="meta">@Param(&quot;orderIds&quot;)</span> List&lt;Long&gt; orderIds)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 애플리케이션에서 그룹화</span></span><br><span class="line"><span class="keyword">return</span> items.stream()</span><br><span class="line">    .collect(Collectors.groupingBy(OrderItemProjection::getOrderId));</span><br></pre></td></tr></table></figure><h3 id="3-Projection과-Tuple-사용"><a href="#3-Projection과-Tuple-사용" class="headerlink" title="3. Projection과 Tuple 사용"></a>3. Projection과 Tuple 사용</h3><p>필요한 컬럼만 조회하여 메모리 효율성 향상:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Long, List&lt;OrderItemDto&gt;&gt; <span class="title function_">getOrderItemsByOrderId</span><span class="params">(List&lt;Long&gt; orderIds)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryFactory</span><br><span class="line">        .select(</span><br><span class="line">            orderItem.orderId,</span><br><span class="line">            orderItem.itemName,</span><br><span class="line">            orderItem.quantity</span><br><span class="line">        )</span><br><span class="line">        .from(orderItem)</span><br><span class="line">        .where(orderItem.orderId.in(orderIds))</span><br><span class="line">        .fetch()  <span class="comment">// fetch() 사용</span></span><br><span class="line">        .stream()</span><br><span class="line">        .map(tuple -&gt; <span class="keyword">new</span> <span class="title class_">OrderItemDto</span>(</span><br><span class="line">            tuple.get(orderItem.orderId),</span><br><span class="line">            tuple.get(orderItem.itemName),</span><br><span class="line">            tuple.get(orderItem.quantity)</span><br><span class="line">        ))</span><br><span class="line">        .collect(Collectors.groupingBy(OrderItemDto::getOrderId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="실전-예시-환불-처리"><a href="#실전-예시-환불-처리" class="headerlink" title="실전 예시: 환불 처리"></a>실전 예시: 환불 처리</h2><p>실제 프로덕션 환경에서 발생했던 환불 처리 코드를 개선한 예시입니다.</p><h3 id="문제가-있던-코드"><a href="#문제가-있던-코드" class="headerlink" title="문제가 있던 코드"></a>문제가 있던 코드</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefundService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Transactional 없음 - 문제 발생!</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processRefund</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 주문 아이템 조회 - transform() 사용</span></span><br><span class="line">        Map&lt;Long, List&lt;OrderItem&gt;&gt; orderItems = queryFactory</span><br><span class="line">            .selectFrom(orderItem)</span><br><span class="line">            .where(orderItem.orderId.eq(orderId))</span><br><span class="line">            .transform(</span><br><span class="line">                groupBy(orderItem.productId)</span><br><span class="line">                .as(list(orderItem))</span><br><span class="line">            );  <span class="comment">// 커넥션 반환 안됨!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 환불 처리 로직</span></span><br><span class="line">        orderItems.forEach((productId, items) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 환불 처리...</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 환불 이력 저장</span></span><br><span class="line">        saveRefundHistory(orderId, orderItems);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>문제점:</strong></p><ul><li>동시에 여러 환불 요청이 들어오면 커넥션 고갈</li><li>환불 이력 저장이 실패하는 현상 발생</li></ul><h3 id="개선된-코드"><a href="#개선된-코드" class="headerlink" title="개선된 코드"></a>개선된 코드</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefundService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JPAQueryFactory queryFactory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RefundHistoryRepository refundHistoryRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 추가!</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processRefund</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 주문 아이템 조회 - transform() 사용해도 안전</span></span><br><span class="line">        Map&lt;Long, List&lt;OrderItem&gt;&gt; orderItemsByProduct = queryFactory</span><br><span class="line">            .selectFrom(orderItem)</span><br><span class="line">            .where(orderItem.orderId.eq(orderId))</span><br><span class="line">            .transform(</span><br><span class="line">                groupBy(orderItem.productId)</span><br><span class="line">                .as(list(orderItem))</span><br><span class="line">            );  <span class="comment">// 메서드 종료 시 커넥션 자동 반환</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 환불 처리 로직</span></span><br><span class="line">        List&lt;RefundHistory&gt; histories = orderItemsByProduct.entrySet()</span><br><span class="line">            .stream()</span><br><span class="line">            .map(entry -&gt; processRefundForProduct(entry.getKey(), entry.getValue()))</span><br><span class="line">            .toList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 환불 이력 일괄 저장 (같은 트랜잭션)</span></span><br><span class="line">        refundHistoryRepository.saveAll(histories);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RefundHistory <span class="title function_">processRefundForProduct</span><span class="params">(Long productId, List&lt;OrderItem&gt; items)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalAmount</span> <span class="operator">=</span> items.stream()</span><br><span class="line">            .mapToInt(OrderItem::getAmount)</span><br><span class="line">            .sum();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> RefundHistory.builder()</span><br><span class="line">            .productId(productId)</span><br><span class="line">            .itemCount(items.size())</span><br><span class="line">            .totalAmount(totalAmount)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>개선 효과:</strong></p><ul><li>커넥션 누수 완전 해결</li><li>환불 처리와 이력 저장이 하나의 트랜잭션으로 묶임</li><li>원자성 보장 (전체 성공 또는 전체 롤백)</li></ul><h2 id="모니터링-및-탐지"><a href="#모니터링-및-탐지" class="headerlink" title="모니터링 및 탐지"></a>모니터링 및 탐지</h2><h3 id="HikariCP-메트릭-설정"><a href="#HikariCP-메트릭-설정" class="headerlink" title="HikariCP 메트릭 설정"></a>HikariCP 메트릭 설정</h3><p>커넥션 풀 상태를 모니터링하여 문제를 조기에 발견:</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="comment"># 커넥션 풀 설정</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 커넥션 누수 탐지</span></span><br><span class="line">      <span class="attr">leak-detection-threshold:</span> <span class="number">60000</span>  <span class="comment"># 60초</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 메트릭 활성화</span></span><br><span class="line">      <span class="attr">register-mbeans:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">metrics,</span> <span class="string">health</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">export:</span></span><br><span class="line">      <span class="attr">prometheus:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="커넥션-풀-상태-모니터링"><a href="#커넥션-풀-상태-모니터링" class="headerlink" title="커넥션 풀 상태 모니터링"></a>커넥션 풀 상태 모니터링</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitoringController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HikariDataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/admin/hikari-stats&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getHikariStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HikariPoolMXBean</span> <span class="variable">poolMXBean</span> <span class="operator">=</span> dataSource.getHikariPoolMXBean();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Map.of(</span><br><span class="line">            <span class="string">&quot;activeConnections&quot;</span>, poolMXBean.getActiveConnections(),</span><br><span class="line">            <span class="string">&quot;idleConnections&quot;</span>, poolMXBean.getIdleConnections(),</span><br><span class="line">            <span class="string">&quot;totalConnections&quot;</span>, poolMXBean.getTotalConnections(),</span><br><span class="line">            <span class="string">&quot;threadsAwaitingConnection&quot;</span>, poolMXBean.getThreadsAwaitingConnection()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="경고-알림-설정"><a href="#경고-알림-설정" class="headerlink" title="경고 알림 설정"></a>경고 알림 설정</h3><p>Prometheus + Grafana를 사용한 알림 설정:</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># prometheus-alert.yml</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hikari_connection_pool</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HikariConnectionPoolExhausted</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">hikari_pool_total_connections</span> <span class="string">&gt;=</span> <span class="string">hikari_pool_max_connections</span> <span class="string">*</span> <span class="number">0.9</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;HikariCP connection pool nearly exhausted&quot;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">&quot;Pool usage is at <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>%&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HikariConnectionLeakSuspected</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">hikari_pool_active_connections</span> <span class="string">&gt;</span> <span class="number">0</span> <span class="string">and</span> <span class="string">rate(hikari_pool_active_connections[5m])</span> <span class="string">&gt;</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;Possible connection leak detected&quot;</span></span><br></pre></td></tr></table></figure><h2 id="체크리스트"><a href="#체크리스트" class="headerlink" title="체크리스트"></a>체크리스트</h2><p>QueryDSL을 사용할 때 확인해야 할 사항들:</p><ul><li><input disabled="" type="checkbox"> <code>transform()</code> 메서드를 사용하는 모든 메서드에 <code>@Transactional</code> 추가</li><li><input disabled="" type="checkbox"> <code>readOnly = true</code> 설정으로 읽기 전용 명시</li><li><input disabled="" type="checkbox"> HikariCP leak detection 설정 활성화</li><li><input disabled="" type="checkbox"> 커넥션 풀 메트릭 모니터링 구성</li><li><input disabled="" type="checkbox"> 대용량 데이터 처리 시 페이징 고려</li><li><input disabled="" type="checkbox"> 테스트 환경에서 동시성 테스트 수행</li></ul><h2 id="교훈과-베스트-프랙티스"><a href="#교훈과-베스트-프랙티스" class="headerlink" title="교훈과 베스트 프랙티스"></a>교훈과 베스트 프랙티스</h2><h3 id="1-QueryDSL-메서드-이해"><a href="#1-QueryDSL-메서드-이해" class="headerlink" title="1. QueryDSL 메서드 이해"></a>1. QueryDSL 메서드 이해</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ✅ 안전 - 자동 리소스 정리</span></span><br><span class="line">queryFactory.selectFrom(entity).fetch()</span><br><span class="line">queryFactory.selectFrom(entity).fetchOne()</span><br><span class="line">queryFactory.selectFrom(entity).fetchFirst()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ⚠️ 주의 필요 - @Transactional 필수</span></span><br><span class="line">queryFactory.selectFrom(entity).transform(...)</span><br><span class="line">queryFactory.selectFrom(entity).iterate()</span><br></pre></td></tr></table></figure><h3 id="2-트랜잭션-경계-명확히"><a href="#2-트랜잭션-경계-명확히" class="headerlink" title="2. 트랜잭션 경계 명확히"></a>2. 트랜잭션 경계 명확히</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ❌ 나쁜 예</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 트랜잭션 없이 transform() 사용</span></span><br><span class="line">    Map&lt;Long, List&lt;Entity&gt;&gt; map = queryFactory</span><br><span class="line">        .selectFrom(entity)</span><br><span class="line">        .transform(groupBy(entity.id).as(list(entity)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 좋은 예</span></span><br><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;Long, List&lt;Entity&gt;&gt; map = queryFactory</span><br><span class="line">        .selectFrom(entity)</span><br><span class="line">        .transform(groupBy(entity.id).as(list(entity)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-적절한-커넥션-풀-크기-설정"><a href="#3-적절한-커넥션-풀-크기-설정" class="headerlink" title="3. 적절한 커넥션 풀 크기 설정"></a>3. 적절한 커넥션 풀 크기 설정</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HikariCP 권장 공식</span></span><br><span class="line">connections = ((core_count * <span class="number">2</span>) + effective_spindle_count)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 예시: 4코어 CPU, SSD 사용</span></span><br><span class="line"><span class="comment">// connections = (4 * 2) + 1 = 9</span></span><br><span class="line"><span class="comment">// 여유를 두어 10~20 설정</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="4-페이징-처리"><a href="#4-페이징-처리" class="headerlink" title="4. 페이징 처리"></a>4. 페이징 처리</h3><p>대용량 데이터를 처리할 때는 페이징 고려:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Long, List&lt;OrderItem&gt;&gt; <span class="title function_">getOrderItemsByOrderIdWithPaging</span><span class="params">(</span></span><br><span class="line"><span class="params">    List&lt;Long&gt; orderIds,</span></span><br><span class="line"><span class="params">    <span class="type">int</span> pageSize</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    Map&lt;Long, List&lt;OrderItem&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; orderIds.size(); i += pageSize) &#123;</span><br><span class="line">        List&lt;Long&gt; batch = orderIds.subList(</span><br><span class="line">            i,</span><br><span class="line">            Math.min(i + pageSize, orderIds.size())</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        Map&lt;Long, List&lt;OrderItem&gt;&gt; batchResult = queryFactory</span><br><span class="line">            .selectFrom(orderItem)</span><br><span class="line">            .where(orderItem.orderId.in(batch))</span><br><span class="line">            .transform(groupBy(orderItem.orderId).as(list(orderItem)));</span><br><span class="line"></span><br><span class="line">        result.putAll(batchResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Spring/">Spring</category>
      
      <category domain="https://ckck803.github.io/categories/Spring/QueryDSL/">QueryDSL</category>
      
      <category domain="https://ckck803.github.io/categories/Spring/QueryDSL/JPA/">JPA</category>
      
      
      
      <comments>https://ckck803.github.io/2025/12/25/spring/querydsl-transform-connection-leak/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[Spring Boot] 애플리케이션 Warm Up 가이드</title>
      <link>https://ckck803.github.io/2025/12/25/spring/spring-boot-warmup/</link>
      <guid>https://ckck803.github.io/2025/12/25/spring/spring-boot-warmup/</guid>
      <pubDate>Wed, 24 Dec 2025 15:00:00 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;참고-IF-kakao-2022&quot;&gt;&lt;a href=&quot;#참고-IF-kakao-2022&quot; class=&quot;headerlink&quot; title=&quot;참고 - IF(kakao) 2022&quot;&gt;&lt;/a&gt;참고 - IF(kakao) 2022&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=CQi3SS2YspY&quot;&gt;https://www.youtube.com/watch?v=CQi3SS2YspY&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;🤔-Warm-Up이-필요한-주요-이유&quot;&gt;&lt;a href=&quot;#🤔-Warm-Up이-필요한-주요-이유&quot; class=&quot;headerlink&quot; title=&quot;🤔 Warm Up이 필요한 주요 이유&quot;&gt;&lt;/a&gt;🤔 Warm Up이 필요한 주요 이유&lt;/h2&gt;&lt;p&gt;Spring Boot 와 같은 JAVA 애플리케이션을 최초 실행하거나 재배포할 때, 첫 번째 요청이 다른 요청들에 비해 현저히 느린 현상을 경험한 적이 있을 것입니다. 이러한 현상을 &lt;code&gt;Cold Start&lt;/code&gt; 문제라고 하며, 이를 해결하기 위해 Warm Up이 필요합니다.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/java/jvm-compile.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-JVM-의-JIT-Just-In-Time-컴파일&quot;&gt;&lt;a href=&quot;#1-JVM-의-JIT-Just-In-Time-컴파일&quot; class=&quot;headerlink&quot; title=&quot;1. JVM 의 JIT (Just-In-Time) 컴파일&quot;&gt;&lt;/a&gt;1. JVM 의 JIT (Just-In-Time) 컴파일&lt;/h2&gt;&lt;p&gt;Java 애플리케이션은 &lt;code&gt;바이트코드&lt;/code&gt; 로 컴파일되어 실행되며, JVM은 런타임에 자주 사용되는 코드를 &lt;code&gt;네이티브 코드&lt;/code&gt; 로 최적화합니다.&lt;/p&gt;
&lt;p&gt;초기에는 &lt;code&gt;인터프리터 모드&lt;/code&gt; 로 실행되어 바이트 코드를 한줄 한줄 해석하기 때문에 성능이 상대적으로 낮습니다. JIT 컴파일러가 자주 실행되는 코드 &lt;code&gt;핫스팟(Hot Spot)&lt;/code&gt; 을 식별하고 최적화된 네이티브 코드로 전환됩니다.&lt;/p&gt;
&lt;p&gt;때문에 애플리케이션 구동 후 JIT 컴파일러가 &lt;strong&gt;핫스팟(Hot Spot)&lt;/strong&gt; 을 식별하고 최적화하는 전까지는 상대적으로 느릴 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/java/jit-compile.png&quot; alt=&quot;Native 코드로 변환되는 과정&quot;&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="참고-IF-kakao-2022"><a href="#참고-IF-kakao-2022" class="headerlink" title="참고 - IF(kakao) 2022"></a>참고 - IF(kakao) 2022</h2><ul><li><a href="https://www.youtube.com/watch?v=CQi3SS2YspY">https://www.youtube.com/watch?v=CQi3SS2YspY</a></li></ul><h2 id="🤔-Warm-Up이-필요한-주요-이유"><a href="#🤔-Warm-Up이-필요한-주요-이유" class="headerlink" title="🤔 Warm Up이 필요한 주요 이유"></a>🤔 Warm Up이 필요한 주요 이유</h2><p>Spring Boot 와 같은 JAVA 애플리케이션을 최초 실행하거나 재배포할 때, 첫 번째 요청이 다른 요청들에 비해 현저히 느린 현상을 경험한 적이 있을 것입니다. 이러한 현상을 <code>Cold Start</code> 문제라고 하며, 이를 해결하기 위해 Warm Up이 필요합니다.</p><p><img src="/images/java/jvm-compile.png"></p><h2 id="1-JVM-의-JIT-Just-In-Time-컴파일"><a href="#1-JVM-의-JIT-Just-In-Time-컴파일" class="headerlink" title="1. JVM 의 JIT (Just-In-Time) 컴파일"></a>1. JVM 의 JIT (Just-In-Time) 컴파일</h2><p>Java 애플리케이션은 <code>바이트코드</code> 로 컴파일되어 실행되며, JVM은 런타임에 자주 사용되는 코드를 <code>네이티브 코드</code> 로 최적화합니다.</p><p>초기에는 <code>인터프리터 모드</code> 로 실행되어 바이트 코드를 한줄 한줄 해석하기 때문에 성능이 상대적으로 낮습니다. JIT 컴파일러가 자주 실행되는 코드 <code>핫스팟(Hot Spot)</code> 을 식별하고 최적화된 네이티브 코드로 전환됩니다.</p><p>때문에 애플리케이션 구동 후 JIT 컴파일러가 <strong>핫스팟(Hot Spot)</strong> 을 식별하고 최적화하는 전까지는 상대적으로 느릴 수 있습니다.</p><p><img src="/images/java/jit-compile.png" alt="Native 코드로 변환되는 과정"></p><h2 id="2-클래스-로딩-지연"><a href="#2-클래스-로딩-지연" class="headerlink" title="2. 클래스 로딩 지연"></a>2. 클래스 로딩 지연</h2><p>자바 클래스가 프로그램 시작 시 전부 로딩되는 게 아니라 <strong>처음 실제로 필요해지는 순간</strong> 에 메모리에 로딩 및 초기화되면서 발생하는 지연이 발생합니다.</p><p>클래스 로딩은  로딩 &gt; 링킹 &gt; 초기화 순으로 3단계를 거치게 됩니다.</p><h4 id="1-로딩-Loading"><a href="#1-로딩-Loading" class="headerlink" title="1. 로딩 (Loading)"></a>1. 로딩 (Loading)</h4><p>로딩 단계에서는 클래스 로더가 클래스 파일 <code>.class</code> 을 찾아 바이트코드를 메모리로 읽어옵니다. 로딩 단계에서는 <strong>디스크 I&#x2F;O</strong> 가 발생할 수 있어 시간이 더 지연될 수 있습니다.</p><h4 id="2-링킹-Linking"><a href="#2-링킹-Linking" class="headerlink" title="2. 링킹 (Linking)"></a>2. 링킹 (Linking)</h4><p>링크 단계에서는 바이트코드 검증, 클래스 변수, static 변수 를 위한 메모리 할당 및 기본값으로 초기화, </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 로딩 단계에서는 static 변수 x 의 값이 0 으로 세팅됩니다.</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h4 id="3-초기화-Initialization"><a href="#3-초기화-Initialization" class="headerlink" title="3. 초기화 (Initialization)"></a>3. 초기화 (Initialization)</h4><p>마지막 초기화 단계에서는 정적필드에 실제 값을 세팅합니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 초기화 단계에서야 static 변수 x 의 값이 실제 10으로 세팅 됩니다. </span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><h2 id="3-커넥션-풀-초기화로-인한-지연"><a href="#3-커넥션-풀-초기화로-인한-지연" class="headerlink" title="3. 커넥션 풀 초기화로 인한 지연"></a>3. 커넥션 풀 초기화로 인한 지연</h2><p>애플리케이션은 실행 초기에 minimum-idle 만큼만 커넥션을 생성하는데 이 크기가 작으면 초기에 요청이 몰렸을 시 Connection 이 부족하게 되고 부족한 DB 커넥션을 추가적으로 생성하는 동안 요청에 대한 응답 지연이 발생하게 됩니다. </p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># HikariCP 설정 예시</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="comment"># 애플리케이션 시작 시 minimum-idle 만큼의 커넥션만 생성</span></span><br></pre></td></tr></table></figure><h2 id="4-캐시-웜업"><a href="#4-캐시-웜업" class="headerlink" title="4. 캐시 웜업"></a>4. 캐시 웜업</h2><ul><li>애플리케이션 수준의 캐시(예: Caffeine, EhCache)가 비어있음</li><li>첫 요청들은 캐시 미스로 인해 실제 데이터 소스에 접근</li><li>캐시가 채워지기까지 성능 저하</li></ul><h2 id="Spring-Boot에서-Warm-Up-방법"><a href="#Spring-Boot에서-Warm-Up-방법" class="headerlink" title="Spring Boot에서 Warm Up 방법"></a>Spring Boot에서 Warm Up 방법</h2><h3 id="1-ApplicationRunner-또는-CommandLineRunner-사용"><a href="#1-ApplicationRunner-또는-CommandLineRunner-사용" class="headerlink" title="1. ApplicationRunner 또는 CommandLineRunner 사용"></a>1. ApplicationRunner 또는 CommandLineRunner 사용</h3><p>애플리케이션 시작 후 자동으로 초기화 로직을 실행합니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarmUpRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WarmUpRunner</span><span class="params">(UserService userService, ProductService productService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">        <span class="built_in">this</span>.productService = productService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 주요 API 엔드포인트 호출하여 Bean 초기화</span></span><br><span class="line">        warmUpServices();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 캐시 프리로딩</span></span><br><span class="line">        preloadCache();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// JIT 컴파일 트리거</span></span><br><span class="line">        triggerJitCompilation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUpServices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 주요 서비스 메소드 호출</span></span><br><span class="line">            userService.findById(<span class="number">1L</span>);</span><br><span class="line">            productService.getPopularProducts();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Warm up 실패는 애플리케이션 시작을 막지 않음</span></span><br><span class="line">            log.warn(<span class="string">&quot;Warm up failed&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">preloadCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 자주 사용되는 데이터 미리 캐시에 로드</span></span><br><span class="line">        productService.loadPopularProductsToCache();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">triggerJitCompilation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 반복적으로 메소드 호출하여 JIT 컴파일 유도</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            productService.someHotMethod();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-PostConstruct를-사용한-Bean-초기화"><a href="#2-PostConstruct를-사용한-Bean-초기화" class="headerlink" title="2. @PostConstruct를 사용한 Bean 초기화"></a>2. @PostConstruct를 사용한 Bean 초기화</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheWarmUpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductRepository productRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CacheManager cacheManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheWarmUpService</span><span class="params">(ProductRepository productRepository,</span></span><br><span class="line"><span class="params">                              CacheManager cacheManager)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.productRepository = productRepository;</span><br><span class="line">        <span class="built_in">this</span>.cacheManager = cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">warmUpCache</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Product&gt; popularProducts = productRepository.findPopularProducts();</span><br><span class="line">        <span class="type">Cache</span> <span class="variable">productCache</span> <span class="operator">=</span> cacheManager.getCache(<span class="string">&quot;products&quot;</span>);</span><br><span class="line"></span><br><span class="line">        popularProducts.forEach(product -&gt;</span><br><span class="line">            productCache.put(product.getId(), product)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-스케줄러를-사용한-주기적-Warm-Up"><a href="#3-스케줄러를-사용한-주기적-Warm-Up" class="headerlink" title="3. 스케줄러를 사용한 주기적 Warm Up"></a>3. 스케줄러를 사용한 주기적 Warm Up</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledWarmUp</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScheduledWarmUp</span><span class="params">(RestTemplate restTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 애플리케이션 시작 1분 후 실행</span></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay = 60000, fixedDelay = Long.MAX_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialWarmUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 내부 헬스체크 엔드포인트 호출</span></span><br><span class="line">        restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/actuator/health&quot;</span>, String.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 주요 엔드포인트 호출</span></span><br><span class="line">        restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/api/products&quot;</span>, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-HikariCP-커넥션-풀-사전-초기화"><a href="#4-HikariCP-커넥션-풀-사전-초기화" class="headerlink" title="4. HikariCP 커넥션 풀 사전 초기화"></a>4. HikariCP 커넥션 풀 사전 초기화</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="comment"># 커넥션 풀을 미리 채움</span></span><br><span class="line">      <span class="attr">initialization-fail-timeout:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HikariDataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">        config.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>);</span><br><span class="line">        config.setUsername(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        config.setPassword(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        config.setMinimumIdle(<span class="number">10</span>);</span><br><span class="line">        config.setMaximumPoolSize(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">HikariDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 애플리케이션 시작 시 커넥션 풀 웜업</span></span><br><span class="line">        warmUpConnectionPool(dataSource);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUpConnectionPool</span><span class="params">(HikariDataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            <span class="comment">// 간단한 쿼리로 커넥션 검증</span></span><br><span class="line">            conn.isValid(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Connection pool warm up failed&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-JVM-Warm-Up-옵션"><a href="#5-JVM-Warm-Up-옵션" class="headerlink" title="5. JVM Warm Up 옵션"></a>5. JVM Warm Up 옵션</h3><p>JVM 옵션을 통해 시작 시 최적화를 강화할 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tiered Compilation 활성화 (기본값)</span></span><br><span class="line">java -XX:+TieredCompilation -jar application.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># C2 컴파일러 임계값 낮춤 (더 빠른 최적화)</span></span><br><span class="line">java -XX:CompileThreshold=1000 -jar application.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># AOT(Ahead-of-Time) 컴파일 사용 (Java 17+)</span></span><br><span class="line">java -XX:ArchiveClassesAtExit=app.jsa -jar application.jar</span><br><span class="line">java -XX:SharedArchiveFile=app.jsa -jar application.jar</span><br></pre></td></tr></table></figure><h2 id="Kubernetes에서-Warm-Up-방법"><a href="#Kubernetes에서-Warm-Up-방법" class="headerlink" title="Kubernetes에서 Warm Up 방법"></a>Kubernetes에서 Warm Up 방법</h2><p>Kubernetes 환경에서는 Pod가 준비되기 전에 트래픽을 받지 않도록 하는 것이 중요합니다.</p><h3 id="1-Startup-Probe-사용"><a href="#1-Startup-Probe-사용" class="headerlink" title="1. Startup Probe 사용"></a>1. Startup Probe 사용</h3><p>애플리케이션이 시작되었는지 확인합니다. Startup Probe가 성공할 때까지 Liveness와 Readiness Probe는 비활성화됩니다.</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-boot-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Startup Probe: 애플리케이션이 시작되었는지 확인</span></span><br><span class="line">        <span class="attr">startupProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">30</span>  <span class="comment"># 최대 150초 (30 * 5) 대기</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Readiness Probe: 트래픽을 받을 준비가 되었는지 확인</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/readiness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Liveness Probe: 애플리케이션이 살아있는지 확인</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="2-Readiness-Probe와-Custom-Health-Indicator"><a href="#2-Readiness-Probe와-Custom-Health-Indicator" class="headerlink" title="2. Readiness Probe와 Custom Health Indicator"></a>2. Readiness Probe와 Custom Health Indicator</h3><p>Spring Boot Actuator를 사용하여 커스텀 헬스 체크를 구현합니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarmUpHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">warmedUp</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (warmedUp) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.up()</span><br><span class="line">                .withDetail(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;warmed up&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down()</span><br><span class="line">                .withDetail(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;warming up&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">markAsWarmedUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.warmedUp = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarmUpRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WarmUpHealthIndicator warmUpHealthIndicator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WarmUpRunner</span><span class="params">(WarmUpHealthIndicator warmUpHealthIndicator,</span></span><br><span class="line"><span class="params">                        UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.warmUpHealthIndicator = warmUpHealthIndicator;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Warm up 로직 실행</span></span><br><span class="line">        performWarmUp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Warm up 완료 표시</span></span><br><span class="line">        warmUpHealthIndicator.markAsWarmedUp();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">performWarmUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 주요 서비스 호출</span></span><br><span class="line">        userService.warmUp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 캐시 프리로딩</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">probes:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">readiness:</span></span><br><span class="line">          <span class="attr">include:</span> <span class="string">warmUp,</span> <span class="string">db,</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure><h3 id="3-PreStop-Hook으로-Graceful-Shutdown"><a href="#3-PreStop-Hook으로-Graceful-Shutdown" class="headerlink" title="3. PreStop Hook으로 Graceful Shutdown"></a>3. PreStop Hook으로 Graceful Shutdown</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-boot-app:latest</span></span><br><span class="line">        <span class="attr">lifecycle:</span></span><br><span class="line">          <span class="comment"># 종료 전 처리</span></span><br><span class="line">          <span class="attr">preStop:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;sleep 10&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 종료 유예 시간</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">lifecycle:</span></span><br><span class="line">    <span class="attr">timeout-per-shutdown-phase:</span> <span class="string">20s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">shutdown:</span> <span class="string">graceful</span></span><br></pre></td></tr></table></figure><h3 id="4-Init-Container로-Warm-Up"><a href="#4-Init-Container로-Warm-Up" class="headerlink" title="4. Init Container로 Warm Up"></a>4. Init Container로 Warm Up</h3><p>별도의 Init Container에서 warm up 작업을 수행할 수 있습니다.</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># Init Container: 메인 컨테이너 실행 전 warm up</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">warm-up</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-boot-app:latest</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;java -cp /app/lib/*:/app/classes com.example.WarmUpTool&#x27;</span>]</span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-boot-app:latest</span></span><br></pre></td></tr></table></figure><h3 id="5-HPA-Horizontal-Pod-Autoscaler-와-함께-사용"><a href="#5-HPA-Horizontal-Pod-Autoscaler-와-함께-사용" class="headerlink" title="5. HPA(Horizontal Pod Autoscaler)와 함께 사용"></a>5. HPA(Horizontal Pod Autoscaler)와 함께 사용</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app-hpa</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span></span><br><span class="line">    <span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spring-boot-app</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Resource</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">cpu</span></span><br><span class="line">      <span class="attr">target:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Utilization</span></span><br><span class="line">        <span class="attr">averageUtilization:</span> <span class="number">70</span></span><br><span class="line">  <span class="attr">behavior:</span></span><br><span class="line">    <span class="attr">scaleDown:</span></span><br><span class="line">      <span class="attr">stabilizationWindowSeconds:</span> <span class="number">300</span>  <span class="comment"># 5분간 안정화</span></span><br><span class="line">      <span class="attr">policies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">50</span></span><br><span class="line">        <span class="attr">periodSeconds:</span> <span class="number">60</span></span><br><span class="line">    <span class="attr">scaleUp:</span></span><br><span class="line">      <span class="attr">stabilizationWindowSeconds:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">policies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Percent</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure><h3 id="6-Pod-Disruption-Budget-설정"><a href="#6-Pod-Disruption-Budget-설정" class="headerlink" title="6. Pod Disruption Budget 설정"></a>6. Pod Disruption Budget 설정</h3><p>Rolling Update 중에도 최소한의 Pod를 유지합니다.</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">policy/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PodDisruptionBudget</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app-pdb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minAvailable:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spring-boot-app</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-boot-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">1</span>        <span class="comment"># 최대 1개 추가 Pod</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span>  <span class="comment"># 최대 1개 중단 가능</span></span><br></pre></td></tr></table></figure><h2 id="실전-Warm-Up-전략"><a href="#실전-Warm-Up-전략" class="headerlink" title="실전 Warm Up 전략"></a>실전 Warm Up 전략</h2><h3 id="종합-예시"><a href="#종합-예시" class="headerlink" title="종합 예시"></a>종합 예시</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComprehensiveWarmUpRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataSource dataSource;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CacheManager cacheManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;WarmUpTask&gt; warmUpTasks;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Starting comprehensive warm-up process...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 데이터베이스 커넥션 풀 warm up</span></span><br><span class="line">        warmUpConnectionPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 캐시 프리로딩</span></span><br><span class="line">        warmUpCache();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. HTTP 클라이언트 warm up</span></span><br><span class="line">        warmUpHttpClient();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 커스텀 warm up 태스크 실행</span></span><br><span class="line">        executeCustomWarmUpTasks();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. JIT 컴파일 트리거</span></span><br><span class="line">        triggerJitCompilation();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">        log.info(<span class="string">&quot;Warm-up process completed in &#123;&#125; ms&quot;</span>, duration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUpConnectionPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            conn.isValid(<span class="number">1</span>);</span><br><span class="line">            log.info(<span class="string">&quot;Database connection pool warmed up&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Failed to warm up connection pool&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUpCache</span><span class="params">()</span> &#123;</span><br><span class="line">        warmUpTasks.stream()</span><br><span class="line">            .filter(task -&gt; task.getType() == WarmUpTaskType.CACHE)</span><br><span class="line">            .forEach(WarmUpTask::execute);</span><br><span class="line">        log.info(<span class="string">&quot;Cache warmed up&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">warmUpHttpClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/actuator/health&quot;</span>, String.class);</span><br><span class="line">            log.info(<span class="string">&quot;HTTP client warmed up&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;Failed to warm up HTTP client&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeCustomWarmUpTasks</span><span class="params">()</span> &#123;</span><br><span class="line">        warmUpTasks.forEach(task -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                task.execute();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;Warm up task failed: &#123;&#125;&quot;</span>, task.getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">triggerJitCompilation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 주요 비즈니스 로직을 여러 번 실행하여 JIT 최적화 유도</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 핫 메소드 호출</span></span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;JIT compilation triggered&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WarmUpTask</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">    WarmUpTaskType <span class="title function_">getType</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">WarmUpTaskType</span> &#123;</span><br><span class="line">    CACHE, SERVICE, CLIENT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="모니터링-및-측정"><a href="#모니터링-및-측정" class="headerlink" title="모니터링 및 측정"></a>모니터링 및 측정</h2><p>Warm up 효과를 측정하기 위해 메트릭을 수집합니다.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarmUpMetrics</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WarmUpMetrics</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordWarmUpDuration</span><span class="params">(String taskName, <span class="type">long</span> durationMs)</span> &#123;</span><br><span class="line">        Timer.builder(<span class="string">&quot;warmup.duration&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;task&quot;</span>, taskName)</span><br><span class="line">            .register(meterRegistry)</span><br><span class="line">            .record(durationMs, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementWarmUpSuccess</span><span class="params">(String taskName)</span> &#123;</span><br><span class="line">        Counter.builder(<span class="string">&quot;warmup.success&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;task&quot;</span>, taskName)</span><br><span class="line">            .register(meterRegistry)</span><br><span class="line">            .increment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementWarmUpFailure</span><span class="params">(String taskName)</span> &#123;</span><br><span class="line">        Counter.builder(<span class="string">&quot;warmup.failure&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;task&quot;</span>, taskName)</span><br><span class="line">            .register(meterRegistry)</span><br><span class="line">            .increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>Spring Boot 애플리케이션의 Warm Up은 초기 요청 성능을 개선하고 사용자 경험을 향상시키는 중요한 작업입니다. 특히 Kubernetes와 같은 컨테이너 오케스트레이션 환경에서는 Probe 설정과 함께 적절한 Warm Up 전략을 수립하는 것이 필수적입니다.</p><p>주요 포인트:</p><ul><li>JVM의 JIT 컴파일, 클래스 로딩, 커넥션 풀 등 초기화 비용 고려</li><li>ApplicationRunner, @PostConstruct 등을 활용한 자동화된 Warm Up</li><li>Kubernetes에서는 Startup&#x2F;Readiness Probe와 함께 사용</li><li>실제 비즈니스 로직에 맞는 커스텀 Warm Up 전략 수립</li><li>메트릭 수집을 통한 Warm Up 효과 측정 및 개선</li></ul><p>적절한 Warm Up 전략을 통해 애플리케이션의 가용성과 성능을 크게 향상시킬 수 있습니다.</p>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Spring/">Spring</category>
      
      <category domain="https://ckck803.github.io/categories/Spring/Spring-Boot/">Spring Boot</category>
      
      
      
      <comments>https://ckck803.github.io/2025/12/25/spring/spring-boot-warmup/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Git - Git Hook으로 워크플로우 자동화하기</title>
      <link>https://ckck803.github.io/2025/12/22/git/git-hooks/</link>
      <guid>https://ckck803.github.io/2025/12/22/git/git-hooks/</guid>
      <pubDate>Sun, 21 Dec 2025 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;&lt;img src=&quot;/images/git/git.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Git-Hook이란&quot;&gt;&lt;a href=&quot;#Git-Hook이란&quot; class=&quot;headerlink&quot; title=&quot;Git Hook이란?&quot;&gt;&lt;/a&gt;Git Hook이란?&lt;/h2&gt;&lt;p&gt;Git Hook은 Git에서 특정 이벤트가 발생했을 때 자동으로 실행되는 스크립트입니다. 커밋, 푸시, 머지 등의 작업 전후에 사용자 정의 스크립트를 실행하여 코드 품질 검사, 테스트 자동화, 메시지 검증 등 다양한 워크플로우를 자동화할 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;Git-Hook의-종류&quot;&gt;&lt;a href=&quot;#Git-Hook의-종류&quot; class=&quot;headerlink&quot; title=&quot;Git Hook의 종류&quot;&gt;&lt;/a&gt;Git Hook의 종류&lt;/h2&gt;&lt;p&gt;Git Hook은 크게 &lt;strong&gt;클라이언트 훅(Client-side Hooks)&lt;/strong&gt; 과 &lt;strong&gt;서버 훅(Server-side Hooks)&lt;/strong&gt; 으로 나뉩니다.&lt;/p&gt;
&lt;h3 id=&quot;클라이언트-훅-Client-side-Hooks&quot;&gt;&lt;a href=&quot;#클라이언트-훅-Client-side-Hooks&quot; class=&quot;headerlink&quot; title=&quot;클라이언트 훅 (Client-side Hooks)&quot;&gt;&lt;/a&gt;클라이언트 훅 (Client-side Hooks)&lt;/h3&gt;&lt;p&gt;개발자의 로컬 저장소에서 실행되는 훅입니다.&lt;/p&gt;
&lt;h4 id=&quot;Commit-관련-훅&quot;&gt;&lt;a href=&quot;#Commit-관련-훅&quot; class=&quot;headerlink&quot; title=&quot;Commit 관련 훅&quot;&gt;&lt;/a&gt;Commit 관련 훅&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pre-commit&lt;/strong&gt;: 커밋 메시지 작성 전 실행 (코드 린트, 테스트 실행)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prepare-commit-msg&lt;/strong&gt;: 커밋 메시지 에디터가 열리기 전 실행 (메시지 템플릿 설정)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;commit-msg&lt;/strong&gt;: 커밋 메시지 검증 (메시지 형식 확인)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;post-commit&lt;/strong&gt;: 커밋이 완료된 후 실행 (알림 전송)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;Merge-Rebase-관련-훅&quot;&gt;&lt;a href=&quot;#Merge-Rebase-관련-훅&quot; class=&quot;headerlink&quot; title=&quot;Merge&amp;#x2F;Rebase 관련 훅&quot;&gt;&lt;/a&gt;Merge&amp;#x2F;Rebase 관련 훅&lt;/h4&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p><img src="/images/git/git.png"></p><h2 id="Git-Hook이란"><a href="#Git-Hook이란" class="headerlink" title="Git Hook이란?"></a>Git Hook이란?</h2><p>Git Hook은 Git에서 특정 이벤트가 발생했을 때 자동으로 실행되는 스크립트입니다. 커밋, 푸시, 머지 등의 작업 전후에 사용자 정의 스크립트를 실행하여 코드 품질 검사, 테스트 자동화, 메시지 검증 등 다양한 워크플로우를 자동화할 수 있습니다.</p><h2 id="Git-Hook의-종류"><a href="#Git-Hook의-종류" class="headerlink" title="Git Hook의 종류"></a>Git Hook의 종류</h2><p>Git Hook은 크게 <strong>클라이언트 훅(Client-side Hooks)</strong> 과 <strong>서버 훅(Server-side Hooks)</strong> 으로 나뉩니다.</p><h3 id="클라이언트-훅-Client-side-Hooks"><a href="#클라이언트-훅-Client-side-Hooks" class="headerlink" title="클라이언트 훅 (Client-side Hooks)"></a>클라이언트 훅 (Client-side Hooks)</h3><p>개발자의 로컬 저장소에서 실행되는 훅입니다.</p><h4 id="Commit-관련-훅"><a href="#Commit-관련-훅" class="headerlink" title="Commit 관련 훅"></a>Commit 관련 훅</h4><ul><li><strong>pre-commit</strong>: 커밋 메시지 작성 전 실행 (코드 린트, 테스트 실행)</li><li><strong>prepare-commit-msg</strong>: 커밋 메시지 에디터가 열리기 전 실행 (메시지 템플릿 설정)</li><li><strong>commit-msg</strong>: 커밋 메시지 검증 (메시지 형식 확인)</li><li><strong>post-commit</strong>: 커밋이 완료된 후 실행 (알림 전송)</li></ul><h4 id="Merge-Rebase-관련-훅"><a href="#Merge-Rebase-관련-훅" class="headerlink" title="Merge&#x2F;Rebase 관련 훅"></a>Merge&#x2F;Rebase 관련 훅</h4><ul><li><strong>pre-merge-commit</strong>: 머지 커밋 생성 전 실행</li><li><strong>post-merge</strong>: 머지가 완료된 후 실행 (의존성 업데이트)</li><li><strong>pre-rebase</strong>: 리베이스 전 실행</li></ul><h4 id="Push-관련-훅"><a href="#Push-관련-훅" class="headerlink" title="Push 관련 훅"></a>Push 관련 훅</h4><ul><li><strong>pre-push</strong>: 푸시 전 실행 (원격 저장소 업데이트 전 검증)</li></ul><h4 id="기타-훅"><a href="#기타-훅" class="headerlink" title="기타 훅"></a>기타 훅</h4><ul><li><strong>pre-auto-gc</strong>: Git의 자동 가비지 컬렉션 전 실행</li><li><strong>post-checkout</strong>: 브랜치 체크아웃 후 실행</li><li><strong>post-rewrite</strong>: 커밋을 재작성하는 명령 후 실행</li></ul><h3 id="서버-훅-Server-side-Hooks"><a href="#서버-훅-Server-side-Hooks" class="headerlink" title="서버 훅 (Server-side Hooks)"></a>서버 훅 (Server-side Hooks)</h3><p>원격 저장소(서버)에서 실행되는 훅입니다.</p><ul><li><strong>pre-receive</strong>: 푸시를 받기 전 실행 (푸시 거부 가능)</li><li><strong>update</strong>: 각 브랜치별로 실행 (브랜치 단위 검증)</li><li><strong>post-receive</strong>: 푸시가 완료된 후 실행 (배포, 알림)</li></ul><h2 id="Hook-파일-위치"><a href="#Hook-파일-위치" class="headerlink" title="Hook 파일 위치"></a>Hook 파일 위치</h2><p>Git Hook 스크립트는 <code>.git/hooks/</code> 디렉토리에 저장됩니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Hook 디렉토리 확인</span></span><br><span class="line"><span class="built_in">ls</span> -la .git/hooks/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 샘플 파일들</span></span><br><span class="line">.git/hooks/pre-commit.sample</span><br><span class="line">.git/hooks/commit-msg.sample</span><br><span class="line">.git/hooks/pre-push.sample</span><br></pre></td></tr></table></figure><p>샘플 파일의 <code>.sample</code> 확장자를 제거하면 활성화됩니다.</p><h2 id="Git-Hook-작성-예시"><a href="#Git-Hook-작성-예시" class="headerlink" title="Git Hook 작성 예시"></a>Git Hook 작성 예시</h2><h3 id="1-Pre-commit-Hook-코드-품질-검사"><a href="#1-Pre-commit-Hook-코드-품질-검사" class="headerlink" title="1. Pre-commit Hook - 코드 품질 검사"></a>1. Pre-commit Hook - 코드 품질 검사</h3><p>커밋 전 자동으로 린트와 테스트를 실행합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-commit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running pre-commit checks...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JavaScript/TypeScript 프로젝트</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;package.json&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Running ESLint...&quot;</span></span><br><span class="line">    npm run lint</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;❌ ESLint check failed. Please fix the errors and try again.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Running tests...&quot;</span></span><br><span class="line">    npm <span class="built_in">test</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;❌ Tests failed. Please fix the tests and try again.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 프로젝트</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;requirements.txt&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Running flake8...&quot;</span></span><br><span class="line">    flake8 .</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;❌ Flake8 check failed.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Trailing whitespace 제거</span></span><br><span class="line">git diff --check</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Detected trailing whitespace. Please remove it.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ All pre-commit checks passed!&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-Commit-msg-Hook-커밋-메시지-검증"><a href="#2-Commit-msg-Hook-커밋-메시지-검증" class="headerlink" title="2. Commit-msg Hook - 커밋 메시지 검증"></a>2. Commit-msg Hook - 커밋 메시지 검증</h3><p>Conventional Commits 형식을 강제합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/commit-msg</span></span><br><span class="line"></span><br><span class="line">commit_msg_file=<span class="variable">$1</span></span><br><span class="line">commit_msg=$(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$commit_msg_file</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Conventional Commits 패턴</span></span><br><span class="line"><span class="comment"># feat: 새로운 기능</span></span><br><span class="line"><span class="comment"># fix: 버그 수정</span></span><br><span class="line"><span class="comment"># docs: 문서 변경</span></span><br><span class="line"><span class="comment"># style: 코드 포맷팅</span></span><br><span class="line"><span class="comment"># refactor: 리팩토링</span></span><br><span class="line"><span class="comment"># test: 테스트 추가</span></span><br><span class="line"><span class="comment"># chore: 빌드 업무, 패키지 매니저 설정</span></span><br><span class="line"></span><br><span class="line">pattern=<span class="string">&quot;^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .&#123;1,50&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$commit_msg</span>&quot;</span> | grep -qE <span class="string">&quot;<span class="variable">$pattern</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Invalid commit message format!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Commit message must follow Conventional Commits format:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  &lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Examples:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  feat: add user authentication&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  fix(api): resolve CORS issue&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  docs: update README&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ Commit message format is valid&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-Pre-push-Hook-푸시-전-검증"><a href="#3-Pre-push-Hook-푸시-전-검증" class="headerlink" title="3. Pre-push Hook - 푸시 전 검증"></a>3. Pre-push Hook - 푸시 전 검증</h3><p>원격 저장소에 푸시하기 전 모든 테스트를 실행합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-push</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running pre-push checks...&quot;</span></span><br><span class="line"></span><br><span class="line">protected_branch=<span class="string">&#x27;main&#x27;</span></span><br><span class="line">current_branch=$(git symbolic-ref HEAD | sed -e <span class="string">&#x27;s,.*/\(.*\),\1,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># main 브랜치 직접 푸시 방지</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$current_branch</span>&quot;</span> = <span class="string">&quot;<span class="variable">$protected_branch</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Direct push to main branch is not allowed!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Please create a feature branch and open a pull request.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 테스트 실행</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running full test suite...&quot;</span></span><br><span class="line">npm run <span class="built_in">test</span>:ci</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Tests failed. Push aborted.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 빌드 테스트</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Testing build...&quot;</span></span><br><span class="line">npm run build</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Build failed. Push aborted.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ All pre-push checks passed!&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-Post-merge-Hook-머지-후-의존성-업데이트"><a href="#4-Post-merge-Hook-머지-후-의존성-업데이트" class="headerlink" title="4. Post-merge Hook - 머지 후 의존성 업데이트"></a>4. Post-merge Hook - 머지 후 의존성 업데이트</h3><p>브랜치 머지 후 자동으로 의존성을 설치합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/post-merge</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Checking for dependency changes...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># package.json 또는 package-lock.json 변경 확인</span></span><br><span class="line">changed_files=<span class="string">&quot;<span class="subst">$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_run</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$changed_files</span>&quot;</span> | grep --quiet <span class="string">&quot;<span class="variable">$1</span>&quot;</span> &amp;&amp; <span class="built_in">eval</span> <span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Node.js 의존성 업데이트</span></span><br><span class="line">check_run package.json <span class="string">&quot;echo &#x27;📦 package.json changed. Running npm install...&#x27; &amp;&amp; npm install&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 의존성 업데이트</span></span><br><span class="line">check_run requirements.txt <span class="string">&quot;echo &#x27;📦 requirements.txt changed. Running pip install...&#x27; &amp;&amp; pip install -r requirements.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Go 모듈 업데이트</span></span><br><span class="line">check_run go.mod <span class="string">&quot;echo &#x27;📦 go.mod changed. Running go mod download...&#x27; &amp;&amp; go mod download&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ Post-merge checks completed!&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5-Prepare-commit-msg-Hook-이슈-번호-자동-추가"><a href="#5-Prepare-commit-msg-Hook-이슈-번호-자동-추가" class="headerlink" title="5. Prepare-commit-msg Hook - 이슈 번호 자동 추가"></a>5. Prepare-commit-msg Hook - 이슈 번호 자동 추가</h3><p>브랜치 이름에서 이슈 번호를 추출하여 커밋 메시지에 자동으로 추가합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/prepare-commit-msg</span></span><br><span class="line"></span><br><span class="line">commit_msg_file=<span class="variable">$1</span></span><br><span class="line">commit_source=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 머지 커밋이면 스킵</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$commit_source</span>&quot;</span> = <span class="string">&quot;merge&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 브랜치 이름에서 이슈 번호 추출 (예: feature/ISSUE-123-description)</span></span><br><span class="line">branch_name=$(git symbolic-ref --short HEAD)</span><br><span class="line">issue_number=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$branch_name</span>&quot;</span> | grep -o -E <span class="string">&#x27;[A-Z]+-[0-9]+&#x27;</span> | <span class="built_in">head</span> -1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$issue_number</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 기존 메시지 읽기</span></span><br><span class="line">    commit_msg=$(<span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$commit_msg_file</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이미 이슈 번호가 있으면 스킵</span></span><br><span class="line">    <span class="keyword">if</span> ! <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$commit_msg</span>&quot;</span> | grep -q <span class="string">&quot;<span class="variable">$issue_number</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># 이슈 번호 추가</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$commit_msg</span>&quot;</span> | sed <span class="string">&quot;1s/^/[<span class="variable">$issue_number</span>] /&quot;</span> &gt; <span class="string">&quot;<span class="variable">$commit_msg_file</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;✅ Added issue number: <span class="variable">$issue_number</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="Hook-파일-실행-권한-부여"><a href="#Hook-파일-실행-권한-부여" class="headerlink" title="Hook 파일 실행 권한 부여"></a>Hook 파일 실행 권한 부여</h2><p>Hook 스크립트를 작성한 후 실행 권한을 부여해야 합니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x .git/hooks/pre-commit</span><br><span class="line"><span class="built_in">chmod</span> +x .git/hooks/commit-msg</span><br><span class="line"><span class="built_in">chmod</span> +x .git/hooks/pre-push</span><br><span class="line"><span class="built_in">chmod</span> +x .git/hooks/post-merge</span><br></pre></td></tr></table></figure><h2 id="Hook-공유하기"><a href="#Hook-공유하기" class="headerlink" title="Hook 공유하기"></a>Hook 공유하기</h2><p><code>.git/hooks/</code> 디렉토리는 Git으로 추적되지 않아 팀원과 공유할 수 없습니다. 다음 방법으로 Hook을 공유할 수 있습니다.</p><h3 id="방법-1-스크립트를-저장소에-포함"><a href="#방법-1-스크립트를-저장소에-포함" class="headerlink" title="방법 1: 스크립트를 저장소에 포함"></a>방법 1: 스크립트를 저장소에 포함</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 프로젝트 루트에 hooks 디렉토리 생성</span></span><br><span class="line"><span class="built_in">mkdir</span> -p .githooks</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hook 스크립트를 .githooks에 작성</span></span><br><span class="line"><span class="comment"># .githooks/pre-commit</span></span><br><span class="line"><span class="comment"># .githooks/commit-msg</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Git 설정 변경</span></span><br><span class="line">git config core.hooksPath .githooks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 팀원도 동일하게 설정</span></span><br></pre></td></tr></table></figure><h3 id="방법-2-설치-스크립트-제공"><a href="#방법-2-설치-스크립트-제공" class="headerlink" title="방법 2: 설치 스크립트 제공"></a>방법 2: 설치 스크립트 제공</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># scripts/install-hooks.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installing Git hooks...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hooks 복사</span></span><br><span class="line"><span class="built_in">cp</span> scripts/hooks/* .git/hooks/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실행 권한 부여</span></span><br><span class="line"><span class="built_in">chmod</span> +x .git/hooks/*</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ Git hooks installed successfully!&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prepare&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sh scripts/install-hooks.sh&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="방법-3-Husky-사용-Node-js-프로젝트"><a href="#방법-3-Husky-사용-Node-js-프로젝트" class="headerlink" title="방법 3: Husky 사용 (Node.js 프로젝트)"></a>방법 3: Husky 사용 (Node.js 프로젝트)</h3><p>Husky는 Git Hook을 쉽게 관리할 수 있는 도구입니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Husky 설치</span></span><br><span class="line">npm install --save-dev husky</span><br><span class="line"></span><br><span class="line"><span class="comment"># Husky 초기화</span></span><br><span class="line">npx husky init</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hook 추가</span></span><br><span class="line">npx husky add .husky/pre-commit <span class="string">&quot;npm run lint&quot;</span></span><br><span class="line">npx husky add .husky/commit-msg <span class="string">&#x27;npx --no -- commitlint --edit &quot;$1&quot;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prepare&quot;</span><span class="punctuation">:</span> <span class="string">&quot;husky install&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="다양한-언어로-Hook-작성"><a href="#다양한-언어로-Hook-작성" class="headerlink" title="다양한 언어로 Hook 작성"></a>다양한 언어로 Hook 작성</h2><h3 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running bash hook&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Running Python hook&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    sys.exit(main())</span><br></pre></td></tr></table></figure><h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Running Node.js hook&#x27;</span>);</span><br><span class="line">process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;Running Ruby hook&quot;</span></span><br><span class="line">exit <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="Hook-우회하기"><a href="#Hook-우회하기" class="headerlink" title="Hook 우회하기"></a>Hook 우회하기</h2><p>테스트나 긴급한 상황에서 Hook을 일시적으로 우회할 수 있습니다.</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --no-verify 또는 -n 옵션 사용</span></span><br><span class="line">git commit --no-verify -m <span class="string">&quot;urgent fix&quot;</span></span><br><span class="line">git commit -n -m <span class="string">&quot;urgent fix&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 푸시 시</span></span><br><span class="line">git push --no-verify</span><br></pre></td></tr></table></figure><p><strong>주의</strong>: 프로덕션 환경에서는 Hook을 우회하지 않는 것이 좋습니다.</p><h2 id="실전-활용-예시"><a href="#실전-활용-예시" class="headerlink" title="실전 활용 예시"></a>실전 활용 예시</h2><h3 id="보안-검사-Gitleaks-통합"><a href="#보안-검사-Gitleaks-통합" class="headerlink" title="보안 검사 - Gitleaks 통합"></a>보안 검사 - Gitleaks 통합</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-commit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running Gitleaks security scan...&quot;</span></span><br><span class="line"></span><br><span class="line">gitleaks protect --verbose --redact --staged</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Gitleaks detected sensitive information.&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Please remove secrets before committing.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ No secrets detected&quot;</span></span><br></pre></td></tr></table></figure><h3 id="코드-포맷팅-Prettier-자동-실행"><a href="#코드-포맷팅-Prettier-자동-실행" class="headerlink" title="코드 포맷팅 - Prettier 자동 실행"></a>코드 포맷팅 - Prettier 자동 실행</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-commit</span></span><br><span class="line"></span><br><span class="line">files=$(git diff --cached --name-only --diff-filter=ACMR | grep -E <span class="string">&#x27;\.(js|jsx|ts|tsx|json|css|md)$&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$files</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Formatting files with Prettier...&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$files</span>&quot;</span> | xargs npx prettier --write</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$files</span>&quot;</span> | xargs git add</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;✅ Files formatted&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="브랜치-네이밍-검증"><a href="#브랜치-네이밍-검증" class="headerlink" title="브랜치 네이밍 검증"></a>브랜치 네이밍 검증</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-push</span></span><br><span class="line"></span><br><span class="line">branch_name=$(git symbolic-ref --short HEAD)</span><br><span class="line">valid_pattern=<span class="string">&quot;^(feature|bugfix|hotfix|release)/[a-z0-9-]+$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$branch_name</span>&quot;</span> | grep -qE <span class="string">&quot;<span class="variable">$valid_pattern</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ Invalid branch name: <span class="variable">$branch_name</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Branch name must follow pattern: type/description&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Valid types: feature, bugfix, hotfix, release&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Example: feature/user-authentication&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ Branch name is valid&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Hook-디버깅"><a href="#Hook-디버깅" class="headerlink" title="Hook 디버깅"></a>Hook 디버깅</h2><p>Hook이 제대로 동작하지 않을 때 디버깅 방법:</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Hook 스크립트에 디버그 모드 추가</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">set</span> -x  <span class="comment"># 모든 명령어 출력</span></span><br><span class="line"><span class="built_in">set</span> -e  <span class="comment"># 에러 발생 시 즉시 중단</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그 파일 생성</span></span><br><span class="line"><span class="built_in">exec</span> 2&gt; /tmp/git-hook-debug.log</span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 환경 변수 확인</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PATH: <span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PWD: <span class="variable">$PWD</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 스크립트 내용...</span></span><br></pre></td></tr></table></figure><h2 id="베스트-프랙티스"><a href="#베스트-프랙티스" class="headerlink" title="베스트 프랙티스"></a>베스트 프랙티스</h2><ol><li><strong>빠른 실행</strong>: Hook은 자주 실행되므로 빠르게 동작해야 합니다</li><li><strong>명확한 에러 메시지</strong>: 실패 시 개발자가 문제를 쉽게 파악할 수 있도록 작성</li><li><strong>점진적 도입</strong>: 처음에는 경고만 출력하고, 팀이 적응한 후 강제 적용</li><li><strong>문서화</strong>: 프로젝트에 어떤 Hook이 설정되어 있는지 README에 명시</li><li><strong>우회 가능</strong>: 긴급 상황을 위해 <code>--no-verify</code> 옵션 사용 가능하도록 유지</li><li><strong>팀 공유</strong>: Husky 등의 도구를 사용하여 팀원 모두가 동일한 Hook 사용</li><li><strong>적절한 범위</strong>: Pre-commit은 빠른 검사만, 전체 테스트는 CI&#x2F;CD에서 수행</li></ol><h2 id="참고-자료"><a href="#참고-자료" class="headerlink" title="참고 자료"></a>참고 자료</h2><ul><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">Git Hooks 공식 문서</a></li><li><a href="https://typicode.github.io/husky/">Husky</a></li><li><a href="https://www.conventionalcommits.org/">Conventional Commits</a></li><li><a href="https://commitlint.js.org/">commitlint</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://ckck803.github.io/categories/Develop/">Develop</category>
      
      <category domain="https://ckck803.github.io/categories/Develop/Git/">Git</category>
      
      
      <category domain="https://ckck803.github.io/tags/Git/">Git</category>
      
      <category domain="https://ckck803.github.io/tags/Automation/">Automation</category>
      
      <category domain="https://ckck803.github.io/tags/Hook/">Hook</category>
      
      
      <comments>https://ckck803.github.io/2025/12/22/git/git-hooks/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
